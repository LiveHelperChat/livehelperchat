{"version":3,"file":"c4d56967822ecb6c3713.js","mappings":"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","sources":["webpack://LiveHelperChat/./src/util/screenShare.js"],"sourcesContent":["import {helperFunctions} from '../lib/helperFunctions';\n\nclass _screenShare {\n    constructor() {\n        this.params = {};\n        this.attributes = null;\n        this.chatEvents = null;\n\n        this.isSharing = false;\n        this.sharemode = 'chat';\n        this.sharehash = null;\n        this.cobrowser = null;\n    }\n\n    startCoBrowse(params) {\n\n        if (typeof formsEnabled == \"undefined\") var formsEnabled = false;\n\n        this.isSharing = true;\n\n        this.cobrowser = new LHCCoBrowser({'formsenabled':formsEnabled,\n                'chat_hash': this.sharehash,\n                'event_emitter': this.attributes.eventEmitter,\n                'nodejssettings': params['nodejssettings'],\n                'nodejsenabled': params['nodejsenabled'],\n                'trans': params['trans'],\n            'url': params['url']+'/(hash)/'+this.sharehash+'/?url='+encodeURIComponent(location.href.match(/^(.*\\/)[^\\/]*$/)[1])});\n        this.cobrowser.startMirroring();\n\n        let listener = (data) => {\n            if (this.cobrowser) {\n                this.cobrowser.handleMessage(data.split(':'));\n            }\n        };\n\n        this.attributes.eventEmitter.addListener('screenshareCommand', listener);\n        \n        this.attributes.eventEmitter.addOnceListener('finishScreenSharing', (data) => {\n\n            helperFunctions.removeById('lhc_status_mirror');\n\n            this.attributes.storageHandler.removeSessionStorage(this.attributes['prefixStorage']+'_screenshare');\n\n            this.isSharing = false;\n  \n            var th = document.getElementsByTagName('head')[0];\n            var s = document.createElement('script');\n            var locationCurrent = encodeURIComponent(window.location.href.substring(window.location.protocol.length));\n            s.setAttribute('id','lhc_finish_shr');\n            s.setAttribute('type','text/javascript');\n            s.setAttribute('src',this.attributes.LHC_API.args.lhc_base_url+'/cobrowse/finishsession/(sharemode)/chat/(hash)/'+this.sharehash);\n            th.appendChild(s);\n\n            this.cobrowser = null;\n\n            this.attributes.eventEmitter.removeListener('screenshareCommand',listener);\n        });\n\n        this.attributes.storageHandler.setSessionStorage(this.attributes['prefixStorage']+'_screenshare',1);\n    }\n\n    setParams(params, attributes, chatEvents) {\n        this.params = params;\n        this.attributes = attributes;\n        this.chatEvents = chatEvents;\n\n        const chatParams = this.attributes['userSession'].getSessionAttributes();\n\n        this.sharehash = chatParams['id'] + '_' + chatParams['hash'];\n\n        if (this.isSharing == false) {\n            helperFunctions.makeRequest(this.attributes.LHC_API.args.lhc_base_url + '/widgetrestapi/screensharesettings', {}, (data) => {\n                if (this.params['auto_start'] || data['auto_share'] == 1) {\n                    this.initCoBrowsing(data);\n                } else {\n\n                    this.addCss('.lhc-modal {display: none; position: fixed; z-index: 1000001 !important;padding-top: 100px;left: 0;top: 0;  width: 100%;height: 100%; overflow: auto; background-color: rgb(0,0,0);  background-color: rgba(0,0,0,0.4); }'+\n                                  '.lhc-modal-content {background-color: #fefefe; margin: auto; padding: 20px; border: 1px solid #888; width: 60%;border-radius:5px; }'+\n                                  '#lhc-close { color: #aaaaaa;    float: right;  font-size: 28px;    font-weight: bold;  }'+\n                                  '#lhc-close:hover,#lhc-close:focus {color: #000; text-decoration: none; cursor: pointer;}');\n\n                    this.appendHTML('<div id=\"lhc-co-browsing-modal\" style=\"display: block\" class=\"lhc-modal\">'+\n                        '<div class=\"lhc-modal-content\">'+\n                            '<span id=\"lhc-close\">&times;</span>'+\n                            '<p style=\"text-align: center\"><button id=\"lhc-start-share-session\" style=\"background-color: #4CAF50;' +\n                        '  border: none;' +\n                        '  color: white;' +\n                        '  padding: 7px 16px;' +\n                        '  text-align: center;border-radius:5px;' +\n                        '  text-decoration: none;' +\n                        '  display: inline-block;' +\n                        '  font-size: 16px;' +\n                        '  margin: 4px 2px;' +\n                        '  cursor: pointer;\">' + data.trans.start_share + '</button><button id=\"lhc-deny-share-session\" style=\"background-color: #d2404a;' +\n                        '  border: none;' +\n                        '  color: white;' +\n                        '  padding: 7px 16px;' +\n                        '  text-align: center;border-radius:5px;' +\n                        '  text-decoration: none;' +\n                        '  display: inline-block;' +\n                        '  font-size: 16px;' +\n                        '  margin: 4px 2px;' +\n                        '  cursor: pointer;\">' + data.trans.deny + '</button></p></div></div>');\n\n                    var btn = document.getElementById(\"lhc-close\");\n                    var btnDeny = document.getElementById(\"lhc-deny-share-session\");\n                    var modal = document.getElementById(\"lhc-co-browsing-modal\");\n\n                    btnDeny.onclick = btn.onclick = () => {\n                        this.removeById('lhc-co-browsing-modal');\n                    }\n\n                    window.addEventListener('click',(event) => {\n                        if (event.target == modal) {\n                            this.removeById('lhc-co-browsing-modal');\n                        }\n                    });\n\n                    document.getElementById(\"lhc-start-share-session\").onclick = () => {\n                        this.removeById('lhc-co-browsing-modal');\n                        this.initCoBrowsing(data);\n                    };\n                }\n            });\n        }\n    }\n\n    removeById(EId)\n    {\n        var EObj = null;\n        return(EObj = document.getElementById(EId))?EObj.parentNode.removeChild(EObj):false;\n    }\n\n    appendHTML(htmlStr) {\n        var frag = document.createDocumentFragment(),\n            temp = document.createElement('div');\n        temp.innerHTML = htmlStr;\n        while (temp.firstChild) {\n            frag.appendChild(temp.firstChild);\n        };\n        document.body.insertBefore(frag, document.body.childNodes[0]);\n    }\n\n    addCss(css_content) {\n        var head = document.getElementsByTagName('head')[0];\n        var style = document.createElement('style');\n        style.type = 'text/css';\n\n        if (style.styleSheet) {\n            style.styleSheet.cssText = css_content;\n        } else {\n            var rules = document.createTextNode(css_content);\n            style.appendChild(rules);\n        };\n\n        head.appendChild(style);\n    }\n\n    initCoBrowsing(data) {\n        if (typeof TreeMirror == \"undefined\") {\n            var th = document.getElementsByTagName('head')[0];\n            var s = document.createElement('script');\n            s.setAttribute('type', 'text/javascript');\n            s.setAttribute('src', data['cobrowser']);\n            th.appendChild(s);\n            s.onreadystatechange = s.onload = () => {\n                this.startCoBrowse(data);\n            };\n        } else {\n            this.startCoBrowse(data);\n        }\n    }\n}\n\nconst screenShare = new _screenShare();\nexport {screenShare};\n\n"],"names":["screenShare","_createClass","_screenShare","_classCallCheck","this","params","attributes","chatEvents","isSharing","sharemode","sharehash","cobrowser","key","value","_this","formsEnabled","LHCCoBrowser","eventEmitter","encodeURIComponent","location","href","match","startMirroring","listener","data","handleMessage","split","addListener","addOnceListener","helperFunctions","removeById","storageHandler","removeSessionStorage","th","document","getElementsByTagName","s","createElement","window","substring","protocol","length","setAttribute","LHC_API","args","lhc_base_url","appendChild","removeListener","setSessionStorage","_this2","chatParams","getSessionAttributes","makeRequest","initCoBrowsing","addCss","appendHTML","trans","start_share","deny","btn","getElementById","btnDeny","modal","onclick","addEventListener","event","target","EId","EObj","parentNode","removeChild","htmlStr","frag","createDocumentFragment","temp","innerHTML","firstChild","body","insertBefore","childNodes","css_content","head","style","type","styleSheet","cssText","rules","createTextNode","_this3","TreeMirror","onreadystatechange","onload","startCoBrowse"],"sourceRoot":""}