"use strict";(self.webpackChunkLiveHelperChat=self.webpackChunkLiveHelperChat||[]).push([[530],{2530:function(t,i,e){e.r(i),e.d(i,{proactiveChat:function(){return r}});var s=e(5671),n=e(3144),a=e(2137),o=e(593),r=new(function(){function t(){(0,s.Z)(this,t),this.params={},this.timeoutStatuscheck=null,this.timeoutActivity=null,this.attributes=null,this.chatEvents=null,this.dynamicInvitations=[],this.iddleTimeoutActivity=null,this.checkMessageTimeout=null,this.nextRescheduleTimeout=null,this.initCall=!0,this.inProgress=!1}return(0,n.Z)(t,[{key:"setParams",value:function(t,i,e){var s=this;this.params=t,this.attributes=i,this.chatEvents=e,this.attributes.events.length>0?this.storeEvents(this.attributes.events):this.initInvitation(),""!=this.attributes.conversion&&this.storeConversion(this.attributes.conversion),this.attributes.eventEmitter.addListener("tagAdded",(function(){s.initInvitation({init:0})})),this.attributes.eventEmitter.addListener("eventAdded",(function(){s.storeEvents(s.attributes.events)})),this.attributes.eventEmitter.addListener("conversionAdded",(function(){s.storeConversion(s.attributes.conversion)})),this.attributes.eventEmitter.addListener("checkMessageOperator",(function(){s.initInvitation({init:0})})),this.attributes.eventEmitter.addListener("endChat",(function(){s.initInvitation({init:0})})),this.attributes.onlineStatus.subscribe((function(t){1==t?s.initInvitation({init:0}):!s.attributes.userSession.getSessionAttributes().id&&s.attributes.proactive.invitation&&(s.attributes.proactive={},!1!==s.attributes.mainWidget.isLoaded&&s.chatEvents.sendChildEvent("proactive",[{}]),s.attributes.mainWidget.hideInvitation(),s.attributes.eventEmitter.emitEvent("closeWidget",[{sender:"closeButton"}]))}))}},{key:"showInvitation",value:function(t,i){var e=this.attributes.userSession.getSessionAttributes();if(!(0===i&&!0===this.attributes.widgetStatus.value&&"embed"==!this.attributes.mode||e.id)){if(t.inject_html&&t.invitation){var s=document.getElementsByTagName("head")[0],n=document.createElement("script");n.setAttribute("type","text/javascript"),n.setAttribute("src",this.attributes.LHC_API.args.lhc_base_url+this.attributes.lang+"chat/htmlsnippet/"+t.invitation+"/inv/0/?ts="+Date.now()),s.appendChild(n)}t.only_inject||(this.attributes.proactive=t,!1===this.attributes.mainWidget.isLoaded?this.attributes.mainWidget.bootstrap():this.chatEvents.sendChildEvent("proactive",[t]),clearTimeout(this.checkMessageTimeout),clearTimeout(this.nextRescheduleTimeout))}}},{key:"storeEvents",value:function(t){var i=this;this.attributes.userSession.getSessionAttributes().id||1!=this.attributes.onlineStatus.value||a.a.makeRequest(this.attributes.LHC_API.args.lhc_base_url+this.attributes.lang+"chat/logevent/(vid)/"+this.attributes.userSession.getVID(),{params:{data:JSON.stringify(t)}},(function(t){i.initInvitation({init:0})}))}},{key:"storeConversion",value:function(t){this.attributes.userSession.getSessionAttributes().id||1!=this.attributes.onlineStatus.value||a.a.makeRequest(this.attributes.LHC_API.args.lhc_base_url+this.attributes.lang+"widgetrestapi/logconversions/(vid)/"+this.attributes.userSession.getVID(),{params:{data:JSON.stringify(t)}},(function(t){}))}},{key:"initInvitation",value:function(t){var i=this;if(1!=this.inProgress){clearTimeout(this.checkMessageTimeout);var e=this.attributes.userSession.getSessionAttributes(),s=t&&0===t.init?0:1;if(!e.id&&1==this.attributes.onlineStatus.value){this.inProgress=!0;var n={vid:this.attributes.userSession.getVID(),dep:this.attributes.department.join(",")};this.attributes.LHC_API.args.priority&&(n.priority=this.attributes.LHC_API.args.priority),this.attributes.LHC_API.args.operator&&(n.operator=this.attributes.LHC_API.args.operator),this.attributes.identifier&&(n.idnt=this.attributes.identifier),this.attributes.tag&&(n.tag=this.attributes.tag),this.attributes.langOverride&&(n.lang=this.attributes.langOverride),n.l=encodeURIComponent(window.location.href.substring(window.location.protocol.length)),n.dt=encodeURIComponent(document.title),n.init=1==this.initCall?1:s,this.initCall=!1,a.a.makeRequest(this.attributes.LHC_API.args.lhc_base_url+this.attributes.lang+"widgetrestapi/checkinvitation",{params:n},(function(t){if(i.inProgress=!1,t.invitation){var e={vid_id:t.vid_id,invitation:t.invitation,inject_html:t.inject_html,qinv:t.qinv};setTimeout((function(){i.showInvitation(e,s)}),!0===i.attributes.widgetStatus.value?0:t.delay?t.delay+i.attributes.status_delay:i.attributes.status_delay)}else i.attributes.LHC_API.args.check_messages&&(i.checkMessageTimeout=setTimeout((function(){i.initInvitation({init:0})}),1e3*i.params.interval));t.next_reschedule&&(i.nextRescheduleTimeout=setTimeout((function(){i.initInvitation({init:0})}),t.next_reschedule)),t.dynamic&&t.dynamic.forEach((function(e){i.dynamicInvitations.push(e.id),1===e.type?o.U.listen(document,"mouseout",(function(s){var n=(s=s||window.event).relatedTarget||s.toElement;n&&"HTML"!=n.nodeName||(i.showInvitation({vid_id:t.vid_id,invitation:e.id,inject_html:e.inject_html,qinv:t.qinv,only_inject:e.only_inject}),e.every_time||o.U.unlisten("lhc_inv_mouse_out_"+e.id))}),"lhc_inv_mouse_out_"+e.id):2===e.type&&(i.iddleTimeoutActivityReset=function(){clearTimeout(i.iddleTimeoutActivity),i.iddleTimeoutActivity=setTimeout((function(){i.showInvitation({vid_id:t.vid_id,invitation:e.id,inject_html:e.inject_html,qinv:t.qinv,only_inject:e.only_inject}),clearTimeout(i.iddleTimeoutActivity),e.every_time||(["mousemove","mousedown","click","scroll","keypress","load"].forEach((function(t){o.U.unlisten("lhc_inv_iddl_win_"+t)})),["mousemove","scroll","touchstart","touchend"].forEach((function(t){o.U.unlisten("lhc_inv_iddl_doc_"+t)})))}),1e3*e.iddle_for)},i.iddleTimeoutActivityReset(),["mousemove","mousedown","click","scroll","keypress","load"].forEach((function(t){o.U.listen(window,t,i.iddleTimeoutActivityReset,"lhc_inv_iddl_win_"+t)})),["mousemove","scroll","touchstart","touchend"].forEach((function(t){o.U.listen(document,t,i.iddleTimeoutActivityReset,"lhc_inv_iddl_doc_"+t)})))}))}))}}}}]),t}())}}]);
//# sourceMappingURL=c9aa29f9fd71f320cdd6.js.map