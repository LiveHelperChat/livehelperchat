"use strict";(globalThis.webpackChunkLHCReactAPP=globalThis.webpackChunkLHCReactAPP||[]).push([[168],{168:(t,e,a)=>{a.d(e,{nodeJSChat:()=>o});var n=a(911),i=a(3115),s=a(9454),c=a(424);function r(t){var e,a,n,i=2;for("undefined"!=typeof Symbol&&(a=Symbol.asyncIterator,n=Symbol.iterator);i--;){if(a&&null!=(e=t[a]))return e.call(t);if(n&&null!=(e=t[n]))return new h(e.call(t));a="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function h(t){function e(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var e=t.done;return Promise.resolve(t.value).then((function(t){return{value:t,done:e}}))}return h=function(t){this.s=t,this.n=t.next},h.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var a=this.s.return;return void 0===a?Promise.resolve({value:t,done:!0}):e(a.apply(this.s,arguments))},throw:function(t){var a=this.s.return;return void 0===a?Promise.reject(t):e(a.apply(this.s,arguments))}},new h(t)}const o=new class{constructor(){this.socket=null,n.q.eventEmitter.addListener("endedChat",(()=>{null!==this.socket&&this.socket.disconnect()}))}bootstrap(t,e,a){const h=a(),o=h.chatwidget.getIn(["chatData","id"]),l=(h.chatwidget.getIn(["chatData","hash"]),h.chatwidget.getIn(["chat_ui","sync_interval"]));var d=null,u={protocolVersion:1,hostname:t.hostname,path:t.path,disconnectOnUnload:!1,autoReconnectOptions:{initialDelay:5e3,randomness:5e3}};""!=t.port&&(u.port=parseInt(t.port)),1==t.secure&&(u.secure=!0),t.instance_id>0&&t.instance_id;var g=this.socket=s.create(u),_=null;function m(t){t.isAuthenticated&&o>0?b():w()}function w(){const e=a();let n=e.chatwidget.getIn(["chatData","id"]);window.lhcAxios.post(window.lhcChat.base_url+"nodejshelper/tokenvisitor/"+n+"/"+e.chatwidget.getIn(["chatData","hash"]),null,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((async e=>{await Promise.all([g.invoke("login",{hash:e.data,chanelName:t.instance_id>0?"chat_"+t.instance_id+"_"+n:"chat_"+n}),g.listener("authenticate").once()]),b()}))}function p(e){1==e.status?t.instance_id>0?g.transmitPublish("chat_"+t.instance_id+"_"+o,{op:"vt",msg:e.msg}):g.transmitPublish("chat_"+o,{op:"vt",msg:e.msg}):t.instance_id>0?g.transmitPublish("chat_"+t.instance_id+"_"+o,{op:"vts"}):g.transmitPublish("chat_"+o,{op:"vts"})}function y(e){const n=a();let i=e.msg;n.chatwidget.hasIn(["chat_ui","hide_typing"])&&!0===n.chatwidget.getIn(["chat_ui","hide_typing"])&&(i=c.A.t("chat.msg_was_sent")),t.instance_id>0?g.transmitPublish("chat_"+t.instance_id+"_"+o,{op:"vt",msg:"âœ‰ï¸ "+i}):g.transmitPublish("chat_"+o,{op:"vt",msg:"âœ‰ï¸ "+i})}function v(e){t.instance_id>0?g.transmitPublish("chat_"+t.instance_id+"_"+o,{op:"vt",msg:"ðŸ“•ï¸ error happened while sending visitor message, please inform your administrator!"}):g.transmitPublish("chat_"+o,{op:"vt",msg:"ðŸ“•ï¸ error happened while sending visitor message, please inform your administrator!"})}function f(){if(null!==_)try{_.unsubscribe()}catch(t){}n.q.eventEmitter.removeListener("visitorTyping",p),n.q.eventEmitter.removeListener("messageSend",y),n.q.eventEmitter.removeListener("messageSendError",v),e({type:"CHAT_UI_UPDATE",data:{sync_interval:l}}),e({type:"CHAT_REMOVE_OVERRIDE",data:"typing"})}function b(){var s=null==_;_=t.instance_id>0?g.subscribe("chat_"+t.instance_id+"_"+o):g.subscribe("chat_"+o),n.q.eventEmitter.addListener("visitorTyping",p),n.q.eventEmitter.addListener("messageSend",y),n.q.eventEmitter.addListener("messageSendError",v),e({type:"CHAT_ADD_OVERRIDE",data:"typing"}),1==s&&((async()=>{try{var a,n=!1,i=!1;try{for(var s,c=r(_.listener("subscribe"));n=!(s=await c.next()).done;n=!1)s.value,g.transmitPublish(t.instance_id>0?"chat_"+t.instance_id+"_"+o:"chat_"+o,{op:"vi_online",status:!0}),e({type:"CHAT_UI_UPDATE",data:{sync_interval:1e4}})}catch(t){i=!0,a=t}finally{try{n&&null!=c.return&&await c.return()}finally{if(i)throw a}}}catch(e){await _.listener("subscribe").once(),g.transmitPublish(t.instance_id>0?"chat_"+t.instance_id+"_"+o:"chat_"+o,{op:"vi_online",status:!0})}})(),(async()=>{try{var n,s=!1,h=!1;try{for(var o,l=r(_);s=!(o=await l.next()).done;s=!1){let n=o.value;if("ot"==n.op)1==n.data.status?e({type:"chat_status_changed",data:{text:n.data.typer?n.data.typer+" "+c.A.t("chat.typing"):n.data.ttx}}):e({type:"chat_status_changed",data:{text:""}});else if("sflow"==n.op)null===d&&(d=document.querySelector("#messages-scroll > div.message-row-typing > .msg-body"))&&(d.innerHTML="",d.parentElement.classList.add("message-row-typing-stream")),d&&(!0===n.as_html?d.innerHTML+=n.msg.replaceAll("__SL__","/"):d.innerText+=n.msg.replaceAll("__SL__","/"),d.scrollIntoView());else if("cmsg"==n.op||"schange"==n.op){d=null;const t=a();t.chatwidget.hasIn(["chatData","id"])&&e((0,i.lj)({chat_id:t.chatwidget.getIn(["chatData","id"]),hash:t.chatwidget.getIn(["chatData","hash"]),lmgsid:t.chatwidget.getIn(["chatLiveData","lmsgid"]),theme:t.chatwidget.get("theme"),debug:t.chatwidget.get("debug"),active_widget:(t.chatwidget.get("shown")&&"widget"==t.chatwidget.get("mode")||"widget"!=t.chatwidget.get("mode")&&document.hasFocus())&&1==window.lhcChat.is_focused}))}else if("umsg"==n.op){const t=a();t.chatwidget.hasIn(["chatData","id"])&&(0,i.nc)({msg_id:n.msid,lmgsid:t.chatwidget.getIn(["chatLiveData","lmsgid"]),mode:t.chatwidget.get("mode"),theme:t.chatwidget.get("theme"),id:t.chatwidget.getIn(["chatData","id"]),hash:t.chatwidget.getIn(["chatData","hash"]),no_scroll:!0})(e,a)}else if("schange"==n.op||"cclose"==n.op){const t=a();t.chatwidget.hasIn(["chatData","id"])&&e((0,i.d1)({chat_id:t.chatwidget.getIn(["chatData","id"]),hash:t.chatwidget.getIn(["chatData","hash"]),mode:t.chatwidget.get("mode"),theme:t.chatwidget.get("theme")}))}else if("vo"==n.op){const e=a();e.chatwidget.hasIn(["chatData","id"])&&g.transmitPublish(t.instance_id>0?"chat_"+t.instance_id+"_"+e.chatwidget.getIn(["chatData","id"]):"chat_"+e.chatwidget.getIn(["chatData","id"]),{op:"vi_online",status:!0})}}}catch(t){h=!0,n=t}finally{try{s&&null!=l.return&&await l.return()}finally{if(h)throw n}}}catch(t){}})())}(async()=>{try{var t,e=!1,a=!1;try{for(var n,i=r(g.listener("connect"));e=!(n=await i.next()).done;e=!1)m(n.value)}catch(e){a=!0,t=e}finally{try{e&&null!=i.return&&await i.return()}finally{if(a)throw t}}}catch(t){m(await g.listener("connect").once())}})(),(async()=>{try{var t,e=!1,a=!1;try{for(var n,i=r(g.listener("disconnect"));e=!(n=await i.next()).done;e=!1)n.value,f()}catch(e){a=!0,t=e}finally{try{e&&null!=i.return&&await i.return()}finally{if(a)throw t}}}catch(t){await g.listener("disconnect").once(),f()}})(),(async()=>{try{var t,e=!1,a=!1;try{for(var n,i=r(g.listener("deauthenticate"));e=!(n=await i.next()).done;e=!1)n.value,w()}catch(e){a=!0,t=e}finally{try{e&&null!=i.return&&await i.return()}finally{if(a)throw t}}}catch(t){await g.listener("deauthenticate").once(),w()}})()}}}}]);
//# sourceMappingURL=168.fc3c39d7802e4164261b.js.map