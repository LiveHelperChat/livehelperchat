"use strict";(self.webpackChunkLHCReactAPP=self.webpackChunkLHCReactAPP||[]).push([[261],{261:function(e,t,n){n.r(t),n.d(t,{nodeJSChat:function(){return _}});var a=n(8926),r=n.n(a),s=n(4575),i=n.n(s),c=n(3913),h=n.n(c),o=n(7757),u=n.n(o),d=n(2137),p=n(6512),l=n(3502),v=n(2596);function g(e){var t,n,a,r=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,a=Symbol.iterator);r--;){if(n&&null!=(t=e[n]))return t.call(e);if(a&&null!=(t=e[a]))return new f(t.call(e));n="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function f(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return f=function(e){this.s=e,this.n=e.next},f.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new f(e)}var m=function(){function e(){var t=this;i()(this,e),this.socket=null,d.a.eventEmitter.addListener("endedChat",(function(){null!==t.socket&&t.socket.disconnect()}))}return h()(e,[{key:"bootstrap",value:function(e,t,n){var a=n(),s=a.chatwidget.getIn(["chatData","id"]),i=(a.chatwidget.getIn(["chatData","hash"]),a.chatwidget.getIn(["chat_ui","sync_interval"])),c={protocolVersion:1,hostname:e.hostname,path:e.path,autoReconnectOptions:{initialDelay:5e3,randomness:5e3}};""!=e.port&&(c.port=parseInt(e.port)),1==e.secure&&(c.secure=!0),e.instance_id>0&&e.instance_id;var h=this.socket=l.create(c),o=null;function f(e){e.isAuthenticated&&s>0?k():m()}function m(){var t=n(),a=t.chatwidget.getIn(["chatData","id"]);window.lhcAxios.post(window.lhcChat.base_url+"nodejshelper/tokenvisitor/"+a+"/"+t.chatwidget.getIn(["chatData","hash"]),null,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(){var t=r()(u().mark((function t(n){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([h.invoke("login",{hash:n.data,chanelName:e.instance_id>0?"chat_"+e.instance_id+"_"+a:"chat_"+a}),h.listener("authenticate").once()]);case 2:k();case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}function _(t){1==t.status?e.instance_id>0?h.transmitPublish("chat_"+e.instance_id+"_"+s,{op:"vt",msg:t.msg}):h.transmitPublish("chat_"+s,{op:"vt",msg:t.msg}):e.instance_id>0?h.transmitPublish("chat_"+e.instance_id+"_"+s,{op:"vts"}):h.transmitPublish("chat_"+s,{op:"vts"})}function w(t){e.instance_id>0?h.transmitPublish("chat_"+e.instance_id+"_"+s,{op:"vt",msg:"✉️ "+t.msg}):h.transmitPublish("chat_"+s,{op:"vt",msg:"✉️ "+t.msg})}function x(t){e.instance_id>0?h.transmitPublish("chat_"+e.instance_id+"_"+s,{op:"vt",msg:"📕️ error happened while sending visitor message, please inform your administrator!"}):h.transmitPublish("chat_"+s,{op:"vt",msg:"📕️ error happened while sending visitor message, please inform your administrator!"})}function b(){if(null!==o)try{o.unsubscribe()}catch(e){}d.a.eventEmitter.removeListener("visitorTyping",_),d.a.eventEmitter.removeListener("messageSend",w),d.a.eventEmitter.removeListener("messageSendError",x),t({type:"CHAT_UI_UPDATE",data:{sync_interval:i}}),t({type:"CHAT_REMOVE_OVERRIDE",data:"typing"})}function k(){var a=null==o;o=e.instance_id>0?h.subscribe("chat_"+e.instance_id+"_"+s):h.subscribe("chat_"+s),d.a.eventEmitter.addListener("visitorTyping",_),d.a.eventEmitter.addListener("messageSend",w),d.a.eventEmitter.addListener("messageSendError",x),t({type:"CHAT_ADD_OVERRIDE",data:"typing"}),1==a&&(r()(u().mark((function n(){var a,r,i,c,d;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:n.prev=0,a=!1,r=!1,n.prev=3,c=g(o.listener("subscribe"));case 5:return n.next=7,c.next();case 7:if(!(a=!(d=n.sent).done)){n.next=14;break}d.value,h.transmitPublish(e.instance_id>0?"chat_"+e.instance_id+"_"+s:"chat_"+s,{op:"vi_online",status:!0}),t({type:"CHAT_UI_UPDATE",data:{sync_interval:1e4}});case 11:a=!1,n.next=5;break;case 14:n.next=20;break;case 16:n.prev=16,n.t0=n.catch(3),r=!0,i=n.t0;case 20:if(n.prev=20,n.prev=21,!a||null==c.return){n.next=25;break}return n.next=25,c.return();case 25:if(n.prev=25,!r){n.next=28;break}throw i;case 28:return n.finish(25);case 29:return n.finish(20);case 30:n.next=38;break;case 32:return n.prev=32,n.t1=n.catch(0),n.next=36,o.listener("subscribe").once();case 36:n.sent,h.transmitPublish(e.instance_id>0?"chat_"+e.instance_id+"_"+s:"chat_"+s,{op:"vi_online",status:!0});case 38:case"end":return n.stop()}}),n,null,[[0,32],[3,16,20,30],[21,,25,29]])})))(),r()(u().mark((function a(){var r,s,i,c,d,l,f,m,_,w;return u().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:a.prev=0,r=!1,s=!1,a.prev=3,c=g(o);case 5:return a.next=7,c.next();case 7:if(!(r=!(d=a.sent).done)){a.next=13;break}"ot"==(l=d.value).op?1==l.data.status?t({type:"chat_status_changed",data:{text:l.data.typer?l.data.typer+" "+v.Z.t("chat.typing"):l.data.ttx}}):t({type:"chat_status_changed",data:{text:""}}):"cmsg"==l.op||"schange"==l.op?(f=n()).chatwidget.hasIn(["chatData","id"])&&t((0,p.W4)({chat_id:f.chatwidget.getIn(["chatData","id"]),hash:f.chatwidget.getIn(["chatData","hash"]),lmgsid:f.chatwidget.getIn(["chatLiveData","lmsgid"]),theme:f.chatwidget.get("theme"),active_widget:(f.chatwidget.get("shown")&&"widget"==f.chatwidget.get("mode")||"widget"!=f.chatwidget.get("mode")&&document.hasFocus())&&1==window.lhcChat.is_focused})):"umsg"==l.op?(m=n()).chatwidget.hasIn(["chatData","id"])&&(0,p.o6)({msg_id:l.msid,id:m.chatwidget.getIn(["chatData","id"]),hash:m.chatwidget.getIn(["chatData","hash"])})(t,n):"schange"==l.op||"cclose"==l.op?(_=n()).chatwidget.hasIn(["chatData","id"])&&t((0,p.kW)({chat_id:_.chatwidget.getIn(["chatData","id"]),hash:_.chatwidget.getIn(["chatData","hash"]),mode:_.chatwidget.get("mode"),theme:_.chatwidget.get("theme")})):"vo"==l.op&&(w=n()).chatwidget.hasIn(["chatData","id"])&&h.transmitPublish(e.instance_id>0?"chat_"+e.instance_id+"_"+w.chatwidget.getIn(["chatData","id"]):"chat_"+w.chatwidget.getIn(["chatData","id"]),{op:"vi_online",status:!0});case 10:r=!1,a.next=5;break;case 13:a.next=19;break;case 15:a.prev=15,a.t0=a.catch(3),s=!0,i=a.t0;case 19:if(a.prev=19,a.prev=20,!r||null==c.return){a.next=24;break}return a.next=24,c.return();case 24:if(a.prev=24,!s){a.next=27;break}throw i;case 27:return a.finish(24);case 28:return a.finish(19);case 29:a.next=33;break;case 31:a.prev=31,a.t1=a.catch(0);case 33:case"end":return a.stop()}}),a,null,[[0,31],[3,15,19,29],[20,,24,28]])})))())}r()(u().mark((function e(){var t,n,a,r,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,t=!1,n=!1,e.prev=3,r=g(h.listener("connect"));case 5:return e.next=7,r.next();case 7:if(!(t=!(s=e.sent).done)){e.next=13;break}f(s.value);case 10:t=!1,e.next=5;break;case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),n=!0,a=e.t0;case 19:if(e.prev=19,e.prev=20,!t||null==r.return){e.next=24;break}return e.next=24,r.return();case 24:if(e.prev=24,!n){e.next=27;break}throw a;case 27:return e.finish(24);case 28:return e.finish(19);case 29:e.next=37;break;case 31:return e.prev=31,e.t1=e.catch(0),e.next=35,h.listener("connect").once();case 35:f(e.sent);case 37:case"end":return e.stop()}}),e,null,[[0,31],[3,15,19,29],[20,,24,28]])})))(),r()(u().mark((function e(){var t,n,a,r,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,t=!1,n=!1,e.prev=3,r=g(h.listener("disconnect"));case 5:return e.next=7,r.next();case 7:if(!(t=!(s=e.sent).done)){e.next=13;break}s.value,b();case 10:t=!1,e.next=5;break;case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),n=!0,a=e.t0;case 19:if(e.prev=19,e.prev=20,!t||null==r.return){e.next=24;break}return e.next=24,r.return();case 24:if(e.prev=24,!n){e.next=27;break}throw a;case 27:return e.finish(24);case 28:return e.finish(19);case 29:e.next=37;break;case 31:return e.prev=31,e.t1=e.catch(0),e.next=35,h.listener("disconnect").once();case 35:e.sent,b();case 37:case"end":return e.stop()}}),e,null,[[0,31],[3,15,19,29],[20,,24,28]])})))(),r()(u().mark((function e(){var t,n,a,r,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,t=!1,n=!1,e.prev=3,r=g(h.listener("deauthenticate"));case 5:return e.next=7,r.next();case 7:if(!(t=!(s=e.sent).done)){e.next=13;break}s.value,m();case 10:t=!1,e.next=5;break;case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),n=!0,a=e.t0;case 19:if(e.prev=19,e.prev=20,!t||null==r.return){e.next=24;break}return e.next=24,r.return();case 24:if(e.prev=24,!n){e.next=27;break}throw a;case 27:return e.finish(24);case 28:return e.finish(19);case 29:e.next=37;break;case 31:return e.prev=31,e.t1=e.catch(0),e.next=35,h.listener("deauthenticate").once();case 35:e.sent,m();case 37:case"end":return e.stop()}}),e,null,[[0,31],[3,15,19,29],[20,,24,28]])})))()}}]),e}(),_=new m}}]);
//# sourceMappingURL=261.77e68634efb90eb07bbc.js.map