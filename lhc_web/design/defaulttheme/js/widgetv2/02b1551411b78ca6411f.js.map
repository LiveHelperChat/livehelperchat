{"version":3,"file":"02b1551411b78ca6411f.js","mappings":"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","sources":["webpack://LiveHelperChat/./src/lib/widgets/msgSnippetWidget.js"],"sourcesContent":["import {settings} from '../settings.js';\nimport {UIConstructorIframe} from '../UIConstructorIframe';\nimport {helperFunctions} from '../helperFunctions';\n\nexport class msgSnippetWidget{\n    constructor(prefix) {\n\n        this.attributes = {};\n        this.hidden = false;\n        this.widgetOpen = false;\n        this.invitationOpen = false;\n        this.nhOpen = false;\n\n        this.msop = null;   // Last operator ID who wrote a message\n        this.msg = null;    // Container of the message\n\n        this.cont = new UIConstructorIframe((prefix || 'lhc')+'_msgsnippet_widget_v2', helperFunctions.getAbstractStyle({\n            zindex: \"2147483639\",\n            width: \"300px\",\n            height: \"200px\",\n            position: \"fixed\",\n            display: \"none\",\n        }), {\"translate\":\"no\"}, \"iframe\");\n\n        this.loadStatus = {main : false, theme: false, status: false};\n    }\n\n    checkLoadStatus() {\n        if (this.loadStatus['theme'] == true && this.loadStatus['main'] == true && this.loadStatus['status'] == true) {\n            this.cont.elmDomDoc.body.style.display = \"\";\n            this.fitContent();\n        }\n    }\n\n    renderBody() {\n\n        this.cont.tmpl = this.msg.replace('{dev_type}',(this.attributes.isMobile === true ? 'lhc-mobile' : 'lhc-desktop')).replace('{msg_body}',this.settings['msg_body']).replace('{operator_profile}',this.settings['operator_profile']);\n\n        this.cont.bodyId = 'msgsnippet';\n\n        if (this.cont.constructUIIframe('', this.attributes.staticJS['dir']) === null){\n            return null;\n        }\n\n        // Content invisible untill media loads\n        this.cont.elmDomDoc.body.style.display = \"none\";\n\n        this.cont.elmDom.className += this.attributes.isMobile === true ? ' notranslate lhc-mobile' : ' notranslate lhc-desktop';\n\n        this.cont.attachUserEventListener(\"click\",  (e) => {\n            this.attributes.eventEmitter.emitEvent('msgSnippetClicked', [{'event': e, 'sender' : 'closeButton'}]);\n            this.attributes.eventEmitter.emitEvent('showWidget', [{'event': e}]);\n        }, \"start-chat-btn\",'msgsnippetstart');\n\n        var _that = this;\n\n        this.cont.attachUserEventListener(\"click\",  (a) => {\n            this.attributes.eventEmitter.emitEvent('msgsnippetClosed', [{'sender' : 'closeButton'}]);\n            a.stopPropagation();\n            _that.hide(true);\n        }, \"close-need-help-btn\",'msgsnippetclose');\n\n        this.cont.insertCssRemoteFile({onload: () => {this.loadStatus['main'] = true; this.checkLoadStatus()},crossOrigin : \"anonymous\",  href : this.attributes.staticJS['widget_css']}, true);\n\n        if (this.attributes.isMobile == true) {\n            this.cont.insertCssRemoteFile({crossOrigin : \"anonymous\",  href : this.attributes.staticJS['widget_mobile_css']});\n        }\n\n        if (this.attributes.theme) {\n            this.cont.insertCssRemoteFile({onload: () => {this.loadStatus['theme'] = true; this.checkLoadStatus()}, id : \"lhc-theme-msgsnippet\", crossOrigin : \"anonymous\",  href : this.attributes.LHC_API.args.lhc_base_url + '/widgetrestapi/theme/' + this.attributes.theme + '?v=' + this.attributes.theme_v}, true);\n        } else {\n            this.loadStatus['theme'] = true;\n            this.checkLoadStatus();\n        }\n\n        // Show need help only if status widget is loaded\n        this.attributes.sload.subscribe((data) => {if(data){this.loadStatus['status'] = true; this.checkLoadStatus()}});\n\n        this.attributes.eventEmitter.emitEvent('showMsgSnippet', [{'sender' : 'closeButton'}]);\n\n        this.attributes.eventEmitter.addListener('unread_message', (dataUnread) => {\n            if (dataUnread.msop) {\n                if (dataUnread.msop == this.msop && dataUnread.msg_body) {\n                    this.showSnippet(dataUnread, true);\n                } else {\n                    this.msop = dataUnread.msop;\n                    helperFunctions.makeRequest(this.attributes.LHC_API.args.lhc_base_url + this.attributes['lang'] + 'widgetrestapi/getmessagesnippet', {params: this.attributes['userSession'].getSessionAttributes()}, (data) => {\n                        this.msop = data.msop;\n                        this.msg = data.msg;\n                        this.showSnippet(data, true);\n                    })\n                }\n            }\n        });\n\n        this.attributes.eventEmitter.addListener('hide_msg_snippet', () => {\n            this.hide(true);\n        });\n\n        this.attributes.widgetStatus.subscribe((data) => {\n            data == true ? (this.widgetOpen = true, this.hide(true)) : (this.widgetOpen = false, this.show());\n        });\n\n        this.attributes.eventEmitter.addListener('reloadWidget',() => {\n            this.cont.insertCssRemoteFile({onload: () => {this.loadStatus['theme'] = true; this.checkLoadStatus()}, id : \"lhc-theme-msgsnippet\", crossOrigin : \"anonymous\",  href : this.attributes.LHC_API.args.lhc_base_url + '/widgetrestapi/theme/' + this.attributes.theme + '?v=' + Date.now()}, true);\n        });\n    }\n\n    init(attributes, settings) {\n        this.attributes = attributes;\n        this.settings = settings;\n\n        if (this.settings['msg']) {\n            this.msg = this.settings['msg'];\n        }\n\n        if (this.settings['msop']) {\n            this.msop = this.settings['msop'];\n        }\n\n        if (!this.msg || (this.settings['msop'] && this.msop !== this.settings['msop'])) {\n            helperFunctions.makeRequest(this.attributes.LHC_API.args.lhc_base_url + this.attributes['lang'] + 'widgetrestapi/getmessagesnippet', {params: this.attributes['userSession'].getSessionAttributes()}, (data) => {\n                this.msop = data.msop;\n                this.msg = data.msg;\n                this.settings['operator_profile'] = data.operator_profile;\n                this.renderBody();\n            })\n        } else {\n            this.renderBody();\n        }\n\n    }\n\n    hide (persistent) {\n\n        if (typeof persistent !== 'undefined' && persistent === true) {\n            this.hidden = true;\n        }\n\n        this.cont.hide();\n\n        if (this.nhOpen == true) {\n            this.attributes.eventEmitter.emitEvent('msgSnippetHide', []);\n        }\n\n        this.attributes.msgsnippet_status.next(false);\n        this.nhOpen = false;\n    }\n\n    showSnippet(data, showSnippet) {\n        if (showSnippet == true) {\n            this.hidden = false;\n            this.show();\n        }\n        this.cont.elmDomDoc.getElementById('messages-scroll').innerHTML = data.msg_body;\n\n        if (data.operator_profile) {\n            this.cont.elmDomDoc.getElementById('operator-profile-snippet').innerHTML = data.operator_profile;\n        }\n\n        this.fitContent();\n    }\n\n    fitContent() {\n\n        var documentHeight = this.cont.elmDomDoc.getElementById('messages-scroll').offsetHeight;\n\n        var placement = {bottom: (70 + this.attributes.widgetDimesions.value.wbottom - (91 - documentHeight)) +\"px\", right: (65+this.attributes.widgetDimesions.value.wright) + \"px\"};\n\n        var leftPosition = false;\n\n        if (this.attributes.position_placement == 'bottom_left' || this.attributes.position_placement == 'full_height_left') {\n            placement = {bottom: (70 + this.attributes.widgetDimesions.value.wbottom - (91 - documentHeight)) +\"px\", left: (65+this.attributes.widgetDimesions.value.wright) + \"px\"};\n            leftPosition = true;\n        } else if (this.attributes.position_placement == 'middle_left') {\n            placement = {bottom: \"calc(50% + 35px)\", left: (65+this.attributes.widgetDimesions.value.wright) + \"px\"};\n            leftPosition = true;\n        } else if (this.attributes.position_placement == 'middle_right') {\n            placement = {bottom: \"calc(50% + 35px)\", right: (65+this.attributes.widgetDimesions.value.wright) + \"px\"};\n        }\n\n        this.cont.massRestyle(placement);\n    }\n\n    show () {\n        if (this.hidden == true || this.widgetOpen == true || this.invitationOpen == true || this.attributes.onlineStatus.value == false) {\n            return;\n        }\n\n        if (this.attributes.hideOffline === false) {\n            this.cont.show();\n            if (this.nhOpen == false) {\n                this.attributes.eventEmitter.emitEvent('msgSnippetShow', []);\n                this.attributes.msgsnippet_status.next(true);\n            }\n            this.nhOpen = true;\n        } else {\n            this.cont.hide();\n            if (this.nhOpen == true) {\n                this.attributes.eventEmitter.emitEvent('msgSnippetHide', []);\n                this.attributes.msgsnippet_status.next(false);\n            }\n            this.nhOpen = false;\n        }\n    }\n}"],"names":["msgSnippetWidget","_createClass","prefix","_classCallCheck","this","attributes","hidden","widgetOpen","invitationOpen","nhOpen","msop","msg","cont","UIConstructorIframe","helperFunctions","getAbstractStyle","zindex","width","height","position","display","loadStatus","main","theme","status","key","value","elmDomDoc","body","style","fitContent","_this","tmpl","replace","isMobile","settings","bodyId","constructUIIframe","staticJS","elmDom","className","attachUserEventListener","e","eventEmitter","emitEvent","_that","a","stopPropagation","hide","insertCssRemoteFile","onload","checkLoadStatus","crossOrigin","href","id","LHC_API","args","lhc_base_url","theme_v","sload","subscribe","data","addListener","dataUnread","msg_body","showSnippet","makeRequest","params","getSessionAttributes","widgetStatus","show","Date","now","_this2","operator_profile","renderBody","persistent","msgsnippet_status","next","getElementById","innerHTML","documentHeight","offsetHeight","placement","bottom","widgetDimesions","wbottom","right","wright","position_placement","left","massRestyle","onlineStatus","hideOffline"],"sourceRoot":""}