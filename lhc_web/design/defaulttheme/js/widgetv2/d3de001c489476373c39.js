"use strict";(self.webpackChunkLiveHelperChat=self.webpackChunkLiveHelperChat||[]).push([[249],{9249:function(e,t,r){r.r(t),r.d(t,{nodeJSChat:function(){return p}});var n=r(467),a=r(3029),s=r(9530),i=r(4756),c=r.n(i),u=r(7912);function o(e){var t,r,n,a=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);a--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new l(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function l(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return l=function(e){this.s=e,this.n=e.next},l.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new l(e)}var h=function(){return(0,s.A)((function e(){(0,a.A)(this,e),this.params={},this.attributes=null,this.chatEvents=null}),[{key:"setParams",value:(e=(0,n.A)(c().mark((function e(t,a,s){var i,l,h,p,v,f,d,_,b,m,k,w,x,y,g;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g=function(){return(g=(0,n.A)(c().mark((function e(){var t,r,n,u,l,h,v,_;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=null==d,d=p.subscribe("uo_"+i),1!=t){e.next=37;break}try{"embed"!=a.mode&&!a.widgetStatus.value&&p.transmitPublish("uo_"+i,{op:"ws_isopen"}),null!==a.lhc_var&&p.transmitPublish("uo_"+i,{op:"check_vars"}),"embed"!=a.mode&&a.widgetStatus.subscribe((function(e){p.transmitPublish("uo_"+i,{op:"wstatus",status:e})}),!0),null!==a.lhc_var&&a.eventEmitter.addListener("jsVarsUpdated",(function(){p.transmitPublish("uo_"+i,{op:"current_vars",lhc_var:a.lhc_var})})),a.eventEmitter.addListener("chatStarted",(function(e,t){"popup"===t&&!0!==a.kcw||p.transmitPublish("uo_"+i,{op:"chat_started",data:e})}))}catch(e){console.log(e)}e.prev=4,r=!1,n=!1,e.prev=7,l=o(d);case 9:return e.next=11,l.next();case 11:if(!(r=!(h=e.sent).done)){e.next=17;break}if("check_message"==(v=h.value).op)a.eventEmitter.emitEvent("checkMessageOperator");else if("is_online"==v.op)p.transmitPublish("ous_"+f,{op:"vi_online",status:!0,vid:i});else if("chat_started"==v.op)try{null===a.userSession.id&&v.data.id&&s.sendChildEvent("reopenNotification",[{id:v.data.id,hash:v.data.hash}])}catch(e){console.log(e)}else if("ws_isopen"==v.op)try{"embed"!=a.mode&&a.widgetStatus.value&&p.transmitPublish("uo_"+i,{op:"wstatus",status:!0})}catch(e){console.log(e)}else if("wstatus"==v.op)try{"embed"!=a.mode&&v.status!=a.widgetStatus.value&&a.widgetStatus.next(v.status)}catch(e){console.log(e)}else if("current_vars"==v.op)try{if(v.lhc_var&&null!==a.lhc_var)for(_ in v.lhc_var)void 0!==a.lhc_var[_]&&""!==a.lhc_var[_]||""===v.lhc_var[_]||a.lhc_var[_]===v.lhc_var[_]||(a.lhc_var[_]=v.lhc_var[_])}catch(e){console.log(e)}else"check_vars"==v.op&&a.lhc_var&&p.transmitPublish("uo_"+i,{op:"current_vars",lhc_var:a.lhc_var});case 14:r=!1,e.next=9;break;case 17:e.next=23;break;case 19:e.prev=19,e.t0=e.catch(7),n=!0,u=e.t0;case 23:if(e.prev=23,e.prev=24,!r||null==l.return){e.next=28;break}return e.next=28,l.return();case 28:if(e.prev=28,!n){e.next=31;break}throw u;case 31:return e.finish(28);case 32:return e.finish(23);case 33:e.next=37;break;case 35:e.prev=35,e.t1=e.catch(4);case 37:case"end":return e.stop()}}),e,null,[[4,35],[7,19,23,33],[24,,28,32]])})))).apply(this,arguments)},y=function(){return g.apply(this,arguments)},x=function(){u.q.makeRequest(a.LHC_API.args.lhc_base_url+a.lang+"nodejshelper/tokenvisitor",{params:{ts:(new Date).getTime()}},function(){var e=(0,n.A)(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f=t.instance_id,e.next=3,Promise.all([p.invoke("login",{hash:t.hash,chanelName:v,instance_id:t.instance_id}),p.listener("authenticate").once()]);case 3:y();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},this.params=t,this.attributes=a,this.chatEvents=s,i=this.attributes.userSession.getVID(),l={protocolVersion:1,hostname:t.hostname,path:t.path,disconnectOnUnload:!1,authTokenName:"socketCluster.authToken_vi"},""!=t.port&&(l.port=parseInt(t.port)),1==t.secure&&(l.secure=!0),h=r(5923),p=h.create(l),v="uo_"+i,f=this.attributes.instance_id,d=null,e.next=17,p.listener("connect").once();case 17:e.sent.isAuthenticated?(y(),a.LHC_API.args.check_messages=!1):x(),e.prev=19,_=!1,b=!1,e.prev=22,k=o(p.listener("deauthenticate"));case 24:return e.next=26,k.next();case 26:if(!(_=!(w=e.sent).done)){e.next=32;break}w.value,x();case 29:_=!1,e.next=24;break;case 32:e.next=38;break;case 34:e.prev=34,e.t0=e.catch(22),b=!0,m=e.t0;case 38:if(e.prev=38,e.prev=39,!_||null==k.return){e.next=43;break}return e.next=43,k.return();case 43:if(e.prev=43,!b){e.next=46;break}throw m;case 46:return e.finish(43);case 47:return e.finish(38);case 48:e.next=52;break;case 50:e.prev=50,e.t1=e.catch(19);case 52:case"end":return e.stop()}}),e,this,[[19,50],[22,34,38,48],[39,,43,47]])}))),function(t,r,n){return e.apply(this,arguments)})}]);var e}(),p=new h}}]);
//# sourceMappingURL=d3de001c489476373c39.js.map