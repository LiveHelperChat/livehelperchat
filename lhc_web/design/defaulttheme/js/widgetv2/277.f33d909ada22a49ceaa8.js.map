{"version":3,"file":"277.f33d909ada22a49ceaa8.js","mappings":"mkCAI8B,IAGxBA,EAAW,WAUZ,OAAAC,EAAAA,EAAAA,IATD,SAAAD,IAAc,IAAAE,EAAA,MAAAC,EAAAA,EAAAA,GAAA,KAAAH,GACVI,KAAKC,OAAS,KAGdC,EAAAA,EAAgBC,aAAaC,YAAY,aAAa,WAC9B,OAAhBN,EAAKG,QACLH,EAAKG,OAAOI,YAEpB,GACJ,GAAC,EAAAC,IAAA,YAAAC,MAED,SAAUC,EAAQC,EAAUC,GAExB,IAAMC,EAAQD,IACRE,EAASD,EAAME,WAAWC,MAAM,CAAC,WAAW,OAE5CC,GADWJ,EAAME,WAAWC,MAAM,CAAC,WAAW,SAChCH,EAAME,WAAWC,MAAM,CAAC,UAAU,mBAClDE,EAAoB,KAEpBC,EAAgB,CAChBC,gBAAiB,EACjBC,SAAUX,EAAOW,SACjBC,KAAMZ,EAAOY,KACbC,oBAAoB,EACpBC,qBAAsB,CAACC,aAAc,IAAMC,WAAY,MAGxC,IAAfhB,EAAOiB,OACPR,EAAcQ,KAAOC,SAASlB,EAAOiB,OAGpB,GAAjBjB,EAAOmB,SACPV,EAAcU,QAAS,GAKvBnB,EAAOoB,YAAc,GACCpB,EAAOoB,YAKjC,IAAI3B,EAASD,KAAKC,OAAS4B,EAAAA,OAAqBZ,GAE5Ca,EAAgB,KAapB,SAASC,EAA2BC,GAC5BA,EAAOC,iBAAmBrB,EAAS,EACnCsB,IAEAC,GAER,CAEA,SAASA,IACL,IAAMxB,EAAQD,IACV0B,EAAUzB,EAAME,WAAWC,MAAM,CAAC,WAAW,OACjDuB,OAAOC,SAASC,KAAKF,OAAOG,QAAkB,SAAI,6BAA6BJ,EAAQ,IAAIzB,EAAME,WAAWC,MAAM,CAAC,WAAW,SAAU,KAAM,CAAC2B,QAAU,CAAC,eAAgB,uCAAuCC,KAAI,eAAAC,GAAAC,EAAAA,EAAAA,GAAAC,IAAAA,MAAC,SAAAC,EAAOC,GAAQ,OAAAF,IAAAA,MAAA,SAAAG,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAAAF,EAAAE,KAAA,EAC3NC,QAAQC,IAAI,CACdnD,EAAOoD,OAAO,QAAS,CAACC,KAAMP,EAASQ,KAAMC,WAAahD,EAAOoB,YAAc,EAAK,QAAQpB,EAAOoB,YAAY,IAAIQ,EAAY,QAAQA,IACvInC,EAAOwD,SAAS,gBAAgBC,SAClC,OACFxB,IAAiB,wBAAAc,EAAAW,OAAA,GAAAb,EAAA,KACpB,gBAAAc,GAAA,OAAAjB,EAAAkB,MAAA,KAAAC,UAAA,EANoN,GAOzN,CAED,SAASC,EAAsBR,GAEP,GAAfA,EAAKvB,OACDxB,EAAOoB,YAAc,EACrB3B,EAAO+D,gBAAgB,QAAQxD,EAAOoB,YAAY,IAAIhB,EAAO,CAAC,GAAK,KAAK,IAAM2C,EAAKU,MAEnFhE,EAAO+D,gBAAgB,QAAQpD,EAAO,CAAC,GAAK,KAAK,IAAM2C,EAAKU,MAG5DzD,EAAOoB,YAAc,EACrB3B,EAAO+D,gBAAgB,QAAQxD,EAAOoB,YAAY,IAAIhB,EAAO,CAAC,GAAK,QAEnEX,EAAO+D,gBAAgB,QAAQpD,EAAO,CAAC,GAAK,OAGzD,CAEA,SAASsD,EAAYX,GAEZ/C,EAAOoB,YAAc,EACrB3B,EAAO+D,gBAAgB,QAAQxD,EAAOoB,YAAY,IAAIhB,EAAQ,CAAC,GAAK,KAAK,IAAM,MAAQ2C,EAAKU,MAE5FhE,EAAO+D,gBAAgB,QAAQpD,EAAO,CAAC,GAAK,KAAM,IAAM,MAAQ2C,EAAKU,KAE7E,CAED,SAASE,EAAiBZ,GAEjB/C,EAAOoB,YAAc,EACrB3B,EAAO+D,gBAAgB,QAAQxD,EAAOoB,YAAY,IAAIhB,EAAO,CAAC,GAAK,KAAK,IAAM,wFAE9EX,EAAO+D,gBAAgB,QAAQpD,EAAQ,CAAC,GAAK,KAAK,IAAM,uFAEhE,CAEA,SAASP,IAEL,GAAsB,OAAlByB,EACA,IACIA,EAAcsC,aAClB,CAAE,MAAOC,GAET,CAGJnE,EAAAA,EAAgBC,aAAamE,eAAe,gBAAiBP,GAC7D7D,EAAAA,EAAgBC,aAAamE,eAAe,cAAeJ,GAC3DhE,EAAAA,EAAgBC,aAAamE,eAAe,mBAAoBH,GAEhE1D,EAAS,CACL,KAAQ,iBACR,KAAQ,CAAC8D,cAAexD,KAG5BN,EAAS,CACL,KAAQ,uBACR,KAAQ,UAEhB,CAaA,SAASyB,IACL,IAAIsC,EAA4B,MAAjB1C,EAGXA,EADAtB,EAAOoB,YAAc,EACL3B,EAAOwE,UAAU,QAAQjE,EAAOoB,YAAY,IAAIhB,GAEhDX,EAAOwE,UAAU,QAAU7D,GAG/CV,EAAAA,EAAgBC,aAAaC,YAAY,gBAAiB2D,GAC1D7D,EAAAA,EAAgBC,aAAaC,YAAY,cAAe8D,GACxDhE,EAAAA,EAAgBC,aAAaC,YAAY,mBAAoB+D,GAE7D1D,EAAS,CACL,KAAQ,oBACR,KAAQ,WAGI,GAAZ+D,KAEA5B,EAAAA,EAAAA,GAAAC,IAAAA,MAAC,SAAA6B,IAAA,IAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAAnC,IAAAA,MAAA,SAAAoC,GAAA,cAAAA,EAAAhC,KAAAgC,EAAA/B,MAAA,OAAA+B,EAAAhC,KAAA,EAAA0B,GAAA,EAAAC,GAAA,EAAAK,EAAAhC,KAAA,EAAA6B,EAAAI,EAE+BpD,EAAc2B,SAAS,cAAY,cAAAwB,EAAA/B,KAAA,EAAA4B,EAAA5B,OAAA,YAAAyB,IAAAI,EAAAE,EAAAE,MAAAC,MAAA,CAAAH,EAAA/B,KAAA,QAAvC6B,EAAAxE,MAChBN,EAAO+D,gBAAiBxD,EAAOoB,YAAc,EAAI,QAAUpB,EAAOoB,YAAc,IAAMhB,EAAS,QAAUA,EAAS,CAC9G,GAAM,YACNoB,QAAQ,IAEZvB,EAAS,CACL,KAAQ,iBACR,KAAQ,CAAC8D,cAAe,OACzB,OAAAI,GAAA,EAAAM,EAAA/B,KAAA,eAAA+B,EAAA/B,KAAA,eAAA+B,EAAAhC,KAAA,EAAA+B,EAAAC,EAAA,SAAAL,GAAA,EAAAC,EAAAG,EAAA,UAAAC,EAAAhC,KAAA,EAAAgC,EAAAhC,KAAA,GAAA0B,GAAA,MAAAG,EAAAO,OAAA,CAAAJ,EAAA/B,KAAA,eAAA+B,EAAA/B,KAAA,EAAA4B,EAAAO,SAAA,UAAAJ,EAAAhC,KAAA,GAAA2B,EAAA,CAAAK,EAAA/B,KAAA,eAAA2B,EAAA,eAAAI,EAAAK,OAAA,kBAAAL,EAAAK,OAAA,WAAAL,EAAA/B,KAAA,wBAAA+B,EAAAhC,KAAA,GAAAgC,EAAA,SAAAA,EAAA/B,KAAA,GAGWpB,EAAc2B,SAAS,aAAaC,OAAM,QAAnDuB,EAAAE,KACTlF,EAAO+D,gBAAiBxD,EAAOoB,YAAc,EAAI,QAAUpB,EAAOoB,YAAc,IAAMhB,EAAS,QAAUA,EAAS,CAC9G,GAAM,YACNoB,QAAQ,IACT,yBAAAiD,EAAAtB,OAAA,GAAAe,EAAA,uCAjBX9B,IAqBAA,EAAAA,EAAAA,GAAAC,IAAAA,MAAC,SAAA0C,IAAA,IAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAArD,IAAAA,MAAA,SAAAsD,GAAA,cAAAA,EAAAlD,KAAAkD,EAAAjD,MAAA,OAAAiD,EAAAlD,KAAA,EAAAuC,GAAA,EAAAC,GAAA,EAAAU,EAAAlD,KAAA,EAAA0C,EAAAT,EAE4BpD,GAAa,cAAAqE,EAAAjD,KAAA,EAAAyC,EAAAzC,OAAA,YAAAsC,IAAAI,EAAAO,EAAAhB,MAAAC,MAAA,CAAAe,EAAAjD,KAAA,QACjB,OADF2C,EAAED,EAAArF,OACNsF,GACmB,GAAlBA,EAAGtC,KAAKvB,OACRvB,EAAS,CACL,KAAQ,sBACR,KAAQ,CAAC2F,KAAMP,EAAGtC,KAAK8C,MAAQR,EAAGtC,KAAK8C,MAAQ,IAAMC,EAAAA,EAAKC,EAAE,eAAgBV,EAAGtC,KAAKiD,OAGxF/F,EAAS,CACL,KAAQ,sBACR,KAAQ,CAAC2F,KAAM,MAGP,SAATP,EAAGA,IAGgB,OAAtB7E,IACAA,EAAoByF,SAASC,cAAc,4DAEvC1F,EAAkB2F,UAAY,GAC9B3F,EAAkB4F,cAAcC,UAAUC,IAAI,8BAIlD9F,KACmB,IAAf6E,EAAGkB,QACH/F,EAAkB2F,WAAad,EAAG5B,IAAI+C,WAAW,SAAS,KAE1DhG,EAAkBiG,WAAapB,EAAG5B,IAAI+C,WAAW,SAAS,KAE9DhG,EAAkBkG,mBAGN,QAATrB,EAAGA,IAAyB,WAATA,EAAGA,IAC7B7E,EAAoB,MACdL,EAAQD,KACJG,WAAWsG,MAAM,CAAC,WAAW,QACnC1G,GAAS2G,EAAAA,EAAAA,IAAc,CACnB,QAAWzG,EAAME,WAAWC,MAAM,CAAC,WAAW,OAC9C,KAASH,EAAME,WAAWC,MAAM,CAAC,WAAW,SAC5C,OAAWH,EAAME,WAAWC,MAAM,CAAC,eAAe,WAClD,MAAUH,EAAME,WAAWwG,IAAI,SAC/B,eAAqB1G,EAAME,WAAWwG,IAAI,UAA4C,UAAhC1G,EAAME,WAAWwG,IAAI,SAAyD,UAAhC1G,EAAME,WAAWwG,IAAI,SAAuBZ,SAASa,aAAgD,GAAhCjF,OAAOG,QAAoB,eAG5L,QAATqD,EAAGA,IACJlF,EAAQD,KACJG,WAAWsG,MAAM,CAAC,WAAW,SACnCI,EAAAA,EAAAA,IAAc,CACV,OAAY1B,EAAG2B,KACf,OAAW7G,EAAME,WAAWC,MAAM,CAAC,eAAe,WAClD,KAASH,EAAME,WAAWwG,IAAI,QAC9B,MAAU1G,EAAME,WAAWwG,IAAI,SAC/B,GAAO1G,EAAME,WAAWC,MAAM,CAAC,WAAW,OAC1C,KAASH,EAAME,WAAWC,MAAM,CAAC,WAAW,SAC5C,WAAc,GAPlByG,CAQG9G,EAAUC,GAED,WAATmF,EAAGA,IAA4B,UAATA,EAAGA,IAC1BlF,EAAQD,KACJG,WAAWsG,MAAM,CAAC,WAAW,QACnC1G,GAASgH,EAAAA,EAAAA,IAAgB,CACrB,QAAW9G,EAAME,WAAWC,MAAM,CAAC,WAAW,OAC9C,KAASH,EAAME,WAAWC,MAAM,CAAC,WAAW,SAC5C,KAASH,EAAME,WAAWwG,IAAI,QAC9B,MAAU1G,EAAME,WAAWwG,IAAI,YAGvB,MAATxB,EAAGA,KACJlF,EAAQD,KACJG,WAAWsG,MAAM,CAAC,WAAW,QACnClH,EAAO+D,gBAAiBxD,EAAOoB,YAAc,EAAI,QAAQpB,EAAOoB,YAAY,IAAIjB,EAAME,WAAWC,MAAM,CAAC,WAAW,OAAS,QAAQH,EAAME,WAAWC,MAAM,CAAC,WAAW,OAAS,CAAC,GAAK,YAAakB,QAAQ,IAElN,OAAAwD,GAAA,EAAAW,EAAAjD,KAAA,eAAAiD,EAAAjD,KAAA,eAAAiD,EAAAlD,KAAA,EAAAiD,EAAAC,EAAA,SAAAV,GAAA,EAAAC,EAAAQ,EAAA,UAAAC,EAAAlD,KAAA,EAAAkD,EAAAlD,KAAA,GAAAuC,GAAA,MAAAG,EAAAN,OAAA,CAAAc,EAAAjD,KAAA,eAAAiD,EAAAjD,KAAA,EAAAyC,EAAAN,SAAA,UAAAc,EAAAlD,KAAA,GAAAwC,EAAA,CAAAU,EAAAjD,KAAA,eAAAwC,EAAA,eAAAS,EAAAb,OAAA,kBAAAa,EAAAb,OAAA,WAAAa,EAAAjD,KAAA,iBAAAiD,EAAAlD,KAAA,GAAAkD,EAAA,kCAAAA,EAAAxC,OAAA,GAAA4B,EAAA,uCA3Eb3C,GAkFT,EAjOCA,EAAAA,EAAAA,GAAAC,IAAAA,MAAC,SAAA6E,IAAA,IAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAAnF,IAAAA,MAAA,SAAAoF,GAAA,cAAAA,EAAAhF,KAAAgF,EAAA/E,MAAA,OAAA+E,EAAAhF,KAAA,EAAA0E,GAAA,EAAAC,GAAA,EAAAK,EAAAhF,KAAA,EAAA6E,EAAA5C,EAEgCjF,EAAOwD,SAAS,YAAU,cAAAwE,EAAA/E,KAAA,EAAA4E,EAAA5E,OAAA,YAAAyE,IAAAI,EAAAE,EAAA9C,MAAAC,MAAA,CAAA6C,EAAA/E,KAAA,QAC/CnB,EADiBgG,EAAAxH,OACkB,OAAAoH,GAAA,EAAAM,EAAA/E,KAAA,eAAA+E,EAAA/E,KAAA,eAAA+E,EAAAhF,KAAA,EAAA+E,EAAAC,EAAA,SAAAL,GAAA,EAAAC,EAAAG,EAAA,UAAAC,EAAAhF,KAAA,EAAAgF,EAAAhF,KAAA,GAAA0E,GAAA,MAAAG,EAAAzC,OAAA,CAAA4C,EAAA/E,KAAA,eAAA+E,EAAA/E,KAAA,EAAA4E,EAAAzC,SAAA,UAAA4C,EAAAhF,KAAA,GAAA2E,EAAA,CAAAK,EAAA/E,KAAA,eAAA2E,EAAA,eAAAI,EAAA3C,OAAA,kBAAA2C,EAAA3C,OAAA,WAAA2C,EAAA/E,KAAA,wBAAA+E,EAAAhF,KAAA,GAAAgF,EAAA,SAAAA,EAAA/E,KAAA,GAGpBjD,EAAOwD,SAAS,WAAWC,OAAM,QACpD3B,EADUkG,EAAA9C,MACyB,yBAAA8C,EAAAtE,OAAA,GAAA+D,EAAA,uCAP3C9E,IA2FAA,EAAAA,EAAAA,GAAAC,IAAAA,MAAC,SAAAqF,IAAA,IAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAA3F,IAAAA,MAAA,SAAA4F,GAAA,cAAAA,EAAAxF,KAAAwF,EAAAvF,MAAA,OAAAuF,EAAAxF,KAAA,EAAAkF,GAAA,EAAAC,GAAA,EAAAK,EAAAxF,KAAA,EAAAqF,EAAApD,EAE+BjF,EAAOwD,SAAS,eAAa,cAAAgF,EAAAvF,KAAA,EAAAoF,EAAApF,OAAA,YAAAiF,IAAAI,EAAAE,EAAAtD,MAAAC,MAAA,CAAAqD,EAAAvF,KAAA,QAAjCqF,EAAAhI,MAChBF,IAAa,OAAA8H,GAAA,EAAAM,EAAAvF,KAAA,eAAAuF,EAAAvF,KAAA,eAAAuF,EAAAxF,KAAA,EAAAuF,EAAAC,EAAA,SAAAL,GAAA,EAAAC,EAAAG,EAAA,UAAAC,EAAAxF,KAAA,EAAAwF,EAAAxF,KAAA,GAAAkF,GAAA,MAAAG,EAAAjD,OAAA,CAAAoD,EAAAvF,KAAA,eAAAuF,EAAAvF,KAAA,EAAAoF,EAAAjD,SAAA,UAAAoD,EAAAxF,KAAA,GAAAmF,EAAA,CAAAK,EAAAvF,KAAA,eAAAmF,EAAA,eAAAI,EAAAnD,OAAA,kBAAAmD,EAAAnD,OAAA,WAAAmD,EAAAvF,KAAA,wBAAAuF,EAAAxF,KAAA,GAAAwF,EAAA,SAAAA,EAAAvF,KAAA,GAGEjD,EAAOwD,SAAS,cAAcC,OAAM,QAA7C+E,EAAAtD,KACV9E,IAAa,yBAAAoI,EAAA9E,OAAA,GAAAuE,EAAA,uCAPrBtF,IAwIDA,EAAAA,EAAAA,GAAAC,IAAAA,MAAC,SAAA6F,IAAA,IAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAAnG,IAAAA,MAAA,SAAAoG,GAAA,cAAAA,EAAAhG,KAAAgG,EAAA/F,MAAA,OAAA+F,EAAAhG,KAAA,EAAA0F,GAAA,EAAAC,GAAA,EAAAK,EAAAhG,KAAA,EAAA6F,EAAA5D,EAEgCjF,EAAOwD,SAAS,mBAAiB,cAAAwF,EAAA/F,KAAA,EAAA4F,EAAA5F,OAAA,YAAAyF,IAAAI,EAAAE,EAAA9D,MAAAC,MAAA,CAAA6D,EAAA/F,KAAA,QAArC6F,EAAAxI,MAChB4B,IAAiB,OAAAwG,GAAA,EAAAM,EAAA/F,KAAA,eAAA+F,EAAA/F,KAAA,eAAA+F,EAAAhG,KAAA,EAAA+F,EAAAC,EAAA,SAAAL,GAAA,EAAAC,EAAAG,EAAA,UAAAC,EAAAhG,KAAA,EAAAgG,EAAAhG,KAAA,GAAA0F,GAAA,MAAAG,EAAAzD,OAAA,CAAA4D,EAAA/F,KAAA,eAAA+F,EAAA/F,KAAA,EAAA4F,EAAAzD,SAAA,UAAA4D,EAAAhG,KAAA,GAAA2F,EAAA,CAAAK,EAAA/F,KAAA,eAAA2F,EAAA,eAAAI,EAAA3D,OAAA,kBAAA2D,EAAA3D,OAAA,WAAA2D,EAAA/F,KAAA,wBAAA+F,EAAAhG,KAAA,GAAAgG,EAAA,SAAAA,EAAA/F,KAAA,GAGHjD,EAAOwD,SAAS,kBAAkBC,OAAM,QAAjDuF,EAAA9D,KACThD,IAAiB,yBAAA8G,EAAAtF,OAAA,GAAA+E,EAAA,uCAP1B9F,EAUH,IAAC,CA7RY,GAgSXsG,EAAa,IAAItJ,C","sources":["webpack://LHCReactAPP/./src/extensions/nodejs/nodeJSChat.js"],"sourcesContent":["import { helperFunctions } from \"../../lib/helperFunctions\";\nimport { fetchMessages, checkChatStatus, updateMessage } from \"../../actions/chatActions\"\n\nimport socketCluster from \"socketcluster-client\";\nimport i18n from \"../../i18n\";\n\n\nclass _nodeJSChat {\n    constructor() {\n        this.socket = null;\n\n        // On chat close event close connection\n        helperFunctions.eventEmitter.addListener('endedChat', () => {\n            if (this.socket !== null) {\n                this.socket.disconnect();\n            }\n        });\n    }\n\n    bootstrap(params, dispatch, getState) {\n\n        const state = getState();\n        const chatId = state.chatwidget.getIn(['chatData','id']);\n        const chatHash = state.chatwidget.getIn(['chatData','hash']);\n        const syncDefault = state.chatwidget.getIn(['chat_ui','sync_interval']);\n        var streamFlowStarted = null;\n\n        var socketOptions = {\n            protocolVersion: 1,\n            hostname: params.hostname,\n            path: params.path,\n            disconnectOnUnload: false,\n            autoReconnectOptions: {initialDelay: 5000, randomness: 5000}\n        }\n\n        if (params.port != '') {\n            socketOptions.port = parseInt(params.port);\n        }\n\n        if (params.secure == 1) {\n            socketOptions.secure = true;\n        }\n\n        var chanelName;\n\n        if (params.instance_id > 0) {\n            chanelName = ('chat_'+params.instance_id+'_'+chatId);\n        } else{\n            chanelName = ('chat_'+chatId);\n        }\n\n        var socket = this.socket = socketCluster.create(socketOptions);\n\n        var sampleChannel = null;\n\n        (async () => {\n            try {\n                for await (let status of socket.listener('connect')) {\n                    doActionByConnectionStatus(status);\n                }\n            } catch (e) {\n                let status = await socket.listener('connect').once();\n                doActionByConnectionStatus(status);\n            }\n        })();\n\n        function doActionByConnectionStatus(status) {\n            if (status.isAuthenticated && chatId > 0) {\n                connectVisitor();\n            } else {\n                authentificate();\n            }\n        }\n\n        function authentificate() {\n            const state = getState();\n            let chat_id = state.chatwidget.getIn(['chatData','id']);\n            window.lhcAxios.post(window.lhcChat['base_url'] + \"nodejshelper/tokenvisitor/\"+chat_id+\"/\"+state.chatwidget.getIn(['chatData','hash']), null, {headers : {'Content-Type': 'application/x-www-form-urlencoded'}}).then(async (response) => {\n                await Promise.all([\n                    socket.invoke('login', {hash: response.data, chanelName: (params.instance_id > 0 ? ('chat_'+params.instance_id+'_'+chat_id) : ('chat_'+chat_id)) }),\n                    socket.listener('authenticate').once()\n                ]);\n                connectVisitor();\n            });\n        }\n\n       function visitorTypingListener(data)\n       {\n            if (data.status == true){\n                if (params.instance_id > 0) {\n                    socket.transmitPublish('chat_'+params.instance_id+'_'+chatId,{'op':'vt','msg':data.msg});\n                } else {\n                    socket.transmitPublish('chat_'+chatId,{'op':'vt','msg':data.msg});\n                }\n            } else {\n                if (params.instance_id > 0) {\n                    socket.transmitPublish('chat_'+params.instance_id+'_'+chatId,{'op':'vts'});\n                } else {\n                    socket.transmitPublish('chat_'+chatId,{'op':'vts'});\n                }\n            }\n       }\n\n       function messageSend(data)\n       {\n            if (params.instance_id > 0) {\n                socket.transmitPublish('chat_'+params.instance_id+'_'+chatId, {'op':'vt','msg':'✉️ ' + data.msg});\n            } else {\n                socket.transmitPublish('chat_'+chatId,{'op':'vt', 'msg':'✉️ ' + data.msg});\n            }\n        }\n\n       function messageSendError(data)\n       {\n            if (params.instance_id > 0) {\n                socket.transmitPublish('chat_'+params.instance_id+'_'+chatId,{'op':'vt','msg':'📕️ error happened while sending visitor message, please inform your administrator!'});\n            } else {\n                socket.transmitPublish('chat_'+chatId, {'op':'vt','msg':'📕️ error happened while sending visitor message, please inform your administrator!'});\n            }\n        }\n\n        function disconnect() {\n\n            if (sampleChannel !== null) {\n                try {\n                    sampleChannel.unsubscribe();\n                } catch (e) {\n\n                }\n            }\n\n            helperFunctions.eventEmitter.removeListener('visitorTyping', visitorTypingListener);\n            helperFunctions.eventEmitter.removeListener('messageSend', messageSend);\n            helperFunctions.eventEmitter.removeListener('messageSendError', messageSendError);\n\n            dispatch({\n                'type': 'CHAT_UI_UPDATE',\n                'data': {sync_interval: syncDefault}\n            });\n\n            dispatch({\n                'type': 'CHAT_REMOVE_OVERRIDE',\n                'data': \"typing\"\n            });\n        }\n\n        (async () => {\n            try {\n                for await (let event of socket.listener('disconnect')) {\n                    disconnect();\n                }\n            } catch (e) {\n                let status = await socket.listener('disconnect').once();\n                disconnect();\n            }\n        })();\n\n        function connectVisitor() {\n            var firstRun = sampleChannel == null;\n\n            if (params.instance_id > 0) {\n                sampleChannel = socket.subscribe('chat_'+params.instance_id+'_'+chatId);\n            } else {\n                sampleChannel = socket.subscribe('chat_' + chatId);\n            }\n\n            helperFunctions.eventEmitter.addListener('visitorTyping', visitorTypingListener);\n            helperFunctions.eventEmitter.addListener('messageSend', messageSend);\n            helperFunctions.eventEmitter.addListener('messageSendError', messageSendError);\n\n            dispatch({\n                'type': 'CHAT_ADD_OVERRIDE',\n                'data': \"typing\"\n            });\n\n            if (firstRun == true)\n            {\n                (async () => {\n                    try {\n                        for await (let event of sampleChannel.listener('subscribe')) {\n                            socket.transmitPublish((params.instance_id > 0 ? 'chat_' + params.instance_id + '_' + chatId : 'chat_' + chatId), {\n                                'op': 'vi_online',\n                                status: true\n                            });\n                            dispatch({\n                                'type': 'CHAT_UI_UPDATE',\n                                'data': {sync_interval: 10000}\n                            });\n                        }\n                    } catch (e) {\n                        let event = await sampleChannel.listener('subscribe').once();\n                        socket.transmitPublish((params.instance_id > 0 ? 'chat_' + params.instance_id + '_' + chatId : 'chat_' + chatId), {\n                            'op': 'vi_online',\n                            status: true\n                        });\n                    }\n\n                })();\n                (async () => {\n                    try {\n                        for await (let op of sampleChannel) {\n                            if (op.op == 'ot') { // Operator Typing Message\n                                if (op.data.status == true) {\n                                    dispatch({\n                                        'type': 'chat_status_changed',\n                                        'data': {text: op.data.typer ? op.data.typer + \" \" + i18n.t('chat.typing'): op.data.ttx}\n                                    });\n                                } else {\n                                    dispatch({\n                                        'type': 'chat_status_changed',\n                                        'data': {text: ''}\n                                    });\n                                }\n                            } else if (op.op == 'sflow') {\n\n                                // We don't have any\n                                if (streamFlowStarted === null) {\n                                    streamFlowStarted = document.querySelector('#messages-scroll > div.message-row-typing > .msg-body');\n                                    if (streamFlowStarted) {\n                                        streamFlowStarted.innerHTML = \"\";\n                                        streamFlowStarted.parentElement.classList.add('message-row-typing-stream');\n                                    }\n                                }\n\n                                if (streamFlowStarted) {\n                                    if (op.as_html === true){\n                                        streamFlowStarted.innerHTML += op.msg.replaceAll('__SL__',\"/\");\n                                    } else {\n                                        streamFlowStarted.innerText += op.msg.replaceAll('__SL__',\"/\");\n                                    }\n                                    streamFlowStarted.scrollIntoView();\n                                }\n\n                            } else if (op.op == 'cmsg' || op.op == 'schange') {\n                                streamFlowStarted = null;\n                                const state = getState();\n                                if (state.chatwidget.hasIn(['chatData','id'])){\n                                    dispatch(fetchMessages({\n                                        'chat_id': state.chatwidget.getIn(['chatData','id']),\n                                        'hash' : state.chatwidget.getIn(['chatData','hash']),\n                                        'lmgsid' : state.chatwidget.getIn(['chatLiveData','lmsgid']),\n                                        'theme' : state.chatwidget.get('theme'),\n                                        'active_widget':  (((state.chatwidget.get('shown') && state.chatwidget.get('mode') == 'widget') || (state.chatwidget.get('mode') != 'widget' && document.hasFocus())) && window.lhcChat['is_focused'] == true)\n                                    }));\n                                }\n                            } else if (op.op == 'umsg') {\n                                const state = getState();\n                                if (state.chatwidget.hasIn(['chatData','id'])) {\n                                    updateMessage({\n                                        'msg_id' :  op.msid,\n                                        'lmgsid' : state.chatwidget.getIn(['chatLiveData','lmsgid']),\n                                        'mode' : state.chatwidget.get('mode'),\n                                        'theme' : state.chatwidget.get('theme'),\n                                        'id' : state.chatwidget.getIn(['chatData','id']),\n                                        'hash' : state.chatwidget.getIn(['chatData','hash']),\n                                        'no_scroll' : true\n                                    })(dispatch, getState);\n                                }\n                            } else if (op.op == 'schange' || op.op == 'cclose') {\n                                const state = getState();\n                                if (state.chatwidget.hasIn(['chatData','id'])){\n                                    dispatch(checkChatStatus({\n                                        'chat_id': state.chatwidget.getIn(['chatData','id']),\n                                        'hash' : state.chatwidget.getIn(['chatData','hash']),\n                                        'mode' : state.chatwidget.get('mode'),\n                                        'theme' : state.chatwidget.get('theme')\n                                    }));\n                                }\n                            } else if (op.op == 'vo') {\n                                const state = getState();\n                                if (state.chatwidget.hasIn(['chatData','id'])) {\n                                    socket.transmitPublish((params.instance_id > 0 ? 'chat_'+params.instance_id+'_'+state.chatwidget.getIn(['chatData','id']) : 'chat_'+state.chatwidget.getIn(['chatData','id'])) ,{'op':'vi_online', status: true});\n                                }\n                            }\n                        }\n                    } catch (e) {\n                        // Shut up old browsers\n                    }\n                })();\n            }\n       }\n\n       (async () => {\n            try {\n                for await (let event of socket.listener('deauthenticate')) {\n                    authentificate();\n                }\n            } catch (e) {\n                let event = await socket.listener('deauthenticate').once();\n                authentificate();\n            }\n       })();\n    }\n}\n\nconst nodeJSChat = new _nodeJSChat();\nexport { nodeJSChat };"],"names":["_nodeJSChat","_createClass","_this","_classCallCheck","this","socket","helperFunctions","eventEmitter","addListener","disconnect","key","value","params","dispatch","getState","state","chatId","chatwidget","getIn","syncDefault","streamFlowStarted","socketOptions","protocolVersion","hostname","path","disconnectOnUnload","autoReconnectOptions","initialDelay","randomness","port","parseInt","secure","instance_id","socketCluster","sampleChannel","doActionByConnectionStatus","status","isAuthenticated","connectVisitor","authentificate","chat_id","window","lhcAxios","post","lhcChat","headers","then","_ref2","_asyncToGenerator","_regeneratorRuntime","_callee2","response","_context2","prev","next","Promise","all","invoke","hash","data","chanelName","listener","once","stop","_x","apply","arguments","visitorTypingListener","transmitPublish","msg","messageSend","messageSendError","unsubscribe","e","removeListener","sync_interval","firstRun","subscribe","_callee4","_iteratorAbruptCompletion3","_didIteratorError3","_iteratorError3","_iterator3","_step3","_t5","_context4","_asyncIterator","sent","done","return","finish","_callee5","_iteratorAbruptCompletion4","_didIteratorError4","_iteratorError4","_iterator4","_step4","op","_state","_state2","_state3","_state4","_t7","_context5","text","typer","i18n","t","ttx","document","querySelector","innerHTML","parentElement","classList","add","as_html","replaceAll","innerText","scrollIntoView","hasIn","fetchMessages","get","hasFocus","updateMessage","msid","checkChatStatus","_callee","_iteratorAbruptCompletion","_didIteratorError","_iteratorError","_iterator","_step","_t","_context","_callee3","_iteratorAbruptCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","_t3","_context3","_callee6","_iteratorAbruptCompletion5","_didIteratorError5","_iteratorError5","_iterator5","_step5","_t9","_context6","nodeJSChat"],"sourceRoot":""}