{"version":3,"file":"departments.js","sources":["../../src/Widgets/LHCDepartmentPicker.svelte","../../node_modules/svelte/src/internal/client/dom/legacy/event-modifiers.js"],"sourcesContent":["<svelte:options customElement={{tag: 'lhc-department-picker', shadow: 'none'}}/>\r\n\r\n<script>\r\n    import { onMount } from 'svelte';\r\n\r\n    export let input_name = 'department_ids[]';\r\n    export let input_selector = '';\r\n    export let selected_ids = '[]';\r\n    export let ajax_url = 'chat/searchprovider/deps';\r\n    export let placeholder = 'Choose department';\r\n    export let base_url = '';\r\n    export let json_input = '';\r\n\r\n    let departments = [];\r\n    let selectedDepartments = [];\r\n    let searchQuery = '';\r\n    let isLoading = false;\r\n    let hiddenInput = null;\r\n    let jsonInput = null;\r\n    let loadedDepartmentNames = {};\r\n\r\n    onMount(() => {\r\n        // Find json input if json_input name provided (output only)\r\n        if (json_input) {\r\n            jsonInput = document.querySelector('input[name=\"' + json_input + '\"], textarea[name=\"' + json_input + '\"]');\r\n        }\r\n\r\n        // Parse initial selected IDs\r\n        try {\r\n            const parsed = typeof selected_ids === 'string' ? JSON.parse(selected_ids) : selected_ids;\r\n            if (Array.isArray(parsed)) {\r\n                selectedDepartments = parsed.map(item => {\r\n                    if (typeof item === 'object' && item.id !== undefined) {\r\n                        loadedDepartmentNames[item.id] = item.name || `Department #${item.id}`;\r\n                        return item.id;\r\n                    }\r\n                    return item;\r\n                });\r\n            }\r\n        } catch (e) {\r\n            console.error('Error parsing selected_ids', e);\r\n        }\r\n\r\n        // Find hidden input if selector provided\r\n        if (input_selector) {\r\n            hiddenInput = document.querySelector(input_selector);\r\n            if (hiddenInput && hiddenInput.value) {\r\n                try {\r\n                    const parsed = JSON.parse(hiddenInput.value);\r\n                    if (Array.isArray(parsed)) {\r\n                        selectedDepartments = parsed.map(item => {\r\n                            if (typeof item === 'object' && item.id !== undefined) {\r\n                                loadedDepartmentNames[item.id] = item.name || `Department #${item.id}`;\r\n                                return item.id;\r\n                            }\r\n                            return item;\r\n                        });\r\n                    }\r\n                } catch (e) {\r\n                    console.error('Error parsing hidden input value', e);\r\n                }\r\n            }\r\n        }\r\n\r\n        // Load initial departments\r\n        loadDepartments();\r\n    });\r\n\r\n    function getBaseUrl() {\r\n        if (base_url) return base_url;\r\n        if (typeof window.WWW_DIR_JAVASCRIPT !== 'undefined') return window.WWW_DIR_JAVASCRIPT;\r\n        return '/';\r\n    }\r\n\r\n    async function loadDepartments(query = '') {\r\n        isLoading = true;\r\n        try {\r\n            const url = new URL(getBaseUrl() + ajax_url, window.location.origin);\r\n            if (query) {\r\n                url.searchParams.set('q', query);\r\n            }\r\n\r\n            const response = await fetch(url.toString());\r\n            const data = await response.json();\r\n\r\n            if (data.items) {\r\n                departments = data.items;\r\n\r\n                // Update loaded department names\r\n                departments.forEach(dept => {\r\n                    loadedDepartmentNames[dept.id] = dept.name;\r\n                });\r\n                loadedDepartmentNames = {...loadedDepartmentNames};\r\n            }\r\n        } catch (e) {\r\n            console.error('Error loading departments', e);\r\n        }\r\n        isLoading = false;\r\n    }\r\n\r\n    function handleSearch(event) {\r\n        searchQuery = event.target.value;\r\n        loadDepartments(searchQuery);\r\n    }\r\n\r\n    function selectDepartment(dept) {\r\n        // Check if already selected\r\n        if (!selectedDepartments.includes(dept.id)) {\r\n            loadedDepartmentNames[dept.id] = dept.name;\r\n            selectedDepartments = [...selectedDepartments, dept.id];\r\n            updateHiddenInput();\r\n        }\r\n    }\r\n\r\n    function removeDepartment(deptId) {\r\n        selectedDepartments = selectedDepartments.filter(id => id !== deptId);\r\n        updateHiddenInput();\r\n    }\r\n\r\n    function updateHiddenInput() {\r\n        if (hiddenInput) {\r\n            hiddenInput.value = JSON.stringify(selectedDepartments);\r\n        }\r\n        if (jsonInput) {\r\n            jsonInput.value = JSON.stringify(selectedDepartments);\r\n        }\r\n    }\r\n\r\n    function isSelected(deptId) {\r\n        return selectedDepartments.includes(deptId);\r\n    }\r\n\r\n    function getDepartmentName(deptId) {\r\n        return loadedDepartmentNames[deptId] || `Department #${deptId}`;\r\n    }\r\n</script>\r\n\r\n<div class=\"row\">\r\n    <div class=\"col-4\">\r\n        <div class=\"btn-block-department\" data-limit=\"1\">\r\n            <ul class=\"nav\">\r\n                <li class=\"dropdown w-100\">\r\n                    <button type=\"button\" class=\"btn btn-light btn-block btn-sm dropdown-toggle btn-department-dropdown\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\">\r\n                        {placeholder}\r\n                    </button>\r\n                    <ul class=\"dropdown-menu\" role=\"menu\">\r\n                        <li class=\"btn-block-department-filter\">\r\n                            <input \r\n                                data-scope={input_name.replace('[]', '')} \r\n                                ajax-provider={ajax_url}\r\n                                type=\"text\" \r\n                                class=\"form-control input-sm\" \r\n                                value={searchQuery}\r\n                                on:input={handleSearch}\r\n                            />\r\n                            <div class=\"selected-items-filter\">\r\n                                {#each selectedDepartments as deptId}\r\n                                    <div class=\"fs12\">\r\n                                        <!-- svelte-ignore a11y-click-events-have-key-events a11y-no-static-element-interactions a11y-missing-attribute -->\r\n                                        <a data-stoppropagation=\"true\" class=\"delete-item\" data-value={deptId} on:click|preventDefault={() => removeDepartment(deptId)}>\r\n                                            <input type=\"hidden\" value={deptId} name={input_name} />\r\n                                            <i class=\"material-icons chat-unread\">delete</i>{getDepartmentName(deptId)}\r\n                                        </a>\r\n                                    </div>\r\n                                {/each}\r\n                            </div>\r\n                        </li>\r\n                        <li class=\"dropdown-result\">\r\n                            <ul class=\"list-unstyled dropdown-lhc\">\r\n                                {#if isLoading}\r\n                                    <!-- svelte-ignore a11y-click-events-have-key-events a11y-no-noninteractive-element-interactions -->\r\n                                    <li data-stoppropagation=\"true\" class=\"search-option-item text-center\">\r\n                                        <small>Loading...</small>\r\n                                    </li>\r\n                                {:else if departments.length === 0}\r\n                                    <!-- svelte-ignore a11y-click-events-have-key-events a11y-no-noninteractive-element-interactions -->\r\n                                    <li data-stoppropagation=\"true\" class=\"search-option-item text-center\">\r\n                                        <small>No departments found</small>\r\n                                    </li>\r\n                                {:else}\r\n                                    {#each departments as dept}\r\n                                        <!-- svelte-ignore a11y-click-events-have-key-events a11y-no-noninteractive-element-interactions -->\r\n                                        <li data-stoppropagation=\"true\" class=\"search-option-item\">\r\n                                            <label>\r\n                                                <input \r\n                                                    title={dept.id}\r\n                                                    class=\"me-1\" \r\n                                                    type=\"radio\" \r\n                                                    name=\"selector-{input_name}\"\r\n                                                    checked={isSelected(dept.id)}\r\n                                                    on:change={() => selectDepartment(dept)}\r\n                                                    value={dept.id}\r\n                                                />\r\n                                                {dept.name}\r\n                                            </label>\r\n                                        </li>\r\n                                    {/each}\r\n                                {/if}\r\n                            </ul>\r\n                        </li>\r\n                    </ul>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n    </div>\r\n    <div class=\"col-8\">\r\n        {#each selectedDepartments as deptId}\r\n            <!-- svelte-ignore a11y-click-events-have-key-events a11y-no-static-element-interactions a11y-interactive-supports-focus -->\r\n            <span role=\"tabpanel\" title=\"Click to remove\" class=\"badge bg-secondary m-1 action-image\" on:click={() => removeDepartment(deptId)}>\r\n                {getDepartmentName(deptId)} <span class=\"material-icons text-warning me-0\">delete</span>\r\n            </span>\r\n        {/each}\r\n    </div>\r\n</div>\r\n","import { noop } from '../../../shared/utils.js';\nimport { user_pre_effect } from '../../reactivity/effects.js';\nimport { on } from '../elements/events.js';\n\n/**\n * Substitute for the `trusted` event modifier\n * @deprecated\n * @param {(event: Event, ...args: Array<unknown>) => void} fn\n * @returns {(event: Event, ...args: unknown[]) => void}\n */\nexport function trusted(fn) {\n\treturn function (...args) {\n\t\tvar event = /** @type {Event} */ (args[0]);\n\t\tif (event.isTrusted) {\n\t\t\t// @ts-ignore\n\t\t\tfn?.apply(this, args);\n\t\t}\n\t};\n}\n\n/**\n * Substitute for the `self` event modifier\n * @deprecated\n * @param {(event: Event, ...args: Array<unknown>) => void} fn\n * @returns {(event: Event, ...args: unknown[]) => void}\n */\nexport function self(fn) {\n\treturn function (...args) {\n\t\tvar event = /** @type {Event} */ (args[0]);\n\t\t// @ts-ignore\n\t\tif (event.target === this) {\n\t\t\t// @ts-ignore\n\t\t\tfn?.apply(this, args);\n\t\t}\n\t};\n}\n\n/**\n * Substitute for the `stopPropagation` event modifier\n * @deprecated\n * @param {(event: Event, ...args: Array<unknown>) => void} fn\n * @returns {(event: Event, ...args: unknown[]) => void}\n */\nexport function stopPropagation(fn) {\n\treturn function (...args) {\n\t\tvar event = /** @type {Event} */ (args[0]);\n\t\tevent.stopPropagation();\n\t\t// @ts-ignore\n\t\treturn fn?.apply(this, args);\n\t};\n}\n\n/**\n * Substitute for the `once` event modifier\n * @deprecated\n * @param {(event: Event, ...args: Array<unknown>) => void} fn\n * @returns {(event: Event, ...args: unknown[]) => void}\n */\nexport function once(fn) {\n\tvar ran = false;\n\n\treturn function (...args) {\n\t\tif (ran) return;\n\t\tran = true;\n\n\t\t// @ts-ignore\n\t\treturn fn?.apply(this, args);\n\t};\n}\n\n/**\n * Substitute for the `stopImmediatePropagation` event modifier\n * @deprecated\n * @param {(event: Event, ...args: Array<unknown>) => void} fn\n * @returns {(event: Event, ...args: unknown[]) => void}\n */\nexport function stopImmediatePropagation(fn) {\n\treturn function (...args) {\n\t\tvar event = /** @type {Event} */ (args[0]);\n\t\tevent.stopImmediatePropagation();\n\t\t// @ts-ignore\n\t\treturn fn?.apply(this, args);\n\t};\n}\n\n/**\n * Substitute for the `preventDefault` event modifier\n * @deprecated\n * @param {(event: Event, ...args: Array<unknown>) => void} fn\n * @returns {(event: Event, ...args: unknown[]) => void}\n */\nexport function preventDefault(fn) {\n\treturn function (...args) {\n\t\tvar event = /** @type {Event} */ (args[0]);\n\t\tevent.preventDefault();\n\t\t// @ts-ignore\n\t\treturn fn?.apply(this, args);\n\t};\n}\n\n/**\n * Substitute for the `passive` event modifier, implemented as an action\n * @deprecated\n * @param {HTMLElement} node\n * @param {[event: string, handler: () => EventListener]} options\n */\nexport function passive(node, [event, handler]) {\n\tuser_pre_effect(() => {\n\t\treturn on(node, event, handler() ?? noop, {\n\t\t\tpassive: true\n\t\t});\n\t});\n}\n\n/**\n * Substitute for the `nonpassive` event modifier, implemented as an action\n * @deprecated\n * @param {HTMLElement} node\n * @param {[event: string, handler: () => EventListener]} options\n */\nexport function nonpassive(node, [event, handler]) {\n\tuser_pre_effect(() => {\n\t\treturn on(node, event, handler() ?? noop, {\n\t\t\tpassive: false\n\t\t});\n\t});\n}\n"],"names":["input_name","input_selector","selected_ids","ajax_url","placeholder","base_url","json_input","departments","$.mutable_source","selectedDepartments","searchQuery","isLoading","hiddenInput","jsonInput","loadedDepartmentNames","async","loadDepartments","query","$.set","url","URL","window","WWW_DIR_JAVASCRIPT","location","origin","searchParams","set","response","fetch","toString","data","json","items","$.get","forEach","dept","id","name","e","console","error","removeDepartment","deptId","filter","updateHiddenInput","value","JSON","stringify","getDepartmentName","onMount","document","querySelector","parsed","parse","Array","isArray","map","item","undefined","div","root","div_1","div_2","ul","li","button","ul_1","li_1","input","div_3","$.index","$$anchor","div_4","root_1","a","input_1","fn","$.set_attribute","$.set_value","$.untrack","args","preventDefault","apply","this","li_2","ul_2","li_3","root_2","li_4","root_4","$.each","node_2","li_5","root_6","label","input_2","$0","isSelected","includes","selectDepartment","length","$$render","consequent","alternate_1","div_5","span","root_7","replace","$.event","event","target"],"mappings":"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","x_google_ignoreList":[1]}