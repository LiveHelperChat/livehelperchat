{"version":3,"file":"departments.js","sources":["../../src/Widgets/LHCDepartmentPicker.svelte"],"sourcesContent":["<svelte:options customElement={{tag: 'lhc-department-picker', shadow: 'none'}}/>\r\n\r\n<script>\r\n    import { onMount } from 'svelte';\r\n\r\n    export let input_name = 'department_ids[]';\r\n    export let input_selector = '';\r\n    export let selected_ids = '[]';\r\n    export let ajax_url = 'chat/searchprovider/deps';\r\n    export let placeholder = 'Choose department';\r\n    export let base_url = '';\r\n    export let json_input = '';\r\n\r\n    let departments = [];\r\n    let selectedDepartments = [];\r\n    let searchQuery = '';\r\n    let isLoading = false;\r\n    let hiddenInput = null;\r\n    let jsonInput = null;\r\n    let loadedDepartmentNames = {};\r\n\r\n    onMount(() => {\r\n        // Find json input if json_input name provided (output only)\r\n        if (json_input) {\r\n            jsonInput = document.querySelector('input[name=\"' + json_input + '\"], textarea[name=\"' + json_input + '\"]');\r\n        }\r\n\r\n        // Parse initial selected IDs\r\n        try {\r\n            const parsed = typeof selected_ids === 'string' ? JSON.parse(selected_ids) : selected_ids;\r\n            if (Array.isArray(parsed)) {\r\n                selectedDepartments = parsed.map(item => {\r\n                    if (typeof item === 'object' && item.id !== undefined) {\r\n                        loadedDepartmentNames[item.id] = item.name || `Department #${item.id}`;\r\n                        return item.id;\r\n                    }\r\n                    return item;\r\n                });\r\n            }\r\n        } catch (e) {\r\n            console.error('Error parsing selected_ids', e);\r\n        }\r\n\r\n        // Find hidden input if selector provided\r\n        if (input_selector) {\r\n            hiddenInput = document.querySelector(input_selector);\r\n            if (hiddenInput && hiddenInput.value) {\r\n                try {\r\n                    const parsed = JSON.parse(hiddenInput.value);\r\n                    if (Array.isArray(parsed)) {\r\n                        selectedDepartments = parsed.map(item => {\r\n                            if (typeof item === 'object' && item.id !== undefined) {\r\n                                loadedDepartmentNames[item.id] = item.name || `Department #${item.id}`;\r\n                                return item.id;\r\n                            }\r\n                            return item;\r\n                        });\r\n                    }\r\n                } catch (e) {\r\n                    console.error('Error parsing hidden input value', e);\r\n                }\r\n            }\r\n        }\r\n\r\n        // Load initial departments\r\n        loadDepartments();\r\n    });\r\n\r\n    function getBaseUrl() {\r\n        if (base_url) return base_url;\r\n        if (typeof window.WWW_DIR_JAVASCRIPT !== 'undefined') return window.WWW_DIR_JAVASCRIPT;\r\n        return '/';\r\n    }\r\n\r\n    async function loadDepartments(query = '') {\r\n        isLoading = true;\r\n        try {\r\n            const url = new URL(getBaseUrl() + ajax_url, window.location.origin);\r\n            if (query) {\r\n                url.searchParams.set('q', query);\r\n            }\r\n\r\n            const response = await fetch(url.toString());\r\n            const data = await response.json();\r\n\r\n            if (data.items) {\r\n                departments = data.items;\r\n\r\n                // Update loaded department names\r\n                departments.forEach(dept => {\r\n                    loadedDepartmentNames[dept.id] = dept.name;\r\n                });\r\n                loadedDepartmentNames = {...loadedDepartmentNames};\r\n            }\r\n        } catch (e) {\r\n            console.error('Error loading departments', e);\r\n        }\r\n        isLoading = false;\r\n    }\r\n\r\n    function handleSearch(event) {\r\n        searchQuery = event.target.value;\r\n        loadDepartments(searchQuery);\r\n    }\r\n\r\n    function selectDepartment(dept) {\r\n        // Check if already selected\r\n        if (!selectedDepartments.includes(dept.id)) {\r\n            loadedDepartmentNames[dept.id] = dept.name;\r\n            selectedDepartments = [...selectedDepartments, dept.id];\r\n            updateHiddenInput();\r\n        }\r\n    }\r\n\r\n    function removeDepartment(deptId) {\r\n        selectedDepartments = selectedDepartments.filter(id => id !== deptId);\r\n        updateHiddenInput();\r\n    }\r\n\r\n    function updateHiddenInput() {\r\n        if (hiddenInput) {\r\n            hiddenInput.value = JSON.stringify(selectedDepartments);\r\n        }\r\n        if (jsonInput) {\r\n            jsonInput.value = JSON.stringify(selectedDepartments);\r\n        }\r\n    }\r\n\r\n    function isSelected(deptId) {\r\n        return selectedDepartments.includes(deptId);\r\n    }\r\n\r\n    function getDepartmentName(deptId) {\r\n        return loadedDepartmentNames[deptId] || `Department #${deptId}`;\r\n    }\r\n</script>\r\n\r\n<div class=\"row\">\r\n    <div class=\"col-4\">\r\n        <div class=\"btn-block-department\" data-limit=\"1\">\r\n            <ul class=\"nav\">\r\n                <li class=\"dropdown w-100\">\r\n                    <button type=\"button\" class=\"btn btn-light btn-block btn-sm dropdown-toggle btn-department-dropdown\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\">\r\n                        {placeholder}\r\n                    </button>\r\n                    <ul class=\"dropdown-menu\" role=\"menu\">\r\n                        <li class=\"btn-block-department-filter\">\r\n                            <input \r\n                                data-scope={input_name.replace('[]', '')} \r\n                                ajax-provider={ajax_url}\r\n                                type=\"text\" \r\n                                class=\"form-control input-sm\" \r\n                                value={searchQuery}\r\n                                on:input={handleSearch}\r\n                            />\r\n                            <div class=\"selected-items-filter\">\r\n                                {#each selectedDepartments as deptId}\r\n                                    <div class=\"fs12\">\r\n                                        <!-- svelte-ignore a11y-click-events-have-key-events a11y-no-static-element-interactions a11y-missing-attribute -->\r\n                                        <a data-stoppropagation=\"true\" class=\"delete-item\" data-value={deptId} on:click|preventDefault={() => removeDepartment(deptId)}>\r\n                                            <input type=\"hidden\" value={deptId} name={input_name} />\r\n                                            <i class=\"material-icons chat-unread\">delete</i>{getDepartmentName(deptId)}\r\n                                        </a>\r\n                                    </div>\r\n                                {/each}\r\n                            </div>\r\n                        </li>\r\n                        <li class=\"dropdown-result\">\r\n                            <ul class=\"list-unstyled dropdown-lhc\">\r\n                                {#if isLoading}\r\n                                    <!-- svelte-ignore a11y-click-events-have-key-events a11y-no-noninteractive-element-interactions -->\r\n                                    <li data-stoppropagation=\"true\" class=\"search-option-item text-center\">\r\n                                        <small>Loading...</small>\r\n                                    </li>\r\n                                {:else if departments.length === 0}\r\n                                    <!-- svelte-ignore a11y-click-events-have-key-events a11y-no-noninteractive-element-interactions -->\r\n                                    <li data-stoppropagation=\"true\" class=\"search-option-item text-center\">\r\n                                        <small>No departments found</small>\r\n                                    </li>\r\n                                {:else}\r\n                                    {#each departments as dept}\r\n                                        <!-- svelte-ignore a11y-click-events-have-key-events a11y-no-noninteractive-element-interactions -->\r\n                                        <li data-stoppropagation=\"true\" class=\"search-option-item\">\r\n                                            <label>\r\n                                                <input \r\n                                                    title={dept.id}\r\n                                                    class=\"me-1\" \r\n                                                    type=\"radio\" \r\n                                                    name=\"selector-{input_name}\"\r\n                                                    checked={isSelected(dept.id)}\r\n                                                    on:change={() => selectDepartment(dept)}\r\n                                                    value={dept.id}\r\n                                                />\r\n                                                {dept.name}\r\n                                            </label>\r\n                                        </li>\r\n                                    {/each}\r\n                                {/if}\r\n                            </ul>\r\n                        </li>\r\n                    </ul>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n    </div>\r\n    <div class=\"col-8\">\r\n        {#each selectedDepartments as deptId}\r\n            <!-- svelte-ignore a11y-click-events-have-key-events a11y-no-static-element-interactions a11y-interactive-supports-focus -->\r\n            <span role=\"tabpanel\" title=\"Click to remove\" class=\"badge bg-secondary m-1 action-image\" on:click={() => removeDepartment(deptId)}>\r\n                {getDepartmentName(deptId)} <span class=\"material-icons text-warning me-0\">delete</span>\r\n            </span>\r\n        {/each}\r\n    </div>\r\n</div>\r\n"],"names":["t2_value","ctx","insert","target","div","anchor","append","a","input","i","dirty","set_data","t2","length","li","t1_value","name","attr","input_title_value","id","value","input_value_value","label","t1","t0_value","span1","span0","t0","create_if_block","create_if_block_1","input_data_scope_value","replace","div4","div2","div1","ul2","li2","button","ul1","li0","div0","li1","ul0","div3","input_name","$$props","input_selector","selected_ids","ajax_url","placeholder","base_url","json_input","departments","selectedDepartments","searchQuery","isLoading","hiddenInput","jsonInput","loadedDepartmentNames","loadDepartments","query","$$invalidate","url","URL","window","WWW_DIR_JAVASCRIPT","location","origin","searchParams","set","response","fetch","toString","data","json","items","forEach","dept","e","console","error","selectDepartment","includes","updateHiddenInput","removeDepartment","deptId","filter","JSON","stringify","onMount","document","querySelector","parsed","parse","Array","isArray","map","item","undefined","event"],"mappings":"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"}