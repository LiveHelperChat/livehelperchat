{"version":3,"sources":["3c8de6c14d5fa1e50a3e8a08c8fc53bf.js"],"names":["services","factory","$http","$q","this","updateViewsList","appendURL","deferred","defer","get","WWW_DIR_JAVASCRIPT","then","data","error_url","document","location","resolve","internalError","reject","status","promise","loadInitialData","loadView","id","mode","params","deleteView","post","updatePassiveMode","loadViewPage","href","truncate","text","length","end","isNaN","undefined","String","substring","lhcAppControllers","controller","$scope","$location","$rootScope","$log","$interval","$window","LiveHelperChatViewsFactory","current_user_id","confLH","user_id","views","invites","default_view_id","currentView","updateTimeout","updateViewsTimeout","_that","ee","addListener","fetchViews","shareView","view","lhc","revealModal","url","initLHCData","viewDefault","angular","forEach","setUpdateLive","setUpdateLiveViews","$","on","e","stopPropagation","preventDefault","target","attr","link","matches","match","page","updateViewList","getElementById","innerHTML","body","view_id","total_records","protectCSFR","changePassiveMode","passive","clearTimeout","setTimeout","confirm","splice","indexOf","cleanupTabs","chatsToRemove","each","lhinst","chatsSynchronising","index","chat_id","push","removeSynchroChat","exportView","title","height","backdrop","click","inst","csrf_token","lhcError","Error","message","log","lineNumber","line","stack"],"mappings":"AAAA,IACAA,SAASC,QAAQ,6BAA8B,CAAC,QAAQ,KAAK,SAAUC,EAAOC,GA4E9E,OA3EAC,KAAKC,gBAAkB,SAASC,GAChC,IAAIC,EAAWJ,EAAGK,QAUlB,OATAN,EAAMO,IAAIC,mBAAqB,qBAAqBC,MAAK,SAASC,QACpC,IAAnBA,EAAKC,UAChBC,SAASC,SAAWH,EAAKA,KAAKC,UAE9BN,EAASS,QAAQJ,EAAKA,SAEpB,SAASK,GACXV,EAASW,YAAuC,IAAzBD,EAAcE,OAAyB,IAAIF,EAAcE,OAAO,IAAM,UAEtFZ,EAASa,SAEhBhB,KAAKiB,gBAAkB,SAASf,GAChC,IAAIC,EAAWJ,EAAGK,QAUlB,OATAN,EAAMO,IAAIC,mBAAqB,wBAA0BJ,GAAWK,MAAK,SAASC,QACpD,IAAnBA,EAAKC,UAChBC,SAASC,SAAWH,EAAKA,KAAKC,UAE9BN,EAASS,QAAQJ,EAAKA,SAEpB,SAASK,GACXV,EAASW,YAAuC,IAAzBD,EAAcE,OAAyB,IAAIF,EAAcE,OAAO,IAAM,UAEtFZ,EAASa,SAEhBhB,KAAKkB,SAAW,SAASC,EAAIC,GAC7B,IAAIjB,EAAWJ,EAAGK,QACdiB,OAAyB,IAATD,EAAuBA,EAAO,GAMlD,OALAtB,EAAMO,IAAIC,mBAAqB,kBAAoBa,EAAKE,GAAQd,MAAK,SAASC,GAC9EL,EAASS,QAAQJ,EAAKA,SACpB,SAASK,GACXV,EAASW,YAAuC,IAAzBD,EAAcE,OAAyB,IAAIF,EAAcE,OAAO,IAAM,UAEtFZ,EAASa,SAEhBhB,KAAKsB,WAAa,SAASH,GAC3B,IAAIhB,EAAWJ,EAAGK,QAMlB,OALAN,EAAMyB,KAAKjB,mBAAqB,oBAAsBa,GAAIZ,MAAK,SAASC,GACxEL,EAASS,QAAQJ,EAAKA,SACpB,SAASK,GACXV,EAASW,YAAuC,IAAzBD,EAAcE,OAAyB,IAAIF,EAAcE,OAAO,IAAM,UAEtFZ,EAASa,SAEhBhB,KAAKwB,kBAAoB,SAASL,GAClC,IAAIhB,EAAWJ,EAAGK,QAMlB,OALAN,EAAMyB,KAAKjB,mBAAqB,2BAA6Ba,GAAIZ,MAAK,SAASC,GAC/EL,EAASS,QAAQJ,EAAKA,SACpB,SAASK,GACXV,EAASW,YAAuC,IAAzBD,EAAcE,OAAyB,IAAIF,EAAcE,OAAO,IAAM,UAEtFZ,EAASa,SAEhBhB,KAAKyB,aAAe,SAASC,GAC7B,IAAIvB,EAAWJ,EAAGK,QAMlB,OALAN,EAAMO,IAAIqB,EAAO,gBAAgBnB,MAAK,SAASC,GAC/CL,EAASS,QAAQJ,EAAKA,SACpB,SAASK,GACXV,EAASW,YAAuC,IAAzBD,EAAcE,OAAyB,IAAIF,EAAcE,OAAO,IAAM,UAEtFZ,EAASa,SAEhBhB,KAAK2B,SAAW,SAAUC,EAAMC,EAAQC,GAKxC,OAJIC,MAAMF,KACVA,EAAS,SACGG,IAARF,IACJA,EAAM,OACFF,EAAKC,QAAUA,GAAUD,EAAKC,OAASC,EAAID,QAAUA,EAClDD,EAGAK,OAAOL,GAAMM,UAAU,EAAGL,EAAOC,EAAID,QAAUC,GAG/C9B,QAEPmC,kBAAkBC,WAAW,0BAA0B,CAAC,SAAS,QAAQ,YAAY,aAAc,OAAO,YAAY,UAAU,6BAA8B,SAASC,EAAQvC,EAAOwC,EAAWC,EAAYC,EAAMC,EAAWC,EAASC,GACvON,EAAOO,gBAAkBC,OAAOC,QAChC9C,KAAK+C,MAAQ,GACb/C,KAAKgD,QAAU,EACfhD,KAAKiD,gBAAkB,EACvBjD,KAAKkD,YAAc,KACnBlD,KAAKmD,cAAgB,KACrBnD,KAAKoD,mBAAqB,KAC1B,IAAIC,EAAQrD,KACZsD,GAAGC,YAAY,qBAAoB,SAAUxC,GAC7CsC,EAAMG,gBAENxD,KAAKyD,UAAY,SAASC,GAC1BC,IAAIC,YAAY,CAACC,IAAMvD,mBAAqB,mBAAqBoD,EAAKvC,MAEtEnB,KAAK8D,YAAc,WAEnBnB,EAA2B1B,gBADX,IACsCV,MAAK,SAASC,GAGpE,GAFA6C,EAAMN,MAAQvC,EAAKuC,MACnBM,EAAML,QAAUxC,EAAKwC,QACjBK,EAAMN,MAAMlB,OAAS,EAAG,CAC5B,IAAIkC,EAAcV,EAAMN,MAAM,GAC1BL,EAA+B,uBACnCsB,QAAQC,QAAQZ,EAAMN,OAAO,SAASW,GAClCA,EAAKvC,IAAMuB,EAA+B,wBAC9CqB,EAAcL,MAIdL,EAAMnC,SAAS6C,GAEfV,EAAMa,gBACNb,EAAMc,wBAENC,EAAE,iBAAiBC,GAAG,QAAS,cAAc,SAASC,GAGtD,GAFAA,EAAEC,kBACFD,EAAEE,iBAC8B,KAA5BJ,EAAEE,EAAEG,QAAQC,KAAK,QAAgB,CACrC,IAAIC,EAAOP,EAAEE,EAAEG,QAAQC,KAAK,QACxBE,EAAUD,EAAKE,MAAM,mBACrBC,EAAO,EACI,MAAXF,IACJE,EAAOF,EAAQ,IAEfvB,EAAMH,YAAY4B,KAAOA,EACzBzB,EAAM0B,eAAeJ,QAIrB3E,KAAK+E,eAAiB,SAASrD,GAC/BiB,EAA2BlB,aAAaC,GAAMnB,MAAK,SAASC,GAC5DE,SAASsE,eAAe,qBAAqBC,UAAYzE,EAAK0E,KACrC,MAArB7B,EAAMH,aAAuBG,EAAMH,YAAY/B,IAAMX,EAAK2E,UAC9D9B,EAAMH,YAAYkC,cAAgB5E,EAAK4E,eAEvC/B,EAAMgC,kBAGNrF,KAAKsF,kBAAoB,SAAS5B,GAClCA,EAAK6B,SAAW7B,EAAK6B,QACrB5C,EAA2BnB,kBAAkBkC,EAAKvC,IAAIZ,MAAK,SAASC,QAGpER,KAAKmE,mBAAqB,WAC1BqB,aAAaxF,KAAKoD,oBAClBpD,KAAKoD,mBAAqBqC,YAAW,WACrC9C,EAA2B1C,kBAAkBM,MAAK,SAASC,GAC3D6C,EAAMN,MAAQvC,EAAKuC,MACnBM,EAAML,QAAUxC,EAAKwC,WAErBK,EAAMc,uBACJ,MAEFnE,KAAKkE,cAAgB,WACrBsB,aAAaxF,KAAKmD,eAClBnD,KAAKmD,cAAgBsC,YAAW,WACP,MAArBpC,EAAMH,aACVG,EAAM0B,eAAezE,mBAAqB,kBAAoB+C,EAAMH,YAAY/B,GAAK,WAAakC,EAAMH,YAAY4B,MAEpHzB,EAAMa,kBACJ,MAEFlE,KAAKwD,WAAa,WAElBb,EAA2B1B,gBADX,IACsCV,MAAK,SAASC,GACpE6C,EAAMN,MAAQvC,EAAKuC,MACnBM,EAAML,QAAUxC,EAAKwC,YAGrBhD,KAAKsB,WAAa,SAAUoC,GACxBgC,QAAQ,kBACZ/C,EAA2BrB,WAAWoC,EAAKvC,IAAIZ,MAAK,WACpD8C,EAAMN,MAAM4C,OAAOtC,EAAMN,MAAM6C,QAAQlC,GAAM,GACnB,OAAtBL,EAAMH,aAAwBG,EAAMH,YAAY/B,IAAMuC,EAAKvC,KAC/DkC,EAAMH,YAAc,MAEhBG,EAAMN,MAAMlB,OAAS,GACzBwB,EAAMnC,SAASmC,EAAMN,MAAM,QAK3B/C,KAAK6F,YAAc,WACnB,IAAIC,EAAgB,GACpB1B,EAAE2B,KAAKC,OAAOC,oBAAoB,SAAUC,EAAOC,GACnDL,EAAcM,KAAKD,MAEnB/B,EAAE2B,KAAKD,GAAe,SAAUI,EAAOC,GACvCH,OAAOK,kBAAkBF,OAGzBnG,KAAKkB,SAAW,SAASwC,GACzB1D,KAAK6F,cACLxC,EAAMH,YAAcQ,EACpBL,EAAMH,YAAY4B,KAAO,EACzBnC,EAA2BzB,SAASwC,EAAKvC,IAAIZ,MAAK,SAASC,GACjC,OAAtB6C,EAAMH,aAAwBG,EAAMH,YAAY/B,IAAMX,EAAK2E,UAC/DzE,SAASsE,eAAe,gBAAgBC,UAAYzE,EAAK0E,KACzD7B,EAAMH,YAAYkC,cAAgB5E,EAAK4E,cACvC/B,EAAMgC,mBAINrF,KAAKsG,WAAa,SAAS5C,GAC3BC,IAAIC,YAAY,CAAC2C,MAAU,SAAUC,OAAS,IAAKC,UAAS,EAAM5C,IAAMvD,mBAAqB,qBAAuBoD,EAAKvC,MAEzHnB,KAAKqF,YAAc,WACnBjB,EAAE,iCAAiCsC,OAAM,WACzC,IAAIC,EAAOvC,EAAEpE,MACR2G,EAAKjC,KAAK,kBACfiC,EAAKjC,KAAK,OAAOiC,EAAKjC,KAAK,QAAQ,WAAW7B,OAAO+D,YACrDD,EAAKjC,KAAK,eAAe,QAIzB1E,KAAK8D,iBAEH,MAAOQ,GACT,IAAIuC,SAAiG,MAAMC,MAAM,SAAWxC,EAAEyC,SAAhHF,SAASG,IAAI1C,EAAEyC,QAAS,uBAAwBzC,EAAE2C,YAAc3C,EAAE4C,KAAM5C,EAAE6C","file":"3c8de6c14d5fa1e50a3e8a08c8fc53bf.js","sourcesContent":["try {\nservices.factory('LiveHelperChatViewsFactory', ['$http','$q',function ($http, $q) {\nthis.updateViewsList = function(appendURL) {\nvar deferred = $q.defer();\n$http.get(WWW_DIR_JAVASCRIPT + 'views/updateviews').then(function(data) {\nif (typeof data.error_url !== 'undefined') {\ndocument.location = data.data.error_url;\n} else {\ndeferred.resolve(data.data);\n}\n},function(internalError){\ndeferred.reject(typeof internalError.status !== 'undefined' ? '['+internalError.status+']' : '[0]');\n});\nreturn deferred.promise;\n};\nthis.loadInitialData = function(appendURL) {\nvar deferred = $q.defer();\n$http.get(WWW_DIR_JAVASCRIPT + 'views/loadinitialdata' + appendURL).then(function(data) {\nif (typeof data.error_url !== 'undefined') {\ndocument.location = data.data.error_url;\n} else {\ndeferred.resolve(data.data);\n}\n},function(internalError){\ndeferred.reject(typeof internalError.status !== 'undefined' ? '['+internalError.status+']' : '[0]');\n});\nreturn deferred.promise;\n};\nthis.loadView = function(id, mode) {\nvar deferred = $q.defer();\nvar params = typeof mode !== 'undefined' ? mode : '';\n$http.get(WWW_DIR_JAVASCRIPT + 'views/loadview/' + id + params).then(function(data) {\ndeferred.resolve(data.data);\n},function(internalError){\ndeferred.reject(typeof internalError.status !== 'undefined' ? '['+internalError.status+']' : '[0]');\n});\nreturn deferred.promise;\n};\nthis.deleteView = function(id) {\nvar deferred = $q.defer();\n$http.post(WWW_DIR_JAVASCRIPT + 'views/deleteview/' + id).then(function(data) {\ndeferred.resolve(data.data);\n},function(internalError){\ndeferred.reject(typeof internalError.status !== 'undefined' ? '['+internalError.status+']' : '[0]');\n});\nreturn deferred.promise;\n};\nthis.updatePassiveMode = function(id) {\nvar deferred = $q.defer();\n$http.post(WWW_DIR_JAVASCRIPT + 'views/updatepassivemode/' + id).then(function(data) {\ndeferred.resolve(data.data);\n},function(internalError){\ndeferred.reject(typeof internalError.status !== 'undefined' ? '['+internalError.status+']' : '[0]');\n});\nreturn deferred.promise;\n};\nthis.loadViewPage = function(href) {\nvar deferred = $q.defer();\n$http.get(href + '/(mode)/list').then(function(data) {\ndeferred.resolve(data.data);\n},function(internalError){\ndeferred.reject(typeof internalError.status !== 'undefined' ? '['+internalError.status+']' : '[0]');\n});\nreturn deferred.promise;\n};\nthis.truncate = function (text, length, end) {\nif (isNaN(length))\nlength = 10;\nif (end === undefined)\nend = \"...\";\nif (text.length <= length || text.length - end.length <= length) {\nreturn text;\n}\nelse {\nreturn String(text).substring(0, length-end.length) + end;\n}\n};\nreturn this;\n}]);\nlhcAppControllers.controller('LiveHelperChatViewsCtrl',['$scope','$http','$location','$rootScope', '$log','$interval','$window','LiveHelperChatViewsFactory', function($scope, $http, $location, $rootScope, $log, $interval, $window, LiveHelperChatViewsFactory) {\n$scope.current_user_id = confLH.user_id;\nthis.views = [];\nthis.invites = 0;\nthis.default_view_id = 0;\nthis.currentView = null;\nthis.updateTimeout = null;\nthis.updateViewsTimeout = null;\nvar _that = this;\nee.addListener('views.updateViews',function (status) {\n_that.fetchViews();\n});\nthis.shareView = function(view) {\nlhc.revealModal({'url':WWW_DIR_JAVASCRIPT + 'views/shareview/' + view.id});\n}\nthis.initLHCData = function() {\nvar appendURL = '';\nLiveHelperChatViewsFactory.loadInitialData(appendURL).then(function(data) {\n_that.views = data.views;\n_that.invites = data.invites;\nif (_that.views.length > 0) {\nvar viewDefault = _that.views[0];\nif ($window['vctrl_default_view_id']) {\nangular.forEach(_that.views, function(view) {\nif (view.id == $window['vctrl_default_view_id']) {\nviewDefault = view;\n}\n});\n}\n_that.loadView(viewDefault);\n}\n_that.setUpdateLive();\n_that.setUpdateLiveViews();\n});\n$('#view-content').on(\"click\", \".page-link\", function(e) {\ne.stopPropagation();\ne.preventDefault();\nif ($(e.target).attr('href') != '#') {\nvar link = $(e.target).attr('href');\nvar matches = link.match(/\\(page\\)\\/(\\d+)/);\nvar page = 1;\nif (matches != null) {\npage = matches[1];\n}\n_that.currentView.page = page;\n_that.updateViewList(link);\n}\n})\n}\nthis.updateViewList = function(href) {\nLiveHelperChatViewsFactory.loadViewPage(href).then(function(data) {\ndocument.getElementById('view-content-list').innerHTML = data.body;\nif (_that.currentView != null && _that.currentView.id == data.view_id) {\n_that.currentView.total_records = data.total_records;\n}\n_that.protectCSFR();\n})\n}\nthis.changePassiveMode = function(view) {\nview.passive = !view.passive;;\nLiveHelperChatViewsFactory.updatePassiveMode(view.id).then(function(data) {\n})\n}\nthis.setUpdateLiveViews = function () {\nclearTimeout(this.updateViewsTimeout);\nthis.updateViewsTimeout = setTimeout(function () {\nLiveHelperChatViewsFactory.updateViewsList().then(function(data){\n_that.views = data.views;\n_that.invites = data.invites;\n});\n_that.setUpdateLiveViews();\n},5000);\n}\nthis.setUpdateLive = function () {\nclearTimeout(this.updateTimeout);\nthis.updateTimeout = setTimeout(function () {\nif (_that.currentView != null) {\n_that.updateViewList(WWW_DIR_JAVASCRIPT + 'views/loadview/' + _that.currentView.id + '/(page)/' + _that.currentView.page);\n}\n_that.setUpdateLive();\n},20000);\n}\nthis.fetchViews = function () {\nvar appendURL = '';\nLiveHelperChatViewsFactory.loadInitialData(appendURL).then(function(data) {\n_that.views = data.views;\n_that.invites = data.invites;\n});\n}\nthis.deleteView = function (view) {\nif (confirm('Are you sure?')) {\nLiveHelperChatViewsFactory.deleteView(view.id).then(function() {\n_that.views.splice(_that.views.indexOf(view),1);\nif (_that.currentView !== null && _that.currentView.id == view.id) {\n_that.currentView = null;\n}\nif (_that.views.length > 0) {\n_that.loadView(_that.views[0]);\n}\n})\n}\n}\nthis.cleanupTabs = function() {\nvar chatsToRemove = [];\n$.each(lhinst.chatsSynchronising, function( index, chat_id ) {\nchatsToRemove.push(chat_id);\n});\n$.each(chatsToRemove, function( index, chat_id ) {\nlhinst.removeSynchroChat(chat_id);\n});\n}\nthis.loadView = function(view) {\nthis.cleanupTabs();\n_that.currentView = view;\n_that.currentView.page = 1;\nLiveHelperChatViewsFactory.loadView(view.id).then(function(data) {\nif (_that.currentView !== null && _that.currentView.id == data.view_id) {\ndocument.getElementById('view-content').innerHTML = data.body;\n_that.currentView.total_records = data.total_records;\n_that.protectCSFR();\n}\n})\n}\nthis.exportView = function(view) {\nlhc.revealModal({'title' : 'Export', 'height':350, backdrop:true, 'url':WWW_DIR_JAVASCRIPT + '/views/exportview/' + view.id})\n}\nthis.protectCSFR = function () {\n$('#view-content a.csfr-required').click(function() {\nvar inst = $(this);\nif (!inst.attr('data-secured')) {\ninst.attr('href',inst.attr('href')+'/(csfr)/'+confLH.csrf_token);\ninst.attr('data-secured',1);\n}\n});\n}\nthis.initLHCData();\n}]);\n} catch (e) {\nif (lhcError) lhcError.log(e.message, \"angular.lhc-views.js\", e.lineNumber || e.line, e.stack); else throw Error(\"lhc : \" + e.message);\n}\n\n"]}