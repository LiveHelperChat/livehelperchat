{"version":3,"file":"3c8de6c14d5fa1e50a3e8a08c8fc53bf.js","names":["services","factory","$http","$q","this","updateViewsList","appendURL","deferred","defer","get","WWW_DIR_JAVASCRIPT","then","data","error_url","document","location","resolve","internalError","reject","status","promise","loadInitialData","loadView","id","mode","params","deleteView","post","updatePassiveMode","loadViewPage","href","includes","replace","slice","substring","length","truncate","text","end","isNaN","undefined","String","lhcAppControllers","controller","$scope","$location","$rootScope","$log","$interval","$window","LiveHelperChatViewsFactory","current_user_id","confLH","user_id","views","invites","default_view_id","currentView","updateTimeout","updateViewsTimeout","_that","ee","addListener","fetchViews","shareView","view","lhc","revealModal","url","initLHCData","viewDefault","angular","forEach","setUpdateLive","setUpdateLiveViews","$","on","e","stopPropagation","preventDefault","target","attr","link","matches","match","page","updateViewList","getElementById","innerHTML","body","view_id","total_records","protectCSFR","changePassiveMode","passive","clearTimeout","setTimeout","confirm","splice","indexOf","cleanupTabs","chatsToRemove","each","lhinst","chatsSynchronising","index","chat_id","push","removeSynchroChat","exportView","title","height","backdrop","click","inst","csrf_token","lhcError","Error","message","log","lineNumber","line","stack"],"sources":["3c8de6c14d5fa1e50a3e8a08c8fc53bf.js"],"mappings":"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","ignoreList":[],"sourcesContent":["try {\nservices.factory('LiveHelperChatViewsFactory', ['$http','$q',function ($http, $q) {\nthis.updateViewsList = function(appendURL) {\nvar deferred = $q.defer();\n$http.get(WWW_DIR_JAVASCRIPT + 'views/updateviews').then(function(data) {\nif (typeof data.error_url !== 'undefined') {\ndocument.location = data.data.error_url;\n} else {\ndeferred.resolve(data.data);\n}\n},function(internalError){\ndeferred.reject(typeof internalError.status !== 'undefined' ? '['+internalError.status+']' : '[0]');\n});\nreturn deferred.promise;\n};\nthis.loadInitialData = function(appendURL) {\nvar deferred = $q.defer();\n$http.get(WWW_DIR_JAVASCRIPT + 'views/loadinitialdata' + appendURL).then(function(data) {\nif (typeof data.error_url !== 'undefined') {\ndocument.location = data.data.error_url;\n} else {\ndeferred.resolve(data.data);\n}\n},function(internalError){\ndeferred.reject(typeof internalError.status !== 'undefined' ? '['+internalError.status+']' : '[0]');\n});\nreturn deferred.promise;\n};\nthis.loadView = function(id, mode) {\nvar deferred = $q.defer();\nvar params = typeof mode !== 'undefined' ? mode : '';\n$http.get(WWW_DIR_JAVASCRIPT + 'views/loadview/' + id + params).then(function(data) {\ndeferred.resolve(data.data);\n},function(internalError){\ndeferred.reject(typeof internalError.status !== 'undefined' ? '['+internalError.status+']' : '[0]');\n});\nreturn deferred.promise;\n};\nthis.deleteView = function(id) {\nvar deferred = $q.defer();\n$http.post(WWW_DIR_JAVASCRIPT + 'views/deleteview/' + id).then(function(data) {\ndeferred.resolve(data.data);\n},function(internalError){\ndeferred.reject(typeof internalError.status !== 'undefined' ? '['+internalError.status+']' : '[0]');\n});\nreturn deferred.promise;\n};\nthis.updatePassiveMode = function(id) {\nvar deferred = $q.defer();\n$http.post(WWW_DIR_JAVASCRIPT + 'views/updatepassivemode/' + id).then(function(data) {\ndeferred.resolve(data.data);\n},function(internalError){\ndeferred.reject(typeof internalError.status !== 'undefined' ? '['+internalError.status+']' : '[0]');\n});\nreturn deferred.promise;\n};\nthis.loadViewPage = function(href) {\nvar deferred = $q.defer();\nif (href.includes('(page)')) {\nhref = href.replace('(page)','(mode)/list/(page)')\n} else if (href.slice(-1) == '?') {\nhref = href.substring(0, href.length - 1) + '/(mode)/list';\n} else {\nhref = href + '/(mode)/list';\n}\n$http.get(href).then(function(data) {\ndeferred.resolve(data.data);\n},function(internalError){\ndeferred.reject(typeof internalError.status !== 'undefined' ? '['+internalError.status+']' : '[0]');\n});\nreturn deferred.promise;\n};\nthis.truncate = function (text, length, end) {\nif (isNaN(length))\nlength = 10;\nif (end === undefined)\nend = \"...\";\nif (text.length <= length || text.length - end.length <= length) {\nreturn text;\n}\nelse {\nreturn String(text).substring(0, length-end.length) + end;\n}\n};\nreturn this;\n}]);\nlhcAppControllers.controller('LiveHelperChatViewsCtrl',['$scope','$http','$location','$rootScope', '$log','$interval','$window','LiveHelperChatViewsFactory', function($scope, $http, $location, $rootScope, $log, $interval, $window, LiveHelperChatViewsFactory) {\n$scope.current_user_id = confLH.user_id;\nthis.views = [];\nthis.invites = 0;\nthis.default_view_id = 0;\nthis.currentView = null;\nthis.updateTimeout = null;\nthis.updateViewsTimeout = null;\nvar _that = this;\nee.addListener('views.updateViews',function (status) {\n_that.fetchViews();\n});\nthis.shareView = function(view) {\nlhc.revealModal({'url':WWW_DIR_JAVASCRIPT + 'views/shareview/' + view.id});\n}\nthis.initLHCData = function() {\nvar appendURL = '';\nLiveHelperChatViewsFactory.loadInitialData(appendURL).then(function(data) {\n_that.views = data.views;\n_that.invites = data.invites;\nif (_that.views.length > 0) {\nvar viewDefault = _that.views[0];\nif ($window['vctrl_default_view_id']) {\nangular.forEach(_that.views, function(view) {\nif (view.id == $window['vctrl_default_view_id']) {\nviewDefault = view;\n}\n});\n}\n_that.loadView(viewDefault);\n}\n_that.setUpdateLive();\n_that.setUpdateLiveViews();\n});\n$('#view-content').on(\"click\", \".page-link\", function(e) {\ne.stopPropagation();\ne.preventDefault();\nif ($(e.target).attr('href') != '#') {\nvar link = $(e.target).attr('href');\nvar matches = link.match(/\\(page\\)\\/(\\d+)/);\nvar page = 1;\nif (matches != null) {\npage = matches[1];\n}\n_that.currentView.page = page;\n_that.updateViewList(link);\n}\n})\n}\nthis.updateViewList = function(href) {\nLiveHelperChatViewsFactory.loadViewPage(href).then(function(data) {\ndocument.getElementById('view-content-list').innerHTML = data.body;\nif (_that.currentView != null && _that.currentView.id == data.view_id) {\n_that.currentView.total_records = data.total_records;\n}\n_that.protectCSFR();\n})\n}\nthis.changePassiveMode = function(view) {\nview.passive = !view.passive;;\nLiveHelperChatViewsFactory.updatePassiveMode(view.id).then(function(data) {\n})\n}\nthis.setUpdateLiveViews = function () {\nclearTimeout(this.updateViewsTimeout);\nthis.updateViewsTimeout = setTimeout(function () {\nLiveHelperChatViewsFactory.updateViewsList().then(function(data){\n_that.views = data.views;\n_that.invites = data.invites;\n});\n_that.setUpdateLiveViews();\n},5000);\n}\nthis.setUpdateLive = function () {\nclearTimeout(this.updateTimeout);\nthis.updateTimeout = setTimeout(function () {\nif (_that.currentView != null) {\n_that.updateViewList(WWW_DIR_JAVASCRIPT + 'views/loadview/' + _that.currentView.id + '/(page)/' + _that.currentView.page);\n}\n_that.setUpdateLive();\n},20000);\n}\nthis.fetchViews = function () {\nvar appendURL = '';\nLiveHelperChatViewsFactory.loadInitialData(appendURL).then(function(data) {\n_that.views = data.views;\n_that.invites = data.invites;\n});\n}\nthis.deleteView = function (view) {\nif (confirm('Are you sure?')) {\nLiveHelperChatViewsFactory.deleteView(view.id).then(function() {\n_that.views.splice(_that.views.indexOf(view),1);\nif (_that.currentView !== null && _that.currentView.id == view.id) {\n_that.currentView = null;\n}\nif (_that.views.length > 0) {\n_that.loadView(_that.views[0]);\n}\n})\n}\n}\nthis.cleanupTabs = function() {\nvar chatsToRemove = [];\n$.each(lhinst.chatsSynchronising, function( index, chat_id ) {\nchatsToRemove.push(chat_id);\n});\n$.each(chatsToRemove, function( index, chat_id ) {\nlhinst.removeSynchroChat(chat_id);\n});\n}\nthis.loadView = function(view) {\nthis.cleanupTabs();\n_that.currentView = view;\n_that.currentView.page = 1;\nLiveHelperChatViewsFactory.loadView(view.id).then(function(data) {\nif (_that.currentView !== null && _that.currentView.id == data.view_id) {\ndocument.getElementById('view-content').innerHTML = data.body;\n_that.currentView.total_records = data.total_records;\n_that.protectCSFR();\n}\n})\n}\nthis.exportView = function(view) {\nlhc.revealModal({'title' : 'Export', 'height':350, backdrop:true, 'url':WWW_DIR_JAVASCRIPT + '/views/exportview/' + view.id})\n}\nthis.protectCSFR = function () {\n$('#view-content a.csfr-required').click(function() {\nvar inst = $(this);\nif (!inst.attr('data-secured')) {\ninst.attr('href',inst.attr('href')+'/(csfr)/'+confLH.csrf_token);\ninst.attr('data-secured',1);\n}\n});\n}\nthis.initLHCData();\n}]);\n} catch (e) {\nif (lhcError) lhcError.log(e.message, \"angular.lhc-views.js\", e.lineNumber || e.line, e.stack); else throw Error(\"lhc : \" + e.message);\n}\n\n"]}