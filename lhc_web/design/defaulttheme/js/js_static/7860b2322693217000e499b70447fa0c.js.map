{"version":3,"sources":["7860b2322693217000e499b70447fa0c.js"],"names":["services","factory","e","n","this","loadOnlineUsers","i","t","defer","get","WWW_DIR_JAVASCRIPT","timeout","department","max_rows","country","time_on_site","encodeURIComponent","then","resolve","data","promise","deleteOnlineUser","post","user_id","confLH","csrf_token","error_url","document","location","lhcAppControllers","controller","o","s","r","a","onlineusers","onlineusersPreviousID","onlineusersGrouped","updateTimeout","userTimeout","maxRows","predicate","reverse","wasInitiated","forbiddenVisitors","soundEnabled","notificationEnabled","groupByField","u","groupBy","sort","length","label","id","ou","push","updateList","lhinst","disableSync","angular","forEach","indexOf","Modernizr","audio","Audio","src","ogg","WWW_DIR_JAVASCRIPT_FILES","mp3","load","setTimeout","play","window","webkitNotifications","Notification","checkPermission","createNotification","WWW_DIR_JAVASCRIPT_FILES_NOTIFICATION","ip","user_country_name","page_title","referrer","onclick","cancel","show","permission","icon","body","close","$watch","changeUserSettingsIndifferent","showOnlineUserInfo","lhc","revealModal","url","previewChat","chat_id","can_view_chat","sendMessage","deleteUser","confirm","splice","disableNewUserBNotif","changeUserSettings","disableNewUserSound","$on"],"mappings":"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","file":"7860b2322693217000e499b70447fa0c.js","sourcesContent":["services.factory(\"OnlineUsersFactory\",[\"$http\",\"$q\",function(e,n){return this.loadOnlineUsers=function(i){var t=n.defer();return e.get(WWW_DIR_JAVASCRIPT+\"chat/onlineusers/(method)/ajax/(timeout)/\"+i.timeout+(i.department>0?\"/(department)/\"+i.department:\"\")+(i.max_rows>0?\"/(maxrows)/\"+i.max_rows:\"\")+(\"\"!=i.country?\"/(country)/\"+i.country:\"\")+(\"\"!=i.time_on_site?\"/(timeonsite)/\"+encodeURIComponent(i.time_on_site):\"\")).then((function(e){t.resolve(e.data)})),t.promise},this.deleteOnlineUser=function(i){var t=n.defer();return e.post(WWW_DIR_JAVASCRIPT+\"chat/onlineusers/(deletevisitor)/\"+i.user_id+\"/(csfr)/\"+confLH.csrf_token).then((function(e){void 0!==e.error_url?document.location=e.data.error_url:t.resolve(e.data)})),t.promise},this}]),lhcAppControllers.controller(\"OnlineCtrl\",[\"$scope\",\"$http\",\"$location\",\"$rootScope\",\"$log\",\"$interval\",\"OnlineUsersFactory\",function(e,n,i,t,o,s,r){var a;this.onlineusers=[],this.onlineusersPreviousID=[],e.onlineusersGrouped=[],this.updateTimeout=\"10\",this.userTimeout=\"3600\",this.maxRows=\"50\",this.department=\"0\",this.country=\"none\",this.predicate=\"last_visit\",this.time_on_site=\"\",this.reverse=!0,this.wasInitiated=!1,this.forbiddenVisitors=!1,this.soundEnabled=!1,this.notificationEnabled=!1,e.groupByField=\"none\";var u=this;e.groupBy=function(n){var i,t;e.onlineusersGrouped=[],i=u.onlineusers,t=n,i.sort((function(e,n){return e[t]<=n[t]?-1:1}));for(var o=\"_INVALID_GROUP_VALUE_\",s=0;s<u.onlineusers.length;s++){var r=u.onlineusers[s];if(r[n]!==o){var a={label:r[n],id:s,ou:[]};o=a.label,e.onlineusersGrouped.push(a)}a.ou.push(r)}},this.updateList=function(){1!=lhinst.disableSync&&1!=u.forbiddenVisitors&&r.loadOnlineUsers({timeout:u.userTimeout,time_on_site:u.time_on_site,department:u.department,country:u.country,max_rows:u.maxRows}).then((function(n){if(u.onlineusers=n,\"none\"!=e.groupByField?e.groupBy(e.groupByField):(e.onlineusersGrouped=[],e.onlineusersGrouped.push({label:\"\",id:0,ou:u.onlineusers})),u.notificationEnabled||u.soundEnabled){var i=!1,t=[];if(angular.forEach(u.onlineusers,(function(e,n){var o=!0;-1==u.onlineusersPreviousID.indexOf(e.id)&&(o=!1,u.onlineusersPreviousID.push(e.id)),1==u.wasInitiated&&0==o&&(i=!0,t.push(e))})),1==i){if(u.soundEnabled&&Modernizr.audio){var o=new Audio;o.src=Modernizr.audio.ogg?WWW_DIR_JAVASCRIPT_FILES+\"/new_visitor.ogg\":Modernizr.audio.mp3?WWW_DIR_JAVASCRIPT_FILES+\"/new_visitor.mp3\":WWW_DIR_JAVASCRIPT_FILES+\"/new_visitor.wav\",o.load(),setTimeout((function(){o.play()}),500)}u.notificationEnabled&&(window.webkitNotifications||window.Notification)&&angular.forEach(t,(function(e,n){if(window.webkitNotifications)0==window.webkitNotifications.checkPermission()&&((i=window.webkitNotifications.createNotification(WWW_DIR_JAVASCRIPT_FILES_NOTIFICATION+\"/notification.png\",e.ip+(\"\"!=e.user_country_name?\", \"+e.user_country_name:\"\"),(\"\"!=e.page_title?e.page_title+\"\\n-----\\n\":\"\")+(\"\"!=e.referrer?e.referrer+\"\\n-----\\n\":\"\"))).onclick=function(){i.cancel()},i.show(),setTimeout((function(){i.cancel()}),15e3));else if(window.Notification){var i;if(\"granted\"==window.Notification.permission)(i=new Notification(e.ip+(\"\"!=e.user_country_name?\", \"+e.user_country_name:\"\"),{icon:WWW_DIR_JAVASCRIPT_FILES_NOTIFICATION+\"/notification.png\",body:(\"\"!=e.page_title?e.page_title+\"\\n-----\\n\":\"\")+(\"\"!=e.referrer?e.referrer+\"\\n-----\\n\":\"\")})).onclick=function(){i.close()},setTimeout((function(){i.close()}),15e3)}}))}u.wasInitiated=!0,u.onlineusersPreviousID.length>100&&(u.wasInitiated=!1,u.onlineusersPreviousID=[])}}))},a=s((function(){0==u.forbiddenVisitors?u.updateList():s.cancel(a)}),1e3*this.updateTimeout),e.$watch(\"online.updateTimeout\",(function(e,n){e!=n&&(s.cancel(a),a=s((function(){u.updateList()}),1e3*e),lhinst.changeUserSettingsIndifferent(\"oupdate_timeout\",e))})),e.$watch(\"online.userTimeout\",(function(e,n){e!=n&&lhinst.changeUserSettingsIndifferent(\"ouser_timeout\",e)})),e.$watch(\"online.country\",(function(e,n){e!=n&&lhinst.changeUserSettingsIndifferent(\"ocountry\",e)})),e.$watch(\"online.time_on_site\",(function(e,n){e!=n&&lhinst.changeUserSettingsIndifferent(\"otime_on_site\",\"\"==e?\"none\":e)})),e.$watch(\"online.maxRows\",(function(e,n){e!=n&&lhinst.changeUserSettingsIndifferent(\"omax_rows\",e)})),e.$watch(\"online.department\",(function(e,n){e!=n&&lhinst.changeUserSettingsIndifferent(\"o_department\",e)})),e.$watch(\"groupByField\",(function(e,n){e!=n&&lhinst.changeUserSettingsIndifferent(\"ogroup_by\",e)})),e.$watch(\"online.userTimeout + online.department + online.maxRows + groupByField + online.country + online.time_on_site\",(function(e,n){setTimeout((function(){u.updateList()}),500)})),this.showOnlineUserInfo=function(e){lhc.revealModal({url:WWW_DIR_JAVASCRIPT+\"chat/getonlineuserinfo/\"+e})},this.previewChat=function(e){e.chat_id>0&&1==e.can_view_chat&&lhc.revealModal({url:WWW_DIR_JAVASCRIPT+\"chat/previewchat/\"+e.chat_id})},this.sendMessage=function(e){lhc.revealModal({url:WWW_DIR_JAVASCRIPT+\"chat/sendnotice/\"+e})},this.deleteUser=function(e,n){confirm(n)&&r.deleteOnlineUser({user_id:e.id}).then((function(n){u.onlineusers.splice(u.onlineusers.indexOf(e),1)}))},this.disableNewUserBNotif=function(){u.notificationEnabled=!u.notificationEnabled,lhinst.changeUserSettings(\"new_user_bn\",1==u.notificationEnabled?1:0)},this.disableNewUserSound=function(){u.soundEnabled=!u.soundEnabled,lhinst.changeUserSettings(\"new_user_sound\",1==u.soundEnabled?1:0)},e.$on(\"$destroy\",(function(){s.cancel(a)}))}]);\n"]}