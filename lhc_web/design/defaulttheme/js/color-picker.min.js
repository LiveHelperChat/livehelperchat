"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}!function(){var addClassName=function(node,str){0===node.className.split(" ").filter(function(s){return s===str}).length&&(node.className+=" "+str)},removeClassName=function(node,str){node.className=node.className.split(" ").filter(function(s){return s!==str}).join(" ")},numberBorder=function(num,max,min){return Math.max(Math.min(num,max),min)},rgbToHsb=function(hex){var hsb={h:0,s:0,b:0};if(0===hex.indexOf("#")&&(hex=hex.substring(1)),3===hex.length&&(hex=hex.split("").map(function(s){return s+s}).join("")),6!==hex.length)return!1;var rgb_r=(hex=[hex.substr(0,2),hex.substr(2,2),hex.substr(4,2)].map(function(s){return parseInt(s,16)}))[0],rgb_g=hex[1],rgb_b=hex[2],MAX=Math.max.apply(Math,_toConsumableArray(hex)),MIN=Math.min.apply(Math,_toConsumableArray(hex));return MAX===MIN?hsb.h=0:MAX===rgb_r&&rgb_g>=rgb_b?hsb.h=60*(rgb_g-rgb_b)/(MAX-MIN)+0:MAX===rgb_r&&rgb_g<rgb_b?hsb.h=60*(rgb_g-rgb_b)/(MAX-MIN)+360:MAX===rgb_g?hsb.h=60*(rgb_b-rgb_r)/(MAX-MIN)+120:MAX===rgb_b&&(hsb.h=60*(rgb_r-rgb_g)/(MAX-MIN)+240),hsb.s=0===MAX?0:1-MIN/MAX,hsb.b=MAX/255,hsb},heightToRgb=function(heightPercent){var rgb={r:void 0,g:void 0,b:void 0},percentInEach=6*(heightPercent=1-heightPercent);return Object.entries(rgb).reduce(function(lastObj,nowArr,index){return Object.assign(lastObj,_defineProperty({},nowArr[0],Math.floor(function(){var left=(index+1)%3*2,differenceL=percentInEach-left,differenceR=left+2-percentInEach;if(differenceL>=0&&differenceR>=0)return 0;var distance=Math.min(Math.abs(differenceL),Math.abs(differenceR),Math.abs(6-differenceL),Math.abs(6-differenceR));return Math.min(255,255*distance)}())))},{})},heightAddLAndT_ToRGB=function(height,left,top){var rgb=heightToRgb(height);for(var key in rgb)rgb[key]=(255-rgb[key])*(1-left)+rgb[key],rgb[key]=rgb[key]*(1-top);return rgb},rgbToHex=function(rgb){var r=rgb.r,g=rgb.g,b=rgb.b;return Math.floor(r).toString(16).padStart(2,"0")+Math.floor(g).toString(16).padStart(2,"0")+Math.floor(b).toString(16).padStart(2,"0")},hexToRgb=function(hex){return{r:parseInt(hex.substr(0,2),16),g:parseInt(hex.substr(2,2),16),b:parseInt(hex.substr(4,2),16)}},cE=function(str){return document.createElement(str)},ColorPicker=function(){function ColorPicker(){var _this=this,_ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_ref$dom=_ref.dom,dom=void 0===_ref$dom?cE("div"):_ref$dom,_ref$value=(_ref.input,_ref.value),value=void 0===_ref$value?"FFF":_ref$value;_classCallCheck(this,ColorPicker),this.dom=dom;var thisClass=this;Array.prototype.forEach.call(this.getDOM().children,function(node){node.remove()}),addClassName(dom,"color-picker");var rightBar=cE("div");rightBar.className="color-picker-right-bar";var rightBarPicker=cE("div");rightBarPicker.className="color-picker-right-bar-picker",rightBar.appendChild(rightBarPicker);var colorBlock=cE("div");colorBlock.className="color-picker-color-block";var gradientColor=cE("div");gradientColor.className="color-picker-gradients color-picker-gradient-color";var gradientBlack=cE("div");gradientBlack.className="color-picker-gradients color-picker-gradient-black",gradientColor.style.background="linear-gradient(to right,#FFFFFF,#FF0000)";var gradientCircle=cE("div");gradientCircle.className="color-picker-circle",gradientBlack.appendChild(gradientCircle);var textInput=cE("input"),textInputBox=cE("div");textInputBox.className="color-picker-input",textInput.maxLength=6,textInput.style.width="100%",textInput.style.height="100%",textInputBox.appendChild(textInput),this.getDOM().appendChild(rightBar),this.getDOM().appendChild(colorBlock),this.getDOM().appendChild(textInputBox),this.getDOM().appendChild(gradientColor),this.getDOM().appendChild(gradientBlack),textInput.addEventListener("change",function(){_this.setValue(textInput.value,!0),_this.onchange(),_this.updatePicker()}),this.textInput=textInput,this._gradientBlack=gradientBlack,this._gradientColor=gradientColor,this._rightBar=rightBar,this._rightBarPicker=rightBarPicker,this._colorBlock=colorBlock,this._gradientCircle=gradientCircle,this._height=0,this._mouseX=0,this._mouseY=0,this.setValue(value,!0),this._lastValue=this.value,this.updatePicker();var mouseMoveFun=function mouseMoveFun(e){window.addEventListener("mouseup",function mouseUpFun(){thisClass.getDOM().style.userSelect="text",window.removeEventListener("mousemove",mouseMoveFun),window.removeEventListener("mouseup",mouseUpFun)});var bbox=thisClass._gradientBlack.getBoundingClientRect();_this._mouseX=e.clientX-bbox.left,_this._mouseY=e.clientY-bbox.top,_this.mouseBorder(),_this.setValue(heightAddLAndT_ToRGB(_this.height,_this.position.x,_this.position.y)),_this.updatePicker()},mouseMoveFunBar=function mouseMoveFunBar(e){window.addEventListener("mouseup",function mouseUpFunBar(){thisClass.getDOM().style.userSelect="text",window.removeEventListener("mousemove",mouseMoveFunBar),window.removeEventListener("mouseup",mouseUpFunBar)});var bbox=thisClass._rightBar.getBoundingClientRect();_this._height=e.clientY-bbox.top,_this.mouseBorderBar(),_this.setValue(heightAddLAndT_ToRGB(_this.height,_this.position.x,_this.position.y)),_this.updatePicker()};if(this._gradientBlack.addEventListener("mousedown",function(e){_this.getDOM().style.userSelect="none",mouseMoveFun(e),window.addEventListener("mousemove",mouseMoveFun)}),this._rightBar.addEventListener("mousedown",function(e){_this.getDOM().style.userSelect="none",mouseMoveFunBar(e),window.addEventListener("mousemove",mouseMoveFunBar)}),"ontouchstart"in window){var touchFun=function(e){e.preventDefault(),e=e.touches[0];var bbox=thisClass._gradientBlack.getBoundingClientRect();_this._mouseX=e.clientX-bbox.left,_this._mouseY=e.clientY-bbox.top,_this.mouseBorder(),_this.setValue(heightAddLAndT_ToRGB(_this.height,_this.position.x,_this.position.y)),_this.updatePicker()},touchFunBar=function(e){e.preventDefault(),e=e.touches[0];var bbox=_this._rightBar.getBoundingClientRect();_this._height=e.clientY-bbox.top,_this.mouseBorderBar(),_this.setValue(heightAddLAndT_ToRGB(_this.height,_this.position.x,_this.position.y)),_this.updatePicker()};this._gradientBlack.addEventListener("touchmove",touchFun),this._gradientBlack.addEventListener("touchstart",touchFun),this._rightBar.addEventListener("touchmove",touchFunBar),this._rightBar.addEventListener("touchstart",touchFunBar)}this._changeFunctions=[]}return _createClass(ColorPicker,[{key:"onchange",value:function(){var _this2=this;this._changeFunctions.forEach(function(fun){return fun({target:_this2,type:"change",timeStamp:performance.now()})})}},{key:"addEventListener",value:function(type,fun){if("function"==typeof fun)switch(type){case"change":this._changeFunctions.push(fun)}}},{key:"getValue",value:function(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"value"){case"hex":return this._value;case"rgb":return hexToRgb(this.getValue("hex"));case"hsb":return rgbToHsb(this.getValue("hex"));case"value":default:return"#"+this._value}}},{key:"getBrightness",value:function(){var _getValue=this.getValue("rgb");return.299*_getValue.r+.587*_getValue.g+.114*_getValue.b}},{key:"setValue",value:function(value){var resetPosition=arguments.length>1&&void 0!==arguments[1]&&arguments[1],hex="";switch(void 0===value?"undefined":_typeof(value)){case"string":0===value.indexOf("#")&&(value=value.substring(1)),3===value.length&&(value=value.split("").map(function(s){return s+s}).join("")),6!==value.length&&(value="FFFFFF"),hex=value;break;case"object":hex=rgbToHex(value)}var rgb=void 0;try{rgb=hexToRgb(hex)}catch(error){rgb={r:255,g:255,b:255}}var _rgb=rgb,r=_rgb.r,g=_rgb.g,b=_rgb.b;if(this._value=rgbToHex({r:r,g:g,b:b}).toUpperCase(),this.textInput.value=this._value,this._colorBlock.style.backgroundColor=this.getValue(),resetPosition){var _rgbToHsb=rgbToHsb(hex),h=_rgbToHsb.h,s=_rgbToHsb.s,_b=_rgbToHsb.b;this._height=1-h/360,0===h&&(this._height=0),this._mouseX=s,this._mouseY=1-_b}else this._lastValue!==this.value&&this.onchange();this._lastValue=this.value}},{key:"getDOM",value:function(){return this.dom}},{key:"mouseBorder",value:function(){this._mouseX=numberBorder(this._mouseX/(this._gradientBlack.getBoundingClientRect().width-2),1,0),this._mouseY=numberBorder(this._mouseY/(this._gradientBlack.getBoundingClientRect().height-2),1,0)}},{key:"mouseBorderBar",value:function(){this._height=numberBorder(this._height/(this._rightBar.getBoundingClientRect().height-2),1,0)}},{key:"updatePicker",value:function(){var position=this.position,target=this._gradientCircle;target.style.left=100*position.x+"%",target.style.top=100*position.y+"%",this._rightBarPicker.style.top=100*this.height+"%",this._gradientColor.style.background="linear-gradient(to right,#FFFFFF,#"+rgbToHex(heightToRgb(this.height))+")",this.getBrightness()>152?(addClassName(target,"color-picker-circle-black"),removeClassName(target,"color-picker-circle-white")):(removeClassName(target,"color-picker-circle-black"),addClassName(target,"color-picker-circle-white"))}},{key:"position",get:function(){return{x:this._mouseX,y:this._mouseY}}},{key:"height",get:function(){return this._height}},{key:"value",get:function(){return this.getValue()},set:function(value){this.setValue(value,!0),this.updatePicker()}}]),ColorPicker}();"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports.ColorPicker=ColorPicker:"object"===("undefined"==typeof window?"undefined":_typeof(window))&&(window.ColorPicker=ColorPicker)}();