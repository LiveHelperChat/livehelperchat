var LHCSpeechToTextCallbackListener=function(){function t(t){this.recognizing=!1,this.startOnEnd=!1,this.final_transcript="",this.chat_id=t.chat_id,this.recognition=t.recognition,this.originText=""!=$("#CSChatMessage-"+this.chat_id).val()?$("#CSChatMessage-"+this.chat_id).val()+" ":""}return t.prototype.onstart=function(){$("#CSChatMessage-"+this.chat_id).addClass("admin-chat-mic"),$("#user-chat-status-"+this.chat_id).removeClass("icon-user").addClass("icon-mic"),$("#mic-chat-"+this.chat_id).addClass("icon-mic-recording").html(this.recognition.lang),$("#user-is-typing-"+this.chat_id).html("Speak now.").css("visibility","visible")},t.prototype.onend=function(){$("#user-chat-status-"+this.chat_id).addClass("icon-user").removeClass("icon-mic"),$("#CSChatMessage-"+this.chat_id).removeClass("admin-chat-mic"),$("#mic-chat-"+this.chat_id).removeClass("icon-mic-recording").html(""),$("#user-is-typing-"+this.chat_id).html(""),1==this.startOnEnd&&(this.originText="",this.final_transcript="",this.startOnEnd=!1,this.recognition.start())},t.prototype.onerror=function(t){"no-speech"==t.error&&$("#user-is-typing-"+this.chat_id).html("No speech was detected.").css("visibility","visible"),"audio-capture"==t.error&&$("#user-is-typing-"+this.chat_id).html("No microphone was found.").css("visibility","visible"),"not-allowed"==t.error&&$("#user-is-typing-"+this.chat_id).html("Permission to use microphone was denied.").css("visibility","visible")},t.prototype.onresult=function(t){if(0==this.startOnEnd){for(var i="",s=t.resultIndex;s<t.results.length;++s)t.results[s].isFinal?this.final_transcript+=t.results[s][0].transcript:i+=t.results[s][0].transcript;""!=i?$("#user-is-typing-"+this.chat_id).html(i).css("visibility","visible"):$("#user-is-typing-"+this.chat_id).html("").css("visibility","hidden"),$("#CSChatMessage-"+this.chat_id).val(this.originText+this.final_transcript+i).focus(),lhinst.operatorTypingCallback(this.chat_id)}},t}(),LHCSpeechToText=function(){function t(){"webkitSpeechRecognition"in window?(this.recognizing=!1,this.browserSupported=!0,this.final_transcript="",this.chat_id=!1,this.chatDialect=[]):(alert("Sorry but only chrome is supported"),this.browserSupported=!1)}return t.prototype.stopSpeech=function(){1==this.browserSupported&&1==this.recognizing&&(this.recognizing=!1,this.recognition.stop())},t.prototype.messageSend=function(){1==this.browserSupported&&(this.recognition.callbackHandler.startOnEnd=!0,this.recognition.stop())},t.prototype.setChatDialect=function(t,i){this.chatDialect[t]=i},t.prototype.getChatDialectAndStart=function(){var t=this;$.getJSON(WWW_DIR_JAVASCRIPT+"speech/getchatdialect/"+this.chat_id,function(i){0==i.error?(t.chatDialect[t.chat_id]=i.dialect,t.recognition.lang=t.chatDialect[t.chat_id],t.recognition.start()):alert(i.result)})},t.prototype.listen=function(t){if(1==this.browserSupported)if(this.chat_id!==!1&&this.chat_id!=t.chat_id&&this.stopSpeech(),this.chat_id=t.chat_id,0==this.recognizing){this.recognition=new webkitSpeechRecognition,this.recognition.continuous=!0,this.recognition.interimResults=!0;var i=new LHCSpeechToTextCallbackListener({chat_id:this.chat_id,recognition:this.recognition});this.recognition.onresult=function(t){i.onresult(t)},this.recognition.onstart=function(){i.onstart()},this.recognition.onend=function(){i.onend()},this.recognition.onerror=function(t){i.onerror(t)},this.recognition.callbackHandler=i,this.recognizing=!0,void 0!=this.chatDialect[this.chat_id]?(this.recognition.lang=this.chatDialect[this.chat_id],this.recognition.start()):this.getChatDialectAndStart()}else this.stopSpeech()},t}();