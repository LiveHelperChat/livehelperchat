function enteredOrExited(e){return 1===e||5===e}function escapeQuotes(e){return'"'+e.replace(/"/,'\\"')+'"'}function validateAttribute(e){if("string"!=typeof e)throw Error("Invalid request opion. attribute must be a non-zero length string.");if(e=e.trim(),!e)throw Error("Invalid request opion. attribute must be a non-zero length string.");if(!e.match(attributeFilterPattern))throw Error("Invalid request option. invalid attribute name: "+e);return e}function validateElementAttributes(e){if(!e.trim().length)throw Error("Invalid request option: elementAttributes must contain at least one attribute.");for(var t={},r={},i=e.split(/\s+/),o=0;o<i.length;o++){var a=i[o];if(a){var a=validateAttribute(a),n=a.toLowerCase();if(t[n])throw Error("Invalid request option: observing multiple case variations of the same attribute is not supported.");r[a]=!0,t[n]=!0}}return Object.keys(r)}function elementFilterAttributes(e){var t={};return e.forEach(function(e){e.qualifiers.forEach(function(e){t[e.attrName]=!0})}),Object.keys(t)}var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);r.prototype=t.prototype,e.prototype=new r},MutationObserverCtor;try{MutationObserverCtor="undefined"!=typeof WebKitMutationObserver?WebKitMutationObserver:MutationObserver}catch(e){MutationObserverCtor=void 0}var NodeMap=function(){function e(){this.nodes=[],this.values=[]}return e.prototype.isIndex=function(e){return+e===e>>>0},e.prototype.nodeId=function(t){var r=t[e.ID_PROP];return r||(r=t[e.ID_PROP]=e.nextId_++),r},e.prototype.set=function(e,t){var r=this.nodeId(e);this.nodes[r]=e,this.values[r]=t},e.prototype.get=function(e){var t=this.nodeId(e);return this.values[t]},e.prototype.has=function(e){return this.nodeId(e)in this.nodes},e.prototype["delete"]=function(e){var t=this.nodeId(e);delete this.nodes[t],this.values[t]=void 0},e.prototype.keys=function(){var e=[];for(var t in this.nodes)this.isIndex(t)&&e.push(this.nodes[t]);return e},e.ID_PROP="__mutation_summary_node_map_id__",e.nextId_=1,e}(),Movement;!function(e){e[e.STAYED_OUT=0]="STAYED_OUT",e[e.ENTERED=1]="ENTERED",e[e.STAYED_IN=2]="STAYED_IN",e[e.REPARENTED=3]="REPARENTED",e[e.REORDERED=4]="REORDERED",e[e.EXITED=5]="EXITED"}(Movement||(Movement={}));var NodeChange=function(){function e(e,t,r,i,o,a,n,s){"undefined"==typeof t&&(t=!1),"undefined"==typeof r&&(r=!1),"undefined"==typeof i&&(i=!1),"undefined"==typeof o&&(o=null),"undefined"==typeof a&&(a=!1),"undefined"==typeof n&&(n=null),"undefined"==typeof s&&(s=null),this.node=e,this.childList=t,this.attributes=r,this.characterData=i,this.oldParentNode=o,this.added=a,this.attributeOldValues=n,this.characterDataOldValue=s,this.isCaseInsensitive=this.node.nodeType===Node.ELEMENT_NODE&&this.node instanceof HTMLElement&&this.node.ownerDocument instanceof HTMLDocument}return e.prototype.getAttributeOldValue=function(e){if(this.attributeOldValues)return this.isCaseInsensitive&&(e=e.toLowerCase()),this.attributeOldValues[e]},e.prototype.getAttributeNamesMutated=function(){var e=[];if(!this.attributeOldValues)return e;for(var t in this.attributeOldValues)e.push(t);return e},e.prototype.attributeMutated=function(e,t){this.attributes=!0,this.attributeOldValues=this.attributeOldValues||{},e in this.attributeOldValues||(this.attributeOldValues[e]=t)},e.prototype.characterDataMutated=function(e){this.characterData||(this.characterData=!0,this.characterDataOldValue=e)},e.prototype.removedFromParent=function(e){this.childList=!0,this.added||this.oldParentNode?this.added=!1:this.oldParentNode=e},e.prototype.insertedIntoParent=function(){this.childList=!0,this.added=!0},e.prototype.getOldParent=function(){if(this.childList){if(this.oldParentNode)return this.oldParentNode;if(this.added)return null}return this.node.parentNode},e}(),ChildListChange=function(){function e(){this.added=new NodeMap,this.removed=new NodeMap,this.maybeMoved=new NodeMap,this.oldPrevious=new NodeMap,this.moved=void 0}return e}(),TreeChanges=function(e){function t(t,r){e.call(this),this.rootNode=t,this.reachableCache=void 0,this.wasReachableCache=void 0,this.anyParentsChanged=!1,this.anyAttributesChanged=!1,this.anyCharacterDataChanged=!1;for(var i=0;i<r.length;i++){var o=r[i];switch(o.type){case"childList":this.anyParentsChanged=!0;for(var a=0;a<o.removedNodes.length;a++){var n=o.removedNodes[a];this.getChange(n).removedFromParent(o.target)}for(var a=0;a<o.addedNodes.length;a++){var n=o.addedNodes[a];this.getChange(n).insertedIntoParent()}break;case"attributes":this.anyAttributesChanged=!0;var s=this.getChange(o.target);s.attributeMutated(o.attributeName,o.oldValue);break;case"characterData":this.anyCharacterDataChanged=!0;var s=this.getChange(o.target);s.characterDataMutated(o.oldValue)}}}return __extends(t,e),t.prototype.getChange=function(e){var t=this.get(e);return t||(t=new NodeChange(e),this.set(e,t)),t},t.prototype.getOldParent=function(e){var t=this.get(e);return t?t.getOldParent():e.parentNode},t.prototype.getIsReachable=function(e){if(e===this.rootNode)return!0;if(!e)return!1;this.reachableCache=this.reachableCache||new NodeMap;var t=this.reachableCache.get(e);return void 0===t&&(t=this.getIsReachable(e.parentNode),this.reachableCache.set(e,t)),t},t.prototype.getWasReachable=function(e){if(e===this.rootNode)return!0;if(!e)return!1;this.wasReachableCache=this.wasReachableCache||new NodeMap;var t=this.wasReachableCache.get(e);return void 0===t&&(t=this.getWasReachable(this.getOldParent(e)),this.wasReachableCache.set(e,t)),t},t.prototype.reachabilityChange=function(e){return this.getIsReachable(e)?this.getWasReachable(e)?2:1:this.getWasReachable(e)?5:0},t}(NodeMap),MutationProjection=function(){function e(e,t,r,i,o){this.rootNode=e,this.mutations=t,this.selectors=r,this.calcReordered=i,this.calcOldPreviousSibling=o,this.treeChanges=new TreeChanges(e,t),this.entered=[],this.exited=[],this.stayedIn=new NodeMap,this.visited=new NodeMap,this.childListChangeMap=void 0,this.characterDataOnly=void 0,this.matchCache=void 0,this.processMutations()}return e.prototype.processMutations=function(){if(this.treeChanges.anyParentsChanged||this.treeChanges.anyAttributesChanged)for(var e=this.treeChanges.keys(),t=0;t<e.length;t++)this.visitNode(e[t],void 0)},e.prototype.visitNode=function(e,t){if(!this.visited.has(e)){this.visited.set(e,!0);var r=this.treeChanges.get(e),i=t;if((r&&r.childList||void 0==i)&&(i=this.treeChanges.reachabilityChange(e)),0!==i){if(this.matchabilityChange(e),1===i)this.entered.push(e);else if(5===i)this.exited.push(e),this.ensureHasOldPreviousSiblingIfNeeded(e);else if(2===i){var o=2;r&&r.childList&&(r.oldParentNode!==e.parentNode?(o=3,this.ensureHasOldPreviousSiblingIfNeeded(e)):this.calcReordered&&this.wasReordered(e)&&(o=4)),this.stayedIn.set(e,o)}if(2!==i)for(var a=e.firstChild;a;a=a.nextSibling)this.visitNode(a,i)}}},e.prototype.ensureHasOldPreviousSiblingIfNeeded=function(e){if(this.calcOldPreviousSibling){this.processChildlistChanges();var t=e.parentNode,r=this.treeChanges.get(e);r&&r.oldParentNode&&(t=r.oldParentNode);var i=this.childListChangeMap.get(t);i||(i=new ChildListChange,this.childListChangeMap.set(t,i)),i.oldPrevious.has(e)||i.oldPrevious.set(e,e.previousSibling)}},e.prototype.getChanged=function(e,t,r){this.selectors=t,this.characterDataOnly=r;for(var i=0;i<this.entered.length;i++){var o=this.entered[i],a=this.matchabilityChange(o);1!==a&&2!==a||e.added.push(o)}for(var n=this.stayedIn.keys(),i=0;i<n.length;i++){var o=n[i],a=this.matchabilityChange(o);if(1===a)e.added.push(o);else if(5===a)e.removed.push(o);else if(2===a&&(e.reparented||e.reordered)){var s=this.stayedIn.get(o);e.reparented&&3===s?e.reparented.push(o):e.reordered&&4===s&&e.reordered.push(o)}}for(var i=0;i<this.exited.length;i++){var o=this.exited[i],a=this.matchabilityChange(o);5!==a&&2!==a||e.removed.push(o)}},e.prototype.getOldParentNode=function(e){var t=this.treeChanges.get(e);if(t&&t.childList)return t.oldParentNode?t.oldParentNode:null;var r=this.treeChanges.reachabilityChange(e);if(0===r||1===r)throw Error("getOldParentNode requested on invalid node.");return e.parentNode},e.prototype.getOldPreviousSibling=function(e){var t=e.parentNode,r=this.treeChanges.get(e);r&&r.oldParentNode&&(t=r.oldParentNode);var i=this.childListChangeMap.get(t);if(!i)throw Error("getOldPreviousSibling requested on invalid node.");return i.oldPrevious.get(e)},e.prototype.getOldAttribute=function(e,t){var r=this.treeChanges.get(e);if(!r||!r.attributes)throw Error("getOldAttribute requested on invalid node.");var i=r.getAttributeOldValue(t);if(void 0===i)throw Error("getOldAttribute requested for unchanged attribute name.");return i},e.prototype.attributeChangedNodes=function(e){if(!this.treeChanges.anyAttributesChanged)return{};var t,r;if(e){t={},r={};for(var i=0;i<e.length;i++){var o=e[i];t[o]=!0,r[o.toLowerCase()]=o}}for(var a={},n=this.treeChanges.keys(),i=0;i<n.length;i++){var s=n[i],h=this.treeChanges.get(s);if(h.attributes&&2===this.treeChanges.reachabilityChange(s)&&2===this.matchabilityChange(s))for(var c=s,l=h.getAttributeNamesMutated(),u=0;u<l.length;u++){var o=l[u];if(!t||t[o]||h.isCaseInsensitive&&r[o]){var d=h.getAttributeOldValue(o);d!==c.getAttribute(o)&&(r&&h.isCaseInsensitive&&(o=r[o]),a[o]=a[o]||[],a[o].push(c))}}}return a},e.prototype.getOldCharacterData=function(e){var t=this.treeChanges.get(e);if(!t||!t.characterData)throw Error("getOldCharacterData requested on invalid node.");return t.characterDataOldValue},e.prototype.getCharacterDataChanged=function(){if(!this.treeChanges.anyCharacterDataChanged)return[];for(var e=this.treeChanges.keys(),t=[],r=0;r<e.length;r++){var i=e[r];if(2===this.treeChanges.reachabilityChange(i)){var o=this.treeChanges.get(i);o.characterData&&i.textContent!=o.characterDataOldValue&&t.push(i)}}return t},e.prototype.computeMatchabilityChange=function(e,t){this.matchCache||(this.matchCache=[]),this.matchCache[e.uid]||(this.matchCache[e.uid]=new NodeMap);var r=this.matchCache[e.uid],i=r.get(t);return void 0===i&&(i=e.matchabilityChange(t,this.treeChanges.get(t)),r.set(t,i)),i},e.prototype.matchabilityChange=function(e){var t=this;if(this.characterDataOnly)switch(e.nodeType){case Node.COMMENT_NODE:case Node.TEXT_NODE:return 2;default:return 0}if(!this.selectors)return 2;if(e.nodeType!==Node.ELEMENT_NODE)return 0;for(var r=e,i=this.selectors.map(function(e){return t.computeMatchabilityChange(e,r)}),o=0,a=0;2!==o&&a<i.length;){switch(i[a]){case 2:o=2;break;case 1:o=5===o?2:1;break;case 5:o=1===o?2:5}a++}return o},e.prototype.getChildlistChange=function(e){var t=this.childListChangeMap.get(e);return t||(t=new ChildListChange,this.childListChangeMap.set(e,t)),t},e.prototype.processChildlistChanges=function(){function e(e,t){!e||i.oldPrevious.has(e)||i.added.has(e)||i.maybeMoved.has(e)||t&&(i.added.has(t)||i.maybeMoved.has(t))||i.oldPrevious.set(e,t)}if(!this.childListChangeMap){this.childListChangeMap=new NodeMap;for(var t=0;t<this.mutations.length;t++){var r=this.mutations[t];if("childList"==r.type&&(2===this.treeChanges.reachabilityChange(r.target)||this.calcOldPreviousSibling)){for(var i=this.getChildlistChange(r.target),o=r.previousSibling,a=0;a<r.removedNodes.length;a++){var n=r.removedNodes[a];e(n,o),i.added.has(n)?i.added["delete"](n):(i.removed.set(n,!0),i.maybeMoved["delete"](n)),o=n}e(r.nextSibling,o);for(var a=0;a<r.addedNodes.length;a++){var n=r.addedNodes[a];i.removed.has(n)?(i.removed["delete"](n),i.maybeMoved.set(n,!0)):i.added.set(n,!0)}}}}},e.prototype.wasReordered=function(e){function t(e){if(!e)return!1;if(!n.maybeMoved.has(e))return!1;var t=n.moved.get(e);return void 0!==t?t:(s.has(e)?t=!0:(s.set(e,!0),t=i(e)!==r(e)),s.has(e)?(s["delete"](e),n.moved.set(e,t)):t=n.moved.get(e),t)}function r(e){var i=h.get(e);if(void 0!==i)return i;for(i=n.oldPrevious.get(e);i&&(n.removed.has(i)||t(i));)i=r(i);return void 0===i&&(i=e.previousSibling),h.set(e,i),i}function i(e){if(c.has(e))return c.get(e);for(var r=e.previousSibling;r&&(n.added.has(r)||t(r));)r=r.previousSibling;return c.set(e,r),r}if(!this.treeChanges.anyParentsChanged)return!1;this.processChildlistChanges();var o=e.parentNode,a=this.treeChanges.get(e);a&&a.oldParentNode&&(o=a.oldParentNode);var n=this.childListChangeMap.get(o);if(!n)return!1;if(n.moved)return n.moved.get(e);n.moved=new NodeMap;var s=new NodeMap,h=new NodeMap,c=new NodeMap;return n.maybeMoved.keys().forEach(t),n.moved.get(e)},e}(),Summary=function(){function e(e,t){var r=this;if(this.projection=e,this.added=[],this.removed=[],this.reparented=t.all||t.element?[]:void 0,this.reordered=t.all?[]:void 0,e.getChanged(this,t.elementFilter,t.characterData),t.all||t.attribute||t.attributeList){var i=t.attribute?[t.attribute]:t.attributeList,o=e.attributeChangedNodes(i);t.attribute?this.valueChanged=o[t.attribute]||[]:(this.attributeChanged=o,t.attributeList&&t.attributeList.forEach(function(e){r.attributeChanged.hasOwnProperty(e)||(r.attributeChanged[e]=[])}))}if(t.all||t.characterData){var a=e.getCharacterDataChanged();t.characterData?this.valueChanged=a:this.characterDataChanged=a}this.reordered&&(this.getOldPreviousSibling=e.getOldPreviousSibling.bind(e))}return e.prototype.getOldParentNode=function(e){return this.projection.getOldParentNode(e)},e.prototype.getOldAttribute=function(e,t){return this.projection.getOldAttribute(e,t)},e.prototype.getOldCharacterData=function(e){return this.projection.getOldCharacterData(e)},e.prototype.getOldPreviousSibling=function(e){return this.projection.getOldPreviousSibling(e)},e}(),validNameInitialChar=/[a-zA-Z_]+/,validNameNonInitialChar=/[a-zA-Z0-9_\-]+/,Qualifier=function(){function e(){}return e.prototype.matches=function(e){if(null===e)return!1;if(void 0===this.attrValue)return!0;if(!this.contains)return this.attrValue==e;for(var t=e.split(" "),r=0;r<t.length;r++)if(this.attrValue===t[r])return!0;return!1},e.prototype.toString=function(){return"class"===this.attrName&&this.contains?"."+this.attrValue:"id"!==this.attrName||this.contains?this.contains?"["+this.attrName+"~="+escapeQuotes(this.attrValue)+"]":"attrValue"in this?"["+this.attrName+"="+escapeQuotes(this.attrValue)+"]":"["+this.attrName+"]":"#"+this.attrValue},e}(),Selector=function(){function e(){this.uid=e.nextUid++,this.qualifiers=[]}return Object.defineProperty(e.prototype,"caseInsensitiveTagName",{get:function(){return this.tagName.toUpperCase()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectorString",{get:function(){return this.tagName+this.qualifiers.join("")},enumerable:!0,configurable:!0}),e.prototype.isMatching=function(t){return t[e.matchesSelector](this.selectorString)},e.prototype.wasMatching=function(e,t,r){if(!t||!t.attributes)return r;var i=t.isCaseInsensitive?this.caseInsensitiveTagName:this.tagName;if("*"!==i&&i!==e.tagName)return!1;for(var o=[],a=!1,n=0;n<this.qualifiers.length;n++){var s=this.qualifiers[n],h=t.getAttributeOldValue(s.attrName);o.push(h),a=a||void 0!==h}if(!a)return r;for(var n=0;n<this.qualifiers.length;n++){var s=this.qualifiers[n],h=o[n];if(void 0===h&&(h=e.getAttribute(s.attrName)),!s.matches(h))return!1}return!0},e.prototype.matchabilityChange=function(e,t){var r=this.isMatching(e);return r?this.wasMatching(e,t,r)?2:1:this.wasMatching(e,t,r)?5:0},e.parseSelectors=function(t){function r(){o&&(a&&(o.qualifiers.push(a),a=void 0),s.push(o)),o=new e}function i(){a&&o.qualifiers.push(a),a=new Qualifier}for(var o,a,n,s=[],h=/\s/,c="Invalid or unsupported selector syntax.",l=1,u=2,d=3,f=4,p=5,m=6,g=7,b=8,v=9,y=10,N=11,C=12,E=13,w=14,S=l,_=0;_<t.length;){var D=t[_++];switch(S){case l:if(D.match(validNameInitialChar)){r(),o.tagName=D,S=u;break}if("*"==D){r(),o.tagName="*",S=d;break}if("."==D){r(),i(),o.tagName="*",a.attrName="class",a.contains=!0,S=f;break}if("#"==D){r(),i(),o.tagName="*",a.attrName="id",S=f;break}if("["==D){r(),i(),o.tagName="*",a.attrName="",S=m;break}if(D.match(h))break;throw Error(c);case u:if(D.match(validNameNonInitialChar)){o.tagName+=D;break}if("."==D){i(),a.attrName="class",a.contains=!0,S=f;break}if("#"==D){i(),a.attrName="id",S=f;break}if("["==D){i(),a.attrName="",S=m;break}if(D.match(h)){S=w;break}if(","==D){S=l;break}throw Error(c);case d:if("."==D){i(),a.attrName="class",a.contains=!0,S=f;break}if("#"==D){i(),a.attrName="id",S=f;break}if("["==D){i(),a.attrName="",S=m;break}if(D.match(h)){S=w;break}if(","==D){S=l;break}throw Error(c);case f:if(D.match(validNameInitialChar)){a.attrValue=D,S=p;break}throw Error(c);case p:if(D.match(validNameNonInitialChar)){a.attrValue+=D;break}if("."==D){i(),a.attrName="class",a.contains=!0,S=f;break}if("#"==D){i(),a.attrName="id",S=f;break}if("["==D){i(),S=m;break}if(D.match(h)){S=w;break}if(","==D){S=l;break}throw Error(c);case m:if(D.match(validNameInitialChar)){a.attrName=D,S=g;break}if(D.match(h))break;throw Error(c);case g:if(D.match(validNameNonInitialChar)){a.attrName+=D;break}if(D.match(h)){S=b;break}if("~"==D){a.contains=!0,S=v;break}if("="==D){a.attrValue="",S=N;break}if("]"==D){S=d;break}throw Error(c);case b:if("~"==D){a.contains=!0,S=v;break}if("="==D){a.attrValue="",S=N;break}if("]"==D){S=d;break}if(D.match(h))break;throw Error(c);case v:if("="==D){a.attrValue="",S=N;break}throw Error(c);case y:if("]"==D){S=d;break}if(D.match(h))break;throw Error(c);case N:if(D.match(h))break;if('"'==D||"'"==D){n=D,S=E;break}a.attrValue+=D,S=C;break;case C:if(D.match(h)){S=y;break}if("]"==D){S=d;break}if("'"==D||'"'==D)throw Error(c);a.attrValue+=D;break;case E:if(D==n){S=y;break}a.attrValue+=D;break;case w:if(D.match(h))break;if(","==D){S=l;break}throw Error(c)}}switch(S){case l:case u:case d:case p:case w:r();break;default:throw Error(c)}if(!s.length)throw Error(c);return s},e.nextUid=1,e.matchesSelector=function(){var e=document.createElement("div");return"function"==typeof e.webkitMatchesSelector?"webkitMatchesSelector":"function"==typeof e.mozMatchesSelector?"mozMatchesSelector":"function"==typeof e.msMatchesSelector?"msMatchesSelector":"matchesSelector"}(),e}(),attributeFilterPattern=/^([a-zA-Z:_]+[a-zA-Z0-9_\-:\.]*)$/,MutationSummary=function(){function e(t){var r=this;this.connected=!1,this.options=e.validateOptions(t),this.observerOptions=e.createObserverOptions(this.options.queries),this.root=this.options.rootNode,this.callback=this.options.callback,this.elementFilter=Array.prototype.concat.apply([],this.options.queries.map(function(e){return e.elementFilter?e.elementFilter:[]})),this.elementFilter.length||(this.elementFilter=void 0),this.calcReordered=this.options.queries.some(function(e){return e.all}),this.queryValidators=[],e.createQueryValidator&&(this.queryValidators=this.options.queries.map(function(t){return e.createQueryValidator(r.root,t)})),this.observer=new MutationObserverCtor(function(e){r.observerCallback(e)}),this.reconnect()}return e.createObserverOptions=function(e){function t(e){if(!i.attributes||r){if(i.attributes=!0,i.attributeOldValue=!0,!e)return void(r=void 0);r=r||{},e.forEach(function(e){r[e]=!0,r[e.toLowerCase()]=!0})}}var r,i={childList:!0,subtree:!0};return e.forEach(function(e){if(e.characterData)return i.characterData=!0,void(i.characterDataOldValue=!0);if(e.all)return t(),i.characterData=!0,void(i.characterDataOldValue=!0);if(e.attribute)return void t([e.attribute.trim()]);var r=elementFilterAttributes(e.elementFilter).concat(e.attributeList||[]);r.length&&t(r)}),r&&(i.attributeFilter=Object.keys(r)),i},e.validateOptions=function(t){for(var r in t)if(!(r in e.optionKeys))throw Error("Invalid option: "+r);if("function"!=typeof t.callback)throw Error("Invalid options: callback is required and must be a function");if(!t.queries||!t.queries.length)throw Error("Invalid options: queries must contain at least one query request object.");for(var i={callback:t.callback,rootNode:t.rootNode||document,observeOwnChanges:!!t.observeOwnChanges,oldPreviousSibling:!!t.oldPreviousSibling,queries:[]},o=0;o<t.queries.length;o++){var a=t.queries[o];if(a.all){if(Object.keys(a).length>1)throw Error("Invalid request option. all has no options.");i.queries.push({all:!0})}else if("attribute"in a){var n={attribute:validateAttribute(a.attribute)};if(n.elementFilter=Selector.parseSelectors("*["+n.attribute+"]"),Object.keys(a).length>1)throw Error("Invalid request option. attribute has no options.");i.queries.push(n)}else if("element"in a){var s=Object.keys(a).length,n={element:a.element,elementFilter:Selector.parseSelectors(a.element)};if(a.hasOwnProperty("elementAttributes")&&(n.attributeList=validateElementAttributes(a.elementAttributes),s--),s>1)throw Error("Invalid request option. element only allows elementAttributes option.");i.queries.push(n)}else{if(!a.characterData)throw Error("Invalid request option. Unknown query request.");if(Object.keys(a).length>1)throw Error("Invalid request option. characterData has no options.");i.queries.push({characterData:!0})}}return i},e.prototype.createSummaries=function(e){if(!e||!e.length)return[];for(var t=new MutationProjection(this.root,e,this.elementFilter,this.calcReordered,this.options.oldPreviousSibling),r=[],i=0;i<this.options.queries.length;i++)r.push(new Summary(t,this.options.queries[i]));return r},e.prototype.checkpointQueryValidators=function(){this.queryValidators.forEach(function(e){e&&e.recordPreviousState()})},e.prototype.runQueryValidators=function(e){this.queryValidators.forEach(function(t,r){t&&t.validate(e[r])})},e.prototype.changesToReport=function(e){return e.some(function(e){var t=["added","removed","reordered","reparented","valueChanged","characterDataChanged"];if(t.some(function(t){return e[t]&&e[t].length}))return!0;if(e.attributeChanged){var r=Object.keys(e.attributeChanged),i=r.some(function(t){return!!e.attributeChanged[t].length});if(i)return!0}return!1})},e.prototype.observerCallback=function(e){this.options.observeOwnChanges||this.observer.disconnect();var t=this.createSummaries(e);this.runQueryValidators(t),this.options.observeOwnChanges&&this.checkpointQueryValidators(),this.changesToReport(t)&&this.callback(t),!this.options.observeOwnChanges&&this.connected&&(this.checkpointQueryValidators(),this.observer.observe(this.root,this.observerOptions))},e.prototype.reconnect=function(){if(this.connected)throw Error("Already connected");this.observer.observe(this.root,this.observerOptions),this.connected=!0,this.checkpointQueryValidators()},e.prototype.takeSummaries=function(){if(!this.connected)throw Error("Not connected");var e=this.createSummaries(this.observer.takeRecords());return this.changesToReport(e)?e:void 0},e.prototype.disconnect=function(){var e=this.takeSummaries();return this.observer.disconnect(),this.connected=!1,e},e.NodeMap=NodeMap,e.parseElementFilter=Selector.parseSelectors,e.optionKeys={callback:!0,queries:!0,rootNode:!0,oldPreviousSibling:!0,observeOwnChanges:!0},e}(),TreeMirror=function(){function e(e,t){this.root=e,this.delegate=t,this.idMap={}}return e.prototype.initialize=function(e,t){this.idMap[e]=this.root;for(var r=0;r<t.length;r++)this.deserializeNode(t[r],this.root)},e.prototype.applyChanged=function(e,t,r,i){var o=this;t.forEach(function(e){var t=o.deserializeNode(e);o.deserializeNode(e.parentNode),o.deserializeNode(e.previousSibling);t.parentNode&&t.parentNode.removeChild(t)}),e.forEach(function(e){var t=o.deserializeNode(e);t.parentNode&&t.parentNode.removeChild(t)}),t.forEach(function(e){var t=o.deserializeNode(e),r=o.deserializeNode(e.parentNode),i=o.deserializeNode(e.previousSibling);r.insertBefore(t,i?i.nextSibling:r.firstChild)}),r.forEach(function(e){var t=o.deserializeNode(e);Object.keys(e.attributes).forEach(function(r){var i=e.attributes[r];null===i?t.removeAttribute(r):o.delegate&&o.delegate.setAttribute&&o.delegate.setAttribute(t,r,i)||t.setAttribute(r,i)})}),i.forEach(function(e){var t=o.deserializeNode(e);t.textContent=e.textContent}),e.forEach(function(e){delete o.idMap[e.id]})},e.prototype.deserializeNode=function(e,t){var r=this;if(null===e)return null;var i=this.idMap[e.id];if(i)return i;var o=this.root.ownerDocument;switch(null===o&&(o=this.root),e.nodeType){case Node.COMMENT_NODE:i=o.createComment(e.textContent);break;case Node.TEXT_NODE:i=o.createTextNode(e.textContent);break;case Node.DOCUMENT_TYPE_NODE:i=o.implementation.createDocumentType(e.name,e.publicId,e.systemId);break;case Node.ELEMENT_NODE:this.delegate&&this.delegate.createElement&&(i=this.delegate.createElement(e.tagName)),i||(i=o.createElement(e.tagName)),Object.keys(e.attributes).forEach(function(t){try{r.delegate&&r.delegate.setAttribute&&r.delegate.setAttribute(i,t,e.attributes[t])||i.setAttribute(t,e.attributes[t])}catch(o){}})}if(!i)throw"ouch";if(this.idMap[e.id]=i,t&&t.appendChild(i),e.childNodes)for(var a=0;a<e.childNodes.length;a++)this.deserializeNode(e.childNodes[a],i);return i},e}(),TreeMirrorClient=function(){function e(e,t,r){var i=this;this.target=e,this.mirror=t,this.nextId=1,this.knownNodes=new MutationSummary.NodeMap;for(var o=this.serializeNode(e).id,a=[],n=e.firstChild;n;n=n.nextSibling)a.push(this.serializeNode(n,!0));this.mirror.initialize(o,a);var s=[{all:!0}];r&&(s=s.concat(r));var h;try{h="undefined"!=typeof WebKitMutationObserver?WebKitMutationObserver:MutationObserver}catch(c){h=void 0}void 0!==h&&(this.mutationSummary=new MutationSummary({rootNode:e,callback:function(e){i.applyChanged(e)},queries:s}))}return e.prototype.disconnect=function(){this.mutationSummary&&(this.mutationSummary.disconnect(),this.mutationSummary=void 0)},e.prototype.rememberNode=function(e){var t=this.nextId++;return this.knownNodes.set(e,t),t},e.prototype.forgetNode=function(e){this.knownNodes["delete"](e)},e.prototype.serializeNode=function(e,t){if(null===e)return null;var r=this.knownNodes.get(e);if(void 0!==r)return{id:r};var i={nodeType:e.nodeType,id:this.rememberNode(e)};switch(i.nodeType){case Node.DOCUMENT_TYPE_NODE:var o=e;i.name=o.name,i.publicId=o.publicId,i.systemId=o.systemId;break;case Node.COMMENT_NODE:case Node.TEXT_NODE:i.textContent=e.textContent;break;case Node.ELEMENT_NODE:var a=e;i.tagName=a.tagName,i.attributes={};for(var n=0;n<a.attributes.length;n++){var s=a.attributes[n];i.attributes[s.name]=s.value}if(t&&a.childNodes.length){i.childNodes=[];for(var h=a.firstChild;h;h=h.nextSibling)i.childNodes.push(this.serializeNode(h,!0))}}return i},e.prototype.serializeAddedAndMoved=function(e,t,r){var i=this,o=e.concat(t).concat(r),a=new MutationSummary.NodeMap;o.forEach(function(e){var t=e.parentNode,r=a.get(t);r||(r=new MutationSummary.NodeMap,a.set(t,r)),r.set(e,!0)});var n=[];return a.keys().forEach(function(e){for(var t=a.get(e),r=t.keys();r.length;){for(var o=r[0];o.previousSibling&&t.has(o.previousSibling);)o=o.previousSibling;for(;o&&t.has(o);){var s=i.serializeNode(o);s.previousSibling=i.serializeNode(o.previousSibling),s.parentNode=i.serializeNode(o.parentNode),n.push(s),t["delete"](o),o=o.nextSibling}var r=t.keys()}}),n},e.prototype.serializeAttributeChanges=function(e){var t=this,r=new MutationSummary.NodeMap;return Object.keys(e).forEach(function(i){e[i].forEach(function(e){var o=r.get(e);o||(o=t.serializeNode(e),o.attributes={},r.set(e,o)),o.attributes[i]=e.getAttribute(i)})}),r.keys().map(function(e){return r.get(e)})},e.prototype.applyChanged=function(e){var t=this,r=e[0],i=r.removed.map(function(e){return t.serializeNode(e)}),o=this.serializeAddedAndMoved(r.added,r.reparented,r.reordered),a=this.serializeAttributeChanges(r.attributeChanged),n=r.characterDataChanged.map(function(e){var r=t.serializeNode(e);return r.textContent=e.textContent,r});this.mirror.applyChanged(i,o,a,n),r.removed.forEach(function(e){t.forgetNode(e)})},e}();"undefined"!=typeof jQuery&&function(){!function(e){var t,r,i,o,a,n,s,h;return s=e.map,a=e.extend,n=e.inArray,i=function(e,t){return n(e,t)!==-1},o=function(e){return e.replace(/([\!\"\#\$\%\&'\(\)\*\+\,\.\/\:\;<\=>\?\@\[\\\]\^\`\{\|\}\~])/g,"\\$1")},r=function(e,t){return s(e,function(e){return e===t?null:e})},h=function(e){return s(e,function(t,r){return parseInt(r,10)===parseInt(e.indexOf(t),10)?t:null})},t=function(){function t(t,r){this.element=t,this.options=a(a({},e.selectorator.options),r),this.cachedResults={}}return t.prototype.query=function(t){var r;return(r=this.cachedResults)[t]||(r[t]=e(t.replace(/#([^\s]+)/g,"[id='$1']")))},t.prototype.getProperTagName=function(){return this.element[0]?this.element[0].tagName.toLowerCase():null},t.prototype.hasParent=function(){return this.element&&0<this.element.parent().length},t.prototype.isElement=function(){var e;return e=this.element[0],e&&e.nodeType===e.ELEMENT_NODE},t.prototype.validate=function(e,t,r,o){var a,n;if(null==r&&(r=!0),null==o&&(o=!1),n=this.query(e),r&&1<n.length||!r&&0===n.length){if(!t||e.indexOf(":")!==-1)return null;if(a=o?" > ":" ",e=t+a+e,n=this.query(e),r&&1<n.length||!r&&0===n.length)return null}return i(this.element[0],n.get())?e:null},t.prototype.generate=function(){var e,t,i,o,a;if(!(this.element&&this.hasParent()&&this.isElement()))return[""];for(t=[],a=[this.generateSimple,this.generateAncestor,this.generateRecursive],i=0,o=a.length;i<o;i++)if(e=a[i],t=h(r(e.call(this))),t&&t.length>0)return t;return h(t)},t.prototype.generateAncestor=function(){var r,i,o,a,n,s,h,c,l,u,d,f,p,m;for(n=[],m=this.element.parents(),c=0,d=m.length;c<d;c++){for(i=m[c],r=!0,h=this.generateSimple(null,!1),l=0,f=h.length;l<f;l++)for(s=h[l],a=new t(e(i),this.options).generateSimple(null,!1),u=0,p=a.length;u<p;u++)o=a[u],e.merge(n,this.generateSimple(o,!0,r));r=!1}return n},t.prototype.generateSimple=function(e,t,i){var o,a,n,h,c,l,u,d;for(n=this,h=n.getProperTagName(),c=function(r){return n.validate(r,e,t,i)},d=[[n.getIdSelector],[n.getClassSelector],[n.getIdSelector,!0],[n.getClassSelector,!0],[n.getNameSelector],[function(){return[n.getProperTagName()]}]],l=0,u=d.length;l<u;l++)if(o=d[l],a=o[0].call(n,o[1])||[],a=r(s(a,c)),a.length>0)return a;return[]},t.prototype.generateRecursive=function(){var e,r,i,o;return o=this.getProperTagName(),o.indexOf(":")!==-1&&(o="*"),r=this.element.parent(),i=new t(r).generate()[0],e=r.children(o).index(this.element),o=""+o+":eq("+e+")",""!==i&&(o=i+" > "+o),[o]},t.prototype.getIdSelector=function(e){var t;return null==e&&(e=!1),e=e?this.getProperTagName():"",t=this.element.attr("id"),"string"!=typeof t||i(t,this.getIgnore("id"))?null:[""+e+"#"+o(t)]},t.prototype.getClassSelector=function(e){var t,r,a;return null==e&&(e=!1),a=this.getProperTagName(),/^(body|html)$/.test(a)?null:(e=e?a:"",r=this.getIgnore("class"),t=(this.element.attr("class")||"").replace(/\{.*\}/,"").split(/\s/),s(t,function(t){return t&&!i(t,r)?""+e+"."+o(t):null}))},t.prototype.getNameSelector=function(){var e,t;return t=this.getProperTagName(),e=this.element.attr("name"),e&&!i(e,this.getIgnore("name"))?[""+t+"[name='"+e+"']"]:null},t.prototype.getIgnore=function(e){var t,r,i;return r=this.options.ignore||{},t="class"===e?"classes":""+e+"s",i=r[e]||r[t],"string"==typeof i?[i]:i},t}(),e.selectorator={options:{},unique:h,clean:r,escapeSelector:o},e.fn.selectorator=function(r){return new t(e(this),r)},e.fn.getSelector=function(e){return this.selectorator(e).generate()},this}(jQuery)}.call(this);var LHCCoBrowserOperator=function(){function e(e,t,r){this.$awesomebar=t.getElementById("awesomebar"),this.$lastmessage=t.getElementById("last-message"),this.$finishedmessage=t.getElementById("finished-message"),this.iFrameDocument,this.mirror;var i=this;this.initialize=r.initialize,this.base=r.base,this.chat_id=r.chat_id?r.chat_id:r.online_user_id,this.chat_hash=r.chat_hash?r.chat_hash:r.online_user_hash,this.mode_co_browse=r.mode?"/(cobrowsemode)/"+r.mode:"/(cobrowsemode)/chat",this.mode_co_browse_internal=r.mode?r.mode:"chat",this.node_js_settings=r.nodejssettings,this.disablejs=r.disablejs,this.disableiframe="undefined"==typeof r.disableiframe||r.disableiframe,this.formsenabled="undefined"==typeof r.formsenabled||r.formsenabled,this.refreshTimeout=null,this.isNodeConnected=!1,this.isInitialized=!1,this.cursor=r.cursor,this.mouseShow=!1,this.windowScroll=!1,this.fillTimeout=null,this.textSend=null,this.highlightedCSS=!1,this.httpsmode=r.httpsmode,
this.lhcbase=r.lhcbase,this.sitehttps=!1,""!=this.base&&this.base.indexOf("https")>-1&&(this.sitehttps=!0),r.nodejsenabled&&this.setupNodeJs(),parseInt(r.cpos.w)>0&&parseInt(r.cpos.wh)>0&&(document.getElementById("center-layout").style.width=r.cpos.w+"px",document.getElementById("center-layout").style.height=r.cpos.wh+"px"),r.options.opmouse&&(r.options.opmouse.click(function(){$(this).is(":checked")?(i.sendData("lhc_cobrowse_cmd:mouse:show"),i.mouseShow=!0):(i.sendData("lhc_cobrowse_cmd:mouse:hide"),i.mouseShow=!1)}),r.options.opmouse.is(":checked")&&(this.mouseShow=!0)),this.opcontrol=!1,r.options.opcontrol&&(r.options.opcontrol.click(function(){$(this).is(":checked")?i.opcontrol=!0:i.opcontrol=!1}),r.options.opcontrol.is(":checked")&&(this.opcontrol=!0)),this.userScrollSync=!1,this.userScrollData={t:0,l:0},r.options.opscroll&&(r.options.opscroll.click(function(){$(this).is(":checked")?(i.userScrollSync=!0,i.visitorScroll(i.userScrollData)):i.userScrollSync=!1}),r.options.opscroll.is(":checked")&&(this.userScrollSync=!0,this.visitorScroll(this.userScrollData))),r.options.scroll&&(r.options.scroll.click(function(){$(this).is(":checked")?(i.sendData("lhc_cobrowse_cmd:scroll:true"),i.windowScroll=!0):(i.sendData("lhc_cobrowse_cmd:scroll:false"),i.windowScroll=!1)}),r.options.scroll.is(":checked")&&(this.windowScroll=!0)),this.mouse={x:0,y:0},this.mouseTimeout=null,this.mouseEventListenerCallback=function(e){i.mouseEventListener(e)},this.treeMirrorParams={createElement:function(e){if(1==i.disablejs&&"SCRIPT"==e){var t=document.createElement("NO-SCRIPT");return t.style.display="none",t}if("SELECT"==e){var t=document.createElement("SELECT");return 0==i.formsenabled&&t.setAttribute("disabled","disabled"),t.addEventListener("change",function(){i.changeSelectValue($(t)[0].selectedIndex,i.getSelectorQuery(t))},!1),t}if("INPUT"==e||"TEXTAREA"==e){var t=document.createElement(e);return 0==i.formsenabled&&t.setAttribute("readonly","readonly"),t.addEventListener("focus",function(){i.highlightElement(-1,-1,i.scrollLeftGS(),i.scrollTopGS(),i.getSelectorQuery(t),t)},!1),t}if("HEAD"==e){var t=document.createElement("HEAD");return t.appendChild(document.createElement("BASE")),t.firstChild.href=i.base,t.firstChild.id="lhc-co-browse-base-id",t}},setAttribute:function(e,t,r){return 1==i.disableiframe&&"IFRAME"==e.nodeName&&"src"==t?(e.setAttribute(t,"javascript:void(0)"),!0):"IFRAME"==e.nodeName&&"id"==t&&"lhc_iframe"==r?(setTimeout(function(){$(i.iFrameDocument).find("#lhc_container").hide().attr("id","lhc_container_dummy").find("#lhc_iframe_container").remove()},2e3),!0):("BASE"==e.nodeName&&($(i.iFrameDocument).find("#lhc-co-browse-base-id").remove(),"href"==e.attr&&(i.base=r)),"SCRIPT"==e.nodeName&&"src"==t&&r.indexOf("google")>-1?(e.setAttribute("src",""),!0):("LINK"==e.nodeName&&("type"==t&&"text/css"==r||"rel"==t&&"stylesheet"==r)&&null===e.getAttribute("lhc-css")&&(e.setAttribute("lhc-css","true"),1==i.httpsmode&&0==i.sitehttps&&""!=e.getAttribute("href")&&e.setAttribute("href",i.lhcbase+"/"+i.chat_id+i.mode_co_browse+"/?base="+encodeURIComponent(i.base)+"&css="+encodeURIComponent(e.getAttribute("href")))),"LINK"==e.nodeName&&"href"==t&&1==i.httpsmode&&0==i.sitehttps&&null!==e.getAttribute("lhc-css")?(e.setAttribute("href",i.lhcbase+"/"+i.chat_id+i.mode_co_browse+"/?base="+encodeURIComponent(i.base)+"&css="+encodeURIComponent(r)),!0):"A"==e.nodeName&&"href"==t?(e.setAttribute(t,"javascript:void(0)"),e.setAttribute("title",r),!0):"A"==e.nodeName&&"onclick"==t?""==r||(e.setAttribute(t,"javascript:void(0)"),!0):void 0))}},e.onIframeLoaded=function(){i.iFrameDocument=e.frames.content.document,i.iFrameDocument.addEventListener("mousemove",i.mouseEventListenerCallback,!1),i.iFrameDocument.onclick=function(e){e.ctrlKey||1==i.opcontrol?((!e.target||"INPUT"!=e.target.tagName||"radio"!=e.target.type&&"checkbox"!=e.target.type)&&e.preventDefault(),i.sendClickCommand(e.x,e.y,i.scrollLeftGS(),i.scrollTopGS(),i.getSelectorQuery(e.target))):(e.preventDefault(),i.highlightElement(e.x,e.y,i.scrollLeftGS(),i.scrollTopGS(),i.getSelectorQuery(e.target),e.target))},i.iFrameDocument.onkeyup=function(e){e=e||window.event,i.fillForm(e.target,i.getSelectorQuery(e.target))},null!==i.initialize&&""!=i.initialize&&i.handleMessage(i.initialize),i.startChangesMonitoring()}}return e.prototype.scrollTopGS=function(e){if("undefined"==typeof e)return this.iFrameDocument.documentElement.scrollTop||this.iFrameDocument.body.scrollTop;if(this.iFrameDocument.documentElement)try{this.iFrameDocument.documentElement.scrollTop=e}catch(t){}if(this.iFrameDocument.body)try{this.iFrameDocument.body.scrollTop=e}catch(t){}},e.prototype.scrollLeftGS=function(e){if("undefined"==typeof e)return this.iFrameDocument.documentElement.scrollLeft||this.iFrameDocument.body.scrollLeft;if(this.iFrameDocument.documentElement)try{this.iFrameDocument.documentElement.scrollLeft=e}catch(t){}if(this.iFrameDocument.body)try{this.iFrameDocument.body.scrollLeft=e}catch(t){}},e.prototype.getSelectorQuery=function(e){var t=$(e).getSelector();return t.length>=1?t[0]:""},e.prototype.fillForm=function(e,t){if(1==this.formsenabled)for(var r=[e],i=0;i<r.length;i++)if("INPUT"==r[i].tagName||"TEXTAREA"==r[i].tagName)if(this.textSend=r[i].value.replace(new RegExp(":","g"),"_SEL_"),this.isNodeConnected===!0)this.sendData("lhc_cobrowse_cmd:fillform:"+this.textSend+"__SPLIT__"+t.replace(new RegExp(":","g"),"_SEL_"));else if(null===this.fillTimeout){var o=this;this.fillTimeout=setTimeout(function(){o.sendData("lhc_cobrowse_cmd:fillform:"+o.textSend+"__SPLIT__"+t.replace(new RegExp(":","g"),"_SEL_")),o.fillTimeout=null},300)}},e.prototype.changeSelectValue=function(e,t){1==this.formsenabled&&this.sendData("lhc_cobrowse_cmd:changeselect:"+e+"__SPLIT__"+t.replace(new RegExp(":","g"),"_SEL_"))},e.prototype.highlightElement=function(e,t,r,i,o,a){this.sendData("lhc_cobrowse_cmd:hightlight:"+e+","+t+","+r+","+i+"__SPLIT__"+o.replace(new RegExp(":","g"),"_SEL_"));var n=!0;if(1==jQuery(a).hasClass("lhc-higlighted")&&"INPUT"!=a.tagName&&"TEXTAREA"!=a.tagName&&"SELECT"!=a.tagName&&(n=!1),jQuery(this.iFrameDocument).find(".lhc-higlighted").removeClass("lhc-higlighted"),1==n&&jQuery(a).addClass("lhc-higlighted"),0==this.highlightedCSS){this.highlightedCSS=!0;var s=this.appendHTML("<style>.lhc-higlighted{-webkit-box-shadow: 0px 0px 20px 5px rgba(88,140,204,1)!important;-moz-box-shadow: 0px 0px 20px 5px rgba(88,140,204,1)!important;box-shadow: 0px 0px 20px 5px rgba(88,140,204,1)!important;}</style>");null!==this.iFrameDocument.body&&this.iFrameDocument.body.insertBefore(s,this.iFrameDocument.body.childNodes[0])}},e.prototype.sendClickCommand=function(e,t,r,i,o){this.sendData("lhc_cobrowse_cmd:click:"+e+","+t+","+r+","+i+"__SPLIT__"+o.replace(new RegExp(":","g"),"_SEL_"))},e.prototype.sendData=function(e){if(this.isNodeConnected===!1){if("onlineuser"==this.mode_co_browse_internal)return lhinst.addExecutionCommand(this.chat_id,"lhc_cobrowse_multi_command__"+e);lhinst.addRemoteCommand(this.chat_id,e)}else this.socket.emit("remotecommand",{chat_id:this.chat_id+"_"+this.chat_hash,cmd:e})},e.prototype.mouseEventListener=function(e){var t=this;if(null!=this.iFrameDocument.body){var r=(e.clientX||e.pageX)+this.scrollLeftGS(),i=(e.clientY||e.pageY)+this.scrollTopGS();t.mouse.x==r&&t.mouse.y==i||(t.mouse.x=r,t.mouse.y=i,1==this.mouseShow&&null===t.mouseTimeout&&(t.mouseTimeout=setTimeout(function(){t.sendData("lhc_cobrowse_cmd:operatorcursor:"+t.mouse.x+","+t.mouse.y),t.mouseTimeout=null},t.isNodeConnected===!0?20:1e3)))}},e.prototype.setupNodeJs=function(){var e=this;if("undefined"==typeof io){var t=document.getElementsByTagName("head")[0],r=document.createElement("script");r.setAttribute("type","text/javascript"),r.setAttribute("src",this.node_js_settings.nodejssocket),t.appendChild(r),r.onreadystatechange=r.onload=function(){e.setupNodeJs()}}else try{this.socket=io.connect(this.node_js_settings.nodejshost,{secure:this.node_js_settings.secure,path:this.node_js_settings.path}),this.socket.on("connect",function(){e.onConnected()}),this.socket.on("reconnect_error",function(){e.isNodeConnected=!1}),this.socket.on("connect_timeout",function(){e.isNodeConnected=!1}),this.socket.on("usermessage",function(t){e.handleMessage(t)}),this.socket.on("userleft",function(t){e.userLeft(t)}),this.socket.on("userjoined",function(t){e.userJoined(t)})}catch(i){console.log(i)}},e.prototype.userLeft=function(e){$("#status-icon-sharing").html("&#xf209;"),this.clearPage()},e.prototype.userJoined=function(e){$("#status-icon-sharing").html("&#xf208;")},e.prototype.onConnected=function(){this.isNodeConnected=!0,this.socket.emit("joinadmin",{chat_id:this.chat_id+"_"+this.chat_hash})},e.prototype.startChangesMonitoring=function(){if(this.isNodeConnected===!1){var e=this;this.isInitialized=!0,$.getJSON(WWW_DIR_JAVASCRIPT+"cobrowse/checkmirrorchanges/"+e.chat_id+e.mode_co_browse,function(t){"undefined"==typeof t.empty&&e.handleMessage(t),e.refreshTimeout=setTimeout(function(){e.startChangesMonitoring()},1400)}).fail(function(){e.refreshTimeout=setTimeout(function(){e.startChangesMonitoring()},1400)})}},e.prototype.clearPage=function(){if(this.highlightedCSS=!1,this.iFrameDocument)for(;this.iFrameDocument.firstChild;)this.iFrameDocument.removeChild(this.iFrameDocument.firstChild)},e.prototype.visitorCursor=function(e){if(document.getElementById("center-layout").style.width=e.w+"px",document.getElementById("center-layout").style.height=e.wh+"px","undefined"!=typeof this.iFrameDocument){var t=this.iFrameDocument.getElementById("user-cursor");if(null===t){var r=this.appendHTML('<div id="user-cursor" style="z-index:99999;top:'+e.y+"px;left:"+parseInt(e.x-12)+'px;position:absolute;"><img src="'+this.cursor+'" /></div>');null!==this.iFrameDocument.body&&this.iFrameDocument.body.appendChild(r)}else t.style.top=e.y+"px",t.style.left=parseInt(e.x-12)+"px"}},e.prototype.visitorScroll=function(e){this.userScrollData=e,"undefined"!=typeof this.iFrameDocument&&1==this.userScrollSync&&(this.scrollTopGS(e.t),this.scrollLeftGS(e.l))},e.prototype.visitorHash=function(e){"undefined"!=typeof this.iFrameDocument&&(jQuery(this.iFrameDocument).find(e.hsh).length>0?this.scrollTopGS(jQuery(this.iFrameDocument).find(e.hsh).offset().top):(this.scrollTopGS(e.t),this.scrollLeftGS(e.l)))},e.prototype.appendHTML=function(e){var t=this.iFrameDocument.createDocumentFragment(),r=this.iFrameDocument.createElement("div");for(r.innerHTML=e;r.firstChild;)t.appendChild(r.firstChild);return t},e.prototype.changeTextValue=function(e){""!=e.selector&&$(this.iFrameDocument).find(e.selector).val(e.value)},e.prototype.changeSelectValueFromUser=function(e){""!=e.selector&&$(this.iFrameDocument).find(e.selector).length>0&&($(this.iFrameDocument).find(e.selector)[0].selectedIndex=e.value)},e.prototype.changeCheckboxValueFromUser=function(e){""!=e.selector&&$(this.iFrameDocument).find(e.selector).length>0&&($(this.iFrameDocument).find(e.selector)[0].checked=e.value)},e.prototype.handleMessage=function(e){if(e.base)this.base=e.base,this.base.indexOf("https")>-1&&(this.sitehttps=!0);else if(e.err)this.iFrameDocument.getElementById("loading").style.display="none",this.iFrameDocument.getElementById("error").innerHTML=e.err,this.iFrameDocument.getElementById("error").style.display="block";else if(e.lmsg)this.$lastmessage.innerHTML=e.lmsg;else if(e.finished)$("#status-icon-sharing").attr("title",e.finished.text),0==e.finished.status?$("#status-icon-sharing").html("&#xf208;"):$("#status-icon-sharing").html("&#xf209;");else if(e.url)this.$awesomebar.value=e.url;else if(e.f&&"initialize"==e.f){this.clearPage(),"undefined"!=typeof e.formsEnabled&&(this.formsenabled=e.formsEnabled),this.mirror=new TreeMirror(this.iFrameDocument,this.treeMirrorParams),this.mirror.initialize.apply(this.mirror,e.args);var t=this;setTimeout(function(){var e=t.appendHTML("<style>body{visibility:visible!important;}#lhc_status_container{display:none!important;}#lhc-user-cursor{display:none!important;}.lhc-higlighted{-webkit-box-shadow: 0px 0px 20px 5px rgba(88,140,204,1);-moz-box-shadow: 0px 0px 20px 5px rgba(88,140,204,1);box-shadow: 0px 0px 20px 5px rgba(88,140,204,1);}</style>");null!==t.iFrameDocument.body&&t.iFrameDocument.body.insertBefore(e,t.iFrameDocument.body.childNodes[0])},2e3),1==this.mouseShow&&this.sendData("lhc_cobrowse_cmd:mouse:show"),1==this.windowScroll&&this.sendData("lhc_cobrowse_cmd:scroll:true")}else if(e.f&&"cursor"==e.f)this.visitorCursor(e.pos);else if(e.f&&"uscroll"==e.f)this.visitorScroll(e.pos);else if(e.f&&"uchash"==e.f)this.visitorHash(e.pos);else if(e.f&&"textdata"==e.f)this.changeTextValue(e);else if(e.f&&"selectval"==e.f)this.changeSelectValueFromUser(e);else if(e.f&&"chkval"==e.f)this.changeCheckboxValueFromUser(e);else if(e.f)"undefined"!=typeof this.mirror&&this.mirror[e.f].apply(this.mirror,e.args);else if(e instanceof Array){var t=this;e.forEach(function(e){try{t.handleMessage(e)}catch(r){console.log(r)}})}else e.clear?this.clearPage():e.error_msg&&alert(e.error_msg)},e}();