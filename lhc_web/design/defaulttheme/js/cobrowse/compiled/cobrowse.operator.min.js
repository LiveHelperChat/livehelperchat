function enteredOrExited(e){return 1===e||5===e}function escapeQuotes(e){return'"'+e.replace(/"/,'\\"')+'"'}function validateAttribute(e){if("string"!=typeof e)throw Error("Invalid request opion. attribute must be a non-zero length string.");if(e=e.trim(),!e)throw Error("Invalid request opion. attribute must be a non-zero length string.");if(!e.match(attributeFilterPattern))throw Error("Invalid request option. invalid attribute name: "+e);return e}function validateElementAttributes(e){if(!e.trim().length)throw Error("Invalid request option: elementAttributes must contain at least one attribute.");for(var t={},i={},r=e.split(/\s+/),o=0;o<r.length;o++){var a=r[o];if(a){var a=validateAttribute(a),n=a.toLowerCase();if(t[n])throw Error("Invalid request option: observing multiple case variations of the same attribute is not supported.");i[a]=!0,t[n]=!0}}return Object.keys(i)}function elementFilterAttributes(e){var t={};return e.forEach(function(e){e.qualifiers.forEach(function(e){t[e.attrName]=!0})}),Object.keys(t)}var __extends=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},MutationObserverCtor;try{MutationObserverCtor="undefined"!=typeof WebKitMutationObserver?WebKitMutationObserver:MutationObserver}catch(e){MutationObserverCtor=void 0}var NodeMap=function(){function e(){this.nodes=[],this.values=[]}return e.prototype.isIndex=function(e){return+e===e>>>0},e.prototype.nodeId=function(t){var i=t[e.ID_PROP];return i||(i=t[e.ID_PROP]=e.nextId_++),i},e.prototype.set=function(e,t){var i=this.nodeId(e);this.nodes[i]=e,this.values[i]=t},e.prototype.get=function(e){var t=this.nodeId(e);return this.values[t]},e.prototype.has=function(e){return this.nodeId(e)in this.nodes},e.prototype["delete"]=function(e){var t=this.nodeId(e);delete this.nodes[t],this.values[t]=void 0},e.prototype.keys=function(){var e=[];for(var t in this.nodes)this.isIndex(t)&&e.push(this.nodes[t]);return e},e.ID_PROP="__mutation_summary_node_map_id__",e.nextId_=1,e}(),Movement;!function(e){e[e.STAYED_OUT=0]="STAYED_OUT",e[e.ENTERED=1]="ENTERED",e[e.STAYED_IN=2]="STAYED_IN",e[e.REPARENTED=3]="REPARENTED",e[e.REORDERED=4]="REORDERED",e[e.EXITED=5]="EXITED"}(Movement||(Movement={}));var NodeChange=function(){function e(e,t,i,r,o,a,n,s){"undefined"==typeof t&&(t=!1),"undefined"==typeof i&&(i=!1),"undefined"==typeof r&&(r=!1),"undefined"==typeof o&&(o=null),"undefined"==typeof a&&(a=!1),"undefined"==typeof n&&(n=null),"undefined"==typeof s&&(s=null),this.node=e,this.childList=t,this.attributes=i,this.characterData=r,this.oldParentNode=o,this.added=a,this.attributeOldValues=n,this.characterDataOldValue=s,this.isCaseInsensitive=this.node.nodeType===Node.ELEMENT_NODE&&this.node instanceof HTMLElement&&this.node.ownerDocument instanceof HTMLDocument}return e.prototype.getAttributeOldValue=function(e){if(this.attributeOldValues)return this.isCaseInsensitive&&(e=e.toLowerCase()),this.attributeOldValues[e]},e.prototype.getAttributeNamesMutated=function(){var e=[];if(!this.attributeOldValues)return e;for(var t in this.attributeOldValues)e.push(t);return e},e.prototype.attributeMutated=function(e,t){this.attributes=!0,this.attributeOldValues=this.attributeOldValues||{},e in this.attributeOldValues||(this.attributeOldValues[e]=t)},e.prototype.characterDataMutated=function(e){this.characterData||(this.characterData=!0,this.characterDataOldValue=e)},e.prototype.removedFromParent=function(e){this.childList=!0,this.added||this.oldParentNode?this.added=!1:this.oldParentNode=e},e.prototype.insertedIntoParent=function(){this.childList=!0,this.added=!0},e.prototype.getOldParent=function(){if(this.childList){if(this.oldParentNode)return this.oldParentNode;if(this.added)return null}return this.node.parentNode},e}(),ChildListChange=function(){function e(){this.added=new NodeMap,this.removed=new NodeMap,this.maybeMoved=new NodeMap,this.oldPrevious=new NodeMap,this.moved=void 0}return e}(),TreeChanges=function(e){function t(t,i){e.call(this),this.rootNode=t,this.reachableCache=void 0,this.wasReachableCache=void 0,this.anyParentsChanged=!1,this.anyAttributesChanged=!1,this.anyCharacterDataChanged=!1;for(var r=0;r<i.length;r++){var o=i[r];switch(o.type){case"childList":this.anyParentsChanged=!0;for(var a=0;a<o.removedNodes.length;a++){var n=o.removedNodes[a];this.getChange(n).removedFromParent(o.target)}for(var a=0;a<o.addedNodes.length;a++){var n=o.addedNodes[a];this.getChange(n).insertedIntoParent()}break;case"attributes":this.anyAttributesChanged=!0;var s=this.getChange(o.target);s.attributeMutated(o.attributeName,o.oldValue);break;case"characterData":this.anyCharacterDataChanged=!0;var s=this.getChange(o.target);s.characterDataMutated(o.oldValue)}}}return __extends(t,e),t.prototype.getChange=function(e){var t=this.get(e);return t||(t=new NodeChange(e),this.set(e,t)),t},t.prototype.getOldParent=function(e){var t=this.get(e);return t?t.getOldParent():e.parentNode},t.prototype.getIsReachable=function(e){if(e===this.rootNode)return!0;if(!e)return!1;this.reachableCache=this.reachableCache||new NodeMap;var t=this.reachableCache.get(e);return void 0===t&&(t=this.getIsReachable(e.parentNode),this.reachableCache.set(e,t)),t},t.prototype.getWasReachable=function(e){if(e===this.rootNode)return!0;if(!e)return!1;this.wasReachableCache=this.wasReachableCache||new NodeMap;var t=this.wasReachableCache.get(e);return void 0===t&&(t=this.getWasReachable(this.getOldParent(e)),this.wasReachableCache.set(e,t)),t},t.prototype.reachabilityChange=function(e){return this.getIsReachable(e)?this.getWasReachable(e)?2:1:this.getWasReachable(e)?5:0},t}(NodeMap),MutationProjection=function(){function e(e,t,i,r,o){this.rootNode=e,this.mutations=t,this.selectors=i,this.calcReordered=r,this.calcOldPreviousSibling=o,this.treeChanges=new TreeChanges(e,t),this.entered=[],this.exited=[],this.stayedIn=new NodeMap,this.visited=new NodeMap,this.childListChangeMap=void 0,this.characterDataOnly=void 0,this.matchCache=void 0,this.processMutations()}return e.prototype.processMutations=function(){if(this.treeChanges.anyParentsChanged||this.treeChanges.anyAttributesChanged)for(var e=this.treeChanges.keys(),t=0;t<e.length;t++)this.visitNode(e[t],void 0)},e.prototype.visitNode=function(e,t){if(!this.visited.has(e)){this.visited.set(e,!0);var i=this.treeChanges.get(e),r=t;if((i&&i.childList||void 0==r)&&(r=this.treeChanges.reachabilityChange(e)),0!==r){if(this.matchabilityChange(e),1===r)this.entered.push(e);else if(5===r)this.exited.push(e),this.ensureHasOldPreviousSiblingIfNeeded(e);else if(2===r){var o=2;i&&i.childList&&(i.oldParentNode!==e.parentNode?(o=3,this.ensureHasOldPreviousSiblingIfNeeded(e)):this.calcReordered&&this.wasReordered(e)&&(o=4)),this.stayedIn.set(e,o)}if(2!==r)for(var a=e.firstChild;a;a=a.nextSibling)this.visitNode(a,r)}}},e.prototype.ensureHasOldPreviousSiblingIfNeeded=function(e){if(this.calcOldPreviousSibling){this.processChildlistChanges();var t=e.parentNode,i=this.treeChanges.get(e);i&&i.oldParentNode&&(t=i.oldParentNode);var r=this.childListChangeMap.get(t);r||(r=new ChildListChange,this.childListChangeMap.set(t,r)),r.oldPrevious.has(e)||r.oldPrevious.set(e,e.previousSibling)}},e.prototype.getChanged=function(e,t,i){this.selectors=t,this.characterDataOnly=i;for(var r=0;r<this.entered.length;r++){var o=this.entered[r],a=this.matchabilityChange(o);1!==a&&2!==a||e.added.push(o)}for(var n=this.stayedIn.keys(),r=0;r<n.length;r++){var o=n[r],a=this.matchabilityChange(o);if(1===a)e.added.push(o);else if(5===a)e.removed.push(o);else if(2===a&&(e.reparented||e.reordered)){var s=this.stayedIn.get(o);e.reparented&&3===s?e.reparented.push(o):e.reordered&&4===s&&e.reordered.push(o)}}for(var r=0;r<this.exited.length;r++){var o=this.exited[r],a=this.matchabilityChange(o);5!==a&&2!==a||e.removed.push(o)}},e.prototype.getOldParentNode=function(e){var t=this.treeChanges.get(e);if(t&&t.childList)return t.oldParentNode?t.oldParentNode:null;var i=this.treeChanges.reachabilityChange(e);if(0===i||1===i)throw Error("getOldParentNode requested on invalid node.");return e.parentNode},e.prototype.getOldPreviousSibling=function(e){var t=e.parentNode,i=this.treeChanges.get(e);i&&i.oldParentNode&&(t=i.oldParentNode);var r=this.childListChangeMap.get(t);if(!r)throw Error("getOldPreviousSibling requested on invalid node.");return r.oldPrevious.get(e)},e.prototype.getOldAttribute=function(e,t){var i=this.treeChanges.get(e);if(!i||!i.attributes)throw Error("getOldAttribute requested on invalid node.");var r=i.getAttributeOldValue(t);if(void 0===r)throw Error("getOldAttribute requested for unchanged attribute name.");return r},e.prototype.attributeChangedNodes=function(e){if(!this.treeChanges.anyAttributesChanged)return{};var t,i;if(e){t={},i={};for(var r=0;r<e.length;r++){var o=e[r];t[o]=!0,i[o.toLowerCase()]=o}}for(var a={},n=this.treeChanges.keys(),r=0;r<n.length;r++){var s=n[r],h=this.treeChanges.get(s);if(h.attributes&&2===this.treeChanges.reachabilityChange(s)&&2===this.matchabilityChange(s))for(var c=s,l=h.getAttributeNamesMutated(),u=0;u<l.length;u++){var o=l[u];if(!t||t[o]||h.isCaseInsensitive&&i[o]){var d=h.getAttributeOldValue(o);d!==c.getAttribute(o)&&(i&&h.isCaseInsensitive&&(o=i[o]),a[o]=a[o]||[],a[o].push(c))}}}return a},e.prototype.getOldCharacterData=function(e){var t=this.treeChanges.get(e);if(!t||!t.characterData)throw Error("getOldCharacterData requested on invalid node.");return t.characterDataOldValue},e.prototype.getCharacterDataChanged=function(){if(!this.treeChanges.anyCharacterDataChanged)return[];for(var e=this.treeChanges.keys(),t=[],i=0;i<e.length;i++){var r=e[i];if(2===this.treeChanges.reachabilityChange(r)){var o=this.treeChanges.get(r);o.characterData&&r.textContent!=o.characterDataOldValue&&t.push(r)}}return t},e.prototype.computeMatchabilityChange=function(e,t){this.matchCache||(this.matchCache=[]),this.matchCache[e.uid]||(this.matchCache[e.uid]=new NodeMap);var i=this.matchCache[e.uid],r=i.get(t);return void 0===r&&(r=e.matchabilityChange(t,this.treeChanges.get(t)),i.set(t,r)),r},e.prototype.matchabilityChange=function(e){var t=this;if(this.characterDataOnly)switch(e.nodeType){case Node.COMMENT_NODE:case Node.TEXT_NODE:return 2;default:return 0}if(!this.selectors)return 2;if(e.nodeType!==Node.ELEMENT_NODE)return 0;for(var i=e,r=this.selectors.map(function(e){return t.computeMatchabilityChange(e,i)}),o=0,a=0;2!==o&&a<r.length;){switch(r[a]){case 2:o=2;break;case 1:o=5===o?2:1;break;case 5:o=1===o?2:5}a++}return o},e.prototype.getChildlistChange=function(e){var t=this.childListChangeMap.get(e);return t||(t=new ChildListChange,this.childListChangeMap.set(e,t)),t},e.prototype.processChildlistChanges=function(){function e(e,t){!e||r.oldPrevious.has(e)||r.added.has(e)||r.maybeMoved.has(e)||t&&(r.added.has(t)||r.maybeMoved.has(t))||r.oldPrevious.set(e,t)}if(!this.childListChangeMap){this.childListChangeMap=new NodeMap;for(var t=0;t<this.mutations.length;t++){var i=this.mutations[t];if("childList"==i.type&&(2===this.treeChanges.reachabilityChange(i.target)||this.calcOldPreviousSibling)){for(var r=this.getChildlistChange(i.target),o=i.previousSibling,a=0;a<i.removedNodes.length;a++){var n=i.removedNodes[a];e(n,o),r.added.has(n)?r.added["delete"](n):(r.removed.set(n,!0),r.maybeMoved["delete"](n)),o=n}e(i.nextSibling,o);for(var a=0;a<i.addedNodes.length;a++){var n=i.addedNodes[a];r.removed.has(n)?(r.removed["delete"](n),r.maybeMoved.set(n,!0)):r.added.set(n,!0)}}}}},e.prototype.wasReordered=function(e){function t(e){if(!e)return!1;if(!n.maybeMoved.has(e))return!1;var t=n.moved.get(e);return void 0!==t?t:(s.has(e)?t=!0:(s.set(e,!0),t=r(e)!==i(e)),s.has(e)?(s["delete"](e),n.moved.set(e,t)):t=n.moved.get(e),t)}function i(e){var r=h.get(e);if(void 0!==r)return r;for(r=n.oldPrevious.get(e);r&&(n.removed.has(r)||t(r));)r=i(r);return void 0===r&&(r=e.previousSibling),h.set(e,r),r}function r(e){if(c.has(e))return c.get(e);for(var i=e.previousSibling;i&&(n.added.has(i)||t(i));)i=i.previousSibling;return c.set(e,i),i}if(!this.treeChanges.anyParentsChanged)return!1;this.processChildlistChanges();var o=e.parentNode,a=this.treeChanges.get(e);a&&a.oldParentNode&&(o=a.oldParentNode);var n=this.childListChangeMap.get(o);if(!n)return!1;if(n.moved)return n.moved.get(e);n.moved=new NodeMap;var s=new NodeMap,h=new NodeMap,c=new NodeMap;return n.maybeMoved.keys().forEach(t),n.moved.get(e)},e}(),Summary=function(){function e(e,t){var i=this;if(this.projection=e,this.added=[],this.removed=[],this.reparented=t.all||t.element?[]:void 0,this.reordered=t.all?[]:void 0,e.getChanged(this,t.elementFilter,t.characterData),t.all||t.attribute||t.attributeList){var r=t.attribute?[t.attribute]:t.attributeList,o=e.attributeChangedNodes(r);t.attribute?this.valueChanged=o[t.attribute]||[]:(this.attributeChanged=o,t.attributeList&&t.attributeList.forEach(function(e){i.attributeChanged.hasOwnProperty(e)||(i.attributeChanged[e]=[])}))}if(t.all||t.characterData){var a=e.getCharacterDataChanged();t.characterData?this.valueChanged=a:this.characterDataChanged=a}this.reordered&&(this.getOldPreviousSibling=e.getOldPreviousSibling.bind(e))}return e.prototype.getOldParentNode=function(e){return this.projection.getOldParentNode(e)},e.prototype.getOldAttribute=function(e,t){return this.projection.getOldAttribute(e,t)},e.prototype.getOldCharacterData=function(e){return this.projection.getOldCharacterData(e)},e.prototype.getOldPreviousSibling=function(e){return this.projection.getOldPreviousSibling(e)},e}(),validNameInitialChar=/[a-zA-Z_]+/,validNameNonInitialChar=/[a-zA-Z0-9_\-]+/,Qualifier=function(){function e(){}return e.prototype.matches=function(e){if(null===e)return!1;if(void 0===this.attrValue)return!0;if(!this.contains)return this.attrValue==e;for(var t=e.split(" "),i=0;i<t.length;i++)if(this.attrValue===t[i])return!0;return!1},e.prototype.toString=function(){return"class"===this.attrName&&this.contains?"."+this.attrValue:"id"!==this.attrName||this.contains?this.contains?"["+this.attrName+"~="+escapeQuotes(this.attrValue)+"]":"attrValue"in this?"["+this.attrName+"="+escapeQuotes(this.attrValue)+"]":"["+this.attrName+"]":"#"+this.attrValue},e}(),Selector=function(){function e(){this.uid=e.nextUid++,this.qualifiers=[]}return Object.defineProperty(e.prototype,"caseInsensitiveTagName",{get:function(){return this.tagName.toUpperCase()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectorString",{get:function(){return this.tagName+this.qualifiers.join("")},enumerable:!0,configurable:!0}),e.prototype.isMatching=function(t){return t[e.matchesSelector](this.selectorString)},e.prototype.wasMatching=function(e,t,i){if(!t||!t.attributes)return i;var r=t.isCaseInsensitive?this.caseInsensitiveTagName:this.tagName;if("*"!==r&&r!==e.tagName)return!1;for(var o=[],a=!1,n=0;n<this.qualifiers.length;n++){var s=this.qualifiers[n],h=t.getAttributeOldValue(s.attrName);o.push(h),a=a||void 0!==h}if(!a)return i;for(var n=0;n<this.qualifiers.length;n++){var s=this.qualifiers[n],h=o[n];if(void 0===h&&(h=e.getAttribute(s.attrName)),!s.matches(h))return!1}return!0},e.prototype.matchabilityChange=function(e,t){var i=this.isMatching(e);return i?this.wasMatching(e,t,i)?2:1:this.wasMatching(e,t,i)?5:0},e.parseSelectors=function(t){function i(){o&&(a&&(o.qualifiers.push(a),a=void 0),s.push(o)),o=new e}function r(){a&&o.qualifiers.push(a),a=new Qualifier}for(var o,a,n,s=[],h=/\s/,c="Invalid or unsupported selector syntax.",l=1,u=2,d=3,f=4,p=5,m=6,g=7,b=8,v=9,y=10,N=11,C=12,E=13,w=14,S=l,_=0;_<t.length;){var D=t[_++];switch(S){case l:if(D.match(validNameInitialChar)){i(),o.tagName=D,S=u;break}if("*"==D){i(),o.tagName="*",S=d;break}if("."==D){i(),r(),o.tagName="*",a.attrName="class",a.contains=!0,S=f;break}if("#"==D){i(),r(),o.tagName="*",a.attrName="id",S=f;break}if("["==D){i(),r(),o.tagName="*",a.attrName="",S=m;break}if(D.match(h))break;throw Error(c);case u:if(D.match(validNameNonInitialChar)){o.tagName+=D;break}if("."==D){r(),a.attrName="class",a.contains=!0,S=f;break}if("#"==D){r(),a.attrName="id",S=f;break}if("["==D){r(),a.attrName="",S=m;break}if(D.match(h)){S=w;break}if(","==D){S=l;break}throw Error(c);case d:if("."==D){r(),a.attrName="class",a.contains=!0,S=f;break}if("#"==D){r(),a.attrName="id",S=f;break}if("["==D){r(),a.attrName="",S=m;break}if(D.match(h)){S=w;break}if(","==D){S=l;break}throw Error(c);case f:if(D.match(validNameInitialChar)){a.attrValue=D,S=p;break}throw Error(c);case p:if(D.match(validNameNonInitialChar)){a.attrValue+=D;break}if("."==D){r(),a.attrName="class",a.contains=!0,S=f;break}if("#"==D){r(),a.attrName="id",S=f;break}if("["==D){r(),S=m;break}if(D.match(h)){S=w;break}if(","==D){S=l;break}throw Error(c);case m:if(D.match(validNameInitialChar)){a.attrName=D,S=g;break}if(D.match(h))break;throw Error(c);case g:if(D.match(validNameNonInitialChar)){a.attrName+=D;break}if(D.match(h)){S=b;break}if("~"==D){a.contains=!0,S=v;break}if("="==D){a.attrValue="",S=N;break}if("]"==D){S=d;break}throw Error(c);case b:if("~"==D){a.contains=!0,S=v;break}if("="==D){a.attrValue="",S=N;break}if("]"==D){S=d;break}if(D.match(h))break;throw Error(c);case v:if("="==D){a.attrValue="",S=N;break}throw Error(c);case y:if("]"==D){S=d;break}if(D.match(h))break;throw Error(c);case N:if(D.match(h))break;if('"'==D||"'"==D){n=D,S=E;break}a.attrValue+=D,S=C;break;case C:if(D.match(h)){S=y;break}if("]"==D){S=d;break}if("'"==D||'"'==D)throw Error(c);a.attrValue+=D;break;case E:if(D==n){S=y;break}a.attrValue+=D;break;case w:if(D.match(h))break;if(","==D){S=l;break}throw Error(c)}}switch(S){case l:case u:case d:case p:case w:i();break;default:throw Error(c)}if(!s.length)throw Error(c);return s},e.nextUid=1,e.matchesSelector=function(){var e=document.createElement("div");return"function"==typeof e.webkitMatchesSelector?"webkitMatchesSelector":"function"==typeof e.mozMatchesSelector?"mozMatchesSelector":"function"==typeof e.msMatchesSelector?"msMatchesSelector":"matchesSelector"}(),e}(),attributeFilterPattern=/^([a-zA-Z:_]+[a-zA-Z0-9_\-:\.]*)$/,MutationSummary=function(){function e(t){var i=this;this.connected=!1,this.options=e.validateOptions(t),this.observerOptions=e.createObserverOptions(this.options.queries),this.root=this.options.rootNode,this.callback=this.options.callback,this.elementFilter=Array.prototype.concat.apply([],this.options.queries.map(function(e){return e.elementFilter?e.elementFilter:[]})),this.elementFilter.length||(this.elementFilter=void 0),this.calcReordered=this.options.queries.some(function(e){return e.all}),this.queryValidators=[],e.createQueryValidator&&(this.queryValidators=this.options.queries.map(function(t){return e.createQueryValidator(i.root,t)})),this.observer=new MutationObserverCtor(function(e){i.observerCallback(e)}),this.reconnect()}return e.createObserverOptions=function(e){function t(e){if(!r.attributes||i){if(r.attributes=!0,r.attributeOldValue=!0,!e)return void(i=void 0);i=i||{},e.forEach(function(e){i[e]=!0,i[e.toLowerCase()]=!0})}}var i,r={childList:!0,subtree:!0};return e.forEach(function(e){if(e.characterData)return r.characterData=!0,void(r.characterDataOldValue=!0);if(e.all)return t(),r.characterData=!0,void(r.characterDataOldValue=!0);if(e.attribute)return void t([e.attribute.trim()]);var i=elementFilterAttributes(e.elementFilter).concat(e.attributeList||[]);i.length&&t(i)}),i&&(r.attributeFilter=Object.keys(i)),r},e.validateOptions=function(t){for(var i in t)if(!(i in e.optionKeys))throw Error("Invalid option: "+i);if("function"!=typeof t.callback)throw Error("Invalid options: callback is required and must be a function");if(!t.queries||!t.queries.length)throw Error("Invalid options: queries must contain at least one query request object.");for(var r={callback:t.callback,rootNode:t.rootNode||document,observeOwnChanges:!!t.observeOwnChanges,oldPreviousSibling:!!t.oldPreviousSibling,queries:[]},o=0;o<t.queries.length;o++){var a=t.queries[o];if(a.all){if(Object.keys(a).length>1)throw Error("Invalid request option. all has no options.");r.queries.push({all:!0})}else if("attribute"in a){var n={attribute:validateAttribute(a.attribute)};if(n.elementFilter=Selector.parseSelectors("*["+n.attribute+"]"),Object.keys(a).length>1)throw Error("Invalid request option. attribute has no options.");r.queries.push(n)}else if("element"in a){var s=Object.keys(a).length,n={element:a.element,elementFilter:Selector.parseSelectors(a.element)};if(a.hasOwnProperty("elementAttributes")&&(n.attributeList=validateElementAttributes(a.elementAttributes),s--),s>1)throw Error("Invalid request option. element only allows elementAttributes option.");r.queries.push(n)}else{if(!a.characterData)throw Error("Invalid request option. Unknown query request.");if(Object.keys(a).length>1)throw Error("Invalid request option. characterData has no options.");r.queries.push({characterData:!0})}}return r},e.prototype.createSummaries=function(e){if(!e||!e.length)return[];for(var t=new MutationProjection(this.root,e,this.elementFilter,this.calcReordered,this.options.oldPreviousSibling),i=[],r=0;r<this.options.queries.length;r++)i.push(new Summary(t,this.options.queries[r]));return i},e.prototype.checkpointQueryValidators=function(){this.queryValidators.forEach(function(e){e&&e.recordPreviousState()})},e.prototype.runQueryValidators=function(e){this.queryValidators.forEach(function(t,i){t&&t.validate(e[i])})},e.prototype.changesToReport=function(e){return e.some(function(e){var t=["added","removed","reordered","reparented","valueChanged","characterDataChanged"];if(t.some(function(t){return e[t]&&e[t].length}))return!0;if(e.attributeChanged){var i=Object.keys(e.attributeChanged),r=i.some(function(t){return!!e.attributeChanged[t].length});if(r)return!0}return!1})},e.prototype.observerCallback=function(e){this.options.observeOwnChanges||this.observer.disconnect();var t=this.createSummaries(e);this.runQueryValidators(t),this.options.observeOwnChanges&&this.checkpointQueryValidators(),this.changesToReport(t)&&this.callback(t),!this.options.observeOwnChanges&&this.connected&&(this.checkpointQueryValidators(),this.observer.observe(this.root,this.observerOptions))},e.prototype.reconnect=function(){if(this.connected)throw Error("Already connected");this.observer.observe(this.root,this.observerOptions),this.connected=!0,this.checkpointQueryValidators()},e.prototype.takeSummaries=function(){if(!this.connected)throw Error("Not connected");var e=this.createSummaries(this.observer.takeRecords());return this.changesToReport(e)?e:void 0},e.prototype.disconnect=function(){var e=this.takeSummaries();return this.observer.disconnect(),this.connected=!1,e},e.NodeMap=NodeMap,e.parseElementFilter=Selector.parseSelectors,e.optionKeys={callback:!0,queries:!0,rootNode:!0,oldPreviousSibling:!0,observeOwnChanges:!0},e}(),TreeMirror=function(){function e(e,t){this.root=e,this.delegate=t,this.idMap={}}return e.prototype.initialize=function(e,t){this.idMap[e]=this.root;for(var i=0;i<t.length;i++)this.deserializeNode(t[i],this.root)},e.prototype.applyChanged=function(e,t,i,r){var o=this;t.forEach(function(e){var t=o.deserializeNode(e);o.deserializeNode(e.parentNode),o.deserializeNode(e.previousSibling);t.parentNode&&t.parentNode.removeChild(t)}),e.forEach(function(e){var t=o.deserializeNode(e);t.parentNode&&t.parentNode.removeChild(t)}),t.forEach(function(e){var t=o.deserializeNode(e),i=o.deserializeNode(e.parentNode),r=o.deserializeNode(e.previousSibling);i.insertBefore(t,r?r.nextSibling:i.firstChild)}),i.forEach(function(e){var t=o.deserializeNode(e);Object.keys(e.attributes).forEach(function(i){var r=e.attributes[i];null===r?t.removeAttribute(i):o.delegate&&o.delegate.setAttribute&&o.delegate.setAttribute(t,i,r)||t.setAttribute(i,r)})}),r.forEach(function(e){var t=o.deserializeNode(e);t.textContent=e.textContent}),e.forEach(function(e){delete o.idMap[e.id]})},e.prototype.deserializeNode=function(e,t){var i=this;if(null===e)return null;var r=this.idMap[e.id];if(r)return r;var o=this.root.ownerDocument;switch(null===o&&(o=this.root),e.nodeType){case Node.COMMENT_NODE:r=o.createComment(e.textContent);break;case Node.TEXT_NODE:r=o.createTextNode(e.textContent);break;case Node.DOCUMENT_TYPE_NODE:r=o.implementation.createDocumentType(e.name,e.publicId,e.systemId);break;case Node.ELEMENT_NODE:this.delegate&&this.delegate.createElement&&(r=this.delegate.createElement(e.tagName)),r||(r=o.createElement(e.tagName)),Object.keys(e.attributes).forEach(function(t){try{i.delegate&&i.delegate.setAttribute&&i.delegate.setAttribute(r,t,e.attributes[t])||r.setAttribute(t,e.attributes[t])}catch(o){}})}if(!r)throw"ouch";if(this.idMap[e.id]=r,t&&t.appendChild(r),e.childNodes)for(var a=0;a<e.childNodes.length;a++)this.deserializeNode(e.childNodes[a],r);return r},e}(),TreeMirrorClient=function(){function e(e,t,i){var r=this;this.target=e,this.mirror=t,this.nextId=1,this.knownNodes=new MutationSummary.NodeMap;for(var o=this.serializeNode(e).id,a=[],n=e.firstChild;n;n=n.nextSibling)a.push(this.serializeNode(n,!0));this.mirror.initialize(o,a);var s=[{all:!0}];i&&(s=s.concat(i));var h;try{h="undefined"!=typeof WebKitMutationObserver?WebKitMutationObserver:MutationObserver}catch(c){h=void 0}void 0!==h&&(this.mutationSummary=new MutationSummary({rootNode:e,callback:function(e){r.applyChanged(e)},queries:s}))}return e.prototype.disconnect=function(){this.mutationSummary&&(this.mutationSummary.disconnect(),this.mutationSummary=void 0)},e.prototype.rememberNode=function(e){var t=this.nextId++;return this.knownNodes.set(e,t),t},e.prototype.forgetNode=function(e){this.knownNodes["delete"](e)},e.prototype.serializeNode=function(e,t){if(null===e)return null;var i=this.knownNodes.get(e);if(void 0!==i)return{id:i};var r={nodeType:e.nodeType,id:this.rememberNode(e)};switch(r.nodeType){case Node.DOCUMENT_TYPE_NODE:var o=e;r.name=o.name,r.publicId=o.publicId,r.systemId=o.systemId;break;case Node.COMMENT_NODE:case Node.TEXT_NODE:r.textContent=e.textContent;break;case Node.ELEMENT_NODE:var a=e;r.tagName=a.tagName,r.attributes={};for(var n=0;n<a.attributes.length;n++){var s=a.attributes[n];r.attributes[s.name]=s.value}if(t&&a.childNodes.length){r.childNodes=[];for(var h=a.firstChild;h;h=h.nextSibling)r.childNodes.push(this.serializeNode(h,!0))}}return r},e.prototype.serializeAddedAndMoved=function(e,t,i){var r=this,o=e.concat(t).concat(i),a=new MutationSummary.NodeMap;o.forEach(function(e){var t=e.parentNode,i=a.get(t);i||(i=new MutationSummary.NodeMap,a.set(t,i)),i.set(e,!0)});var n=[];return a.keys().forEach(function(e){for(var t=a.get(e),i=t.keys();i.length;){for(var o=i[0];o.previousSibling&&t.has(o.previousSibling);)o=o.previousSibling;for(;o&&t.has(o);){var s=r.serializeNode(o);s.previousSibling=r.serializeNode(o.previousSibling),s.parentNode=r.serializeNode(o.parentNode),n.push(s),t["delete"](o),o=o.nextSibling}var i=t.keys()}}),n},e.prototype.serializeAttributeChanges=function(e){var t=this,i=new MutationSummary.NodeMap;return Object.keys(e).forEach(function(r){e[r].forEach(function(e){var o=i.get(e);o||(o=t.serializeNode(e),o.attributes={},i.set(e,o)),o.attributes[r]=e.getAttribute(r)})}),i.keys().map(function(e){return i.get(e)})},e.prototype.applyChanged=function(e){var t=this,i=e[0],r=i.removed.map(function(e){return t.serializeNode(e)}),o=this.serializeAddedAndMoved(i.added,i.reparented,i.reordered),a=this.serializeAttributeChanges(i.attributeChanged),n=i.characterDataChanged.map(function(e){var i=t.serializeNode(e);return i.textContent=e.textContent,i});this.mirror.applyChanged(r,o,a,n),i.removed.forEach(function(e){t.forgetNode(e)})},e}();"undefined"!=typeof jQuery&&function(){!function(e){var t,i,r,o,a,n,s,h;return s=e.map,a=e.extend,n=e.inArray,r=function(e,t){return n(e,t)!==-1},o=function(e){return e.replace(/([\!\"\#\$\%\&'\(\)\*\+\,\.\/\:\;<\=>\?\@\[\\\]\^\`\{\|\}\~])/g,"\\$1")},i=function(e,t){return s(e,function(e){return e===t?null:e})},h=function(e){return s(e,function(t,i){return parseInt(i,10)===parseInt(e.indexOf(t),10)?t:null})},t=function(){function t(t,i){this.element=t,this.options=a(a({},e.selectorator.options),i),this.cachedResults={}}return t.prototype.query=function(t){var i;return(i=this.cachedResults)[t]||(i[t]=e(t.replace(/#([^\s]+)/g,"[id='$1']")))},t.prototype.getProperTagName=function(){return this.element[0]?this.element[0].tagName.toLowerCase():null},t.prototype.hasParent=function(){return this.element&&0<this.element.parent().length},t.prototype.isElement=function(){var e;return e=this.element[0],e&&e.nodeType===e.ELEMENT_NODE},t.prototype.validate=function(e,t,i,o){var a,n;if(null==i&&(i=!0),null==o&&(o=!1),n=this.query(e),i&&1<n.length||!i&&0===n.length){if(!t||e.indexOf(":")!==-1)return null;if(a=o?" > ":" ",e=t+a+e,n=this.query(e),i&&1<n.length||!i&&0===n.length)return null}return r(this.element[0],n.get())?e:null},t.prototype.generate=function(){var e,t,r,o,a;if(!(this.element&&this.hasParent()&&this.isElement()))return[""];for(t=[],a=[this.generateSimple,this.generateAncestor,this.generateRecursive],r=0,o=a.length;r<o;r++)if(e=a[r],t=h(i(e.call(this))),t&&t.length>0)return t;return h(t)},t.prototype.generateAncestor=function(){var i,r,o,a,n,s,h,c,l,u,d,f,p,m;for(n=[],m=this.element.parents(),c=0,d=m.length;c<d;c++){for(r=m[c],i=!0,h=this.generateSimple(null,!1),l=0,f=h.length;l<f;l++)for(s=h[l],a=new t(e(r),this.options).generateSimple(null,!1),u=0,p=a.length;u<p;u++)o=a[u],e.merge(n,this.generateSimple(o,!0,i));i=!1}return n},t.prototype.generateSimple=function(e,t,r){var o,a,n,h,c,l,u,d;for(n=this,h=n.getProperTagName(),c=function(i){return n.validate(i,e,t,r)},d=[[n.getIdSelector],[n.getClassSelector],[n.getIdSelector,!0],[n.getClassSelector,!0],[n.getNameSelector],[function(){return[n.getProperTagName()]}]],l=0,u=d.length;l<u;l++)if(o=d[l],a=o[0].call(n,o[1])||[],a=i(s(a,c)),a.length>0)return a;return[]},t.prototype.generateRecursive=function(){var e,i,r,o;return o=this.getProperTagName(),o.indexOf(":")!==-1&&(o="*"),i=this.element.parent(),r=new t(i).generate()[0],e=i.children(o).index(this.element),o=""+o+":eq("+e+")",""!==r&&(o=r+" > "+o),[o]},t.prototype.getIdSelector=function(e){var t;return null==e&&(e=!1),e=e?this.getProperTagName():"",t=this.element.attr("id"),"string"!=typeof t||r(t,this.getIgnore("id"))?null:[""+e+"#"+o(t)]},t.prototype.getClassSelector=function(e){var t,i,a;return null==e&&(e=!1),a=this.getProperTagName(),/^(body|html)$/.test(a)?null:(e=e?a:"",i=this.getIgnore("class"),t=(this.element.attr("class")||"").replace(/\{.*\}/,"").split(/\s/),s(t,function(t){return t&&!r(t,i)?""+e+"."+o(t):null}))},t.prototype.getNameSelector=function(){var e,t;return t=this.getProperTagName(),e=this.element.attr("name"),e&&!r(e,this.getIgnore("name"))?[""+t+"[name='"+e+"']"]:null},t.prototype.getIgnore=function(e){var t,i,r;return i=this.options.ignore||{},t="class"===e?"classes":""+e+"s",r=i[e]||i[t],"string"==typeof r?[r]:r},t}(),e.selectorator={options:{},unique:h,clean:i,escapeSelector:o},e.fn.selectorator=function(i){return new t(e(this),i)},e.fn.getSelector=function(e){return this.selectorator(e).generate()},this}(jQuery)}.call(this);var LHCCoBrowserOperator=function(){function e(e,t,i){this.$awesomebar=t.getElementById("awesomebar"),this.$lastmessage=t.getElementById("last-message"),this.$finishedmessage=t.getElementById("finished-message"),this.iFrameDocument,this.mirror;var r=this;this.initialize=i.initialize,this.base=i.base,this.chat_id=i.chat_id?i.chat_id:i.online_user_id,this.chat_hash=i.chat_hash?i.chat_hash:i.online_user_hash,this.mode_co_browse=i.mode?"/(cobrowsemode)/"+i.mode:"/(cobrowsemode)/chat",this.mode_co_browse_internal=i.mode?i.mode:"chat",this.node_js_settings=i.nodejssettings,this.disablejs=i.disablejs,this.disableiframe="undefined"==typeof i.disableiframe||i.disableiframe,this.formsenabled="undefined"==typeof i.formsenabled||i.formsenabled,this.refreshTimeout=null,this.isNodeConnected=!1,this.isInitialized=!1,this.cursor=i.cursor,this.mouseShow=!1,this.windowScroll=!1,this.fillTimeout=null,this.textSend=null,this.highlightedCSS=!1,this.httpsmode=i.httpsmode,
this.lhcbase=i.lhcbase,this.sitehttps=!1,""!=this.base&&this.base.indexOf("https")>-1&&(this.sitehttps=!0),i.nodejsenabled&&this.setupNodeJs(),parseInt(i.cpos.w)>0&&parseInt(i.cpos.wh)>0&&(document.getElementById("center-layout").style.width=i.cpos.w+"px",document.getElementById("center-layout").style.height=i.cpos.wh+"px"),i.options.opmouse&&(i.options.opmouse.click(function(){$(this).is(":checked")?(r.sendData("lhc_cobrowse_cmd:mouse:show"),r.mouseShow=!0):(r.sendData("lhc_cobrowse_cmd:mouse:hide"),r.mouseShow=!1)}),i.options.opmouse.is(":checked")&&(this.mouseShow=!0)),this.opcontrol=!1,i.options.opcontrol&&(i.options.opcontrol.click(function(){$(this).is(":checked")?r.opcontrol=!0:r.opcontrol=!1}),i.options.opcontrol.is(":checked")&&(this.opcontrol=!0)),this.userScrollSync=!1,this.userScrollData={t:0,l:0},i.options.opscroll&&(i.options.opscroll.click(function(){$(this).is(":checked")?(r.userScrollSync=!0,r.visitorScroll(r.userScrollData)):r.userScrollSync=!1}),i.options.opscroll.is(":checked")&&(this.userScrollSync=!0,this.visitorScroll(this.userScrollData))),i.options.scroll&&(i.options.scroll.click(function(){$(this).is(":checked")?(r.sendData("lhc_cobrowse_cmd:scroll:true"),r.windowScroll=!0):(r.sendData("lhc_cobrowse_cmd:scroll:false"),r.windowScroll=!1)}),i.options.scroll.is(":checked")&&(this.windowScroll=!0)),this.mouse={x:0,y:0},this.mouseTimeout=null,this.mouseEventListenerCallback=function(e){r.mouseEventListener(e)},this.treeMirrorParams={createElement:function(e){if(1==r.disablejs&&"SCRIPT"==e){var t=document.createElement("NO-SCRIPT");return t.style.display="none",t}if("SELECT"==e){var t=document.createElement("SELECT");return 0==r.formsenabled&&t.setAttribute("disabled","disabled"),t.addEventListener("change",function(){r.changeSelectValue($(t)[0].selectedIndex,r.getSelectorQuery(t))},!1),t}if("INPUT"==e||"TEXTAREA"==e){var t=document.createElement(e);return 0==r.formsenabled&&t.setAttribute("readonly","readonly"),t.addEventListener("focus",function(){r.highlightElement(-1,-1,r.scrollLeftGS(),r.scrollTopGS(),r.getSelectorQuery(t),t)},!1),t}if("HEAD"==e){var t=document.createElement("HEAD");return t.appendChild(document.createElement("BASE")),t.firstChild.href=r.base,t.firstChild.id="lhc-co-browse-base-id",t}},setAttribute:function(e,t,i){return 1==r.disableiframe&&"IFRAME"==e.nodeName&&"src"==t?(e.setAttribute(t,"javascript:void(0)"),!0):"IFRAME"==e.nodeName&&"id"==t&&"lhc_iframe"==i?(setTimeout(function(){$(r.iFrameDocument).find("#lhc_container").hide().attr("id","lhc_container_dummy").find("#lhc_iframe_container").remove()},2e3),!0):("BASE"==e.nodeName&&($(r.iFrameDocument).find("#lhc-co-browse-base-id").remove(),"href"==e.attr&&(r.base=i)),"SCRIPT"==e.nodeName&&"src"==t&&i.indexOf("google")>-1?(e.setAttribute("src",""),!0):("LINK"==e.nodeName&&("type"==t&&"text/css"==i||"rel"==t&&"stylesheet"==i)&&null===e.getAttribute("lhc-css")&&(e.setAttribute("lhc-css","true"),1==r.httpsmode&&0==r.sitehttps&&""!=e.getAttribute("href")&&e.setAttribute("href",r.lhcbase+"/"+r.chat_id+r.mode_co_browse+"/?base="+encodeURIComponent(r.base)+"&css="+encodeURIComponent(e.getAttribute("href")))),"LINK"==e.nodeName&&"href"==t&&1==r.httpsmode&&0==r.sitehttps&&null!==e.getAttribute("lhc-css")?(e.setAttribute("href",r.lhcbase+"/"+r.chat_id+r.mode_co_browse+"/?base="+encodeURIComponent(r.base)+"&css="+encodeURIComponent(i)),!0):"A"==e.nodeName&&"href"==t?(e.setAttribute(t,"javascript:void(0)"),e.setAttribute("title",i),!0):"A"==e.nodeName&&"onclick"==t?""==i||(e.setAttribute(t,"javascript:void(0)"),!0):void 0))}},e.onIframeLoaded=function(){r.iFrameDocument=e.frames.content.document,r.iFrameDocument.addEventListener("mousemove",r.mouseEventListenerCallback,!1),r.iFrameDocument.onclick=function(e){e.ctrlKey||1==r.opcontrol?((!e.target||"INPUT"!=e.target.tagName||"radio"!=e.target.type&&"checkbox"!=e.target.type)&&e.preventDefault(),r.sendClickCommand(e.x,e.y,r.scrollLeftGS(),r.scrollTopGS(),r.getSelectorQuery(e.target))):(e.preventDefault(),r.highlightElement(e.x,e.y,r.scrollLeftGS(),r.scrollTopGS(),r.getSelectorQuery(e.target),e.target))},r.iFrameDocument.onkeyup=function(e){e=e||window.event,r.fillForm(e.target,r.getSelectorQuery(e.target))},null!==r.initialize&&""!=r.initialize&&r.handleMessage(r.initialize),r.startChangesMonitoring()}}return e.prototype.scrollTopGS=function(e){if("undefined"==typeof e)return this.iFrameDocument.documentElement.scrollTop||this.iFrameDocument.body.scrollTop;if(this.iFrameDocument.documentElement)try{this.iFrameDocument.documentElement.scrollTop=e}catch(t){}if(this.iFrameDocument.body)try{this.iFrameDocument.body.scrollTop=e}catch(t){}},e.prototype.scrollLeftGS=function(e){if("undefined"==typeof e)return this.iFrameDocument.documentElement.scrollLeft||this.iFrameDocument.body.scrollLeft;if(this.iFrameDocument.documentElement)try{this.iFrameDocument.documentElement.scrollLeft=e}catch(t){}if(this.iFrameDocument.body)try{this.iFrameDocument.body.scrollLeft=e}catch(t){}},e.prototype.getSelectorQuery=function(e){var t=$(e).getSelector();return t.length>=1?t[0]:""},e.prototype.fillForm=function(e,t){if(1==this.formsenabled)for(var i=[e],r=0;r<i.length;r++)if("INPUT"==i[r].tagName||"TEXTAREA"==i[r].tagName)if(this.textSend=i[r].value.replace(new RegExp(":","g"),"_SEL_"),this.isNodeConnected===!0)this.sendData("lhc_cobrowse_cmd:fillform:"+this.textSend+"__SPLIT__"+t.replace(new RegExp(":","g"),"_SEL_"));else if(null===this.fillTimeout){var o=this;this.fillTimeout=setTimeout(function(){o.sendData("lhc_cobrowse_cmd:fillform:"+o.textSend+"__SPLIT__"+t.replace(new RegExp(":","g"),"_SEL_")),o.fillTimeout=null},300)}},e.prototype.changeSelectValue=function(e,t){1==this.formsenabled&&this.sendData("lhc_cobrowse_cmd:changeselect:"+e+"__SPLIT__"+t.replace(new RegExp(":","g"),"_SEL_"))},e.prototype.highlightElement=function(e,t,i,r,o,a){this.sendData("lhc_cobrowse_cmd:hightlight:"+e+","+t+","+i+","+r+"__SPLIT__"+o.replace(new RegExp(":","g"),"_SEL_"));var n=!0;if(1==jQuery(a).hasClass("lhc-higlighted")&&"INPUT"!=a.tagName&&"TEXTAREA"!=a.tagName&&"SELECT"!=a.tagName&&(n=!1),jQuery(this.iFrameDocument).find(".lhc-higlighted").removeClass("lhc-higlighted"),1==n&&jQuery(a).addClass("lhc-higlighted"),0==this.highlightedCSS){this.highlightedCSS=!0;var s=this.appendHTML("<style>.lhc-higlighted{-webkit-box-shadow: 0px 0px 20px 5px rgba(88,140,204,1)!important;-moz-box-shadow: 0px 0px 20px 5px rgba(88,140,204,1)!important;box-shadow: 0px 0px 20px 5px rgba(88,140,204,1)!important;}</style>");null!==this.iFrameDocument.body&&this.iFrameDocument.body.insertBefore(s,this.iFrameDocument.body.childNodes[0])}},e.prototype.sendClickCommand=function(e,t,i,r,o){this.sendData("lhc_cobrowse_cmd:click:"+e+","+t+","+i+","+r+"__SPLIT__"+o.replace(new RegExp(":","g"),"_SEL_"))},e.prototype.sendData=function(e){if(this.isNodeConnected===!1){if("onlineuser"==this.mode_co_browse_internal)return lhinst.addExecutionCommand(this.chat_id,"lhc_cobrowse_multi_command__"+e);lhinst.addRemoteCommand(this.chat_id,e)}else this.socket.emit("remotecommand",{chat_id:this.chat_id+"_"+this.chat_hash,cmd:e})},e.prototype.mouseEventListener=function(e){var t=this;if(null!=this.iFrameDocument.body){var i=(e.clientX||e.pageX)+this.scrollLeftGS(),r=(e.clientY||e.pageY)+this.scrollTopGS();t.mouse.x==i&&t.mouse.y==r||(t.mouse.x=i,t.mouse.y=r,1==this.mouseShow&&null===t.mouseTimeout&&(t.mouseTimeout=setTimeout(function(){t.sendData("lhc_cobrowse_cmd:operatorcursor:"+t.mouse.x+","+t.mouse.y),t.mouseTimeout=null},t.isNodeConnected===!0?20:1e3)))}},e.prototype.setupNodeJs=function(){var e=this;if("undefined"==typeof io){var t=document.getElementsByTagName("head")[0],i=document.createElement("script");i.setAttribute("type","text/javascript"),i.setAttribute("src",this.node_js_settings.nodejssocket),t.appendChild(i),i.onreadystatechange=i.onload=function(){e.setupNodeJs()}}else try{this.socket=io.connect(this.node_js_settings.nodejshost,{secure:this.node_js_settings.secure,path:this.node_js_settings.path}),this.socket.on("connect",function(){e.onConnected()}),this.socket.on("reconnect_error",function(){e.isNodeConnected=!1}),this.socket.on("connect_timeout",function(){e.isNodeConnected=!1}),this.socket.on("usermessage",function(t){e.handleMessage(t)}),this.socket.on("userleft",function(t){e.userLeft(t)}),this.socket.on("userjoined",function(t){e.userJoined(t)})}catch(r){console.log(r)}},e.prototype.userLeft=function(e){$("#status-icon-sharing").text("visibility_off"),this.clearPage()},e.prototype.userJoined=function(e){$("#status-icon-sharing").text("visibility")},e.prototype.onConnected=function(){this.isNodeConnected=!0,this.socket.emit("joinadmin",{chat_id:this.chat_id+"_"+this.chat_hash})},e.prototype.startChangesMonitoring=function(){if(this.isNodeConnected===!1){var e=this;this.isInitialized=!0,$.getJSON(WWW_DIR_JAVASCRIPT+"cobrowse/checkmirrorchanges/"+e.chat_id+e.mode_co_browse,function(t){"undefined"==typeof t.empty&&e.handleMessage(t),e.refreshTimeout=setTimeout(function(){e.startChangesMonitoring()},1400)}).fail(function(){e.refreshTimeout=setTimeout(function(){e.startChangesMonitoring()},1400)})}},e.prototype.clearPage=function(){if(this.highlightedCSS=!1,this.iFrameDocument)for(;this.iFrameDocument.firstChild;)this.iFrameDocument.removeChild(this.iFrameDocument.firstChild)},e.prototype.visitorCursor=function(e){if(document.getElementById("center-layout").style.width=e.w+"px",document.getElementById("center-layout").style.height=e.wh+"px","undefined"!=typeof this.iFrameDocument){var t=this.iFrameDocument.getElementById("user-cursor");if(null===t){var i=this.appendHTML('<div id="user-cursor" style="z-index:99999;top:'+e.y+"px;left:"+parseInt(e.x-12)+'px;position:absolute;"><img src="'+this.cursor+'" /></div>');null!==this.iFrameDocument.body&&this.iFrameDocument.body.appendChild(i)}else t.style.top=e.y+"px",t.style.left=parseInt(e.x-12)+"px"}},e.prototype.visitorScroll=function(e){this.userScrollData=e,"undefined"!=typeof this.iFrameDocument&&1==this.userScrollSync&&(this.scrollTopGS(e.t),this.scrollLeftGS(e.l))},e.prototype.visitorHash=function(e){"undefined"!=typeof this.iFrameDocument&&(jQuery(this.iFrameDocument).find(e.hsh).length>0?this.scrollTopGS(jQuery(this.iFrameDocument).find(e.hsh).offset().top):(this.scrollTopGS(e.t),this.scrollLeftGS(e.l)))},e.prototype.appendHTML=function(e){var t=this.iFrameDocument.createDocumentFragment(),i=this.iFrameDocument.createElement("div");for(i.innerHTML=e;i.firstChild;)t.appendChild(i.firstChild);return t},e.prototype.changeTextValue=function(e){""!=e.selector&&$(this.iFrameDocument).find(e.selector).val(e.value)},e.prototype.changeSelectValueFromUser=function(e){""!=e.selector&&$(this.iFrameDocument).find(e.selector).length>0&&($(this.iFrameDocument).find(e.selector)[0].selectedIndex=e.value)},e.prototype.changeCheckboxValueFromUser=function(e){""!=e.selector&&$(this.iFrameDocument).find(e.selector).length>0&&($(this.iFrameDocument).find(e.selector)[0].checked=e.value)},e.prototype.handleMessage=function(e){if(e.base)this.base=e.base,this.base.indexOf("https")>-1&&(this.sitehttps=!0);else if(e.err)this.iFrameDocument.getElementById("loading").style.display="none",this.iFrameDocument.getElementById("error").innerHTML=e.err,this.iFrameDocument.getElementById("error").style.display="block";else if(e.lmsg)this.$lastmessage.innerHTML=e.lmsg;else if(e.finished)$("#status-icon-sharing").attr("title",e.finished.text),0==e.finished.status?$("#status-icon-sharing").text("visibility"):$("#status-icon-sharing").text("visibility_off");else if(e.url)this.$awesomebar.value=e.url;else if(e.f&&"initialize"==e.f){this.clearPage(),"undefined"!=typeof e.formsEnabled&&(this.formsenabled=e.formsEnabled),this.mirror=new TreeMirror(this.iFrameDocument,this.treeMirrorParams),this.mirror.initialize.apply(this.mirror,e.args);var t=this;setTimeout(function(){var e=t.appendHTML("<style>body{visibility:visible!important;}#lhc_status_container{display:none!important;}#lhc-user-cursor{display:none!important;}.lhc-higlighted{-webkit-box-shadow: 0px 0px 20px 5px rgba(88,140,204,1);-moz-box-shadow: 0px 0px 20px 5px rgba(88,140,204,1);box-shadow: 0px 0px 20px 5px rgba(88,140,204,1);}</style>");null!==t.iFrameDocument.body&&t.iFrameDocument.body.insertBefore(e,t.iFrameDocument.body.childNodes[0])},2e3),1==this.mouseShow&&this.sendData("lhc_cobrowse_cmd:mouse:show"),1==this.windowScroll&&this.sendData("lhc_cobrowse_cmd:scroll:true")}else if(e.f&&"cursor"==e.f)this.visitorCursor(e.pos);else if(e.f&&"uscroll"==e.f)this.visitorScroll(e.pos);else if(e.f&&"uchash"==e.f)this.visitorHash(e.pos);else if(e.f&&"textdata"==e.f)this.changeTextValue(e);else if(e.f&&"selectval"==e.f)this.changeSelectValueFromUser(e);else if(e.f&&"chkval"==e.f)this.changeCheckboxValueFromUser(e);else if(e.f)"undefined"!=typeof this.mirror&&this.mirror[e.f].apply(this.mirror,e.args);else if(e instanceof Array){var t=this;e.forEach(function(e){try{t.handleMessage(e)}catch(i){console.log(i)}})}else e.clear?this.clearPage():e.error_msg&&alert(e.error_msg)},e}();