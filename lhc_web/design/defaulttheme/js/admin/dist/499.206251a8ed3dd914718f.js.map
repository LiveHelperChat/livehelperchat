{"version":3,"file":"499.206251a8ed3dd914718f.js","mappings":"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","sources":["webpack://LHCReactAPPAdmin/./src/components/parts_mail/MailChatQuote.js","webpack://LHCReactAPPAdmin/./src/components/parts_mail/MailChatAttachement.js","webpack://LHCReactAPPAdmin/./src/components/parts_mail/MailReplyRecipient.js","webpack://LHCReactAPPAdmin/./src/components/parts_mail/MailSendStatus.js","webpack://LHCReactAPPAdmin/./src/components/parts_mail/MailChatReply.js","webpack://LHCReactAPPAdmin/./src/components/parts_mail/MailChatImage.js","webpack://LHCReactAPPAdmin/./src/components/parts_mail/MailChatAttachment.js","webpack://LHCReactAPPAdmin/./src/components/parts_mail/MailChatMessage.js","webpack://LHCReactAPPAdmin/./src/components/MailChat.js"],"sourcesContent":["import React, { useState} from \"react\";\n\nconst MailChatQuote = ({children}) => {\n\n    const [expandBody, setExpandBody] = useState(false);\n\n    return <React.Fragment>\n        <div className=\"pb-2\"><button onClick={() => setExpandBody(!expandBody)} className=\"btn btn-sm btn-outline-secondary\">...</button></div>\n        {expandBody && children}\n    </React.Fragment>\n\n}\n\nexport default React.memo(MailChatQuote);","import React, { PureComponent } from 'react';\nimport { withTranslation } from 'react-i18next';\n\n/**\n * https://github.com/LukasMarx/react-file-upload\n * */\nclass MailChatAttatchement extends PureComponent {\n\n    state = {\n        hightlight: false,\n        files: [],\n        uploading: false,\n        uploadProgress: {},\n        successfullUploaded: false,\n        progress: ''\n    };\n\n    constructor(props) {\n        super(props);\n\n        this.fileInputRef = React.createRef();\n        this.dropAreaRef = React.createRef();\n\n        // UI Actions\n        this.openFileDialog = this.openFileDialog.bind(this);\n        this.onFilesAddedUI = this.onFilesAddedUI.bind(this);\n        this.onDragOver = this.onDragOver.bind(this);\n        this.onDragLeave = this.onDragLeave.bind(this);\n        this.onDrop = this.onDrop.bind(this);\n        this.onPaste = this.onPaste.bind(this);\n\n        // Backend actions\n        this.onFilesAdded = this.onFilesAdded.bind(this);\n        this.uploadFiles = this.uploadFiles.bind(this);\n        this.sendRequest = this.sendRequest.bind(this);\n        this.chooseFromUploaded = this.chooseFromUploaded.bind(this);\n        this.fileUploaded = this.fileUploaded.bind(this);\n    }\n\n    onFilesAdded(files) {\n        const { t } = this.props;\n\n        const ruleTest = new RegExp(\"(\\.|\\/)(\" + this.props.moptions['fop_op'] + \")$\",\"i\");\n\n        let uploadErrors = [];\n        files.forEach(file => {\n\n            if (!(ruleTest.test(file.type) || ruleTest.test(file.name))) {\n                uploadErrors.push(file.name + ': ' + t('file.incorrect_type'));\n            }\n\n            if (file.size > this.props.moptions['fop_size']) {\n                uploadErrors.push(file.name + ': '+ t('file.to_big_file'));\n            }\n        });\n\n        if (uploadErrors.length > 0) {\n            alert(uploadErrors.join(\"\\n\"));\n        } else {\n            this.setState({\n                'files': files\n            })\n        }\n    }\n\n    componentDidUpdate(prevProps, prevState) {\n        if (this.state.files.length > 0 && this.state.uploading == false) {\n            this.uploadFiles();\n        }\n    }\n\n    async uploadFiles() {\n        this.setState({ uploadProgress: {}, uploading: true });\n        const promises = [];\n        this.state.files.forEach(file => {\n            promises.push(this.sendRequest(file));\n        });\n        try {\n            await Promise.all(promises);\n            this.setState({ successfullUploaded: true, uploading: false,  files : []});\n        } catch (e) {\n            // Not Production ready! Do some error handling here instead...\n            this.setState({ successfullUploaded: true, uploading: false,  files : [] });\n        }\n    }\n\n    fileUploaded(file) {\n        this.props.fileAttached(file);\n    }\n\n    sendRequest(file) {\n        const { t } = this.props;\n\n        return new Promise((resolve, reject) => {\n            const req = new XMLHttpRequest();\n\n            req.upload.addEventListener(\"progress\", event => {\n                if (event.lengthComputable) {\n                    const copy = { ...this.state.uploadProgress };\n                    copy[file.name] = {\n                        state: \"pending\",\n                        percentage: (event.loaded / event.total) * 100\n                    };\n                    this.setState({ progress: t('file.uploading') + ' ' + Math.round((event.loaded / event.total) * 100) + '%' });\n                }\n            });\n\n            req.upload.addEventListener(\"load\", event => {\n                const copy = { ...this.state.uploadProgress };\n                copy[file.name] = { state: \"done\", percentage: 100 };\n                this.setState({ progress: '' });\n                resolve(req.response);\n            });\n\n            var _inst = this;\n\n            req.onreadystatechange = function() {\n                if (req.readyState === 4) {\n                    _inst.fileUploaded(JSON.parse(req.response));\n                }\n            }\n\n            req.upload.addEventListener(\"error\", event => {\n                const copy = { ...this.state.uploadProgress };\n                copy[file.name] = { state: \"error\", percentage: 0 };\n                this.setState({ progress: copy });\n                reject(req.response);\n            });\n\n            const formData = new FormData();\n            formData.append(\"files\", file, file.name);\n\n            req.open(\"POST\", WWW_DIR_JAVASCRIPT + 'mailconv/uploadfile/(csrf)/' + confLH.csrf_token);\n            req.send(formData);\n        });\n    }\n\n    openFileDialog() {\n        if (this.state.uploading) return;\n        this.fileInputRef.current.click();\n    }\n\n    onFilesAddedUI(evt) {\n        const files = evt.target.files;\n        const array = this.fileListToArray(files);\n        this.onFilesAdded(array);\n    }\n\n    onDragOver(event) {\n        event.preventDefault();\n        if (this.state.uploading) return;\n        this.setState({hightlight: true})\n    }\n\n    componentDidMount() {\n        if (this.dropAreaRef.current) {\n            this.dropAreaRef.current.ondragover = this.onDragOver;\n            this.dropAreaRef.current.ondragleave = this.onDragLeave;\n            this.dropAreaRef.current.ondrop = this.onDrop;\n        }\n    }\n\n    componentWillUnmount() {\n        if (this.dropAreaRef.current) {\n            this.dropAreaRef.current.ondragover = null;\n            this.dropAreaRef.current.ondragleave = null;\n            this.dropAreaRef.current.ondrop = null;\n        }\n\n        window.attatchReplyCurrent = null;\n    }\n\n    onPaste(e) {\n        var items = e && e.clipboardData &&\n            e.clipboardData.items,\n            data = {files: []};\n\n        if (items && items.length) {\n            const array = [];\n            for (var i = 0; i < items.length; i++) {\n                var file = items[i].getAsFile && items[i].getAsFile();\n                if (file){\n                    array.push(file);\n                }\n            }\n\n            if (array.length > 0) {\n                this.onFilesAdded(array);\n            }\n        }\n    }\n\n    onDragLeave(event) {\n        this.setState({hightlight: false})\n    }\n\n    onDrop(event) {\n        event.preventDefault();\n        if (this.state.uploading) return;\n        const files = event.dataTransfer.files;\n        const array = this.fileListToArray(files);\n        this.onFilesAdded(array);\n        this.setState({hightlight: false})\n    }\n\n    fileListToArray(list) {\n        const array = [];\n        for (var i = 0; i < list.length; i++) {\n            array.push(list.item(i));\n        }\n        return array;\n    }\n\n    chooseFromUploaded() {\n\n        const { t } = this.props;\n        \n        lhc.revealModal({\n            'title' : t('file.choose_uploaded'),\n            'iframe':true,\n            'height':500,\n            'url':WWW_DIR_JAVASCRIPT +'mailconv/attatchfile/(attachment)/1'\n        });\n\n        var _inst = this;\n\n        window.attatchReplyCurrent = function(file) {\n             _inst.props.fileAttached(file);\n        }\n    }\n\n    render() {\n\n            const { t } = this.props;\n\n            return (\n                <React.Fragment>\n                    <button className=\"btn btn-sm btn-outline-secondary\" onClick={this.chooseFromUploaded} ><i className=\"material-icons\">list</i> {t('file.choose_uploaded')}</button>\n                    <button ref={this.dropAreaRef} onClick={this.openFileDialog} className={\"btn btn-sm \" + (this.state.hightlight == true ? 'btn-outline-primary' : 'btn-outline-secondary')}><i className=\"material-icons\">attach_file</i> {this.state.progress || t('file.drop_here')}</button>\n                    <input onChange={this.onFilesAddedUI} ref={this.fileInputRef} id=\"fileupload\" type=\"file\" name=\"files[]\" multiple className=\"d-none\" />\n                </React.Fragment>\n            );\n     }\n}\n\nexport default withTranslation('mail_chat')(MailChatAttatchement);","import React, { useEffect, useState, useReducer } from \"react\";\n\nimport {useTranslation} from 'react-i18next';\n\nconst MailReplyRecipient = props => {\n\n    const [recipients, dispatch] = useReducer((recipients, { type, value }) => {\n        switch (type) {\n            case \"add\":\n                return [...recipients, value];\n\n            case \"add_recipient\":\n                recipients = { ... recipients};\n                recipients[value].push({\"name\" : \"\", \"email\" : \"\"});\n                return recipients;\n\n            case \"remove_recipient\":\n                recipients = { ... recipients};\n                recipients[value.recipient] = recipients[value.recipient].filter((_, index) => index !== value.index);\n                return recipients;\n\n            case \"set\":\n                return value;\n\n            case 'set_attribute':\n                recipients = { ... recipients};\n                recipients[value.value.type][value.value.index][value.value.field] = value.value.value;\n                return recipients;\n                break;\n\n            case \"cleanup\":\n                return [];\n            case \"remove\":\n                return recipients.filter((_, index) => index !== value);\n            default:\n                return recipients;\n        }\n    }, []);\n\n    const setReciepints = (type, value) => {\n        dispatch({'type' : type, \"value\" : value});\n        props.setRecipients(recipients);\n    }\n\n    useEffect(() => {\n        dispatch({\"type\" : \"set\", \"value\" : props.recipients});\n        props.setRecipients(props.recipients);\n    },[props.recipients]);\n\n    const { t, i18n } = useTranslation('mail_chat');\n    \n    return <div className=\"row\">\n\n        {!props.readOnly && <div className=\"col-12 text-secondary fw-bold fs13 pb-1\">{t('r.recipients')} <i className=\"material-icons settings text-muted\" onClick={(e) => setReciepints(\"add_recipient\",\"reply\")} style={{fontSize: \"20px\"}}>add</i> Cc <i className=\"material-icons settings text-muted\" onClick={(e) => setReciepints(\"add_recipient\",\"cc\")} style={{fontSize: \"20px\"}}>add</i> Bcc <i onClick={(e) => setReciepints(\"add_recipient\",\"bcc\")} className=\"material-icons settings text-muted\" style={{fontSize: \"20px\"}}>add</i></div>}\n\n        <div className=\"col-6\">\n            {recipients.reply && recipients.reply.map((mail, index) => (\n                <div className=\"row pb-1\">\n                    <div className=\"col-1 text-secondary fs13 pt-1\">{t('r.to')}:</div>\n                    <div className=\"col-5\">\n                        <div className=\"input-group input-group-sm\">\n                            <span className=\"input-group-text\" ><i className=\"material-icons me-0\">mail_outline</i></span>\n                            <input disabled={props.readOnly} type=\"text\" className=\"form-control form-control-sm\" placeholder=\"E-mail\" onChange={(e) => setReciepints(\"set_attribute\",{value : {value: e.target.value, type: \"reply\", index: index, \"field\" : \"email\"}})} value={mail.email} placeholder={t('r.email')} aria-describedby=\"validationTooltipUsernamePrepend\" />\n                        </div>\n                    </div>\n                    <div className=\"col-5\"><input type=\"text\" disabled={props.readOnly} placeholder={t('r.name')} onChange={(e) => setReciepints(\"set_attribute\",{value : {value: e.target.value, type: \"reply\", index: index, \"field\" : \"name\"}})} value={mail.name} className=\"form-control form-control-sm\" /></div>\n                    {!props.readOnly && index > 0 && <div className=\"col-1\"><i className=\"material-icons settings text-muted\" onClick={(e) => setReciepints(\"remove_recipient\",{\"recipient\":\"reply\", \"index\" : index})}>remove</i></div>}\n                </div>\n            ))}\n        </div>\n\n        <div className=\"col-6\">\n        {recipients.cc && recipients.cc.map((mail, index) => (\n            <div className=\"row pb-1\">\n                <div className=\"col-1 text-secondary fs13 pt-1\">Cc:</div>\n                <div className=\"col-5\">\n                    <div className=\"input-group input-group-sm\">\n                        <span className=\"input-group-text\" ><i className=\"material-icons me-0\">mail_outline</i></span>\n                        <input type=\"text\" disabled={props.readOnly} className=\"form-control form-control-sm\" placeholder=\"E-mail\" onChange={(e) => setReciepints(\"set_attribute\",{value : {value: e.target.value, type: \"cc\", index: index, \"field\" : \"email\"}})} value={mail.email} placeholder={t('r.email')} aria-describedby=\"validationTooltipUsernamePrepend\" />\n                    </div>\n                </div>\n                <div className=\"col-5\"><input disabled={props.readOnly} type=\"text\" placeholder={t('r.name')} onChange={(e) => setReciepints(\"set_attribute\",{value : {value: e.target.value, type: \"cc\", index: index, \"field\" : \"name\"}})} value={mail.name} className=\"form-control form-control-sm\" /></div>\n                {!props.readOnly && <div className=\"col-1\"><i className=\"material-icons settings text-muted\" onClick={(e) => setReciepints(\"remove_recipient\",{\"recipient\":\"cc\", \"index\" : index})}>remove</i></div>}\n            </div>\n        ))}\n        </div>\n\n        <div className=\"col-6\">\n        {recipients.bcc && recipients.bcc.map((mail, index) => (\n            <div className=\"row pb-1\">\n                <div className=\"col-1 text-secondary fs13 pt-1\">Bcc:</div>\n                <div className=\"col-5\">\n                    <div className=\"input-group input-group-sm\">\n                        <span className=\"input-group-text\" ><i className=\"material-icons me-0\">mail_outline</i></span>\n                        <input type=\"text\" disabled={props.readOnly} className=\"form-control form-control-sm\" placeholder=\"E-mail\" onChange={(e) => setReciepints(\"set_attribute\",{value : {value: e.target.value, type: \"bcc\", index: index, \"field\" : \"email\"}})} value={mail.email} placeholder={t('r.email')} aria-describedby=\"validationTooltipUsernamePrepend\" />\n                    </div>\n                </div>\n                <div className=\"col-5\"><input type=\"text\" disabled={props.readOnly} placeholder={t('r.name')} onChange={(e) => setReciepints(\"set_attribute\",{value : {value: e.target.value, type: \"bcc\", index: index, \"field\" : \"name\"}})} value={mail.name} className=\"form-control form-control-sm\" /></div>\n                {!props.readOnly && <div className=\"col-1\"><i className=\"material-icons settings text-muted\" onClick={(e) => setReciepints(\"remove_recipient\",{\"recipient\":\"bcc\", \"index\" : index})}>remove</i></div>}\n            </div>\n        ))}\n        </div>\n\n\n    </div>\n}\n\nexport default React.memo(MailReplyRecipient);","import React, { useEffect, useState, useReducer, useRef } from \"react\";\n\nconst MailSendStatus = props => {\n\n    const [expandBody, setExpandBody] = useState(false);\n\n    return <React.Fragment>\n        {props.status.send && <div className=\"alert alert-success p-1 ps-2\" role=\"alert\">Success!</div>}\n        {!props.status.send && <div className=\"alert alert-danger p-1 ps-2\" role=\"alert\">\n            <ul className=\"mb-0\">\n                {props.status.errors.general && <li>{props.status.errors.general}</li>}\n                {props.status.errors.reply && <li>{props.status.errors.reply}</li>}\n                {props.status.errors.content && <li>{props.status.errors.content}</li>}\n            </ul>\n            {props.status.errors.raw_error &&\n                <div>\n                    <h5>An unknown error happened while sending an email. Please reload a window!</h5>\n                    <div><button onClick={() => {document.location.reload()}} className=\"btn btn-danger btn-sm\">Reload this window</button></div>\n                    <p>Please copy error text and send to your manager!</p>\n                    <textarea className=\"form-control form-control-sm\" rows=\"5\">{props.status.errors.raw_error}</textarea>\n                </div>\n            }\n        </div>}\n        \n    </React.Fragment>\n\n}\n\nexport default React.memo(MailSendStatus);","import React, { useEffect, useState, useReducer, useRef } from \"react\";\nimport { Editor } from '@tinymce/tinymce-react';\nimport axios from \"axios\";\nimport MailChatAttachement from \"./MailChatAttachement\";\nimport MailReplyRecipient from \"./MailReplyRecipient\";\nimport MailSendStatus from \"./MailSendStatus\";\nimport {useTranslation} from 'react-i18next';\n\nconst MailChatReply = props => {\n\n    const [replyMode, setReplyMode] = useState(false);\n    const [forwardMode, setForwardMode] = useState(false);\n    const [keepQuote, setKeepQuote] = useState(true);\n    const [replyContent, setReplyContent] = useState(null);\n    const [replyIntro, setReplyIntro] = useState(null);\n    const [replySignature, setReplySignature] = useState(null);\n    const [loadedReplyData, setLoadedReplyData] = useState(false);\n    const [recipients, setRecipients] = useState([]);\n    const [recipientsModified, setModifiedRecipients] = useState([]);\n    const [replySendStatus, setReplySendStatus] = useState([]);\n    const [sendInProgress, setSendInProgress] = useState(false);\n    const [underReplySignature, setUnderReplySignature] = useState(false);\n    const [isOwner, setIsOwner] = useState(true);\n    const [isSelfReply, setIsSelfReply] = useState(true);\n\n    const [attachedFiles, dispatch] = useReducer((attachedFiles, { type, value }) => {\n        switch (type) {\n            case \"add\":\n                return [...attachedFiles, value];\n            case \"cleanup\":\n                return [];\n            case \"remove\":\n                return attachedFiles.filter((_, index) => index !== value);\n            default:\n                return attachedFiles;\n        }\n    }, []);\n\n    const currentAttatchedFiles = useRef();\n    currentAttatchedFiles.current = attachedFiles;\n\n    let replyContentDirect = null;\n\n    const handleEditorChange = (content, editor) => {\n        replyContentDirect = content;\n    }\n\n    const sendReply = (status) => {\n        let replyPayload = {\n            'recipients' : recipientsModified,\n            'content' : tinyMCE.get(\"reply-to-mce-\"+props.message.id).getContent(),\n            'attatchements' : attachedFiles,\n            'status': status,\n            'mode' : (replyMode == true ? 'reply' : 'forward')\n        };\n\n        setSendInProgress(true);\n\n        axios.post(WWW_DIR_JAVASCRIPT  + \"mailconv/apisendreply/\" + props.message.id, replyPayload).then(result => {\n\n            // We always expect an object\n            if (typeof result.data !== 'object') {\n                setSendInProgress(false);\n                setReplySendStatus({\n                    'send' : false,\n                    'send_tried': true,\n                    'errors': {\n                        'raw_error': result.data\n                    }\n                });\n                return;\n            }\n\n            setReplySendStatus(result.data);\n            setSendInProgress(false);\n\n            if (result.data.send == true) {\n                props.fetchMessages();\n                props.setConversationStatus(result.data.conv_status);\n            }\n\n        }).catch(error => {\n            setSendInProgress(false);\n            // Error \n            if (error.response) {\n                /*\n                 * The request was made and the server responded with a\n                 * status code that falls out of the range of 2xx\n                 */\n                if (error.response.status === 400) {\n                    setReplySendStatus(error.response.data);\n                } else {\n                    setReplySendStatus({\n                        'send' : false,\n                        'send_tried': true,\n                        'errors': {\n                            'raw_error': error.response.data\n                        }\n                    });\n                }\n\n            } else if (error.request) {\n                /*\n                 * The request was made but no response was received, `error.request`\n                 * is an instance of XMLHttpRequest in the browser and an instance\n                 * of http.ClientRequest in Node.js\n                 */\n                console.log(error.request);\n            } else {\n                // Something happened in setting up the request and triggered an Error\n                console.log('Error', error.message);\n            }\n\n            console.log(error.config);\n\n        });\n    }\n\n    const removeAttatchedFile = (file, index) => {\n        dispatch({ type: \"remove\", value: index });\n        if (file.new === true) {\n            axios.get(WWW_DIR_JAVASCRIPT  + \"file/delete/\" + file.id + '/(csfr)/' + confLH.csrf_token + '?react=1');\n        }\n    }\n\n    useEffect(() => {\n        return () => {\n            currentAttatchedFiles.current.map((file, index) => {\n                if (file.new === true) {\n                    axios.get(WWW_DIR_JAVASCRIPT  + \"file/delete/\" + file.id + '/(csfr)/' + confLH.csrf_token + '?react=1');\n                }\n            })\n        }\n    },[]);\n\n    useEffect(() => {\n        if ((replyMode == true || forwardMode == true) && loadedReplyData == false) {\n            axios.post(WWW_DIR_JAVASCRIPT  + \"mailconv/getreplydata/\" + props.message.id + '/' + (replyMode == true ? 'reply' : 'forward')).then(result => {\n                setLoadedReplyData(true);\n                setReplyIntro(result.data.intro);\n                setReplySignature(result.data.signature);\n                setRecipients(result.data.recipients);\n                setUnderReplySignature(result.data.signature_under);\n                setIsSelfReply(result.data.is_self_reply);\n                setKeepQuote(result.data.keep_quote);\n\n                if (result.data.user_id > 0) {\n                    props.verifyOwner(result.data.user_id);\n                    setIsOwner(result.data.is_owner);\n                }\n            });\n        } else if (replyMode == false && forwardMode == false && loadedReplyData == true) {\n            setLoadedReplyData(false);\n            if (currentAttatchedFiles.current.length > 0) {\n                currentAttatchedFiles.current.map((file, index) => {\n                    if (file.new === true) {\n                        axios.get(WWW_DIR_JAVASCRIPT  + \"file/delete/\" + file.id + '/(csfr)/' + confLH.csrf_token + '?react=1');\n                    }\n                });\n                dispatch({ type: \"cleanup\"})\n            }\n        }\n    },[replyMode,forwardMode]);\n\n    if (props.replyMode == true && replyMode == false) {\n        if (forwardMode == true) {\n            setLoadedReplyData(false);\n            setForwardMode(false);\n        }\n        setReplyMode(true);\n    }\n\n    if (props.forwardMode == true && forwardMode == false) {\n        if (replyMode == true) {\n            setLoadedReplyData(false);\n            setReplyMode(false);\n        }\n        setForwardMode(true);\n    }\n\n    const { t, i18n } = useTranslation('mail_chat');\n\n    return <React.Fragment>\n        <div className=\"col-12 mt-2 pt-3 pb-2\">\n\n            {!isOwner && <div className=\"alert alert-warning\" role=\"alert\"><span className=\"material-icons\">warning</span>\n                {t('msg.not_an_owner')}\n            </div>}\n\n            {replyMode && isSelfReply && <div className=\"alert alert-warning\" role=\"alert\"><span className=\"material-icons\">warning</span>\n                {t('msg.self_reply')}\n            </div>}\n\n            {!replyMode && !forwardMode && !props.fetchingMessages && <div className=\"btn-group\" role=\"group\" aria-label=\"Mail actions\">\n                <button type=\"button\" className=\"btn btn-sm btn-outline-secondary\" onClick={() => {setForwardMode(false);setReplyMode(true);}}><i className=\"material-icons\">reply</i>{t('msg.reply')}</button>\n                <button disabled={props.message.response_type == 1} type=\"button\" className=\"btn btn-sm btn-outline-secondary\" onClick={() => props.noReplyRequired()}><i className=\"material-icons\">done</i>{t('msg.nrr')}</button>\n                {!props.moptions.hide_recipients && <button type=\"button\" className=\"btn btn-sm btn-outline-secondary\" onClick={() => {setReplyMode(false);setForwardMode(true)}}><i className=\"material-icons\">forward</i>{t('msg.forward')}</button>}\n            </div>}\n\n            {!props.fetchingMessages && (replyMode || forwardMode) && loadedReplyData && <div className=\"shadow p-2\">\n\n                {replySendStatus.send_tried && <MailSendStatus status={replySendStatus} />}\n\n                <MailReplyRecipient readOnly={props.moptions.hide_recipients} setRecipients={(recipients) => setModifiedRecipients(recipients)} mode={replyMode == true ? 'reply' : 'forward'} message={props.message} recipients={recipients} />\n\n                <Editor\n                    tinymceScriptSrc={props.moptions.tiny_mce_path}\n                    initialValue={\"<p></p>\" + replyIntro + (keepQuote && props.message.body_front ? (\"<blockquote>\" + (props.moptions.skip_images == true ? props.message.body_front.replace(/\\<img([^>]*)\\ssrc=('|\")([^>]*)\\2\\s([^>]*)\\/\\>/gi, props.moptions.image_skipped_text ) : props.message.body_front) + \"</blockquote>\") : \"\") + (underReplySignature == false ? replySignature : \"\")}\n                    onInit={() => {\n                        tinyMCE.get(\"reply-to-mce-\"+props.message.id).focus();\n                    }}\n                    id={\"reply-to-mce-\"+props.message.id}\n                    init={{\n                        cache_suffix: \"?v=\"+props.moptions.cache_version_plugin,\n                        height: 320,\n                        automatic_uploads: props.moptions.files_enabled,\n                        file_picker_types: 'image',\n                        images_upload_url: WWW_DIR_JAVASCRIPT + 'mailconv/uploadimage/(csrf)/' + confLH.csrf_token,\n                        templates: WWW_DIR_JAVASCRIPT + 'mailconv/apiresponsetemplates/'+props.message.id,\n                        paste_data_images: props.moptions.files_enabled,\n                        relative_urls : false,\n                        browser_spellcheck: true,\n                        paste_as_text: true,\n                        contextmenu: false,\n                        menubar: false,\n                        plugins: props.moptions.mce_plugins,\n                        toolbar_mode: 'wrap',\n                        toolbar: props.moptions.mce_toolbar\n                    }}\n                />\n\n                {replyMode && <div className=\"float-end\">\n                    <a className=\"action-image\" onClick={() => {setReplyMode(false); props.cancelReply()}}><i className=\"material-icons\">delete</i></a>\n                </div>}\n\n                {forwardMode && <div className=\"float-end\">\n                    <a className=\"action-image\" onClick={() => {setForwardMode(false); props.cancelForward()}}><i className=\"material-icons\">delete</i></a>\n                </div>}\n\n                <div className=\"btn-group mt-2\" role=\"group\" aria-label=\"Mail actions\">\n                    <button type=\"button\" disabled={sendInProgress} className=\"btn btn-sm btn-primary\" onClick={() => sendReply(2)}><i className=\"material-icons\">send</i>{sendInProgress == true ? t('msg.sending') : t('msg.send_and_close')}</button>\n                    {props.moptions.send_as_new && <button type=\"button\" disabled={sendInProgress} className=\"btn btn-sm btn-outline-secondary\" onClick={() => sendReply(0)}><i className=\"material-icons text-warning\">send</i>{sendInProgress == true ? t('msg.sending') : t('msg.send_as_pending')}</button>}\n                    <button type=\"button\" disabled={sendInProgress} className=\"btn btn-sm btn-outline-secondary\" onClick={() => sendReply(1)}><i className=\"material-icons text-success\">send</i>{sendInProgress == true ? t('msg.sending') : t('msg.send_as_active')}</button>\n                </div>\n\n                {props.moptions.files_enabled && <div className=\"btn-group d-block mt-2\" role=\"group\" aria-label=\"Mail actions\">\n                     <MailChatAttachement moptions={props.moptions} fileAttached={(file) => dispatch({ type: \"add\", value: file})} message={props.message}></MailChatAttachement>\n                </div>}\n\n                {attachedFiles && attachedFiles.length > 0 &&\n                <div className=\"pt-2\">{attachedFiles.map((file, index) => (\n                    <button title={t('msg.click_to_remove')} onClick={() => removeAttatchedFile(file, index)} className=\"btn btn-sm btn-outline-info me-1 mb-1\" title={file.id}>{file.name}</button>\n                ))}</div>}\n\n            </div>}\n\n        </div>\n    </React.Fragment>\n\n}\n\nexport default React.memo(MailChatReply);","import React, { useState, useEffect, useRef } from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\n\r\nconst MailChatImage = ({ \r\n    src, \r\n    alt, \r\n    title, \r\n    className, \r\n    style, \r\n    download_policy = 0,\r\n    width,\r\n    height,\r\n    ...props \r\n}) => {\r\n    const [imageError, setImageError] = useState(false);\r\n    const [errorMode, setErrorMode] = useState(false);\r\n    const [imageLoading, setImageLoading] = useState(true);\r\n    const [canShowImage, setCanShowImage] = useState(false);\r\n    const [fileNotFound, setFileNotFound] = useState(false);\r\n    const [imageSrc, setImageSrc] = useState('');\r\n    const [verificationMessage, setVerificationMessage] = useState('');\r\n    const [verificationAttempts, setVerificationAttempts] = useState(0);\r\n    const [countdownSeconds, setCountdownSeconds] = useState(0);\r\n    const [protectionType, setProtectionType] = useState('');\r\n    const [protectionHtml, setProtectionHtml] = useState('');\r\n    const [isProtected, setIsProtected] = useState(false);\r\n    const [imageRevealed, setImageRevealed] = useState(false);\r\n    const [imageTitle, setImageTitle] = useState('');\r\n    const [buttonTitle, setButtonTitle] = useState('');\r\n    const [extractedFileId, setExtractedFileId] = useState(null);\r\n    const [extractedConvId, setExtractedConvId] = useState(null);\r\n\r\n    const { t, i18n } = useTranslation('mail_chat');\r\n\r\n    const countdownInterval = useRef(null);\r\n    const maxVerificationAttempts = 8;\r\n\r\n    // Extract file_id and conversation_id from URL structure like mailconv/inlinedownload/<file_id>/<conversation_id>\r\n    const extractIdsFromUrl = (url) => {\r\n        if (!url) return { fileId: null, convId: null };\r\n        \r\n        // Match pattern: any_domain/any_path/mailconv/inlinedownload/file_id/conversation_id\r\n        const match = url.match(/\\/mailconv\\/inlinedownload\\/(\\d+)\\/(\\d+)/);\r\n        if (match) {\r\n            return {\r\n                fileId: parseInt(match[1], 10),\r\n                convId: parseInt(match[2], 10)\r\n            };\r\n        }\r\n        \r\n        return { fileId: null, convId: null };\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (src) {\r\n            // Extract file_id and conversation_id from src URL\r\n            const { fileId, convId } = extractIdsFromUrl(src);\r\n\r\n            if (fileId && convId) {\r\n                setExtractedFileId(fileId);\r\n                setExtractedConvId(convId);\r\n                setImageTitle(title || '');\r\n\r\n                // Check download policy (convert to number for comparison)\r\n                const policyValue = parseInt(download_policy, 10);\r\n                if (policyValue === 0) {\r\n                    // No verification needed - show image immediately\r\n                    setCanShowImage(true);\r\n                    setImageSrc(window.WWW_DIR_JAVASCRIPT + 'mailconv/inlinedownload/' + fileId + '/' + convId);\r\n                } else if (policyValue === 1) {\r\n                    // Image needs verification - start verification process\r\n                    setCanShowImage(false);\r\n                    startVerificationProcess(fileId, convId);\r\n                } else if (policyValue === 2) {\r\n                    // No permission to view - check if image is sensitive first\r\n                    setCanShowImage(false);\r\n                    checkImageSensitivity(fileId, convId);\r\n                }\r\n            } else {\r\n                // Fallback to regular src if no pattern match\r\n                setCanShowImage(true);\r\n                setImageSrc(src);\r\n            }\r\n        } else {\r\n            setFileNotFound(true);\r\n        }\r\n\r\n        return () => {\r\n            clearCountdown();\r\n        };\r\n    }, [download_policy, src, title]);\r\n\r\n    const clearCountdown = () => {\r\n        if (countdownInterval.current) {\r\n            clearInterval(countdownInterval.current);\r\n            countdownInterval.current = null;\r\n        }\r\n        setCountdownSeconds(0);\r\n    };\r\n\r\n    const revealImage = () => {\r\n        if (isProtected && !imageRevealed) {\r\n            setImageRevealed(true);\r\n            setImageSrc(window.WWW_DIR_JAVASCRIPT + 'mailconv/inlinedownload/' + extractedFileId + '/' + extractedConvId);\r\n        }\r\n    };\r\n\r\n    const downloadDirectly = () => {\r\n        window.open(window.WWW_DIR_JAVASCRIPT + 'mailconv/inlinedownload/' + extractedFileId + '/' + extractedConvId, '_blank');\r\n    };\r\n\r\n    const handleImageClick = () => {\r\n        if (isProtected && !imageRevealed) {\r\n            revealImage();\r\n        }\r\n    };\r\n\r\n    const startVerificationProcess = (fileId, convId) => {\r\n        setVerificationAttempts(0);\r\n        setVerificationMessage(t('image.verifying_access'));\r\n\r\n        requestVerification(fileId, convId);\r\n    };\r\n\r\n    const requestVerification = (fileId, convId, currentAttempts = null) => {\r\n        const attempts = currentAttempts !== null ? currentAttempts : verificationAttempts;\r\n        \r\n        if (attempts >= maxVerificationAttempts) {\r\n            setVerificationMessage(t('image.verification_failed'));\r\n            return;\r\n        }\r\n\r\n        const newAttempts = attempts + 1;\r\n        setVerificationAttempts(newAttempts);\r\n        \r\n        // Build verification URL using conversation ID\r\n        const verifyUrl = window.WWW_DIR_JAVASCRIPT + 'mailconv/verifyaccess/' + fileId + '/' + convId;\r\n        \r\n        // Make verification request\r\n        fetch(verifyUrl, {\r\n            method: 'GET',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n            }\r\n        })\r\n        .then(response => response.json())\r\n        .then(data => {\r\n            const policyValue = parseInt(download_policy, 10);\r\n            \r\n            if (data.verified === true) {\r\n                // Check if file has error message\r\n                if (data.error_msg) {\r\n                    setVerificationMessage(data.error_msg);\r\n                    clearCountdown();\r\n                    setErrorMode(true);\r\n                } else {\r\n                    if (policyValue === 2 && (data.protection_image || data.protection_html)) {\r\n                        // Policy 2 with sensitive image - show access denied\r\n                        setVerificationMessage(t('image.access_denied'));\r\n                        clearCountdown();\r\n                        setErrorMode(true);\r\n                    } else {\r\n                        // Verification successful - check protection status\r\n                        setCanShowImage(true);\r\n                        setVerificationMessage('');\r\n                        clearCountdown();\r\n                        \r\n                        if (data.protection_image) {\r\n                            setProtectionType(data.protection_image);\r\n                            setIsProtected(true);\r\n                            setImageRevealed(false);\r\n                            setImageSrc(data.protection_image);\r\n                            setButtonTitle(data.btn_title);\r\n                        } else if (data.protection_html) {\r\n                            setProtectionHtml(data.protection_html);\r\n                            setIsProtected(true);\r\n                            setImageRevealed(false);\r\n                            setImageSrc(''); // No image source for HTML protection\r\n                        } else {\r\n                            setImageSrc(window.WWW_DIR_JAVASCRIPT + 'mailconv/inlinedownload/' + fileId + '/' + convId);\r\n                        }\r\n                    }\r\n                }\r\n            } else {\r\n                // Verification not ready yet - schedule next attempt\r\n                if (newAttempts < maxVerificationAttempts) {\r\n                    scheduleNextVerification(newAttempts, fileId, convId);\r\n                } else {\r\n                    setVerificationMessage(t('image.verification_failed'));\r\n                }\r\n            }\r\n        })\r\n        .catch(error => {\r\n            console.error('Verification request failed:', error);\r\n            if (newAttempts < maxVerificationAttempts) {\r\n                scheduleNextVerification(newAttempts, fileId, convId);\r\n            } else {\r\n                setVerificationMessage(t('image.verification_failed'));\r\n                setErrorMode(true);\r\n            }\r\n        });\r\n    };\r\n\r\n    const scheduleNextVerification = (attempts, fileId, convId) => {\r\n        const delaySeconds = 4;\r\n        setCountdownSeconds(delaySeconds);\r\n        \r\n        setVerificationMessage(`${t('image.verifying_access')} (${attempts}/${maxVerificationAttempts})`);\r\n        \r\n        // Start countdown\r\n        countdownInterval.current = setInterval(() => {\r\n            setCountdownSeconds(prev => {\r\n                if (prev <= 1) {\r\n                    clearInterval(countdownInterval.current);\r\n                    requestVerification(fileId, convId, attempts);\r\n                    return 0;\r\n                }\r\n                return prev - 1;\r\n            });\r\n        }, 1000);\r\n    };\r\n\r\n    const checkImageSensitivity = (fileId, convId) => {\r\n        setVerificationMessage(t('image.checking_access'));\r\n        requestVerification(fileId, convId);\r\n    };\r\n\r\n    const handleImageLoad = () => {\r\n        setImageLoading(false);\r\n    };\r\n\r\n    const handleImageError = () => {\r\n        setImageError(true);\r\n        setImageLoading(false);\r\n    };\r\n\r\n    // Check if the image source is an external URL (not our internal system)\r\n    const isExternalImage = () => {\r\n        if (!imageSrc) return false;\r\n        // Check if it's NOT our internal mailconv URL\r\n        return !imageSrc.includes('/mailconv/inlinedownload/');\r\n    };\r\n\r\n    // Show verification message if image is being verified\r\n    if (!canShowImage && verificationMessage && extractedFileId) {\r\n        return (\r\n            <div className=\"mail-image-verification text-muted p-2 fs14 border rounded d-inline-block bg-light\">\r\n                <i className=\"material-icons text-warning\">info</i>\r\n\r\n                <span className=\"ms-1\">{countdownSeconds == 0 && verificationAttempts <= 1 && errorMode === false ? t('image.downloading') : verificationMessage}</span>\r\n\r\n                {countdownSeconds > 0 && (\r\n                    <span className=\"text-secondary ms-1\">\r\n                        ({t('image.next_attempt_in')} {countdownSeconds} {t('image.seconds')})\r\n                    </span>\r\n                )}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (imageError) {\r\n        // If it's an external image, show a link to view it directly\r\n        if (isExternalImage() && (imageSrc || src)) {\r\n            const externalUrl = imageSrc || src;\r\n            return (\r\n                <div className=\"mail-image-error d-inline-block border rounded p-2 text-muted\">\r\n                    <i className=\"material-icons\">link_off</i>\r\n                    <span className=\"ms-1\">\r\n                        {t('image.external_image')}: <a title={externalUrl} href={externalUrl} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-primary\"><i className=\"material-icons\">open_in_new</i>{t('image.open_in_new_tab')}</a>\r\n                    </span>\r\n                    {alt && <div className=\"small text-muted mt-1\">{alt}</div>}\r\n                </div>\r\n            );\r\n        }\r\n        \r\n        // For internal images, show the download button\r\n        return (\r\n            <div className=\"mail-image-error d-inline-block border rounded p-2 text-muted\">\r\n                <i className=\"material-icons\">broken_image</i>\r\n                <span className=\"ms-1\">{t('image.image_not_available')} <button type=\"button\" onClick={downloadDirectly} className=\"btn btn-xs btn-secondary\">{t('image.download')}</button></span>\r\n                {alt && <div className=\"small\">{alt}</div>}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Render protected image content\r\n    if (canShowImage && (imageSrc || protectionHtml)) {        \r\n        if (isProtected && !imageRevealed) {\r\n            if (protectionHtml) {\r\n                return (\r\n                    <div\r\n                        id={`mail-img-reveal-holder-${extractedFileId}`}\r\n                        className=\"mail-image-protected-html action-image protected-html\"\r\n                        onClick={handleImageClick}\r\n                        tabIndex=\"0\"\r\n                        role=\"button\"\r\n                        aria-label={t('image.click_to_reveal')}\r\n                        style={{ cursor: 'pointer' }}\r\n                        dangerouslySetInnerHTML={{ __html: protectionHtml }}\r\n                    />\r\n                );\r\n            } else {\r\n                return (\r\n                    <div\r\n                        id={`mail-img-reveal-holder-${extractedFileId}`}\r\n                        className=\"mail-image-protected action-image protected-image clickable-reveal position-relative d-inline-block\"\r\n                        onClick={handleImageClick}\r\n                        tabIndex=\"0\"\r\n                        role=\"button\"\r\n                        aria-label-title={buttonTitle}\r\n                        aria-label={t('image.click_to_reveal')}\r\n                        style={{ cursor: 'pointer' }}\r\n                    >\r\n                        <img \r\n                            id={`mail-img-file-${extractedFileId}`}\r\n                            src={imageSrc} \r\n                            alt={imageTitle} \r\n                            title={imageTitle}\r\n                            className={`action-image img-fluid ${className || ''}`}\r\n                            width={width}\r\n                            height={height}\r\n                            onLoad={handleImageLoad}\r\n                            onError={handleImageError}\r\n                        />\r\n                    </div>\r\n                );\r\n            }\r\n        } else {\r\n            return (\r\n                <React.Fragment>\r\n                    {imageLoading && (\r\n                        <div className=\"mail-image-loading position-absolute d-flex align-items-center justify-content-center w-100 h-100\">\r\n                            <div className=\"spinner-border spinner-border-sm text-muted\" role=\"status\">\r\n                                <span className=\"visually-hidden\">{t('image.loading')}</span>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                    \r\n                    <img\r\n                        id={`mail-img-file-${extractedFileId}`}\r\n                        src={imageSrc}\r\n                        alt={imageTitle || alt || ''}\r\n                        title={imageTitle || title || alt || ''}\r\n                        className={` ${className || ''}`}\r\n                        style={{\r\n                            maxWidth: '100%',\r\n                            height: 'auto',\r\n                            ...style\r\n                        }}\r\n                        width={width}\r\n                        height={height}\r\n                        onLoad={handleImageLoad}\r\n                        onError={handleImageError}\r\n                        {...props}\r\n                    />\r\n                </React.Fragment> \r\n            );\r\n        }\r\n    }\r\n\r\n/*<img\r\n                src={src}\r\n                alt={alt || ''}\r\n                title={title || alt || ''}\r\n                className={`mail-image ${className || ''}`}\r\n                style={{\r\n                    maxWidth: '100%',\r\n                    height: 'auto',\r\n                    ...style\r\n                }}\r\n                onLoad={handleImageLoad}\r\n                onError={handleImageError}\r\n                {...props}\r\n            />*/\r\n\r\n    if (fileNotFound) {\r\n        return (<div className=\"mail-image-verification text-muted mt-1 p-2 fs14 border rounded d-inline-block bg-light\">\r\n            <i className=\"material-icons text-danger\">info</i>{alt} [{t('image.not_found')}]\r\n        </div>);\r\n    }\r\n\r\n    // Fallback to regular image rendering\r\n    return (\r\n        <div className=\"mail-image-container d-inline-block position-relative\">\r\n            {imageLoading && (\r\n                <div className=\"mail-image-loading position-absolute d-flex align-items-center justify-content-center ms-2 w-100 h-100\">\r\n                    <div className=\"spinner-border spinner-border-sm text-muted\" role=\"status\">\r\n                        &nbsp;&nbsp;&nbsp;\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default React.memo(MailChatImage);\r\n","import React, { useState, useEffect, useRef } from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\n\r\nconst MailChatAttachment = ({ \r\n    id,\r\n    name,\r\n    description,\r\n    download_url,\r\n    is_image = false,\r\n    download_policy = 0,\r\n    restricted_file = false,\r\n    restricted_reason = 0,\r\n    download_modal = false,\r\n    ...props\r\n}) => {\r\n    const [verificationStatus, setVerificationStatus] = useState('idle'); // idle, verifying, verified, failed, denied\r\n    const [verificationMessage, setVerificationMessage] = useState('');\r\n    const [verificationAttempts, setVerificationAttempts] = useState(0);\r\n    const [countdownSeconds, setCountdownSeconds] = useState(0);\r\n    const [extractedFileId, setExtractedFileId] = useState(null);\r\n    const [extractedConvId, setExtractedConvId] = useState(null);\r\n    const [canDownload, setCanDownload] = useState(false);\r\n    const [finalDownloadUrl, setFinalDownloadUrl] = useState('');\r\n    const [isSensitiveImage, setIsSensitiveImage] = useState(false);\r\n    const [buttonTitle, setButtonTitle] = useState('');\r\n\r\n    const { t, i18n } = useTranslation('mail_chat');\r\n\r\n    const countdownInterval = useRef(null);\r\n    const maxVerificationAttempts = 8;\r\n\r\n    // Convert numeric restriction reason to user-friendly message\r\n    const getRestrictionMessage = (reason) => {\r\n        switch (parseInt(reason, 10)) {\r\n            case 1:\r\n                return t('file.no_permission_download');\r\n            case 2:\r\n                return t('file.extension_not_allowed');\r\n            default:\r\n                return t('file.access_restricted');\r\n        }\r\n    };\r\n\r\n    // Extract file_id and conversation_id from URL structure like mailconv/inlinedownload/<file_id>/<conversation_id>\r\n    const extractIdsFromUrl = (url) => {\r\n        if (!url) return { fileId: null, convId: null };\r\n        \r\n        // Match pattern: any_domain/any_path/mailconv/inlinedownload/file_id/conversation_id\r\n        const match = url.match(/\\/mailconv\\/inlinedownload\\/(\\d+)\\/(\\d+)/);\r\n        if (match) {\r\n            return {\r\n                fileId: parseInt(match[1], 10),\r\n                convId: parseInt(match[2], 10)\r\n            };\r\n        }\r\n        \r\n        return { fileId: null, convId: null };\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (download_url) {\r\n            // Check if file is restricted first\r\n            if (restricted_file) {\r\n                setCanDownload(false);\r\n                setVerificationStatus('denied');\r\n                setVerificationMessage(getRestrictionMessage(restricted_reason));\r\n                return;\r\n            }\r\n\r\n            // Extract file_id and conversation_id from download_url\r\n            const { fileId, convId } = extractIdsFromUrl(download_url);\r\n\r\n            if (fileId && convId) {\r\n                setExtractedFileId(fileId);\r\n                setExtractedConvId(convId);\r\n\r\n                // Check download policy (convert to number for comparison)\r\n                const policyValue = parseInt(download_policy, 10);\r\n                if (policyValue === 0 || !is_image) {\r\n                    // No verification needed - allow download immediately\r\n                    setCanDownload(true);\r\n                    setFinalDownloadUrl(download_url);\r\n                    setVerificationStatus('verified');\r\n                } else {\r\n                    // Verification needed for policy 1 or 2\r\n                    setCanDownload(false);\r\n                    setVerificationStatus('idle');\r\n                }\r\n            } else {\r\n                // Fallback to regular download_url if no pattern match\r\n                setCanDownload(true);\r\n                setFinalDownloadUrl(download_url);\r\n                setVerificationStatus('verified');\r\n            }\r\n        }\r\n\r\n        return () => {\r\n            clearCountdown();\r\n        };\r\n    }, [download_policy, download_url, restricted_file, restricted_reason]);\r\n\r\n    const clearCountdown = () => {\r\n        if (countdownInterval.current) {\r\n            clearInterval(countdownInterval.current);\r\n            countdownInterval.current = null;\r\n        }\r\n        setCountdownSeconds(0);\r\n    };\r\n\r\n    const handleButtonClick = (e) => {\r\n        e.preventDefault();\r\n        \r\n        // Check if file is restricted\r\n        if (restricted_file) {\r\n            return; // Do nothing for restricted files\r\n        }\r\n        \r\n        // If it's not an image or verification is not needed, proceed with download\r\n        if (!is_image || verificationStatus === 'verified') {\r\n            if (canDownload && finalDownloadUrl) {\r\n                if (download_modal && is_image) {\r\n                    lhc.revealModal({\r\n                        'title' : t('file.preview'),\r\n                        'url': finalDownloadUrl.replace('mailconv/inlinedownload/','mailconv/inlinedownloadmodal/')\r\n                    });\r\n                } else {\r\n                    window.open(finalDownloadUrl, '_blank');\r\n                }\r\n            }\r\n            return;\r\n        }\r\n\r\n        // For images that need verification, start the verification process\r\n        if (verificationStatus === 'idle' || verificationStatus === 'failed') {\r\n            startVerificationProcess(extractedFileId, extractedConvId);\r\n        }\r\n    };\r\n\r\n    const startVerificationProcess = (fileId, convId) => {\r\n        setVerificationAttempts(0);\r\n        setVerificationStatus('verifying');\r\n        setVerificationMessage(t('image.verifying_access'));\r\n\r\n        requestVerification(fileId, convId);\r\n    };\r\n\r\n    const requestVerification = (fileId, convId, currentAttempts = null) => {\r\n        const attempts = currentAttempts !== null ? currentAttempts : verificationAttempts;\r\n        \r\n        if (attempts >= maxVerificationAttempts) {\r\n            setVerificationStatus('failed');\r\n            setVerificationMessage(t('image.verification_failed'));\r\n            return;\r\n        }\r\n\r\n        const newAttempts = attempts + 1;\r\n        setVerificationAttempts(newAttempts);\r\n        \r\n        // Build verification URL using conversation ID\r\n        const verifyUrl = window.WWW_DIR_JAVASCRIPT + 'mailconv/verifyaccess/' + fileId + '/' + convId;\r\n        \r\n        // Make verification request\r\n        fetch(verifyUrl, {\r\n            method: 'GET',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n            }\r\n        })\r\n        .then(response => response.json())\r\n        .then(data => {\r\n            const policyValue = parseInt(download_policy, 10);\r\n            \r\n            if (data.verified === true) {\r\n                // Check if file has error message\r\n                if (data.error_msg) {\r\n                    setVerificationStatus('failed');\r\n                    setVerificationMessage(data.error_msg);\r\n                    clearCountdown();\r\n                } else {\r\n                    if (policyValue === 2 && (data.protection_image || data.protection_html)) {\r\n                        // Policy 2 with sensitive image - show access denied\r\n                        setVerificationStatus('denied');\r\n                        setVerificationMessage(t('image.access_denied'));\r\n                        clearCountdown();\r\n                    } else {\r\n                        // Verification successful - allow download\r\n                        setVerificationStatus('verified');\r\n                        setCanDownload(true);\r\n                        setFinalDownloadUrl(window.WWW_DIR_JAVASCRIPT + 'mailconv/inlinedownload/' + fileId + '/' + convId);\r\n\r\n                        setVerificationMessage('');\r\n                        clearCountdown();\r\n                        \r\n                        // Check if it's a sensitive image\r\n                        if (data.protection_image || data.protection_html) {\r\n                            setIsSensitiveImage(true);\r\n                            setButtonTitle(data.btn_title || '');\r\n                        } else {\r\n                            setIsSensitiveImage(false);\r\n                            setButtonTitle('');\r\n                        }\r\n                    }\r\n                }\r\n            } else {\r\n                // Verification not ready yet - schedule next attempt\r\n                if (newAttempts < maxVerificationAttempts) {\r\n                    scheduleNextVerification(newAttempts, fileId, convId);\r\n                } else {\r\n                    setVerificationStatus('failed');\r\n                    setVerificationMessage(t('image.verification_failed'));\r\n                }\r\n            }\r\n        })\r\n        .catch(error => {\r\n            console.error('Verification request failed:', error);\r\n            if (newAttempts < maxVerificationAttempts) {\r\n                scheduleNextVerification(newAttempts, fileId, convId);\r\n            } else {\r\n                setVerificationStatus('failed');\r\n                setVerificationMessage(t('image.verification_failed'));\r\n            }\r\n        });\r\n    };\r\n\r\n    const scheduleNextVerification = (attempts, fileId, convId) => {\r\n        const delaySeconds = 4;\r\n        setCountdownSeconds(delaySeconds);\r\n        \r\n        setVerificationMessage(`${t('image.verifying_access')} (${attempts}/${maxVerificationAttempts})`);\r\n        \r\n        // Start countdown\r\n        countdownInterval.current = setInterval(() => {\r\n            setCountdownSeconds(prev => {\r\n                if (prev <= 1) {\r\n                    clearInterval(countdownInterval.current);\r\n                    requestVerification(fileId, convId, attempts);\r\n                    return 0;\r\n                }\r\n                return prev - 1;\r\n            });\r\n        }, 1000);\r\n    };\r\n\r\n    const getButtonIcon = () => {\r\n        if (restricted_file) {\r\n            return 'lock';\r\n        }\r\n        \r\n        if (!is_image) {\r\n            return 'attach_file';\r\n        }\r\n\r\n        switch (verificationStatus) {\r\n            case 'verifying':\r\n                return 'hourglass_empty';\r\n            case 'verified':\r\n                return 'verified';\r\n            case 'failed':\r\n                return 'warning';\r\n            case 'denied':\r\n                return 'block';\r\n            default:\r\n                return 'image';\r\n        }\r\n    };\r\n\r\n    const getButtonClass = () => {\r\n        let baseClass = 'btn btn-sm me-1';\r\n        \r\n        if (restricted_file) {\r\n            return baseClass + ' btn-secondary';\r\n        }\r\n        \r\n        if (!is_image || verificationStatus === 'verified') {\r\n            return baseClass + ' btn-outline-info';\r\n        }\r\n\r\n        switch (verificationStatus) {\r\n            case 'verifying':\r\n                return baseClass + ' btn-warning';\r\n            case 'failed':\r\n                return baseClass + ' btn-danger';\r\n            case 'denied':\r\n                return baseClass + ' btn-danger';\r\n            default:\r\n                return baseClass + ' btn-outline-info';\r\n        }\r\n    };\r\n\r\n    const getButtonTitle = () => {\r\n        if (restricted_file) {\r\n            return getRestrictionMessage(restricted_reason);\r\n        }\r\n        \r\n        if (!is_image) {\r\n            return description || name;\r\n        }\r\n\r\n        switch (verificationStatus) {\r\n            case 'verifying':\r\n                return verificationMessage + (countdownSeconds > 0 ? ` (${countdownSeconds}s)` : '');\r\n            case 'verified':\r\n                return description || name;\r\n            case 'failed':\r\n                return verificationMessage;\r\n            case 'denied':\r\n                return verificationMessage;\r\n            default:\r\n                return description || name;\r\n        }\r\n    };\r\n\r\n    const getButtonText = () => {\r\n        if (restricted_file) {\r\n            return `${name} -  ` + getRestrictionMessage(restricted_reason);\r\n        }\r\n\r\n        if (verificationStatus === 'verifying' && verificationAttempts <= 1 && countdownSeconds === 0) {\r\n            return `${name} ${t('image.downloading')}`;\r\n        }\r\n\r\n        if (verificationStatus === 'verifying' && countdownSeconds > 0) {\r\n            return `${name} (${countdownSeconds}s)`;\r\n        }\r\n\r\n        if (is_image && verificationStatus === 'verified') {\r\n            if (isSensitiveImage && buttonTitle) {\r\n                return `${name} -  ${buttonTitle}`;\r\n            } else {\r\n                return `${name} -  ${t('image.click_to_download')}`;\r\n            }\r\n        }\r\n\r\n        if (is_image && verificationStatus === 'failed') {\r\n            return `${name} -  ${verificationMessage}`;\r\n        }\r\n\r\n\r\n        return name;\r\n    };\r\n\r\n    const isDisabled = () => {\r\n        return restricted_file ||\r\n               (is_image && verificationStatus === 'verifying') || \r\n               (is_image && verificationStatus === 'denied') ||\r\n               (is_image && verificationStatus === 'failed');\r\n    };\r\n\r\n    return (\r\n        <button\r\n            className={getButtonClass()}\r\n            onClick={handleButtonClick}\r\n            title={getButtonTitle()}\r\n            disabled={isDisabled()}\r\n            {...props}\r\n        >\r\n            <i className=\"material-icons me-1 fs14\" >\r\n                {getButtonIcon()}\r\n            </i>\r\n            {getButtonText()}\r\n        </button>\r\n    );\r\n};\r\n\r\nexport default React.memo(MailChatAttachment);\r\n","import parse, { domToReact } from 'html-react-parser';\nimport React, { useState } from \"react\";\nimport MailChatQuote from \"./MailChatQuote\";\nimport MailChatReply from \"./MailChatReply\";\nimport MailChatImage from \"./MailChatImage\";\nimport MailChatAttachment from \"./MailChatAttachment\";\nimport {useTranslation} from 'react-i18next';\nimport axios from \"axios\";\n\nconst MailChatMessage = ({message, index, totalMessages, noReplyRequired, mode, addLabel, moptions, fetchMessages, fetchingMessages, verifyOwner, setConversationStatus, updateMessages, loadMessageBody, keyword}) => {\n\n    const [expandingBody, setExpandingBody] = useState(false);\n    const [expandHeader, setExpandHeader] = useState(false);\n    const [expandBody, setExpandBody] = useState(false);\n    const [plainBody, setPlainBody] = useState(!!message.undelivered);\n    const [replyMode, setReplyMode] = useState(false);\n    const [forwardMode, setForwardMode] = useState(false);\n    const [expandDeliveryInformation, setExpandDeliveryInformation] = useState(false);\n\n    const formatStringToCamelCase = str => {\n        const splitted = str.split(\"-\");\n        if (splitted.length === 1) return splitted[0];\n        return (\n            splitted[0] +\n            splitted\n                .slice(1)\n                .map(word => word[0].toUpperCase() + word.slice(1))\n                .join(\"\")\n        );\n    };\n\n    const getStyleObjectFromString = str => {\n        const style = {};\n        str.split(\";\").forEach(el => {\n            const [property, value] = el.split(\":\");\n            if (!property) return;\n\n            const formattedProperty = formatStringToCamelCase(property.trim());\n            style[formattedProperty] = value.trim();\n        });\n\n        return style;\n    };\n\n    const processRestAPIError = (err) => {\n        if (!!err.isAxiosError && !err.response) {\n            alert(t('system.error'));\n        } else {\n            if (err.response.data.error) {\n                alert(err.response.data.error);\n            } else {\n                alert(JSON.stringify(err.response.data));\n            }\n        }\n    }\n\n    const unMerge = message => {\n        if (confirm(t('status.are_you_sure'))) {\n            axios.post(WWW_DIR_JAVASCRIPT  + \"mailconv/apiunmerge/\" + message.id + \"/\" + message.conversation_id).then(result => {\n                updateMessages();\n            }).catch((error) => processRestAPIError(error));\n        }\n    }\n\n    if (fetchingMessages == true && (replyMode == true || forwardMode == true)) {\n        setReplyMode(false);\n        setForwardMode(false);\n    }\n\n    const loadAndExpand = expandAction => {\n        setExpandBody(expandAction);\n        if (expandAction == true && typeof message.body_front === 'undefined' && typeof message.alt_body === 'undefined') {\n            setExpandingBody(true);\n            axios.post(WWW_DIR_JAVASCRIPT  + \"mailconv/loadmessagebody/\" + message.id + \"/\" + message.conversation_id, {keyword: keyword}).then(result => {\n                loadMessageBody(result.data);\n                setExpandingBody(false);\n            }).catch((error) => {\n\n            });\n        }\n    }\n\n    if (index + 1 == totalMessages && expandBody === false && expandingBody === false || (expandingBody === false && expandBody === true && typeof message.body_front === 'undefined' && typeof message.alt_body === 'undefined')) {\n        loadAndExpand(true);\n    }\n\n    const { t, i18n } = useTranslation('mail_chat');\n\n    return <div className={\"row pb-2 mb-2 border-secondary\" + (mode !== 'preview' ? ' border-top pt-2' : ' border-bottom')}>\n        <div className=\"col-7 action-image\" onClick={() => loadAndExpand(!expandBody)}>\n            <span title={\"Expand message \" + message.id} ><i className=\"material-icons\">{expandBody ? 'expand_less' : 'expand_more'}</i></span>\n            <b>{message.from_name}</b>\n            <small>&nbsp;&lt;{message.from_address}&gt;&nbsp;</small>\n            {message.opened_at && <span className=\"material-icons text-success\" title={message.opened_at_front}>visibility</span>}\n            <span className={\"material-icons \" + (message.is_external ? 'chat-pending' : 'chat-active')} title={message.is_external ? t('msg.external_email') : t('msg.internal_email')} >{message.is_external ? 'location_away' : 'location_home'}</span>\n                <small className={!message.status || message.status == 1 ? 'chat-pending' : (message.cls_time ? 'chat-closed' : 'chat-active')}>\n                <i className=\"material-icons\">mail_outline</i>\n                {!message.status || message.status == 1 ?  t('msg.pnd_rsp') : t('msg.rsp')}\n            </small>\n            {message.conversation_id_old && <small className=\"text-muted\" title={t('msg.merged_message')} ><span className=\"material-icons me-0\">merge_type</span>{message.conversation_id_old}</small>}\n        </div>\n        <div className=\"col-5 text-end text-muted\">\n            <small className=\"pe-1\">\n                {message.subjects && message.subjects.map((label, index) => (\n                        <span className=\"badge me-1\" style={{'background-color': label.color ? '#'+label.color : '#0dcaf0'}}>{label.name}</span>\n                    ))}\n                {mode !== 'preview' && moptions.can_write && <React.Fragment><i title={t('msg.ar_label')} onClick={() => addLabel(message)} className=\"material-icons action-image text-muted\">label</i> |</React.Fragment>}\n            </small>\n            <small className=\"pe-2\">{message.opened_at && <span className=\"material-icons\" title={t('msg.opened_at_message') + message.opened_at_front}>visibility</span>}{message.udate_front} | {message.udate_ago} {t('msg.ago')}.</small>\n            {mode !== 'preview' && moptions.can_write && <i onClick={(e) => {e.stopPropagation();setForwardMode(false);setReplyMode(true)}} className=\"material-icons settings text-muted\">reply</i>}\n\n            <i onClick={(e) => {e.stopPropagation(); setExpandHeader(!expandHeader)}} className=\"material-icons settings text-muted\">{expandHeader ? 'expand_less' : 'expand_more'}</i>\n\n            {mode !== 'preview' && <div className=\"dropdown float-end\">\n                <i className=\"material-icons settings text-muted\" id={\"message-id-\"+message.id} data-bs-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">more_vert</i>\n                <div className=\"dropdown-menu\" aria-labelledby={\"message-id-\"+message.id}>\n                    {moptions.can_write && <a className=\"dropdown-item\" href=\"#\" onClick={(e) => {e.stopPropagation();setForwardMode(false);setReplyMode(true)}}><i className=\"material-icons text-muted\" >reply</i>{t('msg.reply')}</a>}\n                    {moptions.can_write && moptions.can_forward && <a className=\"dropdown-item\" href=\"#\" onClick={(e) => {e.stopPropagation();setReplyMode(false);setForwardMode(true)}}><i className=\"material-icons text-muted\">forward</i>{t('msg.forward')}</a>}\n                    {message.conversation_id_old && <a className=\"dropdown-item\" href=\"#\" onClick={(e) => {e.stopPropagation();unMerge(message);}} ><i className=\"material-icons\">alt_route</i>{t('msg.unmerge')}</a>}\n                    <a className=\"dropdown-item\" target=\"_blank\" href={WWW_DIR_JAVASCRIPT  + \"mailconv/mailprint/\" + message.id + \"/\" + message.conversation_id} ><i className=\"material-icons text-muted\">print</i>{t('mail.print')}</a>\n                    {moptions.can_download && <a className=\"dropdown-item\" href={WWW_DIR_JAVASCRIPT  + \"mailconv/apimaildownload/\" + message.id + \"/\" + message.conversation_id} ><i className=\"material-icons text-muted\">cloud_download</i>{t('msg.download')}</a>}\n                    {moptions.mail_links && moptions.mail_links.map((link, index) => <a className=\"dropdown-item\" target=\"_blank\" href={link.link.replace('{msg_id}',message.id)}>{link.icon && <i className=\"material-icons text-muted\">{link.icon}</i>}{link.title}</a>)}\n                    {moptions.can_write && <a className=\"dropdown-item\" href=\"#\" onClick={() => noReplyRequired(message)}><i className=\"material-icons text-muted\">done</i>{t('msg.no_reply')}</a>}\n                    {message.alt_body && <a className=\"dropdown-item\" href=\"#\" onClick={(e) => setPlainBody(!plainBody)}><i className=\"material-icons text-muted\">visibility</i>{t('msg.plain_html')}</a>}\n                </div>\n            </div>}\n        </div>\n\n        {expandHeader && <div className=\"col-12\">\n\n            <div className=\"card\">\n                <div className=\"card-body\">\n                    <h6 className=\"card-subtitle mb-2 text-muted\">{t('msg.info')}</h6>\n\n                    <div className=\"row\">\n                        <div className=\"col-12 fs13\">\n                            <strong>{t('mail.subject')}:</strong> <span className=\"text-muted\">{message.subject}</span>\n                        </div>\n                        <div className=\"col-6\">\n                            <ul className=\"fs13 mb-0 list-unstyled\">\n                                <li>\n                                    <span className=\"text-muted\">{t('msg.from')}:</span> <b>{message.from_name}</b> &lt;{message.from_address}&gt;\n                                </li>\n                                <li>\n                                    <span className=\"text-muted\">{t('msg.to')}:</span> {message.to_data_front}\n                                </li>\n                                {message.cc_data_front && <li>\n                                    <span className=\"text-muted\">cc:</span> {message.cc_data_front}\n                                </li>}\n                                <li>\n                                    <span className=\"text-muted\">id:</span> {message.message_id}\n                                </li>\n                                {message.bcc_data_front && <li>\n                                    <span className=\"text-muted\">bcc:</span> {message.bcc_data_front}\n                                </li>}\n                                <li>\n                                    <span className=\"text-muted\">{t('msg.reply_to')}:</span> {message.reply_to_data_front}\n                                </li>\n                                <li>\n                                    <span className=\"text-muted\">{t('msg.mailed_by')}:</span> {message.from_host}\n                                </li>\n                            </ul>\n                        </div>\n                        <div className=\"col-6\">\n                            <ul className=\"fs13 mb-0 list-unstyled\">\n                                {message.accept_time_front && <li>{t('mail.accepted_at')}: {message.accept_time_front}</li>}\n                                {message.plain_user_name && <li data-id={message.user_id} >{t('mail.accepted_by')}: <b>{message.plain_user_name}</b></li>}\n                                {message.wait_time && <li>{t('mail.accept_wait_time')}: {message.wait_time_pending}</li>}\n                                {message.lr_time && message.response_time && <li>{t('mail.response_wait_time')}: {message.wait_time_response}, {t('mail.exc_pending_time')}</li>}\n                                <li data-id={message.response_type}>{t('mail.rsp_type')}: {message.response_type == 1 ? t('msg.nrr') : (message.response_type == 2 ? t('msg.orm') : (message.response_type == 3 ? t('msg.rbe') : t('msg.unr')))}</li>\n                                {message.interaction_time && <li>{t('mail.interaction_time')}: {message.interaction_time_duration}</li>}\n                                {message.cls_time && <li>{t('mail.closed_at')}: {message.cls_time_front}</li>}\n                                {message.conv_duration_front && <li>{t('mail.response_wait_time')}: {message.conv_duration_front}</li>}\n                                <li>{t('mail.message_id')}: {message.id}</li>\n                            </ul>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>}\n\n        {expandBody && message.undelivered && <div className=\"col-12 alert alert-warning mt-2\">\n            This message was undelivered. {message.rfc822_body && <a href={WWW_DIR_JAVASCRIPT  + \"mailconv/downloadrfc822/\" + message.id + \"/\" + message.conversation_id}>Download sent message.</a>}\n\n            {message.delivery_status_keyed && <div className=\"text-danger border-bottom my-2 py-2 fs13\">\n                <ul className=\"m-0 ps-3\">\n                {message.delivery_status_keyed.Diagnostic_Code && <li>{message.delivery_status_keyed.Diagnostic_Code}</li>}\n                {message.delivery_status_keyed.taken && <li>{message.delivery_status_keyed.taken}</li>}\n                </ul>\n            </div>}\n\n            {message.delivery_status_keyed && <button onClick={(e) => setExpandDeliveryInformation(!expandDeliveryInformation)} className=\"btn fs12 btn-link\">Show technical information.</button>}\n\n            {expandDeliveryInformation && message.delivery_status_keyed && <div>\n\n                <pre>{JSON.stringify(message.delivery_status_keyed, null, 2)}</pre>\n            </div>}\n        </div>}\n\n        {expandBody && plainBody && message.alt_body && <div className=\"col-12 mail-message-body pt-2 pb-2\">\n            <pre className=\"fs12\">{message.alt_body}</pre>\n        </div>}\n\n        {expandBody && message.body_front && !plainBody && <div className=\"col-12 mail-message-body pt-2 pb-2\">\n         {parse(\"<div>\"+message.body_front+\"</div>\", {\n            replace: domNode => {\n                if (domNode.attribs) {\n\n                    var cloneAttr = Object.assign({}, domNode.attribs);\n\n                    if (domNode.attribs.class) {\n                        domNode.attribs.className = domNode.attribs.class;\n                        delete domNode.attribs.class;\n                    }\n\n                    if (domNode.name && domNode.name === 'img') {\n                        if (domNode.attribs.style) {\n                            domNode.attribs.style = getStyleObjectFromString(domNode.attribs.style);\n                        }\n                        \n                        return <MailChatImage \n                            download_policy={moptions.download_policy}\n                            src={domNode.attribs.src}\n                            alt={domNode.attribs.alt}\n                            title={domNode.attribs.title}\n                            className={domNode.attribs.className}\n                            style={domNode.attribs.style}\n                            {...domNode.attribs}\n                        />;\n                    }\n\n                    if (domNode.name && domNode.name === 'blockquote') {\n                        if (domNode.attribs.style) {\n                            domNode.attribs.style = getStyleObjectFromString(domNode.attribs.style);\n                        }\n\n                        return <blockquote {...domNode.attribs}><MailChatQuote>{domToReact(domNode.children, {\n                            replace: domNode => {\n                                if (domNode.attribs) {\n                                    if (domNode.attribs.class) {\n                                        domNode.attribs.className = domNode.attribs.class;\n                                        delete domNode.attribs.class;\n                                    }\n\n                                    if (domNode.name && domNode.name === 'img') {\n                                        if (domNode.attribs.style) {\n                                            domNode.attribs.style = getStyleObjectFromString(domNode.attribs.style);\n                                        }\n                                        \n                                        return <MailChatImage \n                                            download_policy={moptions.download_policy}\n                                            src={domNode.attribs.src}\n                                            alt={domNode.attribs.alt}\n                                            title={domNode.attribs.title}\n                                            className={domNode.attribs.className}\n                                            style={domNode.attribs.style}\n                                            {...domNode.attribs}\n                                        />;\n                                    }\n                                }\n                            }\n                        })}</MailChatQuote></blockquote>\n                    }\n                }\n            }\n    })}\n    </div>}\n\n        {expandBody && message.attachments && message.attachments.length > 0 &&\n            <div className=\"pb-2 col-12\">\n                {message.attachments.map((file) => (\n                \n                <MailChatAttachment\n                    key={file.id}\n                    id={file.id}\n                    name={file.name}\n                    description={file.description}\n                    download_url={file.download_url}\n                    is_image={file.is_image}\n                    download_policy={moptions.download_policy}\n                    restricted_file={file.restricted_file}\n                    restricted_reason={file.restricted_reason}\n                    download_modal={moptions.download_modal}\n                />\n\n            ))}</div>\n        }\n\n\n        {mode !== 'preview' && moptions.can_write && !fetchingMessages && ((index + 1 == totalMessages) || replyMode || forwardMode) && <MailChatReply setConversationStatus={setConversationStatus} verifyOwner={verifyOwner} fetchingMessages={fetchingMessages} fetchMessages={(e) => fetchMessages()} moptions={moptions} forwardMode={forwardMode} cancelForward={(e) => setForwardMode(false)} cancelReply={(e) => setReplyMode(false)} replyMode={replyMode} lastMessage={index + 1 == totalMessages} message={message} noReplyRequired={() => noReplyRequired(message)} />}\n\n    </div>\n}\n\nexport default React.memo(MailChatMessage);","import React, { useEffect, useState, useReducer, useRef } from \"react\";\nimport axios from \"axios\";\nimport {useTranslation} from 'react-i18next';\nimport MailChatMessage from \"./parts_mail/MailChatMessage\";\n\naxios.defaults.headers.common['X-CSRFToken'] = confLH.csrf_token;\n\nfunction reducer(state, action) {\n    switch (action.type) {\n        case 'increment':\n            return {count: state.count + 1};\n        case 'decrement':\n            return {count: state.count - 1};\n        case 'update': {\n            return { ...state, ...action.value }\n        }\n        case 'update_conversation': {\n            state.conv = { ...state.conv, ...action.value };\n            return { ... state};\n        }\n        case 'update_subjects': {\n            var foundIndex = state.messages.findIndex(x => x.id == action.message_id);\n            state.messages[foundIndex].subjects = action.subjects;\n            state = { ... state};\n            return state;\n        }\n        case 'update_message': {\n            var foundIndex = state.messages.findIndex(x => x.id == action.message.id);\n            state.messages[foundIndex] = action.message;\n\n            if (action.conv) {\n                state.conv = action.conv;\n            }\n\n            if (action.fetching_messages) {\n                state.fetching_messages = action.fetching_messages;\n            }\n\n            state = { ... state};\n\n            return state;\n        }\n\n        case 'update_watching_ops': {\n            var foundIndex = state.op_watching.findIndex(x => x.user_id == action.watcher.user_id);\n            if (action.watcher.status === true) {\n                if (foundIndex === -1) {\n                    if (confLH.user_id != action.watcher.user_id) {\n                        action.watcher.ts = Math.floor(Date.now() / 1000);\n                        state.op_watching.push(action.watcher);\n                    }\n                } else {\n                    state.op_watching[foundIndex].ts = Math.floor(Date.now() / 1000);\n                }\n            } else if (action.watcher.status === false && foundIndex !== -1) {\n                state.op_watching.splice(foundIndex,1);\n            }\n\n            state.op_watching.forEach((element,index) => {\n                if (element.ts < Math.floor(Date.now() / 1000) - 15) {\n                    state.op_watching.splice(index,1);\n                }\n            });\n\n            return { ...state};\n        }\n\n        case 'update_history': {\n            state = { ...state, ...action.value };\n            if (action.history.msg != '') {\n                state.messages.unshift(action.history);\n            }\n            return state;\n        }\n        case 'init':\n            return {count: state.count - 1};\n        default:\n            throw new Error('Unknown action!');\n    }\n}\n\nconst MailChat = props => {\n\n    const messageElement = useRef(null);\n    const messagesElement = useRef(null);\n    const tabsContainer = useRef(null);\n\n    const [state, dispatch] = useReducer(reducer, {\n        messages: [],\n        operators: [],\n        op_watching: [],\n        conv: null,\n        loaded: false,\n        saving_remarks: false,\n        close_mode: false,\n        old_message_id: 0,\n        last_message: '',\n        remarks: '',\n        last_message_id: 0,\n        lmsop: 0,\n        lgsync: 0,\n        fetching_messages: false,\n        expand_messages: false\n    });\n\n    const rememberChat = (chatId) => {\n        if (localStorage) {\n            try {\n                var achat_id_array = [];\n                var achat_id = localStorage.getItem('machat_id');\n\n                if (achat_id !== null && achat_id !== '') {\n                    achat_id_array = achat_id.split(',');\n                }\n\n                if (achat_id_array.indexOf(chatId) === -1){\n                    achat_id_array.push(chatId);\n                    localStorage.setItem('machat_id',achat_id_array.join(','));\n                }\n\n            } catch(e) {\n\n            }\n        }\n    }\n\n    const processRestAPIError = (err) => {\n        if (!!err.isAxiosError && !err.response) {\n            alert(t('system.error'));\n        } else {\n            if (err.response.data.error) {\n                alert(err.response.data.error);\n            } else {\n                alert(JSON.stringify(err.response.data));\n            }\n        }\n    }\n\n    const changeStatus = (e) => {\n        if (confirm(t('status.are_you_sure'))) {\n            axios.post(WWW_DIR_JAVASCRIPT  + \"mailconv/apichangestatus/\" + state.conv.id + '/' + e.target.value).then(result => {\n                dispatch({\n                    type: 'update',\n                    value: {\n                        'conv': result.data.conv,\n                    }\n                });\n            }).catch((error) => processRestAPIError(error));\n        }\n    }\n\n    const deleteConversation = () => {\n        if (confirm('Are you sure?')) {\n            axios.post(WWW_DIR_JAVASCRIPT  + \"mailconv/apideleteconversation/\" + state.conv.id).then(result => {\n                // If we are in the tab close tab also\n                if (document.getElementById('chat-tab-link-mc'+state.conv.id)) {\n                    lhinst.removeDialogTabMail('mc'+state.conv.id,$('#tabs'),true);\n                } else {\n                    document.location = WWW_DIR_JAVASCRIPT + \"mailconv/conversations\";\n                }\n            }).catch((error) => {\n\n            });\n        }\n    }\n\n    const closeConversation = () => {\n        let hasUnrespondedMessages = false;\n        state.messages.forEach((message) => {\n            if (message.status != 2) {\n                hasUnrespondedMessages = true;\n            }\n        });\n\n        if (hasUnrespondedMessages == false || confirm(t('status.unresponded_messages'))) {\n            axios.post(WWW_DIR_JAVASCRIPT  + \"mailconv/apicloseconversation/\" + state.conv.id).then(result => {\n                dispatch({\n                    type: 'update',\n                    value: {\n                        'conv': result.data.conv,\n                        'messages' : result.data.messages\n                    }\n                });\n\n                // If we are in the tab close tab also\n                if (document.getElementById('chat-tab-link-mc'+state.conv.id)) {\n                    lhinst.removeDialogTabMail('mc'+state.conv.id,$('#tabs'),true);\n                }\n\n            }).catch((error) => {\n\n            });\n        }\n    }\n\n    const noReplyRequired = (message) => {\n        axios.post(WWW_DIR_JAVASCRIPT  + \"mailconv/apinoreplyrequired/\" + message.id + \"/\" + message.conversation_id).then(result => {\n            dispatch({\n                type: 'update_message',\n                message: result.data.message,\n                conv: result.data.conv\n            });\n        }).catch((error) => {\n\n        });\n    }\n\n    const loadMessageBody = (message, data) => {\n        dispatch({\n            type: 'update_message',\n            message: data.message,\n            conv: data.conv\n        });\n    }\n\n    const addLabel = (message) => {\n        lhc.revealModal({'url':WWW_DIR_JAVASCRIPT + \"mailconv/apilabelmessage/\" + message.id + \"/\" + message.conversation_id,hidecallback : () => {\n            updateLabels(message);\n        }});\n    }\n\n    const updateLabels = (message) => {\n        axios.get(WWW_DIR_JAVASCRIPT  + \"mailconv/apigetlabels/\" + message.id + \"/\" + message.conversation_id).then(result => {\n            dispatch({\n                type: 'update_subjects',\n                message_id: message.id,\n                subjects: result.data\n            });\n        }).catch((error) => {\n\n        });\n    }\n\n    const verifyOwner = (userId) => {\n        if (userId != state.conv.user_id) {\n            loadMainData();\n        }\n    }\n\n    const loadMainData = () => {\n        axios.post(WWW_DIR_JAVASCRIPT  + \"mailconv/loadmainconv/\" + props.chatId + '/(mode)/' + (props.mode != '' ? props.mode : 'normal'),{keyword: props.keyword}).then(result => {\n            dispatch({\n                type: 'update',\n                value: {\n                    'conv': result.data.conv,\n                    'customer_remarks': result.data.customer_remarks,\n                    'messages' : result.data.messages,\n                    'moptions' : result.data.moptions,\n                    'loaded' : true,\n                    'fetching_messages' : false,\n                }\n            });\n\n            if (props.disableRemember === false && props.mode !== 'preview') {\n                rememberChat(props.chatId);\n            }\n\n            if (props.mode !== 'preview' && result.data.conv.pending_sync) {\n                fetchMessages();\n            }\n\n        }).catch((error) => {\n            lhinst.removeDialogTabMail('mc'+ props.chatId,$('#tabs'),true);\n        });\n    }\n\n    const fetchMessages = (message) => {\n        // Reset previous state\n        dispatch({\n            type: 'update',\n            value: {\n                'fetching_messages': true\n            }\n        });\n\n        fetchUntillUpdate(Math.floor(Date.now() / 1000));\n    }\n\n    const fetchUntillUpdate = (ts) => {\n        axios.get(WWW_DIR_JAVASCRIPT  + \"mailconv/apifetchmails/\" + props.chatId + '/' + ts).then(result => {\n            if (result.data.updated == true) {\n                loadMainData();\n            } else {\n                // Todo handle cleanup\n                setTimeout(() => fetchUntillUpdate(ts),3000);\n            }\n        });\n    }\n\n    const showModal = (params) => {\n        lhc.revealModal({'url':WWW_DIR_JAVASCRIPT + params.url});\n    }\n\n    useEffect(() => {\n        if (state.conv !== null) {\n            const timeout = setTimeout(() => {\n                axios.post(WWW_DIR_JAVASCRIPT  + \"mailconv/saveremarks/\" + props.chatId, {data: state.remarks}).then(result => {\n                    dispatch({\n                        type: 'update',\n                        value: {\n                            'saving_remarks': false\n                        }\n                    });\n                });\n            }, 500);\n            return () => clearTimeout(timeout);\n        }\n    },[state.remarks]);\n\n    useEffect(() => {\n        if (state.conv !== null) {\n            const timeout = setTimeout(() => {\n                axios.post(WWW_DIR_JAVASCRIPT  + \"mailconv/saveremarks/\" + props.chatId + '/(type)/customer', {data: state.customer_remarks}).then(result => {\n                    dispatch({\n                        type: 'update',\n                        value: {\n                            'saving_customer_remarks': false\n                        }\n                    });\n                });\n            }, 500);\n            return () => clearTimeout(timeout);\n        }\n    },[state.customer_remarks]);\n\n    const saveRemarks = (params) => {\n        dispatch({\n            type: 'update',\n            value: {\n                'saving_remarks': true,\n                'remarks': params\n            }\n        });\n    }\n\n    const saveCustomerRemarks = (params) => {\n        dispatch({\n            type: 'update',\n            value: {\n                'saving_customer_remarks': true,\n                'customer_remarks': params\n            }\n        });\n    }\n\n    const forgetChat = (chatId) => {\n        if (localStorage) {\n            try {\n                var achat_id_array = [];\n                var achat_id = localStorage.getItem('machat_id');\n\n                if (achat_id !== null && achat_id !== '') {\n                    achat_id_array = achat_id.split(',');\n                }\n\n                if (achat_id_array.indexOf(chatId) !== -1) {\n                    achat_id_array.splice(achat_id_array.indexOf(chatId),1);\n                }\n\n                localStorage.setItem('machat_id',achat_id_array.join(','));\n            } catch(e) {\n\n            }\n        }\n    }\n\n    const addOpWatching = (watcher) => {\n        dispatch({\n            type: 'update_watching_ops',\n            watcher: watcher\n        });\n    }\n\n    const setConversationStatus = (status) => {\n        dispatch({\n            type: 'update_conversation',\n            value: {\n                'status' : status\n            }\n        });\n    }\n\n    useEffect(() => {\n        loadMainData();\n\n        function mailChatModified(chatId) {\n            if (props.chatId == chatId) {\n                loadMainData();\n            }\n        }\n\n        function mailLabelsModified(chatId, messageId) {\n            if (props.chatId == chatId) {\n                updateLabels({\"id\": messageId});\n            }\n        }\n\n        function mailOpWatching(mail) {\n            if (props.chatId == mail.id) {\n                addOpWatching(mail);\n            }\n        }\n\n        ee.addListener('mailChatModified', mailChatModified);\n        ee.addListener('mailLabelsModified', mailLabelsModified);\n        ee.addListener('mailMerged', mailChatModified);\n        ee.addListener('mail.op_watching', mailOpWatching);\n\n        return function cleanup() {\n           ee.removeListener('mailChatModified', mailChatModified);\n           ee.removeListener('mailLabelsModified', mailLabelsModified);\n           ee.removeListener('mail.op_watching', mailOpWatching);\n           ee.emitEvent('mailChatContentUnLoaded', [props.chatId]);\n           forgetChat(props.chatId)\n        };\n    },[]);\n\n    useEffect(() => {\n        if (state.loaded == true) {\n            var container = tabsContainer.current;\n            ee.emitEvent('mailChatContentLoaded', [props.chatId]);\n        }\n    },[state.loaded]);\n\n    const { t, i18n } = useTranslation('mail_chat');\n\n    if (state.loaded == false) {\n        return <span>...</span>\n    }\n\n    return (\n        <React.Fragment>\n            <div className=\"row\">\n                <div className={\"chat-main-left-column \" + (props.mode == 'preview' ? 'col-12' : 'col-7')}>\n\n                    {props.mode !== 'preview' && <h1 className=\"pb-2\">\n                        <i className=\"material-icons\">{state.conv.start_type == 1 ? 'call_made' : 'call_received'}</i>{state.conv.undelivered && <i title=\"Undelivered e-mail\" className=\"text-danger material-icons\">sms_failed</i>}{state.conv.subject}\n                    </h1>}\n\n                    <div>\n                        {state.messages.map((message, index) => {\n                            if (state.expand_messages == true ||            // Render all if requested\n                            state.messages.length < 5 ||                    // Render all if less than 5\n                            index == 0 ||                                   // Render first\n                            state.messages.length == (index + 1) ||         // Render last one\n                            state.messages.length - 2 == index) {           // Render before last one\n                                    return <React.Fragment key={'msg-mail-hold-' + props.chatId + '_' + index + '_' + message.id}>{state.expand_messages == false && state.messages.length >= 5 && state.messages.length - 2 == index && <div className=\"previous-mails-row\" onClick={() => dispatch({type: 'update',value: {'expand_messages': true}})} ><span className=\"previous-number\" title={t('mail.previous_messages')}>{state.messages.length - 3}</span></div>}<MailChatMessage setConversationStatus={(e) => setConversationStatus(e)}\n                                                            verifyOwner={(e) => verifyOwner(e)} moptions={state.moptions}\n                                                            fetchMessages={(e) => fetchMessages(message)}\n                                                            fetchingMessages={state.fetching_messages} mode={props.mode}\n                                                            key={'msg_mail_' + props.chatId + '_' + index + '_' + message.id}\n                                                            totalMessages={state.messages.length} index={index} message={message}\n                                                            noReplyRequired={(e) => noReplyRequired(message)}\n                                                            addLabel={(e) => addLabel(message)}\n                                                            updateMessages={(e) => loadMainData()}\n                                                            keyword={props.keyword}\n                                                            loadMessageBody={(data) => loadMessageBody(message, data)}/></React.Fragment>;\n                            }\n                        })}\n\n                        {state.fetching_messages && <div className=\"alert alert-success p-1 ps-2\" role=\"alert\">{t('mail.send_fetching')}</div>}\n                    </div>\n                </div>\n                <div className={\"chat-main-right-column \" + (props.mode == 'preview' ? 'd-none' : 'col-5')}>\n                    <div role=\"tabpanel\">\n                        <ul className=\"nav nav-pills\" role=\"tablist\" ref={tabsContainer}>\n                            <li role=\"presentation\" className=\"nav-item\"><a className=\"nav-link active\" href={\"#mail-chat-info-\"+props.chatId} aria-controls={\"#mail-chat-info-\"+props.chatId} title={t('mail.information')} role=\"tab\" data-bs-toggle=\"tab\"><i className=\"material-icons me-0\">info_outline</i></a></li>\n                            <li role=\"presentation\" className=\"nav-item\"><a className=\"nav-link\" href={\"#mail-chat-remarks-\"+props.chatId} aria-controls={\"#mail-chat-remarks-\"+props.chatId} role=\"tab\" data-bs-toggle=\"tab\" title={t('mail.remarks')}><i className=\"material-icons me-0\">mode_edit</i></a></li>\n                        </ul>\n                        <div className=\"tab-content\">\n                            <div role=\"tabpanel\" className=\"tab-pane\" id={\"mail-chat-remarks-\"+props.chatId}>\n\n                                <div className={\"pb-1 text-success\" + (state.saving_customer_remarks ? ' text-warning' : '')}><span className=\"material-icons\">mode_edit</span> Customer remarks</div>\n                                <div>\n                                    <textarea disabled={!state.moptions.can_write} placeholder=\"Enter your remarks here.\" onKeyUp={(e) => saveCustomerRemarks(e.target.value)} className=\"form-control mh150\" defaultValue={state.customer_remarks}></textarea>\n                                </div>\n\n                                <div className={\"pb-1 text-success\" + (state.saving_remarks ? ' text-warning' : '')}><span className=\"material-icons\">mode_edit</span> Conversation remarks</div>\n                                <div>\n                                    {state.conv && <textarea disabled={!state.moptions.can_write} placeholder=\"Enter your remarks here.\" onKeyUp={(e) => saveRemarks(e.target.value)} className=\"form-control mh150\" defaultValue={state.conv.remarks}></textarea>}\n                                </div>\n\n                            </div>\n                            <div role=\"tabpanel\" className=\"tab-pane active\" id={\"mail-chat-info-\"+props.chatId}>\n\n                                {state.moptions.can_close && <div className=\"pb-2\">\n\n                                    {state.close_mode == false && <a className=\"btn btn-outline-secondary btn-sm\" onClick={() => dispatch({type: 'update',value: {'close_mode': true}})}><i className=\"material-icons\">close</i>{t('mail.close')}</a>}\n\n                                    {state.close_mode == true && <p className=\"fs14 mb-2\">{t('mail.sure_close')}</p>}\n\n                                    {state.close_mode == true && <div className=\"btn-group\">\n                                            <button type=\"button\" className=\"btn btn-danger btn-sm\" onClick={() => closeConversation()}>{t('mail.yes')}</button>\n                                            <button type=\"button\" className=\"btn btn-success btn-sm\" onClick={() => dispatch({type: 'update',value: {'close_mode': false}})}>{t('mail.no')}</button>\n                                        </div>}\n\n                                </div>}\n\n                                <div id={\"mail-external-details-\"+props.chatId}></div>\n\n                                {state.conv && <table className=\"table table-sm\">\n                                    <tbody>\n                                    <tr>\n                                        <td colSpan=\"2\">\n\n                                            <div className=\"row\">\n                                                <div className=\"col-6\">\n                                                    <span className=\"action-image\" onClick={() => showModal({url: \"mailconv/mailhistory/\" + props.chatId})}><i className=\"material-icons\">history</i>{t('mail.interactions_history')}</span>\n                                                </div>\n                                                {state.moptions.can_write && <div className=\"col-6\">\n                                                    <span className=\"action-image\" onClick={() => showModal({url: \"mailconv/transfermail/\" + props.chatId})}><i className=\"material-icons\">supervisor_account</i>{t('mail.transfer_chat')}</span>\n                                                </div>}\n                                                {state.moptions.can_write && <div className=\"col-6\">\n                                                    <span className=\"action-image\" onClick={() => showModal({url: \"mailconv/merge/\" + props.chatId})}><i className=\"material-icons\">merge_type</i>{t('mail.merge_chat')}</span>\n                                                </div>}\n                                                <div className=\"col-6\">\n                                                    <a className=\"text-dark\" target=\"_blank\" href={WWW_DIR_JAVASCRIPT  + \"mailconv/mailprintcovnersation/\" + props.chatId} ><i className=\"material-icons\">print</i>{t('mail.print')}</a>\n                                                </div>\n                                                {state.moptions.can_write && state.conv.can_delete && <div className=\"col-6\">\n                                                    <span className=\"action-image me-0\" onClick={(e) => deleteConversation()}><i className=\"material-icons\">delete</i>{t('mail.delete')}</span>\n                                                </div>}\n                                           </div>\n                                        </td>\n                                    </tr>\n                                    <tr>\n                                        <td>{t('mail.sender')}</td>\n                                        <td>\n                                            {state.conv.lang && state.moptions.lang_dir && <img src={state.moptions.lang_dir + '/' + state.conv.lang + '.png'}/>} {state.conv.from_name} &lt;{state.conv.from_address}&gt;<button data-bs-title={t('mail.copied')} class=\"ms-0 btn btn-xs btn-link text-muted py-0\" data-copy={state.conv.from_address} title={t('mail.copy_email')} onClick={(e) => lhinst.copyContent($(e.currentTarget))} type=\"button\"><i class=\"material-icons me-0\">content_copy</i></button><span className=\"text-muted\">|</span> <span className={\"action-image\" + (state.moptions.is_blocked ? \" text-danger fw-bold\" : \"\")} onClick={() => showModal({url: \"mailconv/blocksender/\" + props.chatId})}><span className=\"material-icons\">block</span>{state.moptions.is_blocked ? t('mail.is_blocked') : t('mail.block')}</span>\n                                        </td>\n                                    </tr>\n                                    {(state.conv.phone || state.conv.phone_front) && <tr>\n                                        <td>{t('mail.phone')}</td>\n                                        <td>\n                                            {state.conv.phone && <a href={\"tel:\"+state.conv.phone}><span className=\"material-icons\">dialpad</span>{state.conv.phone_front}</a>}\n                                            {!state.conv.phone && <React.Fragment><span className=\"material-icons\">dialpad</span>{state.conv.phone_front}</React.Fragment>}\n                                        </td>\n                                    </tr>}\n                                    <tr>\n                                        <td colSpan=\"2\">\n\n                                            {!state.conv.status && <span><i className=\"material-icons chat-pending\">mail_outline</i>{t('status.pending')}</span>}\n\n                                            {(!state.conv.status || state.conv.status == 1) && state.conv.opened_at && <span><span className=\"ms-2 material-icons text-success\" title={t('status.opened_at')}>visibility</span>{state.conv.opened_at_front}</span>}\n\n                                            {(state.conv.status == 2 || state.conv.status == 1) && <div className=\"input-group input-group-sm\">\n                                                <span className=\"input-group-text\">\n                                                    {!state.conv.status && <i className=\"material-icons chat-pending me-0\">mail_outline</i>}\n                                                    {state.conv.status == 1 && <i className=\"material-icons chat-active me-0\">mail_outline</i>}\n                                                    {state.conv.status == 2 && <i className=\"material-icons chat-closed me-0\">mail_outline</i>}\n                                                </span>\n                                                <select disabled={state.moptions.is_archive} className=\"form-control form-control-sm\" value={state.conv.status} onChange={(e) => changeStatus(e)}>\n                                                    <option value=\"\">{t('status.pending')}</option>\n                                                    <option value=\"1\">{t('status.active')}</option>\n                                                    {state.conv.status == 2 && <option value=\"2\">{t('status.closed')}</option>}\n                                                </select>\n                                                {state.conv.opened_at && <span className=\"input-group-text\"><span className=\"ms-2 material-icons text-success\" title={t('status.opened_at')}>visibility</span>{state.conv.opened_at_front}</span>}\n                                            </div>}\n\n\n                                        </td>\n                                    </tr>\n                                    <tr>\n                                        <td>{t('mail.department')}</td>\n                                        <td>\n                                            <span title={state.conv.dep_id}><span className=\"material-icons\">home</span>{state.conv.department_name}</span> <span className={state.moptions.can_change_mailbox ? \"action-image\" : \"\"} onClick={() => state.moptions.can_change_mailbox && showModal({url: \"mailconv/changemailbox/\" + props.chatId})} title={state.conv.mailbox_id}>\n                                            <span className=\"material-icons\">email</span>\n                                            {state.conv.mailbox_front.name} ({state.conv.mailbox_front.mail})\n                                            </span>\n                                        </td>\n                                    </tr>\n\n\n\n                                    <tr>\n                                        <td>{t('mail.received')}</td>\n                                        <td>{state.conv.udate_front}</td>\n                                    </tr>\n                                    <tr>\n                                        <td>ID</td>\n                                        <td>\n                                            <button data-success={t('mail.copied')}\n                                                    className=\"btn ps-0 btn-xs btn-link py-0\"\n                                                    data-copy={window.location.origin + WWW_DIR_JAVASCRIPT + \"front/default/(mid)/\" + state.conv.id + \"/#!#chat-id-mc\"+state.conv.id}\n                                                    onClick={(e) => {lhinst.copyContent($(e.target))}} type=\"button\"><i className=\"material-icons\">link</i>{t('mail.copy_link')}\n                                            </button>\n                                            {state.conv.id}\n                                            {state.conv.follow_up_id && <a target=\"_blank\" href={WWW_DIR_JAVASCRIPT  + \"mailconv/view/\" + state.conv.follow_up_id}><span className=\"material-icons\">launch</span>{t('mail.follow_up')} {state.conv.follow_up_id}</a>}\n                                        </td>\n                                    </tr>\n                                    {state.conv.accept_time && <tr>\n                                        <td>{t('mail.last_accepted_at')}</td>\n                                        <td>{state.conv.accept_time_front}{state.conv.wait_time_pending && <React.Fragment> | {t('mail.wait_time')} {state.conv.wait_time_pending}</React.Fragment>}</td>\n                                    </tr>}\n                                    {state.conv.response_time && <tr>\n                                        <td>{t('mail.last_responded_at')}</td>\n                                        <td>{state.conv.lr_time_front}{state.conv.wait_time_response && <React.Fragment> | {t('mail.wait_time')} {state.conv.wait_time_response}</React.Fragment>}</td>\n                                    </tr>}\n                                    {state.conv.cls_time && <tr>\n                                        <td>{t('mail.closed_at')}</td>\n                                        <td>{state.conv.cls_time_front}</td>\n                                    </tr>}\n                                    {state.conv.conv_duration && <tr>\n                                        <td>{t('mail.conv_duration')}</td>\n                                        <td>{state.conv.conv_duration_front}</td>\n                                    </tr>}\n                                    {state.conv.interaction_time && <tr>\n                                        <td>{t('mail.last_interaction_time')}</td>\n                                        <td>{state.conv.interaction_time_duration}</td>\n                                    </tr>}\n                                    {state.conv.priority && <tr>\n                                        <td>{t('mail.priority')}</td>\n                                        <td>{state.conv.priority}</td>\n                                    </tr>}\n                                    <tr>\n                                        <td title={state.conv.user_id}>{t('mail.chat_owner')}</td>\n                                        <td>{state.conv.plain_user_name}\n                                            {state.op_watching.map((op_watching, index) => {\n                                                return <span title={t('mail.op_watching')} className=\"ms-1 mail-watcher\"><span className=\"material-icons text-success\">visibility</span>{op_watching.name_official}</span>\n                                            })}\n                                        </td>\n                                    </tr>\n                                    </tbody>\n                                </table>}\n\n                                <div id={\"mail-external-below-\"+props.chatId}></div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </React.Fragment>\n    );\n}\n\nexport default MailChat"],"names":["MailChatQuote","_ref","children","_useState","useState","_useState2","_slicedToArray","expandBody","setExpandBody","React","className","onClick","MailChatAttatchement","_PureComponent","props","_this","_classCallCheck","_callSuper","_defineProperty","hightlight","files","uploading","uploadProgress","successfullUploaded","progress","fileInputRef","dropAreaRef","openFileDialog","bind","onFilesAddedUI","onDragOver","onDragLeave","onDrop","onPaste","onFilesAdded","uploadFiles","sendRequest","chooseFromUploaded","fileUploaded","_inherits","_createClass","key","value","_this2","t","this","ruleTest","RegExp","moptions","uploadErrors","forEach","file","test","type","name","push","size","length","alert","join","setState","prevProps","prevState","state","_uploadFiles","_asyncToGenerator","_regeneratorRuntime","_callee","promises","_this3","_context","prev","next","Promise","all","stop","apply","arguments","fileAttached","_this4","resolve","reject","req","XMLHttpRequest","upload","addEventListener","event","lengthComputable","_objectSpread","percentage","loaded","total","Math","round","response","_inst","onreadystatechange","readyState","JSON","parse","copy","formData","FormData","append","open","WWW_DIR_JAVASCRIPT","confLH","csrf_token","send","current","click","evt","target","array","fileListToArray","preventDefault","ondragover","ondragleave","ondrop","window","attatchReplyCurrent","e","items","clipboardData","i","getAsFile","dataTransfer","list","item","lhc","revealModal","ref","onChange","id","multiple","PureComponent","withTranslation","MailReplyRecipient","_useReducer","useReducer","recipients","concat","_toConsumableArray","recipient","filter","_","index","field","_useReducer2","dispatch","setReciepints","setRecipients","useEffect","_useTranslation","useTranslation","i18n","readOnly","style","fontSize","reply","map","mail","disabled","placeholder","email","cc","bcc","MailSendStatus","status","role","errors","general","content","raw_error","document","location","reload","rows","MailChatReply","replyMode","setReplyMode","_useState3","_useState4","forwardMode","setForwardMode","_useState5","_useState6","keepQuote","setKeepQuote","_useState7","_useState8","_useState9","_useState0","replyIntro","setReplyIntro","_useState1","_useState10","replySignature","setReplySignature","_useState11","_useState12","loadedReplyData","setLoadedReplyData","_useState13","_useState14","_useState15","_useState16","recipientsModified","setModifiedRecipients","_useState17","_useState18","replySendStatus","setReplySendStatus","_useState19","_useState20","sendInProgress","setSendInProgress","_useState21","_useState22","underReplySignature","setUnderReplySignature","_useState23","_useState24","isOwner","setIsOwner","_useState25","_useState26","isSelfReply","setIsSelfReply","attachedFiles","currentAttatchedFiles","useRef","sendReply","replyPayload","tinyMCE","get","message","getContent","axios","post","then","result","_typeof","data","fetchMessages","setConversationStatus","conv_status","error","request","console","log","config","intro","signature","signature_under","is_self_reply","keep_quote","user_id","verifyOwner","is_owner","fetchingMessages","response_type","noReplyRequired","hide_recipients","send_tried","mode","Editor","tinymceScriptSrc","tiny_mce_path","initialValue","body_front","skip_images","replace","image_skipped_text","onInit","focus","init","cache_suffix","cache_version_plugin","height","automatic_uploads","files_enabled","file_picker_types","images_upload_url","templates","paste_data_images","relative_urls","browser_spellcheck","paste_as_text","contextmenu","menubar","plugins","mce_plugins","toolbar_mode","toolbar","mce_toolbar","cancelReply","cancelForward","send_as_new","MailChatAttachement","title","removeAttatchedFile","MailChatImage","src","alt","_ref$download_policy","download_policy","width","_objectWithoutProperties","_excluded","imageError","setImageError","errorMode","setErrorMode","imageLoading","setImageLoading","canShowImage","setCanShowImage","fileNotFound","setFileNotFound","imageSrc","setImageSrc","verificationMessage","setVerificationMessage","verificationAttempts","setVerificationAttempts","countdownSeconds","setCountdownSeconds","setProtectionType","protectionHtml","setProtectionHtml","isProtected","setIsProtected","imageRevealed","setImageRevealed","imageTitle","setImageTitle","_useState27","_useState28","buttonTitle","setButtonTitle","_useState29","_useState30","extractedFileId","setExtractedFileId","_useState31","_useState32","extractedConvId","setExtractedConvId","countdownInterval","_extractIdsFromUrl","url","fileId","convId","match","parseInt","extractIdsFromUrl","policyValue","startVerificationProcess","checkImageSensitivity","clearCountdown","clearInterval","handleImageClick","requestVerification","currentAttempts","undefined","attempts","newAttempts","verifyUrl","fetch","method","headers","json","verified","error_msg","protection_image","protection_html","btn_title","scheduleNextVerification","setInterval","handleImageLoad","handleImageError","includes","externalUrl","href","rel","tabIndex","cursor","dangerouslySetInnerHTML","__html","onLoad","onError","_extends","maxWidth","MailChatAttachment","description","download_url","_ref$is_image","is_image","_ref$restricted_file","restricted_file","_ref$restricted_reaso","restricted_reason","_ref$download_modal","download_modal","verificationStatus","setVerificationStatus","canDownload","setCanDownload","finalDownloadUrl","setFinalDownloadUrl","isSensitiveImage","setIsSensitiveImage","getRestrictionMessage","reason","baseClass","getButtonClass","getButtonTitle","getButtonIcon","MailChatMessage","totalMessages","addLabel","updateMessages","loadMessageBody","keyword","expandingBody","setExpandingBody","expandHeader","setExpandHeader","undelivered","plainBody","setPlainBody","expandDeliveryInformation","setExpandDeliveryInformation","getStyleObjectFromString","str","split","el","_el$split","_el$split2","property","formattedProperty","splitted","slice","word","toUpperCase","formatStringToCamelCase","trim","loadAndExpand","expandAction","alt_body","conversation_id","from_name","from_address","opened_at","opened_at_front","is_external","cls_time","conversation_id_old","subjects","label","color","can_write","udate_front","udate_ago","stopPropagation","can_forward","confirm","err","isAxiosError","stringify","unMerge","can_download","mail_links","link","icon","subject","to_data_front","cc_data_front","message_id","bcc_data_front","reply_to_data_front","from_host","accept_time_front","plain_user_name","wait_time","wait_time_pending","lr_time","response_time","wait_time_response","interaction_time","interaction_time_duration","cls_time_front","conv_duration_front","rfc822_body","delivery_status_keyed","Diagnostic_Code","taken","domNode","attribs","Object","assign","domToReact","attachments","lastMessage","reducer","action","count","conv","foundIndex","messages","findIndex","x","fetching_messages","op_watching","watcher","ts","floor","Date","now","splice","element","history","msg","unshift","Error","defaults","common","tabsContainer","operators","saving_remarks","close_mode","old_message_id","last_message","remarks","last_message_id","lmsop","lgsync","expand_messages","updateLabels","loadMainData","chatId","customer_remarks","disableRemember","localStorage","achat_id_array","achat_id","getItem","indexOf","setItem","rememberChat","pending_sync","lhinst","removeDialogTabMail","$","fetchUntillUpdate","updated","setTimeout","showModal","params","timeout","clearTimeout","mailChatModified","mailLabelsModified","messageId","mailOpWatching","ee","addListener","removeListener","emitEvent","forgetChat","start_type","hidecallback","saving_customer_remarks","onKeyUp","defaultValue","can_close","hasUnrespondedMessages","getElementById","colSpan","can_delete","lang","lang_dir","class","copyContent","currentTarget","is_blocked","phone","phone_front","is_archive","changeStatus","dep_id","department_name","can_change_mailbox","mailbox_id","mailbox_front","origin","follow_up_id","accept_time","lr_time_front","conv_duration","priority","name_official"],"ignoreList":[],"sourceRoot":""}