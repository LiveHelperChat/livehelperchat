"use strict";(self.webpackChunkLHCReactAPPAdmin=self.webpackChunkLHCReactAPPAdmin||[]).push([[672],{672:(e,t,a)=>{a.r(t),a.d(t,{default:()=>h});var n=a(8168),c=a(2284),i=a(296),s=a(4467),r=a(6540),l=a(1083),o=a(8492),u=a(9896);function d(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function m(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?d(Object(a),!0).forEach((function(t){(0,s.A)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):d(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function f(e,t){switch(t.type){case"attr":return-1===(c=e.chats.findIndex((function(e){return e.id==t.id})))?e:(e.chats[c]=m(m({},e.chats[c]),t.value),e=m({},e));case"attr_remove":return-1===(c=e.chats.findIndex((function(e){return e[t.attr]==t.id})))?e:(e.chats[c]=m(m({},e.chats[c]),t.value),e=m({},e));case"attr_remove_mail":return-1===(c=e.mails.findIndex((function(e){return e[t.attr]==t.id})))?e:(e.mails[c]=m(m({},e.mails[c]),t.value),e=m({},e));case"update":return m(m({},e),t.value);case"add":if(-1===(c=e.chats.findIndex((function(e){return e.id==t.value.id}))))if(!0===t.static_order){var a=e.chats.findIndex((function(e){return e.id>t.value.id}));-1===a?e.chats.push(t.value):e.chats.splice(a,0,t.value)}else e.chats.unshift(t.value);else e.chats[c].active=t.value.active,e.chats[c].mn=0,e.chats[c].support_chat=!1;return m({},e);case"add_mail":return-1===(c=e.mails.findIndex((function(e){return e.id==t.value.id})))?e.mails.unshift(t.value):e.mails[c].active=t.value.active,m({},e);case"remove":return-1===(c=e.chats.findIndex((function(e){return e.id==t.id})))?e:(e.chats.splice(c,1),m({},e));case"remove_mail":return-1===(c=e.mails.findIndex((function(e){return e.id==t.id})))?e:(e.mails.splice(c,1),m({},e));case"update_chat":return-1===(c=e.chats.findIndex((function(e){return e.id==t.id})))?e:(e.chats[c]=m(m({},e.chats[c]),t.value),m({},e));case"update_mail":return-1===(c=e.mails.findIndex((function(e){return e.id==t.id})))?e:(e.mails[c]=m(m({},e.mails[c]),t.value),m({},e));case"msg_received":if(-1===(c=e.chats.findIndex((function(e){return e.id==t.id}))))return e;e.chats[c].msg=t.value.msg;var n=document.getElementById("chat-tab-link-"+t.id);return null!==n&&n.classList.contains("active")?e.chats[c].active=!0:e.chats[c].active=!1,e.chats[c].mn=0==e.chats[c].active?e.chats[c].mn?e.chats[c].mn+t.value.mn:t.value.mn:0,!1===t.static_order&&e.chats.splice(0,0,e.chats.splice(c,1)[0]),m({},e);case"refocus_mail":var c;return e.chats.forEach((function(t,a){t.active&&(e.chats[a].active=!1)})),e.mails.forEach((function(a,n){a.active&&a.id!=t.id&&(e.mails[n].active=!1)})),-1!==(c=e.mails.findIndex((function(e){return e.id==t.id})))&&(e.mails[c].active=!0),m({},e);case"refocus":e.mails.forEach((function(t,a){t.active&&(e.mails[a].active=!1)})),e.chats.forEach((function(a,n){a.active&&a.id!=t.id&&(e.chats[n].active=!1)}));var i=e.chats.findIndex((function(e){return e.id==t.id}));return-1!==i&&(e.chats[i].active=!0,e.chats[i].mn=0,e.chats[i].support_chat=!1),m({},e);case"group_offline":return e.group_offline=t.value,m({},e);default:throw new Error("Unknown action!")}}const h=function(e){var t=(0,r.useReducer)(f,{chats:[],mails:[],group_offline:!1}),a=(0,i.A)(t,2),d=a[0],h=a[1],p=(0,r.useRef)(d);(0,r.useEffect)((function(){p.current=d}),[d]);var v=function(){var e=[];return d.chats.map((function(t,a){return e.push(t.id)})),e},_=function(e){l.A.get(WWW_DIR_JAVASCRIPT+"front/tabs/(id)/"+(void 0!==e?e.join("/"):v().join("/"))).then((function(e){e.data.map((function(e,t){var a=document.getElementById("node-js-indicator-"+e.id);null!==a&&(e.live_status="wifi"==a.textContent),e.nb||(e.nb=!1),e.nc||(e.nc=null),e.aicons||(e.aicons={}),h({type:"update_chat",id:e.id,value:e})}))}))},b=function(e){l.A.get(WWW_DIR_JAVASCRIPT+"front/tabs/(idmail)/"+(void 0!==e?e.join("/"):v().join("/"))).then((function(e){e.data.map((function(e,t){h({type:"update_mail",id:e.id,value:e})}))}))};document.getElementById("tabs")||document.getElementById("views-home")||(0,u.A)((function(){d.chats&&0!=d.chats.length&&l.A.get(WWW_DIR_JAVASCRIPT+"front/tabs/(id)/"+v().join("/")).then((function(e){e.data.map((function(e,t){var a=document.getElementById("node-js-indicator-"+e.id);if(null!==a&&(e.live_status="wifi"==a.textContent),d.chats&&0!=d.chats.length){var n=d.chats.findIndex((function(t){return t.id==e.id}));-1!==n&&(d.chats[n].lmsg_id!==e.lmsg_id?e.mn=1:e.mn=d.chats[n].mn)}h({type:"update_chat",id:e.id,value:e})}))}))}),1e3),(0,r.useEffect)((function(){function t(t,a){h({type:"add",static_order:e.static_order,value:{id:t,active:a.focus}}),!0===a.focus&&h({type:"refocus",id:t}),_([t])}function a(t,a){h({type:"add",value:{id:t,static_order:e.static_order,active:!1,mn:1}}),_([t])}function n(e){p.current.chats&&0!=p.current.chats.length&&-1!==p.current.chats.findIndex((function(t){return t.id==e.id}))&&_([e.id])}function i(e,t){var a=e.replace("mc",""),n=document.getElementById("chat-tab-link-mc"+a),i="object"===(0,c.A)(t)&&!0!==t.background||null!==n&&n.classList.contains("active");h({type:"add_mail",value:{id:a,active:i}}),!0===i&&h({type:"refocus_mail",id:a}),b([a])}function s(e){h({type:"remove",id:e})}function r(e){h({type:"remove_mail",id:e.replace("mc","")})}function l(e){"string"!=typeof e||-1===e.indexOf("mc")?h({type:"refocus",id:e}):o(e.replace("mc",""))}function o(e){h({type:"refocus_mail",id:e})}function u(t){h({type:"group_offline",value:lhinst.hidenicknamesstatus}),Object.keys(t.result_status).map((function(e){h({type:"update_chat",id:t.result_status[e].chat_id,value:t.result_status[e]})})),"false"!==t.result&&Object.keys(t.result).map((function(a){h({type:"msg_received",id:t.result[a].chat_id,value:{msg:t.result[a].msg,mn:t.result[a].mn},order_chats:e.static_order})}))}function d(e){h({type:"update_chat",id:e.id,value:{tp:"true",tx:e.txt}})}function m(e){h({type:"update_chat",id:e.id,value:{tp:"false"}})}function f(e){h({type:"update_chat",id:e.id,value:{live_status:e.status}})}function v(e,t){var a=p.current.chats.findIndex((function(e){return 1==e.active}));-1!==a&&(p.current.chats.length-1>a&&0==t?g(p.current.chats[a+1]):a>0&&1==t&&g(p.current.chats[a-1]))}if(ee.addListener("chatStartTab",t),ee.addListener("chatTabPreload",(function(e,a){p.current.chats&&0!=p.current.chats.length&&-1!==p.current.chats.findIndex((function(t){return t.id==e}))||t(e,a)})),ee.addListener("chatStartBackground",a),ee.addListener("removeSynchroChat",s),ee.addListener("chatTabClicked",l),ee.addListener("chatTabFocused",l),ee.addListener("chatAdminSync",u),ee.addListener("supportUnreadChat",(function(e){e.id&&1==e.unread&&h({type:"update_chat",id:e.id,value:{support_chat:!0}})})),ee.addListener("nodeJsTypingVisitor",d),ee.addListener("nodeJsTypingVisitorStopped",m),ee.addListener("nodeJsVisitorStatus",f),ee.addListener("activateNextTab",v),ee.addListener("updateChatTab",n),ee.addListener("unloadMailChat",r),ee.addListener("mailChatTabLoaded",i),ee.addListener("mailChatTabClicked",o),localStorage){var y;if(null!==(y=localStorage.getItem("achat_id"))&&""!==y){var E=y.split(",").map(Number);1==e.static_order&&E.sort((function(e,t){return e-t}));var x=[];E.forEach((function(e){var t=document.getElementById("chat-tab-link-"+e);parseInt(e)>0&&x.push({id:parseInt(e),active:null!==t&&t.classList.contains("active")})})),h({type:"update",value:{chats:x}}),E.length>0&&_(E),setTimeout((function(){E.forEach((function(e){var t=document.getElementById("chat-tab-link-"+e);null!==t&&t.classList.contains("active")&&l(parseInt(e))}))}),1e3)}if(null!==(y=localStorage.getItem("machat_id"))&&""!==y){var I=y.split(",");x=[],I.forEach((function(e){var t=document.getElementById("chat-tab-link-mc"+e);if(null!==t){var a=t.classList.contains("active");x.push({id:parseInt(e),active:a})}})),h({type:"update",value:{mails:x}}),I.length>0&&b(I),setTimeout((function(){I.forEach((function(e){var t=document.getElementById("chat-tab-link-mc"+e);null!==t&&t.classList.contains("active")&&o(parseInt(e))}))}),1e3)}}return function(){ee.removeListener("chatStartTab",t),ee.removeListener("chatStartBackground",a),ee.removeListener("removeSynchroChat",s),ee.removeListener("chatTabClicked",l),ee.removeListener("chatTabFocused",l),ee.removeListener("chatAdminSync",u),ee.removeListener("supportUnreadChat",u),ee.removeListener("nodeJsTypingVisitor",d),ee.removeListener("nodeJsTypingVisitorStopped",m),ee.removeListener("nodeJsVisitorStatus",f),ee.removeListener("activateNextTab",v),ee.removeListener("updateChatTab",n),ee.removeListener("unloadMailChat",r),ee.removeListener("mailChatTabLoaded",i),ee.removeListener("mailChatTabClicked",o)}}),[]);var g=function(e){null!==document.getElementById("chat-tab-link-"+e.id)?($("#chat-tab-link-"+e.id).click(),new bootstrap.Tab(document.querySelector("#chat-tab-link-"+e.id)).show()):document.location=WWW_DIR_JAVASCRIPT+"front/default/(cid)/"+e.id+"/#!#chat-id-"+e.id},y=(0,o.B)("chat_tabs"),E=y.t;return y.i18n,r.createElement(r.Fragment,null,(!d.chats||0==d.chats.length)&&r.createElement("div",{className:"text-center text-muted p-2"},r.createElement("span",{className:"material-icons"},"chat"),E("chat_tabs.open_chats")),d.chats.map((function(e,t){return r.createElement("div",(0,n.A)({key:"chat-"+e.id,title:e.id,onClick:function(){return g(e)},className:"p-1 action-image chat-tabs-row"+(e.active?" chat-tab-active":"")+(e.vwa?" long-response-chat":"")},e.add_attr?Object.entries(e.add_attr).reduce((function(e,t){var a=(0,i.A)(t,2),n=a[0],c=a[1];return m(m({},e),{},(0,s.A)({},"data-".concat(n),c))}),{}):{}),r.createElement("div",{className:"fs12"},r.createElement("button",{type:"button",onClick:function(t){return function(e,t){e.preventDefault(),e.stopPropagation(),lhinst.removeDialogTab(t.id,$("#tabs"),!0),lhinst.channel&&lhinst.channel.postMessage({action:"close_chat",args:{chat_id:t.id}})}(t,e)},className:"float-end btn-link m-0 ms-1 p-0 btn btn-xs"},r.createElement("i",{className:"material-icons me-0"},"close")),e.dep&&r.createElement("span",{className:"float-end text-muted text-truncate mw-80px"},0==e.cs&&r.createElement("span",{title:E("chat_tabs.pending_status"),className:"material-icons chat-pending me-0"},"chat"),1==e.cs&&r.createElement("span",{title:E("chat_tabs.active_status"),className:"material-icons chat-active me-0"},"chat"),5==e.cs&&r.createElement("span",{title:E("chat_tabs.bot_status"),className:"material-icons chat-active me-0"},"android"),2==e.cs&&r.createElement("span",{title:E("chat_tabs.closed_status"),className:"material-icons chat-closed me-0"},"chat"),r.createElement("span",{className:"d-none d-lg-inline"},r.createElement("span",{className:"material-icons",title:e.dep},"home"),e.dep)),r.createElement("span",{className:"material-icons"+(1==e.pnd_rsp?" text-danger":" text-success")},1==e.pnd_rsp?"call_received":"call_made"),e.adicons&&e.adicons.map((function(t,a){return r.createElement("span",{onClick:function(a){return function(e,t,a){e.preventDefault(),e.stopPropagation(),t.has_popup&&lhc.revealModal({url:WWW_DIR_JAVASCRIPT+"chat/icondetailed/"+a.id+"/"+t.icon_id})}(a,t,e)},style:{color:t.color},className:"material-icons",title:t.title},t.icon)})),e.aicons&&Object.keys(e.aicons).map((function(t,a){return r.createElement(r.Fragment,null,e.aicons[t].i.includes("/")&&r.createElement("img",{className:"me-1",title:e.aicons[t].t||e.aicons[t].i,src:e.aicons[t].i}),!e.aicons[t].i.includes("/")&&r.createElement("span",{style:{color:e.aicons[t].c?e.aicons[t].c:"#1d548e;"},className:"material-icons",title:e.aicons[t].t||e.aicons[t].i},e.aicons[t].i))})),e.vwa&&r.createElement("span",{title:e.vwa,className:"d-none d-lg-inline material-icons text-danger"},"timer"),e.support_chat&&r.createElement("span",{className:"whatshot blink-ani text-warning material-icons"},"whatshot"),r.createElement("i",{className:"material-icons "+("boolean"==typeof e.live_status?!0===e.live_status?"icon-user-online":"icon-user-offline":2==e.us?"icon-user-away":0==e.us?"icon-user-online":"icon-user-offline")},"boolean"==typeof e.live_status?!0===e.live_status?"wifi":"wifi_off":2==e.us?"wifi_1_bar":0==e.us?"wifi":"wifi_off"),r.createElement("i",{className:"material-icons icon-user-online "+(1==e.um?"icon-user-offline":"icon-user-online")},"send"),e.cc&&r.createElement("img",{className:"d-none d-lg-inline",title:e.cn,src:e.cc,alt:""})," ",(0==d.group_offline||!(0!=e.us))&&r.createElement("span",{style:{color:e.nc?e.nc:null},className:"small-truncate-nick "+(e.nb||e.mn>0||0==e.cs?"fw-bold ":"")+(0==e.cs?"text-danger":"")},e.nick||e.id),e.mn>0&&r.createElement("span",{className:"msg-nm ps-1"},"(",e.mn,")"),e.lmsg&&r.createElement("span",{className:"d-none d-xl-inline text-muted"}," ",e.lmsg),e.co==confLH.user_id&&r.createElement("span",{className:"d-none d-lg-inline float-end text-muted"},r.createElement("span",{title:E("chat_tabs.chat_owner"),className:"material-icons"},"account_box"))),(e.msg||"true"==e.tp&&e.tx)&&r.createElement("div",{className:"fs13 text-muted pt-1"},r.createElement("span",{title:"true"==e.tp&&e.tx?e.tx:e.msg,className:"d-none d-lg-inline-block text-truncate mw-100 "+(e.mn>0?"fw-bold":"")+("true"==e.tp&&e.tx?" fst-italic":"")},"true"==e.tp&&e.tx?e.tx:e.msg)))})),d.mails.map((function(e,t){return r.createElement("div",{key:"mail-"+e.id,title:e.id,onClick:function(){return function(e){$("#chat-tab-link-mc"+e.id).click(),new bootstrap.Tab(document.querySelector("#chat-tab-link-mc"+e.id)).show()}(e)},className:"p-1 action-image chat-tabs-row"+(e.active?" chat-tab-active":"")},r.createElement("div",{className:"fs12"},r.createElement("span",{title:e.from_name},r.createElement("i",{className:"material-icons"},"mail_outline"),e.from_address),r.createElement("button",{type:"button",onClick:function(t){return function(e,t){e.preventDefault(),e.stopPropagation(),lhinst.removeDialogTabMail("mc"+t.id,$("#tabs"),!0)}(t,e)},className:"float-end btn-link m-0 ms-1 p-0 btn btn-xs"},r.createElement("i",{className:"material-icons me-0"},"close")),e.dep&&r.createElement("span",{className:"float-end text-muted text-truncate mw-80px"},r.createElement("span",{className:"material-icons"},"home"),e.dep),e.co==confLH.user_id&&r.createElement("span",{className:"float-end text-muted"},r.createElement("span",{title:E("chat_tabs.chat_owner"),className:"material-icons"},"account_box"))),r.createElement("span",{title:e.nick,className:"fs13 text-muted pt-1 d-inline-block text-truncate mw-100"},e.nick))})))}},8168:(e,t,a)=>{function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},n.apply(null,arguments)}a.d(t,{A:()=>n})},9896:(e,t,a)=>{a.d(t,{A:()=>c});var n=a(6540);const c=function(e,t){var a=(0,n.useRef)();(0,n.useEffect)((function(){a.current=e}),[e]),(0,n.useEffect)((function(){if(null!==t){var e=setInterval((function(){a.current()}),t);return function(){return clearInterval(e)}}}),[t])}}}]);
//# sourceMappingURL=672.5c9dc8932dd2ff207a4a.js.map