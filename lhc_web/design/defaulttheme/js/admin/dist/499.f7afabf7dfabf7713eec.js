"use strict";(self.webpackChunkLHCReactAPPAdmin=self.webpackChunkLHCReactAPPAdmin||[]).push([[499],{8499:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Y});var n=a(296),r=a(4467),l=a(6540),i=a(1083),s=a(8492),c=a(8168),o=a(900),m=function(e){var t=e.children,a=(0,l.useState)(!1),r=(0,n.A)(a,2),i=r[0],s=r[1];return l.createElement(l.Fragment,null,l.createElement("div",{className:"pb-2"},l.createElement("button",{onClick:function(){return s(!i)},className:"btn btn-sm btn-outline-secondary"},"...")),i&&t)};const d=l.memo(m);var u=a(2284),p=a(5458),f=a(8002),v=a(467),_=a(3029),g=a(2901),h=a(6822),b=a(3954),E=a(5361),y=a(4756),w=a.n(y),N=a(6943);function A(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function k(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?A(Object(a),!0).forEach((function(t){(0,r.A)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):A(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function I(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(I=function(){return!!e})()}var x=function(e){function t(e){var a,n,i,s;return(0,_.A)(this,t),n=this,i=t,s=[e],i=(0,b.A)(i),a=(0,h.A)(n,I()?Reflect.construct(i,s||[],(0,b.A)(n).constructor):i.apply(n,s)),(0,r.A)(a,"state",{hightlight:!1,files:[],uploading:!1,uploadProgress:{},successfullUploaded:!1,progress:""}),a.fileInputRef=l.createRef(),a.dropAreaRef=l.createRef(),a.openFileDialog=a.openFileDialog.bind(a),a.onFilesAddedUI=a.onFilesAddedUI.bind(a),a.onDragOver=a.onDragOver.bind(a),a.onDragLeave=a.onDragLeave.bind(a),a.onDrop=a.onDrop.bind(a),a.onPaste=a.onPaste.bind(a),a.onFilesAdded=a.onFilesAdded.bind(a),a.uploadFiles=a.uploadFiles.bind(a),a.sendRequest=a.sendRequest.bind(a),a.chooseFromUploaded=a.chooseFromUploaded.bind(a),a.fileUploaded=a.fileUploaded.bind(a),a}return(0,E.A)(t,e),(0,g.A)(t,[{key:"onFilesAdded",value:function(e){var t=this,a=this.props.t,n=new RegExp("(.|/)("+this.props.moptions.fop_op+")$","i"),r=[];e.forEach((function(e){n.test(e.type)||n.test(e.name)||r.push(e.name+": "+a("file.incorrect_type")),e.size>t.props.moptions.fop_size&&r.push(e.name+": "+a("file.to_big_file"))})),r.length>0?alert(r.join("\n")):this.setState({files:e})}},{key:"componentDidUpdate",value:function(e,t){this.state.files.length>0&&0==this.state.uploading&&this.uploadFiles()}},{key:"uploadFiles",value:(a=(0,v.A)(w().mark((function e(){var t,a=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({uploadProgress:{},uploading:!0}),t=[],this.state.files.forEach((function(e){t.push(a.sendRequest(e))})),e.prev=1,e.next=2,Promise.all(t);case 2:this.setState({successfullUploaded:!0,uploading:!1,files:[]}),e.next=4;break;case 3:e.prev=3,e.catch(1),this.setState({successfullUploaded:!0,uploading:!1,files:[]});case 4:case"end":return e.stop()}}),e,this,[[1,3]])}))),function(){return a.apply(this,arguments)})},{key:"fileUploaded",value:function(e){this.props.fileAttached(e)}},{key:"sendRequest",value:function(e){var t=this,a=this.props.t;return new Promise((function(n,r){var l=new XMLHttpRequest;l.upload.addEventListener("progress",(function(n){n.lengthComputable&&(k({},t.state.uploadProgress)[e.name]={state:"pending",percentage:n.loaded/n.total*100},t.setState({progress:a("file.uploading")+" "+Math.round(n.loaded/n.total*100)+"%"}))})),l.upload.addEventListener("load",(function(a){k({},t.state.uploadProgress)[e.name]={state:"done",percentage:100},t.setState({progress:""}),n(l.response)}));var i=t;l.onreadystatechange=function(){4===l.readyState&&i.fileUploaded(JSON.parse(l.response))},l.upload.addEventListener("error",(function(a){var n=k({},t.state.uploadProgress);n[e.name]={state:"error",percentage:0},t.setState({progress:n}),r(l.response)}));var s=new FormData;s.append("files",e,e.name),l.open("POST",WWW_DIR_JAVASCRIPT+"mailconv/uploadfile/(csrf)/"+confLH.csrf_token),l.send(s)}))}},{key:"openFileDialog",value:function(){this.state.uploading||this.fileInputRef.current.click()}},{key:"onFilesAddedUI",value:function(e){var t=e.target.files,a=this.fileListToArray(t);this.onFilesAdded(a)}},{key:"onDragOver",value:function(e){e.preventDefault(),this.state.uploading||this.setState({hightlight:!0})}},{key:"componentDidMount",value:function(){this.dropAreaRef.current&&(this.dropAreaRef.current.ondragover=this.onDragOver,this.dropAreaRef.current.ondragleave=this.onDragLeave,this.dropAreaRef.current.ondrop=this.onDrop)}},{key:"componentWillUnmount",value:function(){this.dropAreaRef.current&&(this.dropAreaRef.current.ondragover=null,this.dropAreaRef.current.ondragleave=null,this.dropAreaRef.current.ondrop=null),window.attatchReplyCurrent=null}},{key:"onPaste",value:function(e){var t=e&&e.clipboardData&&e.clipboardData.items;if(t&&t.length){for(var a=[],n=0;n<t.length;n++){var r=t[n].getAsFile&&t[n].getAsFile();r&&a.push(r)}a.length>0&&this.onFilesAdded(a)}}},{key:"onDragLeave",value:function(e){this.setState({hightlight:!1})}},{key:"onDrop",value:function(e){if(e.preventDefault(),!this.state.uploading){var t=e.dataTransfer.files,a=this.fileListToArray(t);this.onFilesAdded(a),this.setState({hightlight:!1})}}},{key:"fileListToArray",value:function(e){for(var t=[],a=0;a<e.length;a++)t.push(e.item(a));return t}},{key:"chooseFromUploaded",value:function(){var e=this.props.t;lhc.revealModal({title:e("file.choose_uploaded"),iframe:!0,height:500,url:WWW_DIR_JAVASCRIPT+"mailconv/attatchfile/(attachment)/1"});var t=this;window.attatchReplyCurrent=function(e){t.props.fileAttached(e)}}},{key:"render",value:function(){var e=this.props.t;return l.createElement(l.Fragment,null,l.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:this.chooseFromUploaded},l.createElement("i",{className:"material-icons"},"list")," ",e("file.choose_uploaded")),l.createElement("button",{ref:this.dropAreaRef,onClick:this.openFileDialog,className:"btn btn-sm "+(1==this.state.hightlight?"btn-outline-primary":"btn-outline-secondary")},l.createElement("i",{className:"material-icons"},"attach_file")," ",this.state.progress||e("file.drop_here")),l.createElement("input",{onChange:this.onFilesAddedUI,ref:this.fileInputRef,id:"fileupload",type:"file",name:"files[]",multiple:!0,className:"d-none"}))}}]);var a}(l.PureComponent);const S=(0,N.C)("mail_chat")(x);function R(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function C(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?R(Object(a),!0).forEach((function(t){(0,r.A)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):R(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var W=function(e){var t=(0,l.useReducer)((function(e,t){var a=t.type,n=t.value;switch(a){case"add":return[].concat((0,p.A)(e),[n]);case"add_recipient":return(e=C({},e))[n].push({name:"",email:""}),e;case"remove_recipient":return(e=C({},e))[n.recipient]=e[n.recipient].filter((function(e,t){return t!==n.index})),e;case"set":return n;case"set_attribute":return(e=C({},e))[n.value.type][n.value.index][n.value.field]=n.value.value,e;case"cleanup":return[];case"remove":return e.filter((function(e,t){return t!==n}));default:return e}}),[]),a=(0,n.A)(t,2),i=a[0],c=a[1],o=function(t,a){c({type:t,value:a}),e.setRecipients(i)};(0,l.useEffect)((function(){c({type:"set",value:e.recipients}),e.setRecipients(e.recipients)}),[e.recipients]);var m=(0,s.B)("mail_chat"),d=m.t;return m.i18n,l.createElement("div",{className:"row"},!e.readOnly&&l.createElement("div",{className:"col-12 text-secondary fw-bold fs13 pb-1"},d("r.recipients")," ",l.createElement("i",{className:"material-icons settings text-muted",onClick:function(e){return o("add_recipient","reply")},style:{fontSize:"20px"}},"add")," Cc ",l.createElement("i",{className:"material-icons settings text-muted",onClick:function(e){return o("add_recipient","cc")},style:{fontSize:"20px"}},"add")," Bcc ",l.createElement("i",{onClick:function(e){return o("add_recipient","bcc")},className:"material-icons settings text-muted",style:{fontSize:"20px"}},"add")),l.createElement("div",{className:"col-6"},i.reply&&i.reply.map((function(t,a){return l.createElement("div",{className:"row pb-1"},l.createElement("div",{className:"col-1 text-secondary fs13 pt-1"},d("r.to"),":"),l.createElement("div",{className:"col-5"},l.createElement("div",{className:"input-group input-group-sm"},l.createElement("span",{className:"input-group-text"},l.createElement("i",{className:"material-icons me-0"},"mail_outline")),l.createElement("input",(0,r.A)((0,r.A)({disabled:e.readOnly,type:"text",className:"form-control form-control-sm",placeholder:"E-mail",onChange:function(e){return o("set_attribute",{value:{value:e.target.value,type:"reply",index:a,field:"email"}})},value:t.email},"placeholder",d("r.email")),"aria-describedby","validationTooltipUsernamePrepend")))),l.createElement("div",{className:"col-5"},l.createElement("input",{type:"text",disabled:e.readOnly,placeholder:d("r.name"),onChange:function(e){return o("set_attribute",{value:{value:e.target.value,type:"reply",index:a,field:"name"}})},value:t.name,className:"form-control form-control-sm"})),!e.readOnly&&a>0&&l.createElement("div",{className:"col-1"},l.createElement("i",{className:"material-icons settings text-muted",onClick:function(e){return o("remove_recipient",{recipient:"reply",index:a})}},"remove")))}))),l.createElement("div",{className:"col-6"},i.cc&&i.cc.map((function(t,a){return l.createElement("div",{className:"row pb-1"},l.createElement("div",{className:"col-1 text-secondary fs13 pt-1"},"Cc:"),l.createElement("div",{className:"col-5"},l.createElement("div",{className:"input-group input-group-sm"},l.createElement("span",{className:"input-group-text"},l.createElement("i",{className:"material-icons me-0"},"mail_outline")),l.createElement("input",(0,r.A)((0,r.A)({type:"text",disabled:e.readOnly,className:"form-control form-control-sm",placeholder:"E-mail",onChange:function(e){return o("set_attribute",{value:{value:e.target.value,type:"cc",index:a,field:"email"}})},value:t.email},"placeholder",d("r.email")),"aria-describedby","validationTooltipUsernamePrepend")))),l.createElement("div",{className:"col-5"},l.createElement("input",{disabled:e.readOnly,type:"text",placeholder:d("r.name"),onChange:function(e){return o("set_attribute",{value:{value:e.target.value,type:"cc",index:a,field:"name"}})},value:t.name,className:"form-control form-control-sm"})),!e.readOnly&&l.createElement("div",{className:"col-1"},l.createElement("i",{className:"material-icons settings text-muted",onClick:function(e){return o("remove_recipient",{recipient:"cc",index:a})}},"remove")))}))),l.createElement("div",{className:"col-6"},i.bcc&&i.bcc.map((function(t,a){return l.createElement("div",{className:"row pb-1"},l.createElement("div",{className:"col-1 text-secondary fs13 pt-1"},"Bcc:"),l.createElement("div",{className:"col-5"},l.createElement("div",{className:"input-group input-group-sm"},l.createElement("span",{className:"input-group-text"},l.createElement("i",{className:"material-icons me-0"},"mail_outline")),l.createElement("input",(0,r.A)((0,r.A)({type:"text",disabled:e.readOnly,className:"form-control form-control-sm",placeholder:"E-mail",onChange:function(e){return o("set_attribute",{value:{value:e.target.value,type:"bcc",index:a,field:"email"}})},value:t.email},"placeholder",d("r.email")),"aria-describedby","validationTooltipUsernamePrepend")))),l.createElement("div",{className:"col-5"},l.createElement("input",{type:"text",disabled:e.readOnly,placeholder:d("r.name"),onChange:function(e){return o("set_attribute",{value:{value:e.target.value,type:"bcc",index:a,field:"name"}})},value:t.name,className:"form-control form-control-sm"})),!e.readOnly&&l.createElement("div",{className:"col-1"},l.createElement("i",{className:"material-icons settings text-muted",onClick:function(e){return o("remove_recipient",{recipient:"bcc",index:a})}},"remove")))}))))};const O=l.memo(W);var P=function(e){var t=(0,l.useState)(!1),a=(0,n.A)(t,2);return a[0],a[1],l.createElement(l.Fragment,null,e.status.send&&l.createElement("div",{className:"alert alert-success p-1 ps-2",role:"alert"},"Success!"),!e.status.send&&l.createElement("div",{className:"alert alert-danger p-1 ps-2",role:"alert"},l.createElement("ul",{className:"mb-0"},e.status.errors.general&&l.createElement("li",null,e.status.errors.general),e.status.errors.reply&&l.createElement("li",null,e.status.errors.reply),e.status.errors.content&&l.createElement("li",null,e.status.errors.content)),e.status.errors.raw_error&&l.createElement("div",null,l.createElement("h5",null,"An unknown error happened while sending an email. Please reload a window!"),l.createElement("div",null,l.createElement("button",{onClick:function(){document.location.reload()},className:"btn btn-danger btn-sm"},"Reload this window")),l.createElement("p",null,"Please copy error text and send to your manager!"),l.createElement("textarea",{className:"form-control form-control-sm",rows:"5"},e.status.errors.raw_error))))};const D=l.memo(P);var j=function(e){var t=(0,l.useState)(!1),a=(0,n.A)(t,2),c=a[0],o=a[1],m=(0,l.useState)(!1),d=(0,n.A)(m,2),v=d[0],_=d[1],g=(0,l.useState)(!0),h=(0,n.A)(g,2),b=h[0],E=h[1],y=(0,l.useState)(null),w=(0,n.A)(y,2),N=(w[0],w[1],(0,l.useState)(null)),A=(0,n.A)(N,2),k=A[0],I=A[1],x=(0,l.useState)(null),R=(0,n.A)(x,2),C=R[0],W=R[1],P=(0,l.useState)(!1),j=(0,n.A)(P,2),T=j[0],M=j[1],V=(0,l.useState)([]),J=(0,n.A)(V,2),F=J[0],L=J[1],U=(0,l.useState)([]),q=(0,n.A)(U,2),B=q[0],H=q[1],z=(0,l.useState)([]),$=(0,n.A)(z,2),K=$[0],G=$[1],X=(0,l.useState)(!1),Q=(0,n.A)(X,2),Y=Q[0],Z=Q[1],ee=(0,l.useState)(!1),te=(0,n.A)(ee,2),ae=te[0],ne=te[1],re=(0,l.useState)(!0),le=(0,n.A)(re,2),ie=le[0],se=le[1],ce=(0,l.useState)(!0),oe=(0,n.A)(ce,2),me=oe[0],de=oe[1],ue=(0,l.useReducer)((function(e,t){var a=t.type,n=t.value;switch(a){case"add":return[].concat((0,p.A)(e),[n]);case"cleanup":return[];case"remove":return e.filter((function(e,t){return t!==n}));default:return e}}),[]),pe=(0,n.A)(ue,2),fe=pe[0],ve=pe[1],_e=(0,l.useRef)();_e.current=fe;var ge=function(t){var a={recipients:B,content:tinyMCE.get("reply-to-mce-"+e.message.id).getContent(),attatchements:fe,status:t,mode:1==c?"reply":"forward"};Z(!0),i.A.post(WWW_DIR_JAVASCRIPT+"mailconv/apisendreply/"+e.message.id,a).then((function(t){if("object"!==(0,u.A)(t.data))return Z(!1),void G({send:!1,send_tried:!0,errors:{raw_error:t.data}});G(t.data),Z(!1),1==t.data.send&&(e.fetchMessages(),e.setConversationStatus(t.data.conv_status))})).catch((function(e){Z(!1),e.response?400===e.response.status?G(e.response.data):G({send:!1,send_tried:!0,errors:{raw_error:e.response.data}}):e.request?console.log(e.request):console.log("Error",e.message),console.log(e.config)}))};(0,l.useEffect)((function(){return function(){_e.current.map((function(e,t){!0===e.new&&i.A.get(WWW_DIR_JAVASCRIPT+"file/delete/"+e.id+"/(csfr)/"+confLH.csrf_token+"?react=1")}))}}),[]),(0,l.useEffect)((function(){1!=c&&1!=v||0!=T?0==c&&0==v&&1==T&&(M(!1),_e.current.length>0&&(_e.current.map((function(e,t){!0===e.new&&i.A.get(WWW_DIR_JAVASCRIPT+"file/delete/"+e.id+"/(csfr)/"+confLH.csrf_token+"?react=1")})),ve({type:"cleanup"}))):i.A.post(WWW_DIR_JAVASCRIPT+"mailconv/getreplydata/"+e.message.id+"/"+(1==c?"reply":"forward")).then((function(t){M(!0),I(t.data.intro),W(t.data.signature),L(t.data.recipients),ne(t.data.signature_under),de(t.data.is_self_reply),E(t.data.keep_quote),t.data.user_id>0&&(e.verifyOwner(t.data.user_id),se(t.data.is_owner))}))}),[c,v]),1==e.replyMode&&0==c&&(1==v&&(M(!1),_(!1)),o(!0)),1==e.forwardMode&&0==v&&(1==c&&(M(!1),o(!1)),_(!0));var he=(0,s.B)("mail_chat"),be=he.t;return he.i18n,l.createElement(l.Fragment,null,l.createElement("div",{className:"col-12 mt-2 pt-3 pb-2"},!ie&&l.createElement("div",{className:"alert alert-warning",role:"alert"},l.createElement("span",{className:"material-icons"},"warning"),be("msg.not_an_owner")),c&&me&&l.createElement("div",{className:"alert alert-warning",role:"alert"},l.createElement("span",{className:"material-icons"},"warning"),be("msg.self_reply")),!c&&!v&&!e.fetchingMessages&&l.createElement("div",{className:"btn-group",role:"group","aria-label":"Mail actions"},l.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:function(){_(!1),o(!0)}},l.createElement("i",{className:"material-icons"},"reply"),be("msg.reply")),l.createElement("button",{disabled:1==e.message.response_type,type:"button",className:"btn btn-sm btn-outline-secondary",onClick:function(){return e.noReplyRequired()}},l.createElement("i",{className:"material-icons"},"done"),be("msg.nrr")),!e.moptions.hide_recipients&&l.createElement("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:function(){o(!1),_(!0)}},l.createElement("i",{className:"material-icons"},"forward"),be("msg.forward"))),!e.fetchingMessages&&(c||v)&&T&&l.createElement("div",{className:"shadow p-2"},K.send_tried&&l.createElement(D,{status:K}),l.createElement(O,{readOnly:e.moptions.hide_recipients,setRecipients:function(e){return H(e)},mode:1==c?"reply":"forward",message:e.message,recipients:F}),l.createElement(f.K,{tinymceScriptSrc:e.moptions.tiny_mce_path,initialValue:"<p></p>"+k+(b&&e.message.body_front?"<blockquote>"+(1==e.moptions.skip_images?e.message.body_front.replace(/\<img([^>]*)\ssrc=('|")([^>]*)\2\s([^>]*)\/\>/gi,e.moptions.image_skipped_text):e.message.body_front)+"</blockquote>":"")+(0==ae?C:""),onInit:function(){tinyMCE.get("reply-to-mce-"+e.message.id).focus()},id:"reply-to-mce-"+e.message.id,init:{cache_suffix:"?v="+e.moptions.cache_version_plugin,height:320,automatic_uploads:e.moptions.files_enabled,file_picker_types:"image",images_upload_url:WWW_DIR_JAVASCRIPT+"mailconv/uploadimage/(csrf)/"+confLH.csrf_token,templates:WWW_DIR_JAVASCRIPT+"mailconv/apiresponsetemplates/"+e.message.id,paste_data_images:e.moptions.files_enabled,relative_urls:!1,browser_spellcheck:!0,paste_as_text:!0,contextmenu:!1,menubar:!1,plugins:e.moptions.mce_plugins,toolbar_mode:"wrap",toolbar:e.moptions.mce_toolbar}}),c&&l.createElement("div",{className:"float-end"},l.createElement("a",{className:"action-image",onClick:function(){o(!1),e.cancelReply()}},l.createElement("i",{className:"material-icons"},"delete"))),v&&l.createElement("div",{className:"float-end"},l.createElement("a",{className:"action-image",onClick:function(){_(!1),e.cancelForward()}},l.createElement("i",{className:"material-icons"},"delete"))),l.createElement("div",{className:"btn-group mt-2",role:"group","aria-label":"Mail actions"},l.createElement("button",{type:"button",disabled:Y,className:"btn btn-sm btn-primary",onClick:function(){return ge(2)}},l.createElement("i",{className:"material-icons"},"send"),be(1==Y?"msg.sending":"msg.send_and_close")),e.moptions.send_as_new&&l.createElement("button",{type:"button",disabled:Y,className:"btn btn-sm btn-outline-secondary",onClick:function(){return ge(0)}},l.createElement("i",{className:"material-icons text-warning"},"send"),be(1==Y?"msg.sending":"msg.send_as_pending")),l.createElement("button",{type:"button",disabled:Y,className:"btn btn-sm btn-outline-secondary",onClick:function(){return ge(1)}},l.createElement("i",{className:"material-icons text-success"},"send"),be(1==Y?"msg.sending":"msg.send_as_active"))),e.moptions.files_enabled&&l.createElement("div",{className:"btn-group d-block mt-2",role:"group","aria-label":"Mail actions"},l.createElement(S,{moptions:e.moptions,fileAttached:function(e){return ve({type:"add",value:e})},message:e.message})),fe&&fe.length>0&&l.createElement("div",{className:"pt-2"},fe.map((function(e,t){return l.createElement("button",(0,r.A)({title:be("msg.click_to_remove"),onClick:function(){return function(e,t){ve({type:"remove",value:t}),!0===e.new&&i.A.get(WWW_DIR_JAVASCRIPT+"file/delete/"+e.id+"/(csfr)/"+confLH.csrf_token+"?react=1")}(e,t)},className:"btn btn-sm btn-outline-info me-1 mb-1"},"title",e.id),e.name)}))))))};const T=l.memo(j);var M=a(3986),V=["src","alt","title","className","style","download_policy","width","height"];function J(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function F(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?J(Object(a),!0).forEach((function(t){(0,r.A)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):J(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var L=function(e){var t=e.src,a=e.alt,r=e.title,i=e.className,o=e.style,m=e.download_policy,d=void 0===m?0:m,u=e.width,p=e.height,f=(0,M.A)(e,V),v=(0,l.useState)(!1),_=(0,n.A)(v,2),g=_[0],h=_[1],b=(0,l.useState)(!1),E=(0,n.A)(b,2),y=E[0],w=E[1],N=(0,l.useState)(!0),A=(0,n.A)(N,2),k=A[0],I=A[1],x=(0,l.useState)(!1),S=(0,n.A)(x,2),R=S[0],C=S[1],W=(0,l.useState)(!1),O=(0,n.A)(W,2),P=O[0],D=O[1],j=(0,l.useState)(""),T=(0,n.A)(j,2),J=T[0],L=T[1],U=(0,l.useState)(""),q=(0,n.A)(U,2),B=q[0],H=q[1],z=(0,l.useState)(0),$=(0,n.A)(z,2),K=$[0],G=$[1],X=(0,l.useState)(0),Q=(0,n.A)(X,2),Y=Q[0],Z=Q[1],ee=(0,l.useState)(""),te=(0,n.A)(ee,2),ae=(te[0],te[1]),ne=(0,l.useState)(""),re=(0,n.A)(ne,2),le=re[0],ie=re[1],se=(0,l.useState)(!1),ce=(0,n.A)(se,2),oe=ce[0],me=ce[1],de=(0,l.useState)(!1),ue=(0,n.A)(de,2),pe=ue[0],fe=ue[1],ve=(0,l.useState)(""),_e=(0,n.A)(ve,2),ge=_e[0],he=_e[1],be=(0,l.useState)(""),Ee=(0,n.A)(be,2),ye=Ee[0],we=Ee[1],Ne=(0,l.useState)(null),Ae=(0,n.A)(Ne,2),ke=Ae[0],Ie=Ae[1],xe=(0,l.useState)(null),Se=(0,n.A)(xe,2),Re=Se[0],Ce=Se[1],We=(0,s.B)("mail_chat"),Oe=We.t,Pe=(We.i18n,(0,l.useRef)(null));(0,l.useEffect)((function(){if(t){var e=function(e){if(!e)return{fileId:null,convId:null};var t=e.match(/\/mailconv\/inlinedownload\/(\d+)\/(\d+)/);return t?{fileId:parseInt(t[1],10),convId:parseInt(t[2],10)}:{fileId:null,convId:null}}(t),a=e.fileId,n=e.convId;if(a&&n){Ie(a),Ce(n),he(r||"");var l=parseInt(d,10);0===l?(C(!0),L(window.WWW_DIR_JAVASCRIPT+"mailconv/inlinedownload/"+a+"/"+n)):1===l?(C(!1),Te(a,n)):2===l&&(C(!1),Je(a,n))}else C(!0),L(t)}else D(!0);return function(){De()}}),[d,t,r]);var De=function(){Pe.current&&(clearInterval(Pe.current),Pe.current=null),Z(0)},je=function(){oe&&!pe&&oe&&!pe&&(fe(!0),L(window.WWW_DIR_JAVASCRIPT+"mailconv/inlinedownload/"+ke+"/"+Re))},Te=function(e,t){G(0),H(Oe("image.verifying_access")),Me(e,t)},Me=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=null!==a?a:K;if(n>=8)H(Oe("image.verification_failed"));else{var r=n+1;G(r);var l=window.WWW_DIR_JAVASCRIPT+"mailconv/verifyaccess/"+e+"/"+t;fetch(l,{method:"GET",headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(a){var n=parseInt(d,10);!0===a.verified?a.error_msg?(H(a.error_msg),De(),w(!0)):2===n&&(a.protection_image||a.protection_html)?(H(Oe("image.access_denied")),De(),w(!0)):(C(!0),H(""),De(),a.protection_image?(ae(a.protection_image),me(!0),fe(!1),L(a.protection_image),we(a.btn_title)):a.protection_html?(ie(a.protection_html),me(!0),fe(!1),L("")):L(window.WWW_DIR_JAVASCRIPT+"mailconv/inlinedownload/"+e+"/"+t)):r<8?Ve(r,e,t):H(Oe("image.verification_failed"))})).catch((function(a){console.error("Verification request failed:",a),r<8?Ve(r,e,t):(H(Oe("image.verification_failed")),w(!0))}))}},Ve=function(e,t,a){Z(4),H("".concat(Oe("image.verifying_access")," (").concat(e,"/").concat(8,")")),Pe.current=setInterval((function(){Z((function(n){return n<=1?(clearInterval(Pe.current),Me(t,a,e),0):n-1}))}),1e3)},Je=function(e,t){H(Oe("image.checking_access")),Me(e,t)},Fe=function(){I(!1)},Le=function(){h(!0),I(!1)};return!R&&B&&ke?l.createElement("div",{className:"mail-image-verification text-muted p-2 fs14 border rounded d-inline-block bg-light"},l.createElement("i",{className:"material-icons text-warning"},"info"),l.createElement("span",{className:"ms-1"},0==Y&&K<=1&&!1===y?Oe("image.downloading"):B),Y>0&&l.createElement("span",{className:"text-secondary ms-1"},"(",Oe("image.next_attempt_in")," ",Y," ",Oe("image.seconds"),")")):g?l.createElement("div",{className:"mail-image-error d-inline-block border rounded p-2 text-muted"},l.createElement("i",{className:"material-icons"},"broken_image"),l.createElement("span",{className:"ms-1"},Oe("image.image_not_available")," ",l.createElement("button",{type:"button",onClick:function(){window.open(window.WWW_DIR_JAVASCRIPT+"mailconv/inlinedownload/"+ke+"/"+Re,"_blank")},className:"btn btn-xs btn-secondary"},Oe("image.download"))),a&&l.createElement("div",{className:"small"},a)):R&&(J||le)?oe&&!pe?le?l.createElement("div",{id:"mail-img-reveal-holder-".concat(ke),className:"mail-image-protected-html action-image protected-html",onClick:je,tabIndex:"0",role:"button","aria-label":Oe("image.click_to_reveal"),style:{cursor:"pointer"},dangerouslySetInnerHTML:{__html:le}}):l.createElement("div",{id:"mail-img-reveal-holder-".concat(ke),className:"mail-image-protected action-image protected-image clickable-reveal position-relative d-inline-block",onClick:je,tabIndex:"0",role:"button","aria-label-title":ye,"aria-label":Oe("image.click_to_reveal"),style:{cursor:"pointer"}},l.createElement("img",{id:"mail-img-file-".concat(ke),src:J,alt:ge,title:ge,className:"action-image img-fluid ".concat(i||""),width:u,height:p,onLoad:Fe,onError:Le})):l.createElement(l.Fragment,null,k&&l.createElement("div",{className:"mail-image-loading position-absolute d-flex align-items-center justify-content-center w-100 h-100"},l.createElement("div",{className:"spinner-border spinner-border-sm text-muted",role:"status"},l.createElement("span",{className:"visually-hidden"},Oe("image.loading")))),l.createElement("img",(0,c.A)({id:"mail-img-file-".concat(ke),src:J,alt:ge||a||"",title:ge||r||a||"",className:" ".concat(i||""),style:F({maxWidth:"100%",height:"auto"},o),width:u,height:p,onLoad:Fe,onError:Le},f))):P?l.createElement("div",{className:"mail-image-verification text-muted mt-1 p-2 fs14 border rounded d-inline-block bg-light"},l.createElement("i",{className:"material-icons text-danger"},"info"),a," [",Oe("image.not_found"),"]"):l.createElement("div",{className:"mail-image-container d-inline-block position-relative"},k&&l.createElement("div",{className:"mail-image-loading position-absolute d-flex align-items-center justify-content-center ms-2 w-100 h-100"},l.createElement("div",{className:"spinner-border spinner-border-sm text-muted",role:"status"},"   ")))};const U=l.memo(L);var q=["id","name","description","download_url","is_image","download_policy","restricted_file","restricted_reason","download_modal"],B=function(e){e.id;var t=e.name,a=e.description,r=e.download_url,i=e.is_image,o=void 0!==i&&i,m=e.download_policy,d=void 0===m?0:m,u=e.restricted_file,p=void 0!==u&&u,f=e.restricted_reason,v=void 0===f?0:f,_=e.download_modal,g=void 0!==_&&_,h=(0,M.A)(e,q),b=(0,l.useState)("idle"),E=(0,n.A)(b,2),y=E[0],w=E[1],N=(0,l.useState)(""),A=(0,n.A)(N,2),k=A[0],I=A[1],x=(0,l.useState)(0),S=(0,n.A)(x,2),R=S[0],C=S[1],W=(0,l.useState)(0),O=(0,n.A)(W,2),P=O[0],D=O[1],j=(0,l.useState)(null),T=(0,n.A)(j,2),V=T[0],J=T[1],F=(0,l.useState)(null),L=(0,n.A)(F,2),U=L[0],B=L[1],H=(0,l.useState)(!1),z=(0,n.A)(H,2),$=z[0],K=z[1],G=(0,l.useState)(""),X=(0,n.A)(G,2),Q=X[0],Y=X[1],Z=(0,l.useState)(!1),ee=(0,n.A)(Z,2),te=ee[0],ae=ee[1],ne=(0,l.useState)(""),re=(0,n.A)(ne,2),le=re[0],ie=re[1],se=(0,s.B)("mail_chat"),ce=se.t,oe=(se.i18n,(0,l.useRef)(null)),me=function(e){switch(parseInt(e,10)){case 1:return ce("file.no_permission_download");case 2:return ce("file.extension_not_allowed");default:return ce("file.access_restricted")}};(0,l.useEffect)((function(){if(r){if(p)return K(!1),w("denied"),void I(me(v));var e=function(e){if(!e)return{fileId:null,convId:null};var t=e.match(/\/mailconv\/inlinedownload\/(\d+)\/(\d+)/);return t?{fileId:parseInt(t[1],10),convId:parseInt(t[2],10)}:{fileId:null,convId:null}}(r),t=e.fileId,a=e.convId;t&&a?(J(t),B(a),0!==parseInt(d,10)&&o?(K(!1),w("idle")):(K(!0),Y(r),w("verified"))):(K(!0),Y(r),w("verified"))}return function(){de()}}),[d,r,p,v]);var de=function(){oe.current&&(clearInterval(oe.current),oe.current=null),D(0)},ue=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=null!==a?a:R;if(n>=8)return w("failed"),void I(ce("image.verification_failed"));var r=n+1;C(r);var l=window.WWW_DIR_JAVASCRIPT+"mailconv/verifyaccess/"+e+"/"+t;fetch(l,{method:"GET",headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(a){var n=parseInt(d,10);!0===a.verified?a.error_msg?(w("failed"),I(a.error_msg),de()):2===n&&(a.protection_image||a.protection_html)?(w("denied"),I(ce("image.access_denied")),de()):(w("verified"),K(!0),Y(window.WWW_DIR_JAVASCRIPT+"mailconv/inlinedownload/"+e+"/"+t),I(""),de(),a.protection_image||a.protection_html?(ae(!0),ie(a.btn_title||"")):(ae(!1),ie(""))):r<8?pe(r,e,t):(w("failed"),I(ce("image.verification_failed")))})).catch((function(a){console.error("Verification request failed:",a),r<8?pe(r,e,t):(w("failed"),I(ce("image.verification_failed")))}))},pe=function(e,t,a){D(4),I("".concat(ce("image.verifying_access")," (").concat(e,"/").concat(8,")")),oe.current=setInterval((function(){D((function(n){return n<=1?(clearInterval(oe.current),ue(t,a,e),0):n-1}))}),1e3)};return l.createElement("button",(0,c.A)({className:function(){var e="btn btn-sm me-1";if(p)return e+" btn-secondary";if(!o||"verified"===y)return e+" btn-outline-info";switch(y){case"verifying":return e+" btn-warning";case"failed":case"denied":return e+" btn-danger";default:return e+" btn-outline-info"}}(),onClick:function(e){var t,a;e.preventDefault(),p||(o&&"verified"!==y?"idle"!==y&&"failed"!==y||(t=V,a=U,C(0),w("verifying"),I(ce("image.verifying_access")),ue(t,a)):$&&Q&&(g&&o?lhc.revealModal({title:ce("file.preview"),url:Q.replace("mailconv/inlinedownload/","mailconv/inlinedownloadmodal/")}):window.open(Q,"_blank")))},title:function(){if(p)return me(v);if(!o)return a||t;switch(y){case"verifying":return k+(P>0?" (".concat(P,"s)"):"");case"verified":default:return a||t;case"failed":case"denied":return k}}(),disabled:p||o&&"verifying"===y||o&&"denied"===y||o&&"failed"===y},h),l.createElement("i",{className:"material-icons me-1 fs14"},function(){if(p)return"lock";if(!o)return"attach_file";switch(y){case"verifying":return"hourglass_empty";case"verified":return"verified";case"failed":return"warning";case"denied":return"block";default:return"image"}}()),p?"".concat(t," - 🔒 ")+me(v):"verifying"===y&&R<=1&&0===P?"".concat(t," ").concat(ce("image.downloading")):"verifying"===y&&P>0?"".concat(t," (").concat(P,"s)"):o&&"verified"===y?te&&le?"".concat(t," - 🔒 ").concat(le):"".concat(t," - ✔️ ").concat(ce("image.click_to_download")):o&&"failed"===y?"".concat(t," - ⚠️ ").concat(k):t)};const H=l.memo(B);var z=function(e){var t=e.message,a=e.index,r=e.totalMessages,m=e.noReplyRequired,u=e.mode,p=e.addLabel,f=e.moptions,v=e.fetchMessages,_=e.fetchingMessages,g=e.verifyOwner,h=e.setConversationStatus,b=e.updateMessages,E=e.loadMessageBody,y=e.keyword,w=(0,l.useState)(!1),N=(0,n.A)(w,2),A=N[0],k=N[1],I=(0,l.useState)(!1),x=(0,n.A)(I,2),S=x[0],R=x[1],C=(0,l.useState)(!1),W=(0,n.A)(C,2),O=W[0],P=W[1],D=(0,l.useState)(!!t.undelivered),j=(0,n.A)(D,2),M=j[0],V=j[1],J=(0,l.useState)(!1),F=(0,n.A)(J,2),L=F[0],q=F[1],B=(0,l.useState)(!1),z=(0,n.A)(B,2),$=z[0],K=z[1],G=(0,l.useState)(!1),X=(0,n.A)(G,2),Q=X[0],Y=X[1],Z=function(e){var t={};return e.split(";").forEach((function(e){var a=e.split(":"),r=(0,n.A)(a,2),l=r[0],i=r[1];if(l){var s=function(e){var t=e.split("-");return 1===t.length?t[0]:t[0]+t.slice(1).map((function(e){return e[0].toUpperCase()+e.slice(1)})).join("")}(l.trim());t[s]=i.trim()}})),t};1!=_||1!=L&&1!=$||(q(!1),K(!1));var ee=function(e){P(e),1==e&&void 0===t.body_front&&void 0===t.alt_body&&(k(!0),i.A.post(WWW_DIR_JAVASCRIPT+"mailconv/loadmessagebody/"+t.id+"/"+t.conversation_id,{keyword:y}).then((function(e){E(e.data),k(!1)})).catch((function(e){})))};(a+1==r&&!1===O&&!1===A||!1===A&&!0===O&&void 0===t.body_front&&void 0===t.alt_body)&&ee(!0);var te=(0,s.B)("mail_chat"),ae=te.t;return te.i18n,l.createElement("div",{className:"row pb-2 mb-2 border-secondary"+("preview"!==u?" border-top pt-2":" border-bottom")},l.createElement("div",{className:"col-7 action-image",onClick:function(){return ee(!O)}},l.createElement("span",{title:"Expand message "+t.id},l.createElement("i",{className:"material-icons"},O?"expand_less":"expand_more")),l.createElement("b",null,t.from_name),l.createElement("small",null," <",t.from_address,"> "),t.opened_at&&l.createElement("span",{className:"material-icons text-success",title:t.opened_at_front},"visibility"),l.createElement("span",{className:"material-icons "+(t.is_external?"chat-pending":"chat-active"),title:t.is_external?ae("msg.external_email"):ae("msg.internal_email")},t.is_external?"location_away":"location_home"),l.createElement("small",{className:t.status&&1!=t.status?t.cls_time?"chat-closed":"chat-active":"chat-pending"},l.createElement("i",{className:"material-icons"},"mail_outline"),t.status&&1!=t.status?ae("msg.rsp"):ae("msg.pnd_rsp")),t.conversation_id_old&&l.createElement("small",{className:"text-muted",title:ae("msg.merged_message")},l.createElement("span",{className:"material-icons me-0"},"merge_type"),t.conversation_id_old)),l.createElement("div",{className:"col-5 text-end text-muted"},l.createElement("small",{className:"pe-1"},t.subjects&&t.subjects.map((function(e,t){return l.createElement("span",{className:"badge me-1",style:{"background-color":e.color?"#"+e.color:"#0dcaf0"}},e.name)})),"preview"!==u&&f.can_write&&l.createElement(l.Fragment,null,l.createElement("i",{title:ae("msg.ar_label"),onClick:function(){return p(t)},className:"material-icons action-image text-muted"},"label")," |")),l.createElement("small",{className:"pe-2"},t.opened_at&&l.createElement("span",{className:"material-icons",title:ae("msg.opened_at_message")+t.opened_at_front},"visibility"),t.udate_front," | ",t.udate_ago," ",ae("msg.ago"),"."),"preview"!==u&&f.can_write&&l.createElement("i",{onClick:function(e){e.stopPropagation(),K(!1),q(!0)},className:"material-icons settings text-muted"},"reply"),l.createElement("i",{onClick:function(e){e.stopPropagation(),R(!S)},className:"material-icons settings text-muted"},S?"expand_less":"expand_more"),"preview"!==u&&l.createElement("div",{className:"dropdown float-end"},l.createElement("i",{className:"material-icons settings text-muted",id:"message-id-"+t.id,"data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},"more_vert"),l.createElement("div",{className:"dropdown-menu","aria-labelledby":"message-id-"+t.id},f.can_write&&l.createElement("a",{className:"dropdown-item",href:"#",onClick:function(e){e.stopPropagation(),K(!1),q(!0)}},l.createElement("i",{className:"material-icons text-muted"},"reply"),ae("msg.reply")),f.can_write&&f.can_forward&&l.createElement("a",{className:"dropdown-item",href:"#",onClick:function(e){e.stopPropagation(),q(!1),K(!0)}},l.createElement("i",{className:"material-icons text-muted"},"forward"),ae("msg.forward")),t.conversation_id_old&&l.createElement("a",{className:"dropdown-item",href:"#",onClick:function(e){e.stopPropagation(),function(e){confirm(ae("status.are_you_sure"))&&i.A.post(WWW_DIR_JAVASCRIPT+"mailconv/apiunmerge/"+e.id+"/"+e.conversation_id).then((function(e){b()})).catch((function(e){var t;(t=e).isAxiosError&&!t.response?alert(ae("system.error")):t.response.data.error?alert(t.response.data.error):alert(JSON.stringify(t.response.data))}))}(t)}},l.createElement("i",{className:"material-icons"},"alt_route"),ae("msg.unmerge")),l.createElement("a",{className:"dropdown-item",target:"_blank",href:WWW_DIR_JAVASCRIPT+"mailconv/mailprint/"+t.id+"/"+t.conversation_id},l.createElement("i",{className:"material-icons text-muted"},"print"),ae("mail.print")),f.can_download&&l.createElement("a",{className:"dropdown-item",href:WWW_DIR_JAVASCRIPT+"mailconv/apimaildownload/"+t.id+"/"+t.conversation_id},l.createElement("i",{className:"material-icons text-muted"},"cloud_download"),ae("msg.download")),f.mail_links&&f.mail_links.map((function(e,a){return l.createElement("a",{className:"dropdown-item",target:"_blank",href:e.link.replace("{msg_id}",t.id)},e.icon&&l.createElement("i",{className:"material-icons text-muted"},e.icon),e.title)})),f.can_write&&l.createElement("a",{className:"dropdown-item",href:"#",onClick:function(){return m(t)}},l.createElement("i",{className:"material-icons text-muted"},"done"),ae("msg.no_reply")),t.alt_body&&l.createElement("a",{className:"dropdown-item",href:"#",onClick:function(e){return V(!M)}},l.createElement("i",{className:"material-icons text-muted"},"visibility"),ae("msg.plain_html"))))),S&&l.createElement("div",{className:"col-12"},l.createElement("div",{className:"card"},l.createElement("div",{className:"card-body"},l.createElement("h6",{className:"card-subtitle mb-2 text-muted"},ae("msg.info")),l.createElement("div",{className:"row"},l.createElement("div",{className:"col-12 fs13"},l.createElement("strong",null,ae("mail.subject"),":")," ",l.createElement("span",{className:"text-muted"},t.subject)),l.createElement("div",{className:"col-6"},l.createElement("ul",{className:"fs13 mb-0 list-unstyled"},l.createElement("li",null,l.createElement("span",{className:"text-muted"},ae("msg.from"),":")," ",l.createElement("b",null,t.from_name)," <",t.from_address,">"),l.createElement("li",null,l.createElement("span",{className:"text-muted"},ae("msg.to"),":")," ",t.to_data_front),t.cc_data_front&&l.createElement("li",null,l.createElement("span",{className:"text-muted"},"cc:")," ",t.cc_data_front),l.createElement("li",null,l.createElement("span",{className:"text-muted"},"id:")," ",t.message_id),t.bcc_data_front&&l.createElement("li",null,l.createElement("span",{className:"text-muted"},"bcc:")," ",t.bcc_data_front),l.createElement("li",null,l.createElement("span",{className:"text-muted"},ae("msg.reply_to"),":")," ",t.reply_to_data_front),l.createElement("li",null,l.createElement("span",{className:"text-muted"},ae("msg.mailed_by"),":")," ",t.from_host))),l.createElement("div",{className:"col-6"},l.createElement("ul",{className:"fs13 mb-0 list-unstyled"},t.accept_time_front&&l.createElement("li",null,ae("mail.accepted_at"),": ",t.accept_time_front),t.plain_user_name&&l.createElement("li",{"data-id":t.user_id},ae("mail.accepted_by"),": ",l.createElement("b",null,t.plain_user_name)),t.wait_time&&l.createElement("li",null,ae("mail.accept_wait_time"),": ",t.wait_time_pending),t.lr_time&&t.response_time&&l.createElement("li",null,ae("mail.response_wait_time"),": ",t.wait_time_response,", ",ae("mail.exc_pending_time")),l.createElement("li",{"data-id":t.response_type},ae("mail.rsp_type"),": ",1==t.response_type?ae("msg.nrr"):2==t.response_type?ae("msg.orm"):3==t.response_type?ae("msg.rbe"):ae("msg.unr")),t.interaction_time&&l.createElement("li",null,ae("mail.interaction_time"),": ",t.interaction_time_duration),t.cls_time&&l.createElement("li",null,ae("mail.closed_at"),": ",t.cls_time_front),t.conv_duration_front&&l.createElement("li",null,ae("mail.response_wait_time"),": ",t.conv_duration_front),l.createElement("li",null,ae("mail.message_id"),": ",t.id))))))),O&&t.undelivered&&l.createElement("div",{className:"col-12 alert alert-warning mt-2"},"This message was undelivered. ",l.createElement("a",{href:WWW_DIR_JAVASCRIPT+"mailconv/downloadrfc822/"+t.id+"/"+t.conversation_id},"Download sent message."),l.createElement("div",{className:"text-danger border-bottom my-2 py-2 fs13"},l.createElement("ul",{className:"m-0 ps-3"},t.delivery_status_keyed.Diagnostic_Code&&l.createElement("li",null,t.delivery_status_keyed.Diagnostic_Code),t.delivery_status_keyed.taken&&l.createElement("li",null,t.delivery_status_keyed.taken))),t.delivery_status_keyed&&l.createElement("button",{onClick:function(e){return Y(!Q)},className:"btn fs12 btn-link"},"Show technical information."),Q&&t.delivery_status_keyed&&l.createElement("div",null,l.createElement("pre",null,JSON.stringify(t.delivery_status_keyed,null,2)))),O&&M&&t.alt_body&&l.createElement("div",{className:"col-12 mail-message-body pt-2 pb-2"},l.createElement("pre",{className:"fs12"},t.alt_body)),O&&t.body_front&&!M&&l.createElement("div",{className:"col-12 mail-message-body pt-2 pb-2"},(0,o.Ay)(t.body_front,{replace:function(e){if(e.attribs){if(Object.assign({},e.attribs),e.attribs.class&&(e.attribs.className=e.attribs.class,delete e.attribs.class),e.name&&"img"===e.name)return e.attribs.style&&(e.attribs.style=Z(e.attribs.style)),l.createElement(U,(0,c.A)({download_policy:f.download_policy,src:e.attribs.src,alt:e.attribs.alt,title:e.attribs.title,className:e.attribs.className,style:e.attribs.style},e.attribs));if(e.name&&"blockquote"===e.name)return e.attribs.style&&(e.attribs.style=Z(e.attribs.style)),l.createElement("blockquote",e.attribs,l.createElement(d,null,(0,o.zd)(e.children,{replace:function(e){if(e.attribs&&(e.attribs.class&&(e.attribs.className=e.attribs.class,delete e.attribs.class),e.name&&"img"===e.name))return e.attribs.style&&(e.attribs.style=Z(e.attribs.style)),l.createElement(U,(0,c.A)({download_policy:f.download_policy,src:e.attribs.src,alt:e.attribs.alt,title:e.attribs.title,className:e.attribs.className,style:e.attribs.style},e.attribs))}})))}}})),O&&t.attachments&&t.attachments.length>0&&l.createElement("div",{className:"pb-2 col-12"},t.attachments.map((function(e){return l.createElement(H,{key:e.id,id:e.id,name:e.name,description:e.description,download_url:e.download_url,is_image:e.is_image,download_policy:f.download_policy,restricted_file:e.restricted_file,restricted_reason:e.restricted_reason,download_modal:f.download_modal})}))),"preview"!==u&&f.can_write&&!_&&(a+1==r||L||$)&&l.createElement(T,{setConversationStatus:h,verifyOwner:g,fetchingMessages:_,fetchMessages:function(e){return v()},moptions:f,forwardMode:$,cancelForward:function(e){return K(!1)},cancelReply:function(e){return q(!1)},replyMode:L,lastMessage:a+1==r,message:t,noReplyRequired:function(){return m(t)}}))};const K=l.memo(z);function G(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function X(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?G(Object(a),!0).forEach((function(t){(0,r.A)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):G(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Q(e,t){switch(t.type){case"increment":return{count:e.count+1};case"decrement":case"init":return{count:e.count-1};case"update":return X(X({},e),t.value);case"update_conversation":return e.conv=X(X({},e.conv),t.value),X({},e);case"update_subjects":var a=e.messages.findIndex((function(e){return e.id==t.message_id}));return e.messages[a].subjects=t.subjects,e=X({},e);case"update_message":return a=e.messages.findIndex((function(e){return e.id==t.message.id})),e.messages[a]=t.message,t.conv&&(e.conv=t.conv),t.fetching_messages&&(e.fetching_messages=t.fetching_messages),e=X({},e);case"update_watching_ops":return a=e.op_watching.findIndex((function(e){return e.user_id==t.watcher.user_id})),!0===t.watcher.status?-1===a?confLH.user_id!=t.watcher.user_id&&(t.watcher.ts=Math.floor(Date.now()/1e3),e.op_watching.push(t.watcher)):e.op_watching[a].ts=Math.floor(Date.now()/1e3):!1===t.watcher.status&&-1!==a&&e.op_watching.splice(a,1),e.op_watching.forEach((function(t,a){t.ts<Math.floor(Date.now()/1e3)-15&&e.op_watching.splice(a,1)})),X({},e);case"update_history":return e=X(X({},e),t.value),""!=t.history.msg&&e.messages.unshift(t.history),e;default:throw new Error("Unknown action!")}}i.A.defaults.headers.common["X-CSRFToken"]=confLH.csrf_token;const Y=function(e){(0,l.useRef)(null),(0,l.useRef)(null);var t=(0,l.useRef)(null),a=(0,l.useReducer)(Q,{messages:[],operators:[],op_watching:[],conv:null,loaded:!1,saving_remarks:!1,close_mode:!1,old_message_id:0,last_message:"",remarks:"",last_message_id:0,lmsop:0,lgsync:0,fetching_messages:!1,expand_messages:!1}),r=(0,n.A)(a,2),c=r[0],o=r[1],m=function(e){i.A.get(WWW_DIR_JAVASCRIPT+"mailconv/apigetlabels/"+e.id+"/"+e.conversation_id).then((function(t){o({type:"update_subjects",message_id:e.id,subjects:t.data})})).catch((function(e){}))},d=function(){i.A.post(WWW_DIR_JAVASCRIPT+"mailconv/loadmainconv/"+e.chatId+"/(mode)/"+(""!=e.mode?e.mode:"normal"),{keyword:e.keyword}).then((function(t){o({type:"update",value:{conv:t.data.conv,customer_remarks:t.data.customer_remarks,messages:t.data.messages,moptions:t.data.moptions,loaded:!0,fetching_messages:!1}}),!1===e.disableRemember&&"preview"!==e.mode&&function(e){if(localStorage)try{var t=[],a=localStorage.getItem("machat_id");null!==a&&""!==a&&(t=a.split(",")),-1===t.indexOf(e)&&(t.push(e),localStorage.setItem("machat_id",t.join(",")))}catch(e){}}(e.chatId),"preview"!==e.mode&&t.data.conv.pending_sync&&u()})).catch((function(t){lhinst.removeDialogTabMail("mc"+e.chatId,$("#tabs"),!0)}))},u=function(e){o({type:"update",value:{fetching_messages:!0}}),p(Math.floor(Date.now()/1e3))},p=function(t){i.A.get(WWW_DIR_JAVASCRIPT+"mailconv/apifetchmails/"+e.chatId+"/"+t).then((function(e){1==e.data.updated?d():setTimeout((function(){return p(t)}),3e3)}))},f=function(e){lhc.revealModal({url:WWW_DIR_JAVASCRIPT+e.url})};(0,l.useEffect)((function(){if(null!==c.conv){var t=setTimeout((function(){i.A.post(WWW_DIR_JAVASCRIPT+"mailconv/saveremarks/"+e.chatId,{data:c.remarks}).then((function(e){o({type:"update",value:{saving_remarks:!1}})}))}),500);return function(){return clearTimeout(t)}}}),[c.remarks]),(0,l.useEffect)((function(){if(null!==c.conv){var t=setTimeout((function(){i.A.post(WWW_DIR_JAVASCRIPT+"mailconv/saveremarks/"+e.chatId+"/(type)/customer",{data:c.customer_remarks}).then((function(e){o({type:"update",value:{saving_customer_remarks:!1}})}))}),500);return function(){return clearTimeout(t)}}}),[c.customer_remarks]),(0,l.useEffect)((function(){function t(t){e.chatId==t&&d()}function a(t,a){e.chatId==t&&m({id:a})}function n(t){e.chatId==t.id&&o({type:"update_watching_ops",watcher:t})}return d(),ee.addListener("mailChatModified",t),ee.addListener("mailLabelsModified",a),ee.addListener("mailMerged",t),ee.addListener("mail.op_watching",n),function(){ee.removeListener("mailChatModified",t),ee.removeListener("mailLabelsModified",a),ee.removeListener("mail.op_watching",n),ee.emitEvent("mailChatContentUnLoaded",[e.chatId]),function(e){if(localStorage)try{var t=[],a=localStorage.getItem("machat_id");null!==a&&""!==a&&(t=a.split(",")),-1!==t.indexOf(e)&&t.splice(t.indexOf(e),1),localStorage.setItem("machat_id",t.join(","))}catch(e){}}(e.chatId)}}),[]),(0,l.useEffect)((function(){1==c.loaded&&(t.current,ee.emitEvent("mailChatContentLoaded",[e.chatId]))}),[c.loaded]);var v=(0,s.B)("mail_chat"),_=v.t;return v.i18n,0==c.loaded?l.createElement("span",null,"..."):l.createElement(l.Fragment,null,l.createElement("div",{className:"row"},l.createElement("div",{className:"chat-main-left-column "+("preview"==e.mode?"col-12":"col-7")},"preview"!==e.mode&&l.createElement("h1",{className:"pb-2"},l.createElement("i",{className:"material-icons"},1==c.conv.start_type?"call_made":"call_received"),c.conv.undelivered&&l.createElement("i",{title:"Undelivered e-mail",className:"text-danger material-icons"},"sms_failed"),c.conv.subject),l.createElement("div",null,c.messages.map((function(t,a){if(1==c.expand_messages||c.messages.length<5||0==a||c.messages.length==a+1||c.messages.length-2==a)return l.createElement(l.Fragment,{key:"msg-mail-hold-"+e.chatId+"_"+a+"_"+t.id},0==c.expand_messages&&c.messages.length>=5&&c.messages.length-2==a&&l.createElement("div",{className:"previous-mails-row",onClick:function(){return o({type:"update",value:{expand_messages:!0}})}},l.createElement("span",{className:"previous-number",title:_("mail.previous_messages")},c.messages.length-3)),l.createElement(K,{setConversationStatus:function(e){o({type:"update_conversation",value:{status:e}})},verifyOwner:function(e){e!=c.conv.user_id&&d()},moptions:c.moptions,fetchMessages:function(e){return u(t)},fetchingMessages:c.fetching_messages,mode:e.mode,key:"msg_mail_"+e.chatId+"_"+a+"_"+t.id,totalMessages:c.messages.length,index:a,message:t,noReplyRequired:function(e){return function(e){i.A.post(WWW_DIR_JAVASCRIPT+"mailconv/apinoreplyrequired/"+e.id+"/"+e.conversation_id).then((function(e){o({type:"update_message",message:e.data.message,conv:e.data.conv})})).catch((function(e){}))}(t)},addLabel:function(e){return function(e){lhc.revealModal({url:WWW_DIR_JAVASCRIPT+"mailconv/apilabelmessage/"+e.id+"/"+e.conversation_id,hidecallback:function(){m(e)}})}(t)},updateMessages:function(e){return d()},keyword:e.keyword,loadMessageBody:function(e){return function(e,t){o({type:"update_message",message:t.message,conv:t.conv})}(0,e)}}))})),c.fetching_messages&&l.createElement("div",{className:"alert alert-success p-1 ps-2",role:"alert"},_("mail.send_fetching")))),l.createElement("div",{className:"chat-main-right-column "+("preview"==e.mode?"d-none":"col-5")},l.createElement("div",{role:"tabpanel"},l.createElement("ul",{className:"nav nav-pills",role:"tablist",ref:t},l.createElement("li",{role:"presentation",className:"nav-item"},l.createElement("a",{className:"nav-link active",href:"#mail-chat-info-"+e.chatId,"aria-controls":"#mail-chat-info-"+e.chatId,title:_("mail.information"),role:"tab","data-bs-toggle":"tab"},l.createElement("i",{className:"material-icons me-0"},"info_outline"))),l.createElement("li",{role:"presentation",className:"nav-item"},l.createElement("a",{className:"nav-link",href:"#mail-chat-remarks-"+e.chatId,"aria-controls":"#mail-chat-remarks-"+e.chatId,role:"tab","data-bs-toggle":"tab",title:_("mail.remarks")},l.createElement("i",{className:"material-icons me-0"},"mode_edit")))),l.createElement("div",{className:"tab-content"},l.createElement("div",{role:"tabpanel",className:"tab-pane",id:"mail-chat-remarks-"+e.chatId},l.createElement("div",{className:"pb-1 text-success"+(c.saving_customer_remarks?" text-warning":"")},l.createElement("span",{className:"material-icons"},"mode_edit")," Customer remarks"),l.createElement("div",null,l.createElement("textarea",{disabled:!c.moptions.can_write,placeholder:"Enter your remarks here.",onKeyUp:function(e){return t=e.target.value,void o({type:"update",value:{saving_customer_remarks:!0,customer_remarks:t}});var t},className:"form-control mh150",defaultValue:c.customer_remarks})),l.createElement("div",{className:"pb-1 text-success"+(c.saving_remarks?" text-warning":"")},l.createElement("span",{className:"material-icons"},"mode_edit")," Conversation remarks"),l.createElement("div",null,c.conv&&l.createElement("textarea",{disabled:!c.moptions.can_write,placeholder:"Enter your remarks here.",onKeyUp:function(e){return t=e.target.value,void o({type:"update",value:{saving_remarks:!0,remarks:t}});var t},className:"form-control mh150",defaultValue:c.conv.remarks}))),l.createElement("div",{role:"tabpanel",className:"tab-pane active",id:"mail-chat-info-"+e.chatId},c.moptions.can_close&&l.createElement("div",{className:"pb-2"},0==c.close_mode&&l.createElement("a",{className:"btn btn-outline-secondary btn-sm",onClick:function(){return o({type:"update",value:{close_mode:!0}})}},l.createElement("i",{className:"material-icons"},"close"),_("mail.close")),1==c.close_mode&&l.createElement("p",{className:"fs14 mb-2"},_("mail.sure_close")),1==c.close_mode&&l.createElement("div",{className:"btn-group"},l.createElement("button",{type:"button",className:"btn btn-danger btn-sm",onClick:function(){return e=!1,c.messages.forEach((function(t){2!=t.status&&(e=!0)})),void((0==e||confirm(_("status.unresponded_messages")))&&i.A.post(WWW_DIR_JAVASCRIPT+"mailconv/apicloseconversation/"+c.conv.id).then((function(e){o({type:"update",value:{conv:e.data.conv,messages:e.data.messages}}),document.getElementById("chat-tab-link-mc"+c.conv.id)&&lhinst.removeDialogTabMail("mc"+c.conv.id,$("#tabs"),!0)})).catch((function(e){})));var e}},_("mail.yes")),l.createElement("button",{type:"button",className:"btn btn-success btn-sm",onClick:function(){return o({type:"update",value:{close_mode:!1}})}},_("mail.no")))),l.createElement("div",{id:"mail-external-details-"+e.chatId}),c.conv&&l.createElement("table",{className:"table table-sm"},l.createElement("tbody",null,l.createElement("tr",null,l.createElement("td",{colSpan:"2"},l.createElement("div",{className:"row"},l.createElement("div",{className:"col-6"},l.createElement("span",{className:"action-image",onClick:function(){return f({url:"mailconv/mailhistory/"+e.chatId})}},l.createElement("i",{className:"material-icons"},"history"),_("mail.interactions_history"))),c.moptions.can_write&&l.createElement("div",{className:"col-6"},l.createElement("span",{className:"action-image",onClick:function(){return f({url:"mailconv/transfermail/"+e.chatId})}},l.createElement("i",{className:"material-icons"},"supervisor_account"),_("mail.transfer_chat"))),c.moptions.can_write&&l.createElement("div",{className:"col-6"},l.createElement("span",{className:"action-image",onClick:function(){return f({url:"mailconv/merge/"+e.chatId})}},l.createElement("i",{className:"material-icons"},"merge_type"),_("mail.merge_chat"))),l.createElement("div",{className:"col-6"},l.createElement("a",{className:"text-dark",target:"_blank",href:WWW_DIR_JAVASCRIPT+"mailconv/mailprintcovnersation/"+e.chatId},l.createElement("i",{className:"material-icons"},"print"),_("mail.print"))),c.moptions.can_write&&c.conv.can_delete&&l.createElement("div",{className:"col-6"},l.createElement("span",{className:"action-image me-0",onClick:function(e){confirm("Are you sure?")&&i.A.post(WWW_DIR_JAVASCRIPT+"mailconv/apideleteconversation/"+c.conv.id).then((function(e){document.getElementById("chat-tab-link-mc"+c.conv.id)?lhinst.removeDialogTabMail("mc"+c.conv.id,$("#tabs"),!0):document.location=WWW_DIR_JAVASCRIPT+"mailconv/conversations"})).catch((function(e){}))}},l.createElement("i",{className:"material-icons"},"delete"),_("mail.delete")))))),l.createElement("tr",null,l.createElement("td",null,_("mail.sender")),l.createElement("td",null,c.conv.lang&&c.moptions.lang_dir&&l.createElement("img",{src:c.moptions.lang_dir+"/"+c.conv.lang+".png"})," ",c.conv.from_name," <",c.conv.from_address,"> ",l.createElement("span",{className:"action-image"+(c.moptions.is_blocked?" text-danger fw-bold":""),onClick:function(){return f({url:"mailconv/blocksender/"+e.chatId})}},l.createElement("span",{className:"material-icons"},"block"),c.moptions.is_blocked?_("mail.is_blocked"):_("mail.block")))),(c.conv.phone||c.conv.phone_front)&&l.createElement("tr",null,l.createElement("td",null,_("mail.phone")),l.createElement("td",null,c.conv.phone&&l.createElement("a",{href:"tel:"+c.conv.phone},l.createElement("span",{className:"material-icons"},"dialpad"),c.conv.phone_front),!c.conv.phone&&l.createElement(l.Fragment,null,l.createElement("span",{className:"material-icons"},"dialpad"),c.conv.phone_front))),l.createElement("tr",null,l.createElement("td",{colSpan:"2"},!c.conv.status&&l.createElement("span",null,l.createElement("i",{className:"material-icons chat-pending"},"mail_outline"),_("status.pending")),(!c.conv.status||1==c.conv.status)&&c.conv.opened_at&&l.createElement("span",null,l.createElement("span",{className:"ms-2 material-icons text-success",title:_("status.opened_at")},"visibility"),c.conv.opened_at_front),(2==c.conv.status||1==c.conv.status)&&l.createElement("div",{className:"input-group input-group-sm"},l.createElement("span",{className:"input-group-text"},!c.conv.status&&l.createElement("i",{className:"material-icons chat-pending me-0"},"mail_outline"),1==c.conv.status&&l.createElement("i",{className:"material-icons chat-active me-0"},"mail_outline"),2==c.conv.status&&l.createElement("i",{className:"material-icons chat-closed me-0"},"mail_outline")),l.createElement("select",{disabled:c.moptions.is_archive,className:"form-control form-control-sm",value:c.conv.status,onChange:function(e){return function(e){confirm(_("status.are_you_sure"))&&i.A.post(WWW_DIR_JAVASCRIPT+"mailconv/apichangestatus/"+c.conv.id+"/"+e.target.value).then((function(e){o({type:"update",value:{conv:e.data.conv}})})).catch((function(e){var t;(t=e).isAxiosError&&!t.response?alert(_("system.error")):t.response.data.error?alert(t.response.data.error):alert(JSON.stringify(t.response.data))}))}(e)}},l.createElement("option",{value:""},_("status.pending")),l.createElement("option",{value:"1"},_("status.active")),2==c.conv.status&&l.createElement("option",{value:"2"},_("status.closed"))),c.conv.opened_at&&l.createElement("span",{className:"input-group-text"},l.createElement("span",{className:"ms-2 material-icons text-success",title:_("status.opened_at")},"visibility"),c.conv.opened_at_front)))),l.createElement("tr",null,l.createElement("td",null,_("mail.department")),l.createElement("td",null,l.createElement("span",{title:c.conv.dep_id},l.createElement("span",{className:"material-icons"},"home"),c.conv.department_name)," ",l.createElement("span",{className:c.moptions.can_change_mailbox?"action-image":"",onClick:function(){return c.moptions.can_change_mailbox&&f({url:"mailconv/changemailbox/"+e.chatId})},title:c.conv.mailbox_id},l.createElement("span",{className:"material-icons"},"email"),c.conv.mailbox_front.name," (",c.conv.mailbox_front.mail,")"))),l.createElement("tr",null,l.createElement("td",null,_("mail.received")),l.createElement("td",null,c.conv.udate_front)),l.createElement("tr",null,l.createElement("td",null,"ID"),l.createElement("td",null,l.createElement("button",{"data-success":_("mail.copied"),className:"btn ps-0 btn-xs btn-link py-0","data-copy":window.location.origin+WWW_DIR_JAVASCRIPT+"front/default/(mid)/"+c.conv.id+"/#!#chat-id-mc"+c.conv.id,onClick:function(e){lhinst.copyContent($(e.target))},type:"button"},l.createElement("i",{className:"material-icons"},"link"),_("mail.copy_link")),c.conv.id,c.conv.follow_up_id&&l.createElement("a",{target:"_blank",href:WWW_DIR_JAVASCRIPT+"mailconv/view/"+c.conv.follow_up_id},l.createElement("span",{className:"material-icons"},"launch"),_("mail.follow_up")," ",c.conv.follow_up_id))),c.conv.accept_time&&l.createElement("tr",null,l.createElement("td",null,_("mail.last_accepted_at")),l.createElement("td",null,c.conv.accept_time_front,c.conv.wait_time_pending&&l.createElement(l.Fragment,null," | ",_("mail.wait_time")," ",c.conv.wait_time_pending))),c.conv.response_time&&l.createElement("tr",null,l.createElement("td",null,_("mail.last_responded_at")),l.createElement("td",null,c.conv.lr_time_front,c.conv.wait_time_response&&l.createElement(l.Fragment,null," | ",_("mail.wait_time")," ",c.conv.wait_time_response))),c.conv.cls_time&&l.createElement("tr",null,l.createElement("td",null,_("mail.closed_at")),l.createElement("td",null,c.conv.cls_time_front)),c.conv.conv_duration&&l.createElement("tr",null,l.createElement("td",null,_("mail.conv_duration")),l.createElement("td",null,c.conv.conv_duration_front)),c.conv.interaction_time&&l.createElement("tr",null,l.createElement("td",null,_("mail.last_interaction_time")),l.createElement("td",null,c.conv.interaction_time_duration)),c.conv.priority&&l.createElement("tr",null,l.createElement("td",null,_("mail.priority")),l.createElement("td",null,c.conv.priority)),l.createElement("tr",null,l.createElement("td",{title:c.conv.user_id},_("mail.chat_owner")),l.createElement("td",null,c.conv.plain_user_name,c.op_watching.map((function(e,t){return l.createElement("span",{title:_("mail.op_watching"),className:"ms-1 mail-watcher"},l.createElement("span",{className:"material-icons text-success"},"visibility"),e.name_official)})))))),l.createElement("div",{id:"mail-external-below-"+e.chatId})))))))}}}]);
//# sourceMappingURL=499.f7afabf7dfabf7713eec.js.map