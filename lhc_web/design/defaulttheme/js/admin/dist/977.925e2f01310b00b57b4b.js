"use strict";(self.webpackChunkLHCReactAPPAdmin=self.webpackChunkLHCReactAPPAdmin||[]).push([[977],{4977:(e,t,n)=>{n.r(t),n.d(t,{default:()=>u});var a,s=n(2284),c=n(296),r=n(6540),d=n(1083),o=n(8492),i=null,l=null,m=!1;const u=function(e){var t=(0,r.useState)([]),n=(0,c.A)(t,2),u=n[0],f=n[1],p=(0,r.useState)(!1),g=(0,c.A)(p,2),h=g[0],v=g[1],C=(0,r.useReducer)((function(e){return e+1}),0),b=(0,c.A)(C,2),I=(b[0],b[1]),_=(0,r.useState)(!0),E=(0,c.A)(_,2),A=E[0],y=E[1],k=(0,r.useState)(0),x=(0,c.A)(k,2),N=x[0],T=x[1],R=function(){h||d.A.get(WWW_DIR_JAVASCRIPT+"cannedmsg/filter/"+e.chatId).then((function(e){y(!1),f(e.data),v(!0),e.data.map((function(e,t){e.messages.map((function(e){1==e.current&&S(e)}))}))}))},w=function(t,n){void 0!==n&&(n.stopPropagation(),n.preventDefault()),!0!==m&&(N!=t.id||confirm(P("chat_canned.send_previous")))&&(T(t.id),m=!0,setTimeout((function(){var n=new FormData;n.append("msg",t.msg);var a=!1;t.subject_ids&&(n.append("subjects_ids",t.subject_ids),a=!0),n.append("canned_id",t.id);var s=document.getElementById("CSChatMessage-"+e.chatId);s&&s.getAttribute("mode-write")&&n.append("mode_write",s.getAttribute("mode-write")),d.A.post(WWW_DIR_JAVASCRIPT+"chat/addmsgadmin/"+e.chatId,n,{headers:{"X-CSRFToken":confLH.csrf_token}}).then((function(t){return m=!1,LHCCallbacks.addmsgadmin&&LHCCallbacks.addmsgadmin(e.chatId),ee.emitEvent("chatAddMsgAdmin",[e.chatId]),1==a&&lhinst.updateVoteStatus(e.chatId),lhinst.syncadmincall(),!0})).catch((function(e){return D(e)}))}),t.delay))},D=function(e){m=!1,e.isAxiosError&&!e.response?alert(P("system.error")):e.response.data.error?alert(e.response.data.error):alert(JSON.stringify(e.response.data))},S=function(t){clearTimeout(i);var n=document.getElementById("chat-render-preview-"+e.chatId);if(n)if(null!==t){n.innerHTML=t.msg;var a=new FormData;a.append("msg",t.msg),a.append("msg_body",!0),i=setTimeout((function(){d.A.post(WWW_DIR_JAVASCRIPT+"chat/previewmessage/",a).then((function(e){n&&(n.innerHTML=e.data)}))}),100)}else n.innerHTML=""};(0,r.useEffect)((function(){u.map((function(t,n){t.messages.map((function(t){if(t.current){var n=document.getElementById("canned-msg-"+e.chatId+"-"+t.id);null==n||(a="canned-list-"+e.chatId,s="canned-msg-"+e.chatId+"-"+t.id,c={threshold:10},r=document.getElementById(a),d=document.getElementById(s),r.offsetHeight+r.scrollTop>=d.offsetTop+c.threshold&&d.offsetTop>r.scrollTop-c.threshold)||n.scrollIntoView()}var a,s,c,r,d}))}))})),(0,r.useEffect)((function(){function t(t,n){e.chatId==t&&d.A.get(WWW_DIR_JAVASCRIPT+"cannedmsg/filter/"+e.chatId).then((function(e){h||(f(e.data),S(null),v(!0)),e.data.map((function(e,t){e.messages.map((function(e){e.id==n&&w(e)}))}))}))}return ee.addListener("sendCannedByMessageId",t),ee.emitEvent("chatCannedMounted",[e.chatId]),function(){ee.removeListener("sendCannedByMessageId",t)}}),[]);var W=function(t,n){if((13==t.keyCode||38==t.keyCode||40==t.keyCode)&&1==n)return t.preventDefault(),void t.stopPropagation();if(27==t.keyCode){var c=document.getElementById("CSChatMessage-"+e.chatId);"LHC-EDITOR"==c.nodeName?c.setFocus():c.focus(),y(!0)}if(13==t.keyCode)u.map((function(t,n){return t.messages.map((function(t){if(t.current){var n=document.getElementById("CSChatMessage-"+e.chatId);"LHC-EDITOR"==n.nodeName?(n.setContent(t.msg,{convert_bbcode:!0}),n.setFocus()):(n.value=t.msg,n.focus()),t.subject_ids&&n.setAttribute("subjects_ids",t.subject_ids),n.setAttribute("canned_id",t.id),y(!0)}}))})),t.preventDefault(),t.stopPropagation();else if(38==t.keyCode){var r=!1;if(void 0!==u[0]&&1==u[0].messages[0].current){u[0].messages[0].current=!1;var o=u.length-1;u[o].messages[u[o].messages.length-1].current=!0,S(u[o].messages[u[o].messages.length-1]),u[o].expanded||(u[o].expanded=!0)}else u.map((function(e,t,n){return n[n.length-1-t].messages.map((function(e,a,s){var c=s[s.length-1-a];1==r?(n[n.length-1-t].expanded||(n[n.length-1-t].expanded=!0),c.current=!0,r=!1,S(c)):c.current&&(c.current=!1,r=!0)}))}));f(u),I(),t.preventDefault(),t.stopPropagation()}else if(40==t.keyCode)r=!1,void 0!==u[u.length-1]&&1==u[u.length-1].messages[u[u.length-1].messages.length-1].current?(u[u.length-1].messages[u[u.length-1].messages.length-1].current=!1,u[0].messages[0].current=!0,S(u[0].messages[0]),u[0].expanded||(u[0].expanded=!0)):u.map((function(e,t){e.messages.map((function(t){1==r?(e.expanded||(e.expanded=!0),t.current=!0,S(t),r=!1):t.current&&(t.current=!1,r=!0)}))})),f(u),I(),t.preventDefault(),t.stopPropagation();else if(!0===n){clearTimeout(l);var i=t.target.value;l=setTimeout((function(){"undefined"!=(0,s.A)(a)&&a.cancel("Operation canceled due to new request."),a=d.A.CancelToken.source(),d.A.get(WWW_DIR_JAVASCRIPT+"cannedmsg/filter/"+e.chatId+"?q="+encodeURIComponent(i),{cancelToken:a.token}).then((function(e){f(e.data),y(!1),S(null),e.data.map((function(e,t){e.messages.map((function(e){1==e.current&&S(e)}))}))})).catch((function(e){d.A.isCancel(e)}))}),50)}},L=(0,o.B)("chat_canned"),P=L.t;return L.i18n,r.createElement(r.Fragment,null,r.createElement("div",{className:"col-12 col-xl-6 pb-1"},!h&&r.createElement("p",{className:"border mb-0 mt-0 pb-1 pt-1"},r.createElement("a",{className:"fs13 d-block",onClick:R},r.createElement("span",{className:"material-icons"},"expand_more"),P("chat_canned.canned"))),h&&A&&r.createElement("ul",{className:"list-unstyled fs13 border mt-0 mx300 mb-0"},r.createElement("li",{className:"pt-1 pb-1"},r.createElement("a",{className:"d-block",onClick:function(e){return y(!1)}},r.createElement("span",{className:"material-icons"},"expand_more"),P("chat_canned.canned")))),h&&!A&&r.createElement("ul",{className:"list-unstyled fs13 border mt-0 mx300",id:"canned-list-"+e.chatId},r.createElement("li",{className:"border-bottom pt-1 pb-1"},r.createElement("a",{onClick:function(e){return y(!0)}},r.createElement("span",{className:"material-icons"},"expand_less"),P("chat_canned.canned"))),u.map((function(t,n){return r.createElement("li",{key:"canned-"+n},r.createElement("a",{className:"fw-bold",key:n,onClick:function(){return a=n,(e=t).expanded=!e.expanded,void f(u.map((function(t,n){return a==n?e:t})));var e,a}},r.createElement("span",{className:"material-icons"},t.expanded?"expand_less":"expand_more"),t.title," [",t.messages.length,t.messages.length>=50?"+":"","]"),t.expanded&&r.createElement("ul",{className:"list-unstyled ms-4"},t.messages.map((function(t){return r.createElement("li",{key:t.id,className:t.current?"fst-italic fw-bold":"",id:"canned-msg-"+e.chatId+"-"+t.id},r.createElement("a",{className:"hover-canned d-block user-select-none",onMouseLeave:function(e){return S(null),void u.map((function(e,t){e.messages.map((function(e){1==e.current&&S(e)}))}))},onMouseEnter:function(e){return function(e){S(e)}(t)},title:t.msg,onClick:function(n){return function(t){var n=document.getElementById("CSChatMessage-"+e.chatId);"LHC-EDITOR"==n.nodeName?(n.getAttribute("content_modified")?n.insertContent(t.msg,{convert_bbcode:!0}):n.setContent(t.msg,{convert_bbcode:!0}),n.setFocus()):(n.value=n.getAttribute("content_modified")?n.value+t.msg:t.msg,n.focus()),t.subject_ids&&n.setAttribute("subjects_ids",t.subject_ids),n.setAttribute("canned_id",t.id),S(t)}(t)}},r.createElement("span",{title:P("chat_canned.send_instantly"),onClick:function(e){return w(t,e)},className:"material-icons fs12 user-select-none"},"send")," ",t.message_title))}))))})))),r.createElement("div",{className:"col-12 col-xl-6"},r.createElement("input",{type:"text",onFocus:R,className:"form-control form-control-sm",onKeyUp:function(e){return W(e,!0)},onKeyDown:function(e){return W(e,!1)},defaultValue:"",placeholder:P("chat_canned.navigate")}),!A&&r.createElement("div",{className:"mx275 mh275 mt-1 break-words",id:"chat-render-preview-"+e.chatId})))}}}]);
//# sourceMappingURL=977.925e2f01310b00b57b4b.js.map