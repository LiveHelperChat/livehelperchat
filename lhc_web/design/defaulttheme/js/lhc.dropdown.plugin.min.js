$.fn.makeDropdown=function(t){var e=this.find(".btn-block-department-filter > input");this.on("click","[data-stopPropagation]",(function(t){t.stopPropagation()}));this.each((function(){var e=$(this).attr("data-limit")?parseInt($(this).attr("data-limit")):0,n=$(this).find(".selected-items-filter");$(this).find(".btn-department-dropdown").attr("data-text",$(this).find(".btn-department-dropdown").text());var a=$(this);a.find(".btn-department-dropdown").click((function(){$(this).hasClass("show")&&a.find(".btn-block-department-filter > input").focus()}));var r=n.find(".delete-item").length;if(r>0){var d=1==r?n.find(".delete-item").first().parent().text().trim().replace("delete",""):"";$(this).find(".btn-department-dropdown").text((1==r?d:"["+r+"] ")+(1!=r?$(this).find(".btn-department-dropdown").attr("data-text"):""))}var p=$(this).find("li input:checked");1==p.length&&$(this).find(".btn-department-dropdown").text(p.first().parent().text()),a.on("change","li input:checkbox",(function(){var i,r;$(this).is(":checked")?(0==n.find('.delete-item[data-value="'+$(this).val()+'"]').length&&n.prepend('<div class="fs12"><a data-stoppropagation="true" class="delete-item" data-value="'+$(this).val()+'"><input type="hidden" value="'+$(this).val()+'" name="'+a.find(".btn-block-department-filter > input").attr("data-scope")+(0==e||e>1?"[]":"")+'" /><i class="material-icons chat-unread">delete</i>'+$(this).parent().text().trim()+"</a></div>"),e>0&&n.find(".delete-item:gt("+(e-1)+")").each((function(){$(this).parent().remove(),$(".search-option-item > label > input[value="+$(this).attr("data-value")+"]").prop("checked",!1)}))):n.find('.delete-item[data-value="'+$(this).val()+'"]').remove(),r=1==(i=n.find(".delete-item").length)?n.find(".delete-item").first().parent().text().trim().replace("delete",""):"",i>0?a.find(".btn-department-dropdown").text((1==i?r:"["+i+"] ")+(1!=i?a.find(".btn-department-dropdown").attr("data-text"):"")):a.find(".btn-department-dropdown").text(a.find(".btn-department-dropdown").attr("data-text")),t&&t.on_select&&t.on_select(n.find("input[type=hidden]"))})),a.on("change","li input:radio",(function(){$(this).is(":checked")&&(a.find(".btn-department-dropdown").text($(this).parent().text()),n.find(".delete-item").parent().remove(),n.prepend('<div class="fs12"><a data-stoppropagation="true" class="delete-item" data-value="'+$(this).val()+'"><input type="hidden" value="'+$(this).val()+'" name="'+a.find(".btn-block-department-filter > input").attr("data-scope")+(0==e||e>1?"[]":"")+'" /><i class="material-icons chat-unread">delete</i>'+$(this).parent().text().trim()+"</a></div>"))})),$(this).on("click",".delete-item",(function(){var e=a.find("input[value="+$(this).attr("data-value")+"]");e.prop("checked",!1),$(this).parent().remove();var n=a.find("li input:checked").length;n>0?a.find(".btn-department-dropdown").text("["+n+"] "+a.find(".btn-department-dropdown").attr("data-text")):a.find(".btn-department-dropdown").text(a.find(".btn-department-dropdown").attr("data-text")),t&&t.on_delete&&t.on_delete(e)})),a.find(".btn-block-department-filter > input").attr("ajax-provider")&&a.find(".dropdown-result").scroll((function(t){parseInt($(this)[0].scrollHeight)-parseInt($(this)[0].clientHeight)==parseInt($(this).scrollTop())&&i($(this).parent().find(".btn-block-department-filter > input"),$(this).find("li").length)}))}));var n=null,a=null,i=function(t,e){var i=t.parent().parent(),r=t.parent(),d=t.parent().parent().parent().parent().parent().attr("data-type")?t.parent().parent().parent().parent().parent().attr("data-type"):"checkbox",p=!!t.parent().parent().parent().parent().parent().attr("data-noselector"),o=t.parent().parent().parent().parent().parent().attr("data-limit")?parseInt(t.parent().parent().parent().parent().parent().attr("data-limit")):0;null!==n&&clearTimeout(n),n=setTimeout((function(){null!=a&&(a.abort(),a=null),a=$.getJSON(WWW_DIR_JAVASCRIPT+"chat/searchprovider/"+t.attr("ajax-provider")+"/?q="+encodeURIComponent(t.val())+(e?"&offset="+parseInt(e):""),(function(n){var a="";n.items.forEach((function(e){var n=1==r.find('.delete-item[data-value="'+e.id+'"]').length;a+='<li class="search-option-item" data-stoppropagation="true"><label><input type="'+d+'" '+(n?' checked="checked" ':"")+' name="'+(!0===p?"":"selector-")+t.attr("data-scope")+(0==o||o>1?"[]":"")+'" value="'+e.id+'"> '+e.name+"</label></li>"})),e||i.find(".search-option-item").remove(),i.find(".dropdown-result > .dropdown-lhc").append(a)}))}),200)};e.keyup((function(){if($(this).attr("ajax-provider"))i($(this));else{var t=$(this).val().toLowerCase();$(this).parent().parent().find("li.dropdown-result > ul").children("li").each((function(e){$(this).text().toLowerCase().includes(t)||""==t?$(this).show():$(this).hide()}))}}))};