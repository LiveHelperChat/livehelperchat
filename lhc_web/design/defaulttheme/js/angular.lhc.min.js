$(document).ready(function(){var t=window.location.hash;""!=t&&$('ul[role="tablist"] a[href="'+t.replace("#!","")+'"]').tab("show")});var phonecatApp=angular.module("lhcApp",["lhcAppServices","lhcAppControllers"]),services=angular.module("lhcAppServices",[]),lhcAppControllers=angular.module("lhcAppControllers",["checklist-model"]);angular.element(document).ready(function(){angular.element(document.querySelector("form")).triggerHandler("$destroy")}),services.factory("LiveHelperChatFactory",["$http","$q",function(t,e){return this.loadChatList=function(a){var i=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"chat/syncadmininterface"+a).then(function(t){void 0!==t.error_url?document.location=t.error_url:i.resolve(t.data)},function(t){i.reject(void 0!==t.status?"["+t.status+"]":"[0]")}),i.promise},this.loadInitialData=function(a){var i=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"chat/loadinitialdata"+a).then(function(t){void 0!==t.error_url?document.location=t.data.error_url:i.resolve(t.data)},function(t){i.reject(void 0!==t.status?"["+t.status+"]":"[0]")}),i.promise},this.loadActiveChats=function(){var a=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"chat/loadactivechats").then(function(t){void 0!==t.error_url?document.location=t.error_url:a.resolve(t.data)},function(t){a.reject(void 0!==t.status?"["+t.status+"]":"[0]")}),a.promise},this.getNotificationsData=function(a){var i=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"chat/getnotificationsdata/(id)/"+a).then(function(t){void 0!==t.error_url?document.location=t.data.error_url:i.resolve(t.data)},function(t){i.reject(void 0!==t.status?"["+t.status+"]":"[0]")}),i.promise},this.setInactive=function(a){var i=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"user/setinactive/"+a).then(function(t){i.resolve(t.data)},function(t){i.reject(void 0!==t.status?"["+t.status+"]":"[0]")}),i.promise},this.setOnlineMode=function(a){var i=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"user/setoffline/"+a).then(function(t){i.resolve(t.data)},function(t){i.reject(void 0!==t.status?"["+t.status+"]":"[0]")}),i.promise},this.setAlwaysOnlineMode=function(a){var i=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"user/setalwaysonline/"+a).then(function(t){i.resolve(t.data)},function(t){i.reject(void 0!==t.status?"["+t.status+"]":"[0]")}),i.promise},this.changeVisibility=function(a){var i=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"user/setinvisible/"+a).then(function(t){i.resolve(t.data)},function(t){i.reject(void 0!==t.status?"["+t.status+"]":"[0]")}),i.promise},this.getActiveOperatorChat=function(a){var i=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"groupchat/startchatwithoperator/"+a).then(function(t){i.resolve(t.data)},function(t){i.reject(void 0!==t.status?"["+t.status+"]":"[0]")}),i.promise},this.rejectGroupChat=function(a){var i=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"groupchat/leave/"+a).then(function(t){i.resolve(t.data)},function(t){i.reject(void 0!==t.status?"["+t.status+"]":"[0]")}),i.promise},this.newGroupChat=function(a,i){var o=e.defer();return t.post(WWW_DIR_JAVASCRIPT+"groupchat/newgroupajax/",{name:a,public:i}).then(function(t){o.resolve(t.data)},function(t){o.reject(void 0!==t.status?"["+t.status+"]":"[0]")}),o.promise},this.truncate=function(t,e,a){return isNaN(e)&&(e=10),void 0===a&&(a="..."),t.length<=e||t.length-a.length<=e?t:String(t).substring(0,e-a.length)+a},this}]),lhcAppControllers.controller("LiveHelperChatCtrl",["$scope","$http","$location","$rootScope","$log","$interval","LiveHelperChatFactory",function($scope,$http,$location,$rootScope,$log,$interval,LiveHelperChatFactory){$scope.predicate="last_visit",$scope.pending_chats={},$scope.pending_chats_expanded=!0,$scope.active_chats={},$scope.active_chats_expanded=!0,$scope.my_active_chats_expanded=!0,$scope.closed_chats={},$scope.closed_chats_expanded=!0,$scope.unread_chats={},$scope.unread_chats_expanded=!0,$scope.transfer_dep_chats={},$scope.transfer_chats={},$scope.timeoutControl=null,$scope.setTimeoutEnabled=!0,$scope.lmtoggle=!1,$scope.lmtoggler=!1,$scope.custom_list_1_expanded=!0,$scope.custom_list_2_expanded=!0,$scope.custom_list_3_expanded=!0,$scope.custom_list_4_expanded=!0,$scope.current_user_id=confLH.user_id;var _that=this;this.restoreLocalSetting=function(t,e,a){try{if(localStorage){var i=localStorage.getItem(t);if(null!==i){if(1==a){var o=i.split("/"),n=new Array;return angular.forEach(o,function(t){n.push(parseInt(t))}),n}return i}return e}}catch(t){}return e},this.custom_extension_filter="",this.limitb=this.restoreLocalSetting("limitb","10",!1),this.limita=this.restoreLocalSetting("limita","10",!1),this.limitu=this.restoreLocalSetting("limitu","10",!1),this.limitp=this.restoreLocalSetting("limitp","10",!1),this.limito=this.restoreLocalSetting("limito",confLH.dlist.op_n,!1),this.limitc=this.restoreLocalSetting("limitc","10",!1),this.limitd=this.restoreLocalSetting("limitd","10",!1),this.limitmc=this.restoreLocalSetting("limitmc","10",!1),this.limitgc=this.restoreLocalSetting("limitgc","10",!1),this.activeu=this.restoreLocalSetting("activeu",[],!0),this.pendingu=this.restoreLocalSetting("pendingu",[],!0),$scope.lmtoggle="false"!=this.restoreLocalSetting("lmtoggle","false",!1),$scope.lmtoggler="false"!=this.restoreLocalSetting("lmtoggler","false",!1),this.lhcVersion=0,this.lhcVersionCounter=8,this.lhcPendingRefresh=!1,this.lhcConnectivityProblem=!1,this.lhcConnectivityProblemExplain="",this.lastidEvent=0,this.userDepartments=[],this.userProductNames=[],this.userDepartmentsGroups=[],this.userGroups=[],this.userList=[],this.widgets=[],this.additionalColumns=[],this.departmentd=this.restoreLocalSetting("departmentd",[],!0),this.departmentd_dpgroups=this.restoreLocalSetting("departmentd_dpgroups",[],!0),this.departmentdNames=[],this.operatord=this.restoreLocalSetting("operatord",[],!0),this.operatord_dpgroups=this.restoreLocalSetting("operatord_dpgroups",[],!0),this.operatordNames=[],this.actived=this.restoreLocalSetting("actived",[],!0),this.actived_products=this.restoreLocalSetting("actived_products",[],!0),this.actived_dpgroups=this.restoreLocalSetting("actived_dpgroups",[],!0),this.actived_ugroups=this.restoreLocalSetting("actived_ugroups",[],!0),this.activedNames=[],this.mcd=this.restoreLocalSetting("mcd",[],!0),this.mcd_products=this.restoreLocalSetting("mcd_products",[],!0),this.mcd_dpgroups=this.restoreLocalSetting("mcd_dpgroups",[],!0),this.mcdNames=[],this.unreadd=this.restoreLocalSetting("unreadd",[],!0),this.unreadd_products=this.restoreLocalSetting("unreadd_products",[],!0),this.unreadd_dpgroups=this.restoreLocalSetting("unreadd_dpgroups",[],!0),this.unreaddNames=[],this.pendingd=this.restoreLocalSetting("pendingd",[],!0),this.pendingd_products=this.restoreLocalSetting("pendingd_products",[],!0),this.pendingd_dpgroups=this.restoreLocalSetting("pendingd_dpgroups",[],!0),this.pendingd_ugroups=this.restoreLocalSetting("pendingd_ugroups",[],!0),this.pendingdNames=[],this.botd=this.restoreLocalSetting("botd",[],!0),this.botd_products=this.restoreLocalSetting("botd_products",[],!0),this.botd_dpgroups=this.restoreLocalSetting("botd_dpgroups",[],!0),this.botd_ugroups=this.restoreLocalSetting("botd_ugroups",[],!0),this.botdNames=[],this.closedd=this.restoreLocalSetting("closedd",[],!0),this.closedd_products=this.restoreLocalSetting("closedd_products",[],!0),this.closedd_dpgroups=this.restoreLocalSetting("closedd_dpgroups",[],!0),this.closeddNames=[],this.statusNotifications=[],this.isListLoaded=!1,this.widgetsItems=new Array,this.widgetsItems.push("actived"),this.widgetsItems.push("departmentd"),this.widgetsItems.push("unreadd"),this.widgetsItems.push("pendingd"),this.widgetsItems.push("operatord"),this.widgetsItems.push("closedd"),this.widgetsItems.push("mcd"),this.timeoutActivity=null,this.timeoutActivityTime=300,this.blockSync=!1,this.hideOnline=!1,this.hideInvisible=!1,this.alwaysOnline=!1,this.bot_st={},this.changeVisibility=function(t){t&&(t.stopPropagation(),t.preventDefault()),LiveHelperChatFactory.changeVisibility(1==!_that.hideInvisible?"true":"false").then(function(t){!1===t.error?_that.hideInvisible=!_that.hideInvisible:void 0!==t.msg?alert(t.msg):alert(t)},function(t){alert("We could not change your status!")})},this.changeAlwaysOnline=function(t){t&&(t.stopPropagation(),t.preventDefault()),LiveHelperChatFactory.setAlwaysOnlineMode(1==!_that.alwaysOnline?"true":"false").then(function(t){!1===t.error?_that.alwaysOnline=!_that.alwaysOnline:void 0!==t.msg?alert(t.msg):alert(t)},function(t){alert("We could not change your status! "+t)})},this.changeOnline=function(t){t&&(t.stopPropagation(),t.preventDefault()),LiveHelperChatFactory.setOnlineMode(1==!_that.hideOnline?"true":"false").then(function(t){!1===t.error?_that.hideOnline=!_that.hideOnline:void 0!==t.msg?alert(t.msg):alert(t)},function(t){alert("We could not change your status! "+t)})},angular.forEach(this.widgetsItems,function(t){_that[t+"_all_departments"]="false"!=_that.restoreLocalSetting(t+"_all_departments","false",!1),_that[t+"_hide_hidden"]="false"!=_that.restoreLocalSetting(t+"_hide_hidden","false",!1),_that[t+"_hide_disabled"]="false"!=_that.restoreLocalSetting(t+"_hide_disabled","false",!1),_that[t+"_only_online"]="false"!=_that.restoreLocalSetting(t+"_only_online","false",!1),_that[t+"_only_explicit_online"]="false"!=_that.restoreLocalSetting(t+"_only_explicit_online","false",!1)}),this.storeLocalSetting=function(t,e){if(localStorage)try{e=localStorage.setItem(t,e)}catch(t){}},this.removeLocalSetting=function(t){if(localStorage)try{localStorage.removeItem(t)}catch(t){}},this.toggleList=function(t){if($scope[t]=!$scope[t],localStorage)try{localStorage.setItem(t,$scope[t])}catch(t){}},this.toggleWidgetData=[],this.toggleWidget=function(t,e){if(_that.toggleWidgetData[t]=void 0===_that.toggleWidgetData[t]||!_that.toggleWidgetData[t],localStorage)try{localStorage.setItem(t,_that.toggleWidgetData[t])}catch(t){}void 0!==e&&1==e&&$scope.loadChatList()},this.toggleWidgetSort=function(t,e,a,i){if(_that.toggleWidgetData[t]=void 0===_that.toggleWidgetData[t]?e:_that.toggleWidgetData[t]==e?a:e,localStorage)try{localStorage.setItem(t,_that.toggleWidgetData[t])}catch(t){}void 0!==i&&1==i&&$scope.loadChatList()},this.getToggleWidget=function(t,e){this.toggleWidgetData[t]="false"!=this.restoreLocalSetting(t,void 0===e?"false":e,!1)},this.getToggleWidgetSort=function(t){this.toggleWidgetData[t]=this.restoreLocalSetting(t,"",!1)},$scope.getSyncFilter=function(){_that.custom_extension_filter="";var t="/(limita)/"+parseInt(_that.limita);(t+="/(limitu)/"+parseInt(_that.limitu),t+="/(limitp)/"+parseInt(_that.limitp),t+="/(limito)/"+parseInt(_that.limito),t+="/(limitc)/"+parseInt(_that.limitc),t+="/(limitd)/"+parseInt(_that.limitd),t+="/(limitmc)/"+parseInt(_that.limitmc),t+="/(limitb)/"+parseInt(_that.limitb),t+="/(limitgc)/"+parseInt(_that.limitgc),"object"==typeof _that.widgetsActive&&_that.widgetsActive.length>0&&(t+="/(w)/"+_that.widgetsActive.join("/")),"object"==typeof _that.activeu&&_that.activeu.length>0&&(t+="/(activeu)/"+_that.activeu.join("/")),"object"==typeof _that.pendingu&&_that.pendingu.length>0&&(t+="/(pendingu)/"+_that.pendingu.join("/")),"object"==typeof _that.actived_dpgroups&&_that.actived_dpgroups.length>0&&(t+="/(adgroups)/"+_that.actived_dpgroups.join("/")),"object"==typeof _that.pendingd_dpgroups&&_that.pendingd_dpgroups.length>0&&(t+="/(pdgroups)/"+_that.pendingd_dpgroups.join("/")),"object"==typeof _that.closedd_dpgroups&&_that.closedd_dpgroups.length>0&&(t+="/(cdgroups)/"+_that.closedd_dpgroups.join("/")),"object"==typeof _that.mcd_dpgroups&&_that.mcd_dpgroups.length>0&&(t+="/(mdgroups)/"+_that.mcd_dpgroups.join("/")),"object"==typeof _that.unreadd_dpgroups&&_that.unreadd_dpgroups.length>0&&(t+="/(udgroups)/"+_that.unreadd_dpgroups.join("/")),"object"==typeof _that.departmentd_dpgroups&&_that.departmentd_dpgroups.length>0&&(t+="/(ddgroups)/"+_that.departmentd_dpgroups.join("/")),"object"==typeof _that.operatord_dpgroups&&_that.operatord_dpgroups.length>0&&(t+="/(odpgroups)/"+_that.operatord_dpgroups.join("/")),"object"==typeof _that.actived)&&(_that.actived.length>0?t+="/(actived)/"+_that.actived.join("/"):(e=_that.manualFilterByFilter("actived")).length>0&&(t+="/(actived)/"+e.join("/")));"object"==typeof _that.mcd&&(_that.mcd.length>0?t+="/(mcd)/"+_that.mcd.join("/"):(e=_that.manualFilterByFilter("mcd")).length>0&&(t+="/(mcd)/"+e.join("/")));"object"==typeof _that.unreadd&&(_that.unreadd.length>0?t+="/(unreadd)/"+_that.unreadd.join("/"):(e=_that.manualFilterByFilter("unreadd")).length>0&&(t+="/(unreadd)/"+e.join("/")));if("object"==typeof _that.pendingd){var e;if(_that.pendingd.length>0)t+="/(pendingd)/"+_that.pendingd.join("/");else(e=_that.manualFilterByFilter("pendingd")).length>0&&(t+="/(pendingd)/"+e.join("/"));void 0!==_that.toggleWidgetData.pending_chats_sort&&1==_that.toggleWidgetData.pending_chats_sort&&(t+="/(psort)/asc")}"object"==typeof _that.operatord&&(_that.operatord.length>0?t+="/(operatord)/"+_that.operatord.join("/"):(e=_that.manualFilterByFilter("operatord")).length>0&&(t+="/(operatord)/"+e.join("/")));("object"==typeof _that.closedd&&_that.closedd.length>0&&(t+="/(closedd)/"+_that.closedd.join("/")),"object"==typeof _that.departmentd)&&(_that.departmentd.length>0?t+="/(departmentd)/"+_that.departmentd.join("/"):(e=_that.manualFilterByFilter("departmentd")).length>0&&(t+="/(departmentd)/"+e.join("/")));return"object"==typeof _that.actived_products&&_that.actived_products.length>0&&(t+="/(activedprod)/"+_that.actived_products.join("/")),"object"==typeof _that.pendingd_ugroups&&_that.pendingd_ugroups.length>0&&(t+="/(pugroups)/"+_that.pendingd_ugroups.join("/")),"object"==typeof _that.actived_ugroups&&_that.actived_ugroups.length>0&&(t+="/(augroups)/"+_that.actived_ugroups.join("/")),"object"==typeof _that.mcd_products&&_that.mcd_products.length>0&&(t+="/(mcdprod)/"+_that.mcd_products.join("/")),"object"==typeof _that.unreadd_products&&_that.unreadd_products.length>0&&(t+="/(unreaddprod)/"+_that.unreadd_products.join("/")),"object"==typeof _that.pendingd_products&&_that.pendingd_products.length>0&&(t+="/(pendingdprod)/"+_that.pendingd_products.join("/")),"object"==typeof _that.closedd_products&&_that.closedd_products.length>0&&(t+="/(closeddprod)/"+_that.closedd_products.join("/")),void 0!==_that.toggleWidgetData.track_open_chats&&1==_that.toggleWidgetData.track_open_chats&&(t+="/(topen)/true"),void 0!==_that.toggleWidgetData.active_chats_sort&&""!==_that.toggleWidgetData.active_chats_sort&&(t+="/(acs)/"+_that.toggleWidgetData.active_chats_sort),void 0!==_that.toggleWidgetData.closed_chats_sort&&""!==_that.toggleWidgetData.closed_chats_sort&&(t+="/(clcs)/"+_that.toggleWidgetData.closed_chats_sort),void 0!==_that.toggleWidgetData.onop_sort&&""!==_that.toggleWidgetData.onop_sort&&(t+="/(onop)/"+_that.toggleWidgetData.onop_sort),ee.emitEvent("eventGetSyncFilter",[_that,$scope]),t+=_that.custom_extension_filter},$scope.$watch("lhc.limita",function(t,e){t!=e&&(_that.storeLocalSetting("limita",t),$scope.loadChatList())}),this.manualFilterByFilter=function(t){if((1==_that[t+"_only_explicit_online"]||1==_that[t+"_hide_hidden"]||1==_that[t+"_hide_disabled"]||1==_that[t+"_only_online"])&&_that.userDepartments.length>0){var e=[];return angular.forEach(_that.userDepartments,function(a){(0==_that[t+"_only_explicit_online"]||1==_that[t+"_only_explicit_online"]&&1==a.oexp)&&(0==_that[t+"_hide_hidden"]||1==_that[t+"_hide_hidden"]&&0==a.hidden)&&(0==_that[t+"_hide_disabled"]||1==_that[t+"_hide_disabled"]&&0==a.disabled)&&(0==_that[t+"_only_online"]||1==_that[t+"_only_online"]&&1==a.ogen)&&e.push(a.id)}),0==e.length&&e.push(-1),e}return[]},this.setDepartmentNames=function(t){_that[t+"Names"]=[],angular.forEach(_that[t],function(e){void 0!==_that.userDepartmentsNames&&void 0!==_that.userDepartmentsNames[e]?_that[t+"Names"].push(_that.userDepartmentsNames[e]):void 0!==_that.userDepartmentsNames&&(_that[t].splice(_that[t].indexOf(e),1),_that.departmentChanged(t))})},this.departmentChanged=function(t){if(_that[t].length>0){_that[t+"_all_departments"]=!1,_that.allDepartmentsChanged(t,!1);var e=_that[t].join("/");""!=e&&(_that.storeLocalSetting(t,e),_that.setDepartmentNames(t))}else if(localStorage)try{localStorage.removeItem(t)}catch(t){}_that.isListLoaded=!1,$scope.loadChatList()},this.productChanged=function(t){if(_that[t].length>0){var e=_that[t].join("/");""!=e&&_that.storeLocalSetting(t,e)}else if(localStorage)try{localStorage.removeItem(t)}catch(t){}_that.isListLoaded=!1,$scope.loadChatList()},this.allDepartmentsChanged=function(t,e){1==_that[t+"_all_departments"]?_that.storeLocalSetting(t+"_all_departments",!0):_that.removeLocalSetting(t+"_all_departments"),1==_that[t+"_hide_hidden"]?_that.storeLocalSetting(t+"_hide_hidden",!0):_that.removeLocalSetting(t+"_hide_hidden"),1==_that[t+"_hide_disabled"]?_that.storeLocalSetting(t+"_hide_disabled",!0):_that.removeLocalSetting(t+"_hide_disabled"),1==_that[t+"_only_online"]?_that.storeLocalSetting(t+"_only_online",!0):_that.removeLocalSetting(t+"_only_online"),1==_that[t+"_all_departments"]?(_that[t]=[],angular.forEach(_that.userDepartments,function(e){(0==_that[t+"_only_explicit_online"]||1==_that[t+"_only_explicit_online"]&&1==e.oexp)&&(0==_that[t+"_hide_hidden"]||1==_that[t+"_hide_hidden"]&&0==e.hidden)&&(0==_that[t+"_hide_disabled"]||1==_that[t+"_hide_disabled"]&&0==e.disabled)&&(0==_that[t+"_only_online"]||1==_that[t+"_only_online"]&&1==e.ogen)&&_that[t].push(e.id)}),0==_that[t].length&&_that[t].push(-1)):1==e&&(_that[t]=[]),1==e&&(_that.isListLoaded=!1,$scope.loadChatList())},$scope.$watch("lhc.limitu",function(t,e){t!=e&&(_that.storeLocalSetting("limitu",t),$scope.loadChatList())}),$scope.$watch("lhc.limitc",function(t,e){t!=e&&(_that.storeLocalSetting("limitc",t),$scope.loadChatList())}),$scope.$watch("lhc.limitp",function(t,e){t!=e&&(_that.storeLocalSetting("limitp",t),$scope.loadChatList())}),$scope.$watch("lhc.limito",function(t,e){t!=e&&(_that.storeLocalSetting("limito",t),$scope.loadChatList())}),$scope.$watch("lhc.limitmc",function(t,e){t!=e&&(_that.storeLocalSetting("limitmc",t),$scope.loadChatList())}),$scope.$watch("lhc.limitgc",function(t,e){t!=e&&(_that.storeLocalSetting("limitgc",t),$scope.loadChatList())}),$scope.$watch("lhc.limitd",function(t,e){t!=e&&(_that.storeLocalSetting("limitd",t),$scope.loadChatList())}),$scope.$watch("lhc.activeu",function(t,e){t!=e&&(_that.storeLocalSetting("activeu",t),_that.isListLoaded=!1,$scope.loadChatList())}),$scope.$watch("lhc.pendingu",function(t,e){t!=e&&(_that.storeLocalSetting("pendingu",t),_that.isListLoaded=!1,$scope.loadChatList())}),$scope.syncDisabled=function(t){_that.blockSync=t},$scope.loadChatList=function(){if(localStorage)try{$scope.pending_chats_expanded="false"!=localStorage.getItem("pending_chats_expanded"),$scope.active_chats_expanded="false"!=localStorage.getItem("active_chats_expanded"),$scope.my_active_chats_expanded="false"!=localStorage.getItem("my_active_chats_expanded"),$scope.closed_chats_expanded="false"!=localStorage.getItem("closed_chats_expanded"),$scope.unread_chats_expanded="false"!=localStorage.getItem("unread_chats_expanded"),$scope.my_chats_expanded="false"!=localStorage.getItem("my_chats_expanded"),$scope.custom_list_1_expanded="false"!=localStorage.getItem("custom_list_1_expanded"),$scope.custom_list_2_expanded="false"!=localStorage.getItem("custom_list_2_expanded"),$scope.custom_list_3_expanded="false"!=localStorage.getItem("custom_list_3_expanded"),$scope.custom_list_4_expanded="false"!=localStorage.getItem("custom_list_4_expanded")}catch(t){}if(1==_that.blockSync)return clearTimeout($scope.timeoutControl),void($scope.timeoutControl=setTimeout(function(){$scope.loadChatList()},confLH.back_office_sinterval));clearTimeout($scope.timeoutControl),LiveHelperChatFactory.loadChatList($scope.getSyncFilter()).then(function(data){if(1==_that.blockSync)return clearTimeout($scope.timeoutControl),void($scope.timeoutControl=setTimeout(function(){$scope.loadChatList()},confLH.back_office_sinterval));if(1==_that.lhcConnectivityProblem&&(_that.lhcConnectivityProblem=!1),ee.emitEvent("eventLoadChatList",[data,$scope,_that]),void 0===data.items_processed){var currentStatusNotifications=[],chatsToNotify=[],notificationsData=[],notificationDataAccept=[],tabs=$("#tabs");angular.forEach(data.result,function(t,e){if($scope[e]=t,tabs.length>0&&("pending_chat"==e||"my_chats"==e?t.list.forEach(function(t){void 0!==t.user_id&&t.user_id==confLH.user_id&&1==confLH.accept_chats&&1!==t.status&&0==$("#chat-tab-link-"+t.id).length&&(tabs.length>0&&0==lhinst.disableremember&&(lhinst.removeSynchroChat(t.id),lhinst.startChatBackground(t.id,tabs,LiveHelperChatFactory.truncate(t.nick,10))),0==lhinst.disableremember&&notificationDataAccept.push(t.id))}):"group_chats"==e&&tabs.length>0&&1==confLH.auto_join_private&&t.list.forEach(function(t){1==t.type&&0==t.jtime&&0==$("#chat-tab-link-gc"+t.id).length&&lhinst.startGroupChat(t.id,tabs,LiveHelperChatFactory.truncate(t.name,10),!0)})),t.last_id_identifier){chatsToNotify=[],currentStatusNotifications=[];var a=0,i=t.list;"pending_chat"==t.last_id_identifier&&void 0!==_that.toggleWidgetData.pending_chats_sort&&1==_that.toggleWidgetData.pending_chats_sort&&(i=t.list.slice().reverse()),angular.forEach(i,function(e,i){var o=void 0!==e.user_id?e.user_id:0,n=e.id+"_"+o;("bot_chats"!=t.last_id_identifier||e.msg_v&&e.msg_v>_that.bot_st.msg_nm&&1==_that.bot_st.bot_notifications)&&(currentStatusNotifications.push(n),void 0===_that.statusNotifications[t.last_id_identifier]&&(_that.statusNotifications[t.last_id_identifier]=new Array),1!=_that.isListLoaded||0!=a&&2!==e.status_sub_sub||!(-1==_that.statusNotifications[t.last_id_identifier].indexOf(n)&&0==o&&0==confLH.ownntfonly||-1==_that.statusNotifications[t.last_id_identifier].indexOf(n)&&o==confLH.user_id)?a++:-1===lhinst.chatsSynchronising.indexOf(parseInt(e.id))&&chatsToNotify.push(e.id))}),chatsToNotify.length>0&&(chatsToNotify.unshift(t.last_id_identifier),notificationsData.push(chatsToNotify.join("/"))),1==_that.isListLoaded&&_that.compareNotificationsAndHide(_that.statusNotifications[t.last_id_identifier],currentStatusNotifications),_that.statusNotifications[t.last_id_identifier]=currentStatusNotifications}}),notificationDataAccept.length>0&&(notificationDataAccept.unshift("active_chat"),LiveHelperChatFactory.getNotificationsData(notificationDataAccept.join("/")).then(function(t){angular.forEach(t,function(t,e){lhinst.removeBackgroundChat(parseInt(t.last_id)),lhinst.playSoundNewAction(t.last_id_identifier,parseInt(t.last_id),t.nick?t.nick:"Live Help",t.msg?t.msg:confLH.transLation.new_chat,t.nt),lhinst.backgroundChats.push(parseInt(t.last_id))})})),notificationsData.length>0&&LiveHelperChatFactory.getNotificationsData(notificationsData.join("/")).then(function(t){angular.forEach(t,function(t,e){lhinst.playSoundNewAction(t.last_id_identifier,parseInt(t.last_id),t.nick?t.nick:"Live Help",t.msg?t.msg:confLH.transLation.new_chat,t.nt)})})}if(void 0!==data.ou&&eval(data.ou),void 0!==data.fs&&data.fs.length>0&&angular.forEach(data.fs,function(t,e){lhinst.playSoundNewAction("pending_transfered",parseInt(t.id),t.nick?t.nick:"Live Help",confLH.transLation.transfered,t.nt,t.uid)}),void 0!==data.mac&&data.mac.length>0){var tabs=$("#tabs");tabs.length>0&&0==lhinst.disableremember&&angular.forEach(data.mac,function(t,e){lhinst.startChatBackground(t.id,tabs,LiveHelperChatFactory.truncate(t.nick,10),!1)})}_that.hideOnline=1==data.ho,_that.hideInvisible=1==data.im,_that.alwaysOnline=1==data.a_on,_that.lhcVersion!=data.v&&(_that.lhcVersion=data.v,_that.lhcPendingRefresh=!0,_that.versionChanged()),1==$scope.setTimeoutEnabled&&($scope.timeoutControl=setTimeout(function(){$scope.loadChatList()},confLH.back_office_sinterval)),_that.isListLoaded=!0},function(t){_that.lhcConnectivityProblem=!0,_that.lhcConnectivityProblemExplain=t,$scope.timeoutControl=setTimeout(function(){$scope.loadChatList()},confLH.back_office_sinterval)})},this.versionChanged=function(){var t=this;$interval(function(){t.lhcVersionCounter=t.lhcVersionCounter-1,console.log(t.lhcVersionCounter),0==t.lhcVersionCounter&&document.location.reload(!0)},1e3)},this.compareNotificationsAndHide=function(t,e){if(void 0!==t)for(var a=t.length-1;a>=0;a--){var i=t[a];-1===e.indexOf(i)&&lhinst.hideNotification(i.split("_")[0])}},this.appendActiveChats=function(){LiveHelperChatFactory.loadActiveChats().then(function(t){var e=$("#tabs");angular.forEach(t.result,function(t,a){lhinst.startChatBackground(t.id,e,LiveHelperChatFactory.truncate(t.nick,10))}),setTimeout(function(){lhinst.syncadmininterfacestatic()},1e3)})},this.previewChat=function(t){lhc.previewChat(t)},this.previewChatArchive=function(t,e){lhc.previewChatArchive(t,e)},this.redirectContact=function(t,e){return lhinst.redirectContact(t,e)},this.startChatNewWindow=function(t,e){return lhinst.startChatNewWindow(t,e)},this.deleteChat=function(t,e,a){return lhinst.deleteChat(t,e,a)},this.startGroupChat=function(t,e){if($("#tabs").length>0)return lhinst.startGroupChat(t,$("#tabs"),LiveHelperChatFactory.truncate(e,10))},this.startChat=function(t,e){if($("#tabs").length>0)return lhinst.startChat(t,$("#tabs"),LiveHelperChatFactory.truncate(e,10));lhinst.startChatNewWindow(t,e)},this.startChatNewWindowTransfer=function(t,e,a){return lhinst.startChatNewWindowTransfer(t,e,a)},this.startChatTransfer=function(t,e,a){return lhinst.startChatTransfer(t,$("#tabs"),e,a)},$scope.startChatOperatorPublic=function(t){_that.startChatOperator(t)},this.startChatOperator=function(t){LiveHelperChatFactory.getActiveOperatorChat(t).then(function(t){lhinst.startGroupChat(t.id,$("#tabs"),LiveHelperChatFactory.truncate(t.name,10))})},this.openModal=function(t){lhc.revealModal({url:WWW_DIR_JAVASCRIPT+t,hidecallback:function(){$scope.loadChatList()}})},this.addEvent=function(){var t=this;return document.addEventListener?function(e,a,i){if(e&&e.nodeName||e===window)e.addEventListener(a,i,!1);else if(e&&e.length)for(var o=0;o<e.length;o++)t.addEvent(e[o],a,i)}:function(e,a,i){if(e&&e.nodeName||e===window)e.attachEvent("on"+a,function(){return i.call(e,window.event)});else if(e&&e.length)for(var o=0;o<e.length;o++)t.addEvent(e[o],a,i)}}(),this.setupActivityMonitoring=function(){var t=this,e=function(){t.resetTimeoutActivity()};this.addEvent(window,"mousemove",e),this.addEvent(document,"mousemove",e),this.addEvent(window,"mousedown",e),this.addEvent(window,"click",e),this.addEvent(window,"scroll",e),this.addEvent(window,"keypress",e),this.addEvent(window,"load",e),this.addEvent(document,"scroll",e),this.addEvent(document,"touchstart",e),this.addEvent(document,"touchend",e),this.resetTimeoutActivity()},$scope.resetActivityFromChild=function(){_that.resetTimeoutActivity()},this.resetTimeoutActivity=function(){var t=window.opener;if(t)try{t.angular.element("body").scope().resetActivityFromChild()}catch(t){console.log(t)}else if(0==this.blockSync){clearTimeout(this.timeoutActivity);var e=this;this.timeoutActivity=setTimeout(function(){e.blockSync=!0,lhinst.disableSync=!0,LiveHelperChatFactory.setInactive("true").then(function(t){lhc.revealModal({url:WWW_DIR_JAVASCRIPT+"user/wentinactive/false",hidecallback:function(){LiveHelperChatFactory.setInactive("false"),e.isListLoaded=!1,e.blockSync=!1,e.resetTimeoutActivity(),lhinst.disableSync=!1,$scope.loadChatList()}})})},1e3*e.timeoutActivityTime)}},this.getOpenedChatIds=function(t){if(localStorage)try{var e=localStorage.getItem(t);if(null!==e&&""!==e)return achat_id_array=e.split(",")}catch(t){}return[]},$scope.loadchatMessagesScope=function(){lhinst.syncadmincall()},this.verifyFilters=function(){var t=[],e=[],a=[],i=[];angular.forEach(_that.userList,function(e){t.push(e.id)}),angular.forEach(_that.userGroups,function(t){e.push(t.id)}),angular.forEach(_that.userDepartmentsGroups,function(t){a.push(t.id)}),angular.forEach(_that.userProductNames,function(t){i.push(t.id)});var o={activeu:t,actived_products:i,actived_ugroups:e,actived_dpgroups:a,pendingu:t,pendingd_ugroups:e,pendingd_dpgroups:a,pendingd_products:i,departmentd_dpgroups:a,closedd_products:i,closedd_dpgroups:a,unreadd_dpgroups:a,unreadd_products:i,mcd_products:i,mcd_dpgroups:a};angular.forEach(o,function(t,e){angular.forEach(_that[e],function(a){-1===t.indexOf(a)&&(_that[e].splice(_that[e].indexOf(a),1),_that.productChanged(e))})})},this.rejectGroupChat=function(t){LiveHelperChatFactory.rejectGroupChat(t).then(function(t){$scope.loadChatList()})},this.startNewGroupChat=function(t,e){LiveHelperChatFactory.newGroupChat(t,e).then(function(t){lhinst.startGroupChat(t.id,$("#tabs"),LiveHelperChatFactory.truncate(t.name,10)),$scope.loadChatList(),_that.new_group_name="",_that.new_group_type=""})},this.initLHCData=function(){var t="",e=this.getOpenedChatIds("achat_id"),a=this.getOpenedChatIds("gachat_id");$("#tabs").length>0&&0==lhinst.disableremember&&e.length>0&&(t="/(chatopen)/"+e.join("/")),$("#tabs").length>0&&0==lhinst.disableremember&&a.length>0&&(t+="/(chatgopen)/"+a.join("/")),LiveHelperChatFactory.loadInitialData(t).then(function(t){_that.userDepartmentsNames=t.dp_names,_that.userDepartments=t.dep_list,_that.userProductNames=t.pr_names,_that.userDepartmentsGroups=t.dp_groups,_that.userGroups=t.user_groups,_that.userList=t.user_list,_that.hideInvisible=t.im,_that.hideOnline=t.ho,_that.lhcVersion=t.v,_that.alwaysOnline=t.a_on,_that.additionalColumns=t.col,_that.widgetsActive=t.widgets,_that.bot_st=t.bot_st,angular.forEach(_that.widgetsItems,function(t){_that.setDepartmentNames(t)}),1==t.track_activity&&(_that.timeoutActivityTime=t.timeout_activity,_that.setupActivityMonitoring()),angular.forEach(t.copen,function(t){lhinst.startChat(t.id,$("#tabs"),LiveHelperChatFactory.truncate(t.nick,10),!1,0,t.status)}),angular.forEach(t.cgopen,function(t){lhinst.startGroupChat(t.id,$("#tabs"),LiveHelperChatFactory.truncate(t.nick,10))}),angular.forEach(t.cdel,function(t){lhinst.forgetChat(t,"achat_id")}),angular.forEach(t.cgdel,function(t){lhinst.forgetChat(t,"gachat_id")}),ee.emitEvent("eventLoadInitialData",[t,$scope,_that]),_that.verifyFilters(),$scope.loadChatList()})},this.initLHCData()}]);