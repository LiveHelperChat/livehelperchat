try{var phonecatApp=angular.module("lhcApp",["lhcAppServices","lhcAppControllers"]),services=angular.module("lhcAppServices",[]),lhcAppControllers=angular.module("lhcAppControllers",["checklist-model"]);lhcAppControllers.config(["$compileProvider",function(t){t.debugInfoEnabled(!1)}]),lhcAppControllers.run(["$http",function(t){t.defaults.headers.common["X-CSRFToken"]=confLH.csrf_token}]),angular.element(document).ready((function(){angular.element(document.querySelector("form")).triggerHandler("$destroy")})),services.factory("LiveHelperChatFactory",["$http","$q",function(t,e){return this.loadChatList=function(i){var n=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"chat/syncadmininterface"+i).then((function(t){void 0!==t.error_url?document.location=t.error_url:n.resolve(t.data)}),(function(t){n.reject(void 0!==t.status?"["+t.status+"]":"[0]")})),n.promise},this.loadInitialData=function(i){var n=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"chat/loadinitialdata"+i).then((function(t){void 0!==t.error_url?document.location=t.data.error_url:n.resolve(t.data)}),(function(t){n.reject(void 0!==t.status?"["+t.status+"]":"[0]")})),n.promise},this.loadActiveChats=function(){var i=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"chat/loadactivechats").then((function(t){void 0!==t.error_url?document.location=t.error_url:i.resolve(t.data)}),(function(t){i.reject(void 0!==t.status?"["+t.status+"]":"[0]")})),i.promise},this.getNotificationsData=function(i){var n=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"chat/getnotificationsdata/(id)/"+i).then((function(t){void 0!==t.error_url?document.location=t.data.error_url:n.resolve(t.data)}),(function(t){n.reject(void 0!==t.status?"["+t.status+"]":"[0]")})),n.promise},this.getChatData=function(i){var n=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"chat/getchatdata/"+i).then((function(t){n.resolve(t.data)}),(function(t){n.reject(void 0!==t.status?"["+t.status+"]":"[0]")})),n.promise},this.setInactive=function(i){var n=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"user/setinactive/"+i).then((function(t){n.resolve(t.data)}),(function(t){n.reject(void 0!==t.status?"["+t.status+"]":"[0]")})),n.promise},this.setOnlineMode=function(i){var n=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"user/setoffline/"+i).then((function(t){n.resolve(t.data)}),(function(t){n.reject(void 0!==t.status?"["+t.status+"]":"[0]")})),n.promise},this.setAlwaysOnlineMode=function(i){var n=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"user/setalwaysonline/"+i).then((function(t){n.resolve(t.data)}),(function(t){n.reject(void 0!==t.status?"["+t.status+"]":"[0]")})),n.promise},this.changeVisibility=function(i){var n=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"user/setinvisible/"+i).then((function(t){n.resolve(t.data)}),(function(t){n.reject(void 0!==t.status?"["+t.status+"]":"[0]")})),n.promise},this.getActiveOperatorChat=function(i){var n=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"groupchat/startchatwithoperator/"+i).then((function(t){n.resolve(t.data)}),(function(t){n.reject(void 0!==t.status?"["+t.status+"]":"[0]")})),n.promise},this.rejectGroupChat=function(i){var n=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"groupchat/leave/"+i).then((function(t){n.resolve(t.data)}),(function(t){n.reject(void 0!==t.status?"["+t.status+"]":"[0]")})),n.promise},this.setLocalSettings=function(i,n){var a=e.defer();return t.post(WWW_DIR_JAVASCRIPT+"front/settings",{attr:i,val:n}).then((function(t){a.resolve(t.data)}),(function(t){a.reject(void 0!==t.status?"["+t.status+"]":"[0]")})),a.promise},this.newGroupChat=function(i,n){var a=e.defer();return t.post(WWW_DIR_JAVASCRIPT+"groupchat/newgroupajax/",{name:i,public:n}).then((function(t){a.resolve(t.data)}),(function(t){a.reject(void 0!==t.status?"["+t.status+"]":"[0]")})),a.promise},this.searchProvider=function(i,n){var a=e.defer();return t.post(WWW_DIR_JAVASCRIPT+"chat/searchprovider/"+i+"/?exclude_disabled=1&q="+n).then((function(t){a.resolve(t.data)}),(function(t){a.reject(void 0!==t.status?"["+t.status+"]":"[0]")})),a.promise},this.truncate=function(t,e,i){return isNaN(e)&&(e=10),void 0===i&&(i="..."),t.length<=e||t.length-i.length<=e?t:String(t).substring(0,e-i.length)+i},this}]);var $_LHC_API={};lhcAppControllers.controller("LiveHelperChatCtrl",["$scope","$http","$location","$rootScope","$log","$interval","LiveHelperChatFactory",function(t,e,i,n,a,o,s){t.predicate="last_visit",t.pending_chats={},t.pending_chats_expanded=!0,t.active_chats={},t.active_chats_expanded=!0,t.my_active_chats_expanded=!0,t.closed_chats={},t.closed_chats_expanded=!0,t.unread_chats={},t.unread_chats_expanded=!0,t.transfer_dep_chats={},t.transfer_chats={},t.timeoutControl=null,t.setTimeoutEnabled=!0,t.lmtoggle=!1,t.lmtoggler=!1,t.custom_list_1_expanded=!0,t.custom_list_2_expanded=!0,t.custom_list_3_expanded=!0,t.custom_list_4_expanded=!0,t.current_user_id=confLH.user_id;var d=this;this.restoreSettingByString=function(t,e){if(1==e){var i=t.split("/"),n=new Array;return angular.forEach(i,(function(t){n.push(parseInt(t))})),n}return t},this.restoreLocalSetting=function(t,e,i){try{if(localStorage){var n=localStorage.getItem(t);if(null!==n){if(1==i){var a=n.split("/"),o=new Array;return angular.forEach(a,(function(t){o.push(parseInt(t))})),o}return n}return e}}catch(t){}return e},this.custom_extension_filter="",this.limitb="10",this.limita="10",this.limitu="10",this.limitp="10",this.limito=confLH.dlist.op_n,this.restoreLocalSetting("limito",confLH.dlist.op_n,!1),this.limitc="10",this.limitd="10",this.limitmc="10",this.limitgc="10",this.limits="10",this.activeu=[],this.pendingu=[],this.subjectu=[],t.lmtoggle="false"!=this.restoreLocalSetting("lmtoggle","false",!1),t.lmtoggler="false"!=this.restoreLocalSetting("lmtoggler","false",!1),this.lhcVersion=0,this.lhcVersionCounter=8,this.lhcPendingRefresh=!1,this.lhcConnectivityProblem=!1,this.lhcConnectivityProblemExplain="",this.lastd_activity=Math.round((new Date).getTime()/1e3),this.lastidEvent=0,this.userDepartments=[],this.userProductNames=[],this.userDepartmentsGroups=[],this.userGroups=[],this.userList=[],this.widgets=[],this.additionalColumns=[],this.excludeIcons=[],this.notifIcons=[],this.departmentd=[],this.departmentd_dpgroups=[],this.departmentdNames=[],this.operatord=[],this.operatord_dpgroups=[],this.operatordNames=[],this.actived=[],this.actived_products=[],this.actived_dpgroups=[],this.actived_ugroups=[],this.activedNames=[],this.mcd=[],this.mcd_products=[],this.mcd_dpgroups=[],this.mcdNames=[],this.unreadd=[],this.unreadd_products=[],this.unreadd_dpgroups=[],this.unreaddNames=[],this.pendingd=[],this.pendingd_products=[],this.pendingd_dpgroups=[],this.pendingd_ugroups=[],this.pendingdNames=[],this.botd=[],this.botd_products=[],this.botd_dpgroups=[],this.botd_ugroups=[],this.botdNames=[],this.subjectd=[],this.subjectd_products=[],this.subjectd_dpgroups=[],this.subjectd_ugroups=[],this.subjectdNames=[],this.closedd=[],this.closedd_products=[],this.closedd_dpgroups=[],this.closeddNames=[],this.statusNotifications=[],this.isListLoaded=!1,this.widgetsItems=new Array,this.widgetsItems.push("actived"),this.widgetsItems.push("departmentd"),this.widgetsItems.push("unreadd"),this.widgetsItems.push("pendingd"),this.widgetsItems.push("operatord"),this.widgetsItems.push("closedd"),this.widgetsItems.push("mcd"),this.widgetsItems.push("botd"),this.widgetsItems.push("subjectd"),d.departmentd_hide_dep="false"!=d.restoreLocalSetting("departmentd_hide_dep","false",!1),d.departmentd_hide_dgroup="false"!=d.restoreLocalSetting("departmentd_hide_dgroup","false",!1),this.timeoutActivity=null,this.timeoutActivityTime=300,this.blockSync=!1,this.hideOnline=!1,this.hideInvisible=!1,this.alwaysOnline=!1,this.inActive=!1,this.bot_st={},ee.addListener("angularSyncDisabled",(function(e){t.syncDisabled(e)})),ee.addListener("angularLoadChatList",(function(){t.loadChatList()})),ee.addListener("angularStartChatOperatorPublic",(function(e){t.startChatOperatorPublic(e)})),ee.addListener("angularStartChatbyId",(function(t){d.startChatByID(t)})),this.changeVisibility=function(t){t&&(t.stopPropagation(),t.preventDefault()),s.changeVisibility(1==!d.hideInvisible?"true":"false").then((function(t){!1===t.error?d.hideInvisible=!d.hideInvisible:void 0!==t.msg?alert(t.msg):alert(t)}),(function(t){alert("We could not change your status!")}))},this.changeAlwaysOnline=function(t){t&&(t.stopPropagation(),t.preventDefault()),s.setAlwaysOnlineMode(1==!d.alwaysOnline?"true":"false").then((function(t){!1===t.error?d.alwaysOnline=!d.alwaysOnline:void 0!==t.msg?alert(t.msg):alert(t)}),(function(t){alert("We could not change your status! "+t)}))},this.changeOnline=function(t){t&&(t.stopPropagation(),t.preventDefault()),s.setOnlineMode(1==!d.hideOnline?"true":"false").then((function(t){!1===t.error?d.hideOnline=!d.hideOnline:void 0!==t.msg?alert(t.msg):alert(t)}),(function(t){alert("We could not change your status! "+t)}))},angular.forEach(this.widgetsItems,(function(t){d[t+"_all_departments"]="false"!=d.restoreLocalSetting(t+"_all_departments","false",!1),d[t+"_hide_hidden"]="false"!=d.restoreLocalSetting(t+"_hide_hidden","false",!1),d[t+"_hide_disabled"]="false"!=d.restoreLocalSetting(t+"_hide_disabled","false",!1),d[t+"_only_online"]="false"!=d.restoreLocalSetting(t+"_only_online","false",!1),d[t+"_only_explicit_online"]="false"!=d.restoreLocalSetting(t+"_only_explicit_online","false",!1)})),this.storeLocalSetting=function(t,e){if(localStorage)try{e=localStorage.setItem(t,e)}catch(t){}},this.removeLocalSetting=function(t){if(localStorage)try{localStorage.removeItem(t)}catch(t){}},this.toggleList=function(e){if(t[e]=!t[e],localStorage)try{localStorage.setItem(e,t[e])}catch(t){}},this.toggleWidgetData=[],this.toggleWidget=function(e,i){if(d.toggleWidgetData[e]=void 0===d.toggleWidgetData[e]||!d.toggleWidgetData[e],localStorage)try{localStorage.setItem(e,d.toggleWidgetData[e])}catch(t){}void 0!==i&&1==i&&(d.isListLoaded=!1,t.loadChatList())},this.toggleWidgetSort=function(e,i,n,a){if(d.toggleWidgetData[e]=void 0===d.toggleWidgetData[e]?i:d.toggleWidgetData[e]==i?n:i,localStorage)try{localStorage.setItem(e,d.toggleWidgetData[e])}catch(t){}void 0!==a&&1==a&&(d.isListLoaded=!1,t.loadChatList())},this.getToggleWidget=function(t,e){this.toggleWidgetData[t]="false"!=this.restoreLocalSetting(t,void 0===e?"false":e,!1)},this.getToggleWidgetSort=function(t){this.toggleWidgetData[t]=this.restoreLocalSetting(t,"",!1)},t.getSyncFilter=function(){d.custom_extension_filter="";var e="/(limita)/"+parseInt(d.limita);if(e+="/(limitu)/"+parseInt(d.limitu),e+="/(limitp)/"+parseInt(d.limitp),e+="/(limito)/"+parseInt(d.limito),e+="/(limitc)/"+parseInt(d.limitc),e+="/(limitd)/"+parseInt(d.limitd),e+="/(limits)/"+parseInt(d.limits),e+="/(limitmc)/"+parseInt(d.limitmc),e+="/(limitb)/"+parseInt(d.limitb),e+="/(limitgc)/"+parseInt(d.limitgc),"object"==typeof d.widgetsActive&&d.widgetsActive.length>0){var i={my_chats:0,online_operators:1,group_chats:2,pending_chats:3,online_visitors:4,unread_chats:5,active_chats:6,bot_chats:7,transfered_chats:8,departments_stats:9,subject_chats:20},n=[];angular.forEach(d.widgetsActive,(function(t){i[t]&&n.push(i[t])})),e+="/(w)/"+n.join("/")}("object"==typeof d.activeu&&d.activeu.length>0&&(e+="/(activeu)/"+d.activeu.join("/")),"object"==typeof d.pendingu&&d.pendingu.length>0&&(e+="/(pendingu)/"+d.pendingu.join("/")),"object"==typeof d.subjectu&&d.subjectu.length>0&&(e+="/(subjectu)/"+d.subjectu.join("/")),"object"==typeof d.actived_dpgroups&&d.actived_dpgroups.length>0&&(e+="/(adgroups)/"+d.actived_dpgroups.join("/")),"object"==typeof d.pendingd_dpgroups&&d.pendingd_dpgroups.length>0&&(e+="/(pdgroups)/"+d.pendingd_dpgroups.join("/")),"object"==typeof d.subjectd_dpgroups&&d.subjectd_dpgroups.length>0&&(e+="/(sdgroups)/"+d.subjectd_dpgroups.join("/")),"object"==typeof d.closedd_dpgroups&&d.closedd_dpgroups.length>0&&(e+="/(cdgroups)/"+d.closedd_dpgroups.join("/")),"object"==typeof d.botd_dpgroups&&d.botd_dpgroups.length>0&&(e+="/(bdgroups)/"+d.botd_dpgroups.join("/")),"object"==typeof d.mcd_dpgroups&&d.mcd_dpgroups.length>0&&(e+="/(mdgroups)/"+d.mcd_dpgroups.join("/")),"object"==typeof d.unreadd_dpgroups&&d.unreadd_dpgroups.length>0&&(e+="/(udgroups)/"+d.unreadd_dpgroups.join("/")),"object"==typeof d.departmentd_dpgroups&&d.departmentd_dpgroups.length>0&&(e+="/(ddgroups)/"+d.departmentd_dpgroups.join("/")),"object"==typeof d.operatord_dpgroups&&d.operatord_dpgroups.length>0&&(e+="/(odpgroups)/"+d.operatord_dpgroups.join("/")),"object"==typeof d.actived)&&(d.actived.length>0?e+="/(actived)/"+d.actived.join("/"):(a=d.manualFilterByFilter("actived")).length>0&&(e+="/(actived)/"+a.join("/")));"object"==typeof d.subjectd&&(d.subjectd.length>0?e+="/(subjectd)/"+d.subjectd.join("/"):(a=d.manualFilterByFilter("subjectd")).length>0&&(e+="/(subjectd)/"+a.join("/")));"object"==typeof d.mcd&&(d.mcd.length>0?e+="/(mcd)/"+d.mcd.join("/"):(a=d.manualFilterByFilter("mcd")).length>0&&(e+="/(mcd)/"+a.join("/")));"object"==typeof d.unreadd&&(d.unreadd.length>0?e+="/(unreadd)/"+d.unreadd.join("/"):(a=d.manualFilterByFilter("unreadd")).length>0&&(e+="/(unreadd)/"+a.join("/")));"object"==typeof d.botd&&(d.botd.length>0?e+="/(botd)/"+d.botd.join("/"):(a=d.manualFilterByFilter("botd")).length>0&&(e+="/(botd)/"+a.join("/")));if("object"==typeof d.pendingd){var a;if(d.pendingd.length>0)e+="/(pendingd)/"+d.pendingd.join("/");else(a=d.manualFilterByFilter("pendingd")).length>0&&(e+="/(pendingd)/"+a.join("/"));void 0!==d.toggleWidgetData.pending_chats_sort&&1==d.toggleWidgetData.pending_chats_sort&&(e+="/(psort)/asc")}"object"==typeof d.operatord&&(d.operatord.length>0?e+="/(operatord)/"+d.operatord.join("/"):(a=d.manualFilterByFilter("operatord")).length>0&&(e+="/(operatord)/"+a.join("/")));("object"==typeof d.closedd&&d.closedd.length>0&&(e+="/(closedd)/"+d.closedd.join("/")),"object"==typeof d.departmentd)&&(d.departmentd.length>0?e+="/(departmentd)/"+d.departmentd.join("/"):(a=d.manualFilterByFilter("departmentd")).length>0&&(e+="/(departmentd)/"+a.join("/")));"object"==typeof d.actived_products&&d.actived_products.length>0&&(e+="/(activedprod)/"+d.actived_products.join("/")),"object"==typeof d.pendingd_ugroups&&d.pendingd_ugroups.length>0&&(e+="/(pugroups)/"+d.pendingd_ugroups.join("/")),"object"==typeof d.subjectd_ugroups&&d.subjectd_ugroups.length>0&&(e+="/(sugroups)/"+d.subjectd_ugroups.join("/")),"object"==typeof d.actived_ugroups&&d.actived_ugroups.length>0&&(e+="/(augroups)/"+d.actived_ugroups.join("/")),"object"==typeof d.mcd_products&&d.mcd_products.length>0&&(e+="/(mcdprod)/"+d.mcd_products.join("/")),"object"==typeof d.unreadd_products&&d.unreadd_products.length>0&&(e+="/(unreaddprod)/"+d.unreadd_products.join("/")),"object"==typeof d.pendingd_products&&d.pendingd_products.length>0&&(e+="/(pendingdprod)/"+d.pendingd_products.join("/")),"object"==typeof d.subjectd_products&&d.subjectd_products.length>0&&(e+="/(subjectdprod)/"+d.subjectd_products.join("/")),"object"==typeof d.botd_products&&d.botd_products.length>0&&(e+="/(botdprod)/"+d.botd_products.join("/")),"object"==typeof d.closedd_products&&d.closedd_products.length>0&&(e+="/(closeddprod)/"+d.closedd_products.join("/")),void 0!==d.toggleWidgetData.track_open_chats&&1==d.toggleWidgetData.track_open_chats&&(e+="/(topen)/true"),void 0!==d.toggleWidgetData.active_chats_sort&&""!==d.toggleWidgetData.active_chats_sort&&(e+="/(acs)/"+d.toggleWidgetData.active_chats_sort),void 0!==d.toggleWidgetData.closed_chats_sort&&""!==d.toggleWidgetData.closed_chats_sort&&(e+="/(clcs)/"+d.toggleWidgetData.closed_chats_sort),void 0!==d.toggleWidgetData.onop_sort&&""!==d.toggleWidgetData.onop_sort&&(e+="/(onop)/"+d.toggleWidgetData.onop_sort);var o=[];return!0===d.departmentd_hide_dep&&o.push("dhdep"),!0===d.departmentd_hide_dgroup&&o.push("dhdepg"),o.length>0&&(e+="/(hsub)/"+o.join("/")),d.lastd_activity>0&&(e+="/(lda)/"+d.lastd_activity),d.lastd_activity=0,ee.emitEvent("eventGetSyncFilter",[d,t]),e+=d.custom_extension_filter},t.$watch("lhc.limita",(function(e,i){e!=i&&(s.setLocalSettings("limita",e),d.isListLoaded=!1,t.loadChatList())})),this.manualFilterByFilter=function(t){if((1==d[t+"_only_explicit_online"]||1==d[t+"_hide_hidden"]||1==d[t+"_hide_disabled"]||1==d[t+"_only_online"])&&d.userDepartments.length>0){var e=[];return angular.forEach(d.userDepartments,(function(i){(0==d[t+"_only_explicit_online"]||1==d[t+"_only_explicit_online"]&&1==i.oexp)&&(0==d[t+"_hide_hidden"]||1==d[t+"_hide_hidden"]&&0==i.hidden)&&(0==d[t+"_hide_disabled"]||1==d[t+"_hide_disabled"]&&0==i.disabled)&&(0==d[t+"_only_online"]||1==d[t+"_only_online"]&&1==i.ogen)&&e.push(i.id)})),0==e.length&&e.push(-1),e}return[]},this.setDepartmentNames=function(t){d[t+"Names"]=[],angular.forEach(d[t],(function(e){void 0!==d.userDepartmentsNames&&void 0!==d.userDepartmentsNames[e]?d[t+"Names"].push(d.userDepartmentsNames[e]):void 0!==d.userDepartmentsNames&&(d[t].splice(d[t].indexOf(e),1),d.departmentChanged(t))}))},this.departmentChanged=function(e){if(d[e].length>0){d[e+"_all_departments"]=!1,d.allDepartmentsChanged(e,!1);var i=d[e].join("/");""!=i&&(s.setLocalSettings(e,i),d.setDepartmentNames(e))}else s.setLocalSettings(e,null);d.isListLoaded=!1,t.loadChatList()},this.productChanged=function(e){if(d[e].length>0){var i=d[e].join("/");""!=i&&s.setLocalSettings(e,i)}else s.setLocalSettings(e,null);d.isListLoaded=!1,t.loadChatList()},this.allDepartmentsChanged=function(e,i){1==d[e+"_all_departments"]?d.storeLocalSetting(e+"_all_departments",!0):d.removeLocalSetting(e+"_all_departments"),1==d[e+"_hide_hidden"]?d.storeLocalSetting(e+"_hide_hidden",!0):d.removeLocalSetting(e+"_hide_hidden"),1==d[e+"_hide_disabled"]?d.storeLocalSetting(e+"_hide_disabled",!0):d.removeLocalSetting(e+"_hide_disabled"),1==d[e+"_only_online"]?d.storeLocalSetting(e+"_only_online",!0):d.removeLocalSetting(e+"_only_online"),void 0!==d[e+"_hide_dep"]&&(1==d[e+"_hide_dep"]?d.storeLocalSetting(e+"_hide_dep",!0):d.removeLocalSetting(e+"_hide_dep")),void 0!==d[e+"_hide_dgroup"]&&(1==d[e+"_hide_dgroup"]?d.storeLocalSetting(e+"_hide_dgroup",!0):d.removeLocalSetting(e+"_hide_dgroup")),1==d[e+"_all_departments"]?(d[e]=[],angular.forEach(d.userDepartments,(function(t){(0==d[e+"_only_explicit_online"]||1==d[e+"_only_explicit_online"]&&1==t.oexp)&&(0==d[e+"_hide_hidden"]||1==d[e+"_hide_hidden"]&&0==t.hidden)&&(0==d[e+"_hide_disabled"]||1==d[e+"_hide_disabled"]&&0==t.disabled)&&(0==d[e+"_only_online"]||1==d[e+"_only_online"]&&1==t.ogen)&&d[e].push(t.id)})),0==d[e].length&&d[e].push(-1)):1==i&&(d[e]=[]),1==i&&(d.isListLoaded=!1,t.loadChatList())},t.$watch("lhc.limitu",(function(e,i){e!=i&&(s.setLocalSettings("limitu",e),t.loadChatList())})),t.$watch("lhc.limitc",(function(e,i){e!=i&&(s.setLocalSettings("limitc",e),t.loadChatList())})),t.$watch("lhc.limitp",(function(e,i){e!=i&&(s.setLocalSettings("limitp",e),t.loadChatList())})),t.$watch("lhc.limito",(function(e,i){e!=i&&(s.setLocalSettings("limito",e),t.loadChatList())})),t.$watch("lhc.limitmc",(function(e,i){e!=i&&(s.setLocalSettings("limitmc",e),t.loadChatList())})),t.$watch("lhc.limitgc",(function(e,i){e!=i&&(s.setLocalSettings("limitgc",e),t.loadChatList())})),t.$watch("lhc.limitd",(function(e,i){e!=i&&(s.setLocalSettings("limitd",e),t.loadChatList())})),t.$watch("lhc.activeu",(function(e,i){e!=i&&(s.setLocalSettings("activeu",e),d.isListLoaded=!1,t.loadChatList())})),t.$watch("lhc.pendingu",(function(e,i){e!=i&&(s.setLocalSettings("pendingu",e),d.isListLoaded=!1,t.loadChatList())})),t.$watch("lhc.subjectu",(function(e,i){e!=i&&(s.setLocalSettings("subjectu",e),d.isListLoaded=!1,t.loadChatList())})),t.syncDisabled=function(t){d.blockSync=t},t.loadChatList=function(){if(localStorage)try{t.pending_chats_expanded="false"!=localStorage.getItem("pending_chats_expanded"),t.active_chats_expanded="false"!=localStorage.getItem("active_chats_expanded"),t.my_active_chats_expanded="false"!=localStorage.getItem("my_active_chats_expanded"),t.closed_chats_expanded="false"!=localStorage.getItem("closed_chats_expanded"),t.unread_chats_expanded="false"!=localStorage.getItem("unread_chats_expanded"),t.my_chats_expanded="false"!=localStorage.getItem("my_chats_expanded"),t.custom_list_1_expanded="false"!=localStorage.getItem("custom_list_1_expanded"),t.custom_list_2_expanded="false"!=localStorage.getItem("custom_list_2_expanded"),t.custom_list_3_expanded="false"!=localStorage.getItem("custom_list_3_expanded"),t.custom_list_4_expanded="false"!=localStorage.getItem("custom_list_4_expanded")}catch(t){}if(1==d.blockSync)return clearTimeout(t.timeoutControl),void(t.timeoutControl=setTimeout((function(){d.isListLoaded=!1,t.loadChatList()}),confLH.back_office_sinterval));clearTimeout(t.timeoutControl),s.loadChatList(t.getSyncFilter()).then((function(e){if(e.logout||e.error_url)document.location.reload();else{if(1==d.blockSync)return clearTimeout(t.timeoutControl),void(t.timeoutControl=setTimeout((function(){d.isListLoaded=!1,t.loadChatList()}),confLH.back_office_sinterval));if(1==d.lhcConnectivityProblem&&(d.lhcConnectivityProblem=!1),ee.emitEvent("eventLoadChatList",[e,t,d]),void 0===e.items_processed){var i=[],n=[],a=[],o=[],r=$("#tabs");angular.forEach(e.result,(function(e,c){if(t[c]=e,r.length>0&&("pending_chat"==c||"my_chats"==c?e.list.forEach((function(t){void 0!==t.user_id&&t.user_id==confLH.user_id&&1==confLH.accept_chats&&(1!==t.status||1===t.status&&!0===t.hum)&&0==$("#chat-tab-link-"+t.id).length&&(r.length>0&&0==lhinst.disableremember&&(lhinst.removeSynchroChat(t.id),lhinst.startChatBackground(t.id,r,s.truncate(t.nick||"Visitor",10))),0==lhinst.disableremember&&o.push(t.id))})):"transfer_chats"==c?e.list.forEach((function(t){void 0!==t.user_id&&t.user_id==confLH.user_id&&(1==confLH.accept_chats||$("#chat-tab-link-"+t.id).length>0)&&(r.length>0&&0==lhinst.disableremember&&lhinst.startChatTransfer(t.id,r,s.truncate(t.nick||"Visitor",10),t.transfer_id,0==$("#chat-tab-link-"+t.id).length),0==lhinst.disableremember&&o.push(t.id))})):"group_chats"==c?r.length>0&&1==confLH.auto_join_private&&e.list.forEach((function(t){1==t.type&&0==t.jtime&&0==$("#chat-tab-link-gc"+t.id).length&&lhinst.startGroupChat(t.id,r,s.truncate(t.name,10),!0)})):"support_chats"==c&&r.length>0&&1==confLH.auto_join_private&&e.list.forEach((function(t){null===document.getElementById("chat-tab-li-"+t.chat_id)?d.startChatByID(t.chat_id,!0):$("#private-chat-tab-link-"+t.chat_id).attr("private-loaded")?$("#chat-tab-link-"+t.chat_id).hasClass("active")?$("#private-chat-tab-link-"+t.chat_id).hasClass("active")||$("#private-chat-tab-link-"+t.chat_id+" > .whatshot").removeClass("d-none"):$("#chat-tab-link-"+t.chat_id+" > .whatshot").removeClass("d-none"):($("#private-chat-tab-link-"+t.chat_id).attr("private-loaded",!0),ee.emitEvent("privateChatStart",[t.chat_id,{unread:!0}]))}))),e.last_id_identifier){n=[],i=[];var l=0,u=e.list;"pending_chat"==e.last_id_identifier&&void 0!==d.toggleWidgetData.pending_chats_sort&&1==d.toggleWidgetData.pending_chats_sort&&(u=e.list.slice().reverse()),angular.forEach(u,(function(t,a){var o=void 0!==t.user_id?t.user_id:0,s=t.id+"_"+o;if(("bot_chats"!=e.last_id_identifier||t.msg_v&&t.msg_v>d.bot_st.msg_nm&&1==d.bot_st.bot_notifications||t.aalert)&&"transfer_chat_dep"!=e.last_id_identifier){var r=[];if("active_chats"==e.last_id_identifier&&t.aicons&&(s+="_"+(r=Object.keys(t.aicons)).join("_")),i.push(s),void 0===d.statusNotifications[e.last_id_identifier]&&(d.statusNotifications[e.last_id_identifier]=new Array),1==d.isListLoaded&&"subject_chats"==e.last_id_identifier)-1==d.statusNotifications[e.last_id_identifier].indexOf(s)&&-1===lhinst.chatsSynchronising.indexOf(parseInt(t.id))&&n.push(t.id);else if(1==d.isListLoaded&&"active_chats"==e.last_id_identifier){if(-1==d.statusNotifications[e.last_id_identifier].indexOf(s)&&r.length>0&&d.notifIcons.length>0){var c=d.notifIcons.filter((function(t){return-1===d.excludeIcons.indexOf(t)&&-1!==r.indexOf(t)}));c.length>0&&n.push(t.id+"__"+c.join("__"))}}else 1!=d.isListLoaded||0!=l&&2!==t.status_sub_sub||!(-1==d.statusNotifications[e.last_id_identifier].indexOf(s)&&0==o&&0==confLH.ownntfonly||-1==d.statusNotifications[e.last_id_identifier].indexOf(s)&&o==confLH.user_id)?l++:-1===lhinst.chatsSynchronising.indexOf(parseInt(t.id))&&n.push(t.id)}})),n.length>0&&(n.unshift(e.last_id_identifier),a.push(n.join("/"))),1==d.isListLoaded&&d.compareNotificationsAndHide(d.statusNotifications[e.last_id_identifier],i),d.statusNotifications[e.last_id_identifier]=i}})),o.length>0&&(o.unshift("active_chat"),s.getNotificationsData(o.join("/")).then((function(t){angular.forEach(t,(function(t,e){lhinst.removeBackgroundChat(parseInt(t.last_id)),lhinst.playSoundNewAction(t.last_id_identifier,parseInt(t.last_id),t.nick?t.nick:"Live Help",t.msg?t.msg:confLH.transLation.new_chat,t.nt),lhinst.backgroundChats.push(parseInt(t.last_id))}))}))),a.length>0&&s.getNotificationsData(a.join("/")).then((function(t){angular.forEach(t,(function(t,e){lhinst.playSoundNewAction(t.last_id_identifier,parseInt(t.last_id),t.nick?t.nick:"Live Help",t.msg?t.msg:confLH.transLation.new_chat,t.nt)}))}))}if(void 0!==e.ou&&1==e.ou){$("#lhc_op_operation").remove();var c=document.getElementsByTagName("head")[0],l=document.createElement("script");l.setAttribute("id","lhc_op_operation"),l.setAttribute("type","text/javascript"),l.setAttribute("src",WWW_DIR_JAVASCRIPT+"chat/loadoperatorjs"),c.appendChild(l)}if(void 0!==e.fs&&e.fs.length>0&&angular.forEach(e.fs,(function(t,e){lhinst.playSoundNewAction("pending_transfered",parseInt(t.id),t.nick?t.nick:"Live Help",confLH.transLation.transfered,t.nt,t.uid)})),void 0!==e.mac&&e.mac.length>0)(r=$("#tabs")).length>0&&0==lhinst.disableremember&&angular.forEach(e.mac,(function(t,e){lhinst.startChatBackground(t.id,r,s.truncate(t.nick||"Visitor",10),!1)}));d.hideOnline=1==e.ho,d.hideInvisible=1==e.im,d.alwaysOnline=1==e.a_on,d.inActive=1==e.ina,d.lhcVersion!=e.v&&(d.lhcVersion=e.v,d.lhcPendingRefresh=!0,d.versionChanged()),1==t.setTimeoutEnabled&&(t.timeoutControl=setTimeout((function(){t.loadChatList()}),confLH.back_office_sinterval)),d.isListLoaded=!0}}),(function(e){d.lhcConnectivityProblem=!0,d.lhcConnectivityProblemExplain=e,t.timeoutControl=setTimeout((function(){t.loadChatList()}),confLH.back_office_sinterval)}))},this.versionChanged=function(){var t=this;o((function(){t.lhcVersionCounter=t.lhcVersionCounter-1,console.log(t.lhcVersionCounter),0==t.lhcVersionCounter&&document.location.reload(!0)}),1e3)},this.compareNotificationsAndHide=function(t,e){if(void 0!==t)for(var i=t.length-1;i>=0;i--){var n=t[i];-1===e.indexOf(n)&&lhinst.hideNotification(n.split("_")[0])}},this.appendActiveChats=function(){s.loadActiveChats().then((function(t){var e=$("#tabs");angular.forEach(t.result,(function(t,i){lhinst.startChatBackground(t.id,e,s.truncate(t.nick||"Visitor",10))})),setTimeout((function(){lhinst.syncadmininterfacestatic()}),1e3)}))},this.previewChat=function(t,e){e&&e.stopPropagation(),lhc.previewChat(t)},this.previewChatArchive=function(t,e,i){i&&i.stopPropagation(),lhc.previewChatArchive(t,e)},this.emitEvent=function(t,e){ee.emitEvent(t,[this,e])},this.redirectContact=function(t,e,i){return i&&i.stopPropagation(),lhinst.redirectContact(t,e)},this.startChatNewWindow=function(t,e,i){return i&&i.stopPropagation(),lhinst.startChatNewWindow(t,e)},this.deleteChat=function(t,e,i){return lhinst.deleteChat(t,e,i)},this.startGroupChat=function(t,e){if($("#tabs").length>0)return lhinst.startGroupChat(t,$("#tabs"),s.truncate(e,10))},this.startChatByID=function(t,e){if(!isNaN(t)&&$("#tabs").length>0){$("#menu-chat-options").dropdown("toggle");var i=this;s.getChatData(t).then((function(n){e?lhinst.startChatBackground(parseInt(t),$("#tabs"),s.truncate(n.nick||"Visitor",10),"backgroundid"):i.startChat(parseInt(t),s.truncate(n.nick||"Visitor",10))}))}},this.startChat=function(t,e){if($("#tabs").length>0)return lhinst.startChat(t,$("#tabs"),s.truncate(e||"Visitor",10));lhinst.startChatNewWindow(t,e)},this.startChatNewWindowTransfer=function(t,e,i){return lhinst.startChatNewWindowTransfer(t,e,i)},this.startChatTransfer=function(t,e,i){return lhinst.startChatTransfer(t,$("#tabs"),e,i)},t.startChatOperatorPublic=function(t){d.startChatOperator(t)},this.startChatOperator=function(t){s.getActiveOperatorChat(t).then((function(t){lhinst.startGroupChat(t.id,$("#tabs"),s.truncate(t.name,10))}))},this.openModal=function(e,i){i&&i.stopPropagation(),lhc.revealModal({url:WWW_DIR_JAVASCRIPT+e,hidecallback:function(){t.loadChatList()}})},this.addEvent=function(){var t=this;return document.addEventListener?function(e,i,n){if(e&&e.nodeName||e===window)e.addEventListener(i,n,!1);else if(e&&e.length)for(var a=0;a<e.length;a++)t.addEvent(e[a],i,n)}:function(e,i,n){if(e&&e.nodeName||e===window)e.attachEvent("on"+i,(function(){return n.call(e,window.event)}));else if(e&&e.length)for(var a=0;a<e.length;a++)t.addEvent(e[a],i,n)}}(),this.setupActivityMonitoring=function(){var t=this,e=function(){t.resetTimeoutActivity()};this.addEvent(window,"mousemove",e),this.addEvent(document,"mousemove",e),this.addEvent(window,"mousedown",e),this.addEvent(window,"click",e),this.addEvent(window,"scroll",e),this.addEvent(window,"keypress",e),this.addEvent(window,"load",e),this.addEvent(document,"scroll",e),this.addEvent(document,"touchstart",e),this.addEvent(document,"touchend",e),this.resetTimeoutActivity()},t.resetActivityFromChild=function(){d.resetTimeoutActivity()},this.resetTimeoutActivity=function(){var e=window.opener;if(e)try{e.angular.element("body").scope().resetActivityFromChild()}catch(t){console.log(t)}else if(0==this.blockSync){this.lastd_activity=Math.round((new Date).getTime()/1e3),clearTimeout(this.timeoutActivity);var i=this;this.timeoutActivity=setTimeout((function(){s.setInactive("true").then((function(e){if(1==e.active)return i.resetTimeoutActivity(),void(i.lastd_activity=0);i.blockSync=!0,lhinst.disableSync=!0,lhc.revealModal({url:WWW_DIR_JAVASCRIPT+"user/wentinactive/false",backdrop:!0,hidecallback:function(){s.setInactive("false"),i.isListLoaded=!1,i.blockSync=!1,i.resetTimeoutActivity(),lhinst.disableSync=!1,t.loadChatList(),i.inActive=!1}})}))}),1e3*i.timeoutActivityTime)}},this.getOpenedChatIds=function(t){if(localStorage)try{var e=localStorage.getItem(t);if(null!==e&&""!==e)return achat_id_array=e.split(",")}catch(t){}return[]},t.loadchatMessagesScope=function(){lhinst.syncadmincall()},this.verifyFilters=function(){var t=[],e=[],i=[],n=[];angular.forEach(d.userGroups,(function(t){e.push(t.id)})),angular.forEach(d.userDepartmentsGroups,(function(t){i.push(t.id)})),angular.forEach(d.userProductNames,(function(t){n.push(t.id)})),s.searchProvider("users_ids",d.pendingu.join(",")+","+d.activeu.join(",")+","+d.subjectu.join(",")).then((function(a){d.userList=a.items,angular.forEach(d.userList,(function(e){t.push(e.id)}));var o={activeu:t,actived_products:n,actived_ugroups:e,actived_dpgroups:i,pendingu:t,pendingd_ugroups:e,pendingd_dpgroups:i,pendingd_products:n,botd_dpgroups:i,botd_products:n,departmentd_dpgroups:i,closedd_products:n,closedd_dpgroups:i,unreadd_dpgroups:i,unreadd_products:n,mcd_products:n,mcd_dpgroups:i};angular.forEach(o,(function(t,e){var i=[...d[e]];angular.forEach(i,(function(i){-1===t.indexOf(i)&&(d[e].splice(d[e].indexOf(i),1),d.productChanged(e))}))}))}))},this.rejectGroupChat=function(e){s.rejectGroupChat(e).then((function(e){t.loadChatList()}))},this.startNewGroupChat=function(e,i){s.newGroupChat(e,i).then((function(e){lhinst.startGroupChat(e.id,$("#tabs"),s.truncate(e.name,10)),t.loadChatList(),d.new_group_name="",d.new_group_type=""}))},t.$watch("lhc.userFilterText",(function(t,e){t!=e&&s.searchProvider("users",t).then((function(t){d.userList=t.items}))})),this.initLHCData=function(){var e="",i=this.getOpenedChatIds("achat_id"),n=this.getOpenedChatIds("gachat_id"),a=0,o=window.location.hash;if(""!=o){var r=o.match(/\d+$/);null!==r&&r[0]&&(a=parseInt(r[0]),-1===i.indexOf(a)&&i.push(a))}var c=document.getElementById("load_chat_id");c&&-1===i.indexOf(c.value)&&(a=c.value,i.push(c.value),window.location.hash="#!#chat-id-"+c.value),$("#tabs").length>0&&0==lhinst.disableremember&&i.length>0&&(e="/(chatopen)/"+i.join("/")),$("#tabs").length>0&&0==lhinst.disableremember&&n.length>0&&(e+="/(chatgopen)/"+n.join("/")),s.loadInitialData(e).then((function(e){if(e.logout||e.error_url)document.location.reload();else{d.userDepartmentsNames=e.dp_names,d.userDepartments=e.dep_list,d.userProductNames=e.pr_names,d.userDepartmentsGroups=e.dp_groups,d.userGroups=e.user_groups,d.hideInvisible=e.im,d.hideOnline=e.ho,d.lhcVersion=e.v,d.alwaysOnline=e.a_on,d.additionalColumns=e.col,d.widgetsActive=e.widgets,d.bot_st=e.bot_st,d.excludeIcons=e.exc_ic,d.notifIcons=e.not_ic;var i=["subjectd","subjectd_products","subjectd_dpgroups","subjectd_ugroups","activeu","pendingu","subjectu","closedd","closedd_products","closedd_dpgroups","botd","botd_products","botd_dpgroups","botd_ugroups","pendingd","pendingd_products","pendingd_dpgroups","pendingd_ugroups","unreadd","unreadd_products","unreadd_dpgroups","mcd","mcd_products","mcd_dpgroups","actived","actived_products","actived_dpgroups","actived_ugroups","departmentd_dpgroups","departmentd","operatord_dpgroups","operatord"],n=["limitb","limita","limitu","limitp","limito","limitc","limitd","limitmc","limitgc","limits"];e.dw_filters&&Object.keys(e.dw_filters).forEach(t=>{-1!==i.indexOf(t)?d[t]=d.restoreSettingByString(e.dw_filters[t],!0):-1!==n.indexOf(t)&&(d[t]=e.dw_filters[t])}),angular.forEach(d.widgetsItems,(function(t){d.setDepartmentNames(t)})),1==e.track_activity&&(d.timeoutActivityTime=e.timeout_activity,d.setupActivityMonitoring()),angular.forEach(e.copen,(function(t){lhinst.startChat(t.id,$("#tabs"),s.truncate(t.nick||"Visitor",10),t.id==a,0,t.status)})),angular.forEach(e.cgopen,(function(t){lhinst.startGroupChat(t.id,$("#tabs"),s.truncate(t.nick||"Visitor",10),!0)})),angular.forEach(e.cdel,(function(t){lhinst.forgetChat(t,"achat_id")})),angular.forEach(e.cgdel,(function(t){lhinst.forgetChat(t,"gachat_id")})),ee.emitEvent("eventLoadInitialData",[e,t,d]),$_LHC_API.initial_data=e,d.verifyFilters(),t.loadChatList()}}))},this.initLHCData()}])}catch(t){if(!lhcError)throw Error("lhc : "+t.message);lhcError.log(t.message,"angular.lhc.js",t.lineNumber||t.line,t.stack)}