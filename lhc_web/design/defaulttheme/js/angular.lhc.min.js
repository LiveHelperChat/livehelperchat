!function(t,e,a){var i=a(t,t.jQuery);"undefined"!=typeof module&&"exports"in module?module.exports=i:"function"==typeof define&&define.amd?define([],function(){return i}):t[e]=i}(this,"jdenticon",function(t,e){function a(t,e,a){for(var i=document.createElementNS("http://www.w3.org/2000/svg",e),n=2;n+1<arguments.length;n+=2)i.setAttribute(arguments[n],arguments[n+1]);t.appendChild(i)}function i(t){for(this.b=Math.min(Number(t.getAttribute("width"))||100,Number(t.getAttribute("height"))||100),this.a=t;t.firstChild;)t.removeChild(t.firstChild);t.setAttribute("viewBox","0 0 "+this.b+" "+this.b),t.setAttribute("preserveAspectRatio","xMidYMid meet")}function n(t){this.b=t,this.a='<svg xmlns="http://www.w3.org/2000/svg" width="'+t+'" height="'+t+'" viewBox="0 0 '+t+" "+t+'" preserveAspectRatio="xMidYMid meet">'}function o(t){return function(t){for(var e=[],a=0;a<t.length;a++)for(var i=t[a],n=28;0<=n;n-=4)e.push((i>>>n&15).toString(16));return e.join("")}(function(t){for(var e=1732584193,a=4023233417,i=2562383102,n=271733878,o=3285377520,s=[e,a,i,n,o],r=0;r<t.length;r++){for(var c=t[r],h=16;80>h;h++){var d=c[h-3]^c[h-8]^c[h-14]^c[h-16];c[h]=d<<1|d>>>31}for(h=0;80>h;h++)d=(e<<5|e>>>27)+(20>h?(a&i^~a&n)+1518500249:40>h?(a^i^n)+1859775393:60>h?(a&i^a&n^i&n)+2400959708:(a^i^n)+3395469782)+o+c[h],o=n,n=i,i=a<<30|a>>>2,a=e,e=0|d;s[0]=e=s[0]+e|0,s[1]=a=s[1]+a|0,s[2]=i=s[2]+i|0,s[3]=n=s[3]+n|0,s[4]=o=s[4]+o|0}return s}(function(t){function e(t,e){for(var a=[],n=-1,o=0;o<e;o++)n=o/4|0,a[n]=(a[n]||0)+(i[t+o]<<8*(3-(3&o)));for(;16>++n;)a[n]=0;return a}var a=encodeURI(t),i=[];t=0;var n,o=[];for(n=0;n<a.length;n++){if("%"==a[n]){var s=d(a,n+1,2);n+=2}else s=a.charCodeAt(n);i[t++]=s}for(i[t++]=128,n=0;n+64<=t;n+=64)o.push(e(n,64));return a=t-n,n=e(n,a),64<a+8&&(o.push(n),n=e(0,0)),n[15]=8*t-8,o.push(n),o}(t)))}function s(t,e){var a=t.canvas.width,i=t.canvas.height;t.save(),this.b=t,e?this.a=e:(this.a=Math.min(a,i),t.translate((a-this.a)/2|0,(i-this.a)/2|0)),t.clearRect(0,0,this.a,this.a)}function r(t){return t|=0,0>t?"00":16>t?"0"+t.toString(16):256>t?t.toString(16):"ff"}function c(t,e,a){return a=0>a?a+6:6<a?a-6:a,r(255*(1>a?t+(e-t)*a:3>a?e:4>a?t+(e-t)*(4-a):t))}function h(t){"undefined"!=typeof MutationObserver&&new MutationObserver(function(e){for(var a=0;a<e.length;a++){for(var i=e[a],n=i.addedNodes,o=0;n&&o<n.length;o++){var s=n[o];if(1==s.nodeType)if($.w(s))t(s);else{s=s.querySelectorAll($.A);for(var r=0;r<s.length;r++)t(s[r])}}"attributes"==i.type&&$.w(i.target)&&t(i.target)}}).observe(document.body,{childList:!0,attributes:!0,attributeFilter:[$.o,$.s,"width","height"],subtree:!0})}function d(t,e,a){return parseInt(t.substr(e,a),16)}function l(t){return(10*t+.5|0)/10}function u(){this.j=""}function f(t){this.b={},this.h=t,this.a=t.b}function _(t){this.h=t,this.c=m.a}function p(t,e){return t=e.O(t),[I.i(t,e.H,e.G(0)),I.i(t,e.v,e.u(.5)),I.i(t,e.H,e.G(1)),I.i(t,e.v,e.u(1)),I.i(t,e.v,e.u(0))]}function g(t,e){this.x=t,this.y=e}function m(t,e,a,i){this.b=t,this.c=e,this.h=a,this.a=i}function v(t,e,a,i,n,o,s){function r(n,o,s,r,c){for(r=r?d(e,r,1):0,o=o[d(e,s,1)%o.length],t.D(u[f[n]]),n=0;n<c.length;n++)h.c=new m(a+c[n][0]*l,i+c[n][1]*l,l,r++%4),o(h,l,n);t.F()}function c(t){if(0<=t.indexOf(g))for(var e=0;e<t.length;e++)if(0<=f.indexOf(t[e]))return!0}s.C&&t.m(s.C),o=.5+n*(void 0===o?.08:o)|0,n-=2*o;var h=new _(t),l=0|n/4;a+=0|o+n/2-2*l,i+=0|o+n/2-2*l;var u=p(d(e,-7)/268435455,s),f=[];for(n=0;3>n;n++){var g=d(e,8+n,1)%u.length;(c([0,4])||c([2,3]))&&(g=1),f.push(g)}r(0,A.I,2,3,[[1,0],[2,0],[2,3],[1,3],[0,1],[3,1],[3,2],[0,2]]),r(1,A.I,4,5,[[0,0],[3,0],[3,3],[0,3]]),r(2,A.M,1,null,[[1,1],[2,1],[2,2],[1,2]]),t.finish()}function y(){function e(t,e){var a=i[t];return a&&1<a.length||(a=e),function(t){return t=a[0]+t*(a[1]-a[0]),0>t?0:1<t?1:t}}var a=L.config||t.jdenticon_config||{},i=a.lightness||{},n=a.saturation||{},o="color"in n?n.color:n;return n=n.grayscale,{O:function(t){var e,i=a.hues;return i&&0<i.length&&(e=i[0|.999*t*i.length]),"number"==typeof e?(e/360%1+1)%1:t},v:"number"==typeof o?o:.5,H:"number"==typeof n?n:0,u:e("color",[.4,.8]),G:e("grayscale",[.3,.9]),C:I.parse(a.backColor)}}function C(t){return/^[0-9a-f]{11,}$/i.test(t)&&t}function S(t){return o(null==t?"":""+t)}function b(t,e,a){if("string"==typeof t){if($.J){t=document.querySelectorAll(t);for(var n=0;n<t.length;n++)b(t[n],e,a)}}else(n=$.w(t))&&(e=C(e)||null!=e&&S(e)||C(t.getAttribute($.s))||t.hasAttribute($.o)&&S(t.getAttribute($.o)))&&(t=n==$.B?new f(new i(t)):new s(t.getContext("2d")),v(t,e,0,0,t.a,a,y()))}function L(){$.J&&b($.A)}function w(){var e=(L.config||t.jdenticon_config||{}).replaceMode;"never"!=e&&(L(),"observe"==e&&h(b))}i.prototype={m:function(t,e){e&&a(this.a,"rect","width","100%","height","100%","fill",t,"opacity",e)},c:function(t,e){a(this.a,"path","fill",t,"d",e)}},n.prototype={m:function(t,e){e&&(this.a+='<rect width="100%" height="100%" fill="'+t+'" opacity="'+e.toFixed(2)+'"/>')},c:function(t,e){this.a+='<path fill="'+t+'" d="'+e+'"/>'},toString:function(){return this.a+"</svg>"}};var $={B:1,L:2,s:"data-jdenticon-hash",o:"data-jdenticon-value",J:"undefined"!=typeof document&&"querySelectorAll"in document,w:function(t){if(t){var e=t.tagName;if(/svg/i.test(e))return $.B;if(/canvas/i.test(e)&&"getContext"in t)return $.L}}};$.A="["+$.s+"],["+$.o+"]",s.prototype={m:function(t){var e=this.b,a=this.a;e.fillStyle=I.K(t),e.fillRect(0,0,a,a)},D:function(t){this.b.fillStyle=I.K(t),this.b.beginPath()},F:function(){this.b.fill()},f:function(t){var e,a=this.b;for(a.moveTo(t[0].x,t[0].y),e=1;e<t.length;e++)a.lineTo(t[e].x,t[e].y);a.closePath()},g:function(t,e,a){var i=this.b;e/=2,i.moveTo(t.x+e,t.y+e),i.arc(t.x+e,t.y+e,e,0,2*Math.PI,a),i.closePath()},finish:function(){this.b.restore()}};var I={P:function(t,e,a){return"#"+r(t)+r(e)+r(a)},parse:function(t){if(/^#[0-9a-f]{3,8}$/i.test(t)){if(6>t.length){var e=t[1],a=t[2],i=t[3];return t=t[4]||"","#"+e+e+a+a+i+i+t+t}if(7==t.length||8<t.length)return t}},K:function(t){var e=d(t,7,2);return isNaN(e)?t:"rgba("+d(t,1,2)+","+d(t,3,2)+","+d(t,5,2)+","+(e/255).toFixed(2)+")"},N:function(t,e,a){return 0==e?(t=r(255*a),"#"+t+t+t):(e=.5>=a?a*(e+1):a+e-a*e,a=2*a-e,"#"+c(a,e,6*t+2)+c(a,e,6*t)+c(a,e,6*t-2))},i:function(t,e,a){var i=[.55,.5,.5,.46,.6,.55,.55][6*t+.5|0];return I.N(t,e,.5>a?a*i*2:i+(a-.5)*(1-i)*2)}},A={M:[function(t,e){var a=.42*e;t.f([0,0,e,0,e,e-2*a,e-a,e,0,e])},function(t,e){var a=0|.5*e;t.b(e-a,0,a,0|.8*e,2)},function(t,e){var a=0|e/3;t.a(a,a,e-a,e-a)},function(t,e){var a=.1*e,i=6>e?1:8>e?2:0|.25*e;a=1<a?0|a:.5<a?1:a,t.a(i,i,e-a-i,e-a-i)},function(t,e){var a=0|.15*e,i=0|.5*e;t.g(e-i-a,e-i-a,i)},function(t,e){var a=.1*e,i=4*a;3<i&&(i|=0),t.a(0,0,e,e),t.f([i,i,e-a,i,i+(e-i-a)/2,e-a],!0)},function(t,e){t.f([0,0,e,0,e,.7*e,.4*e,.4*e,.7*e,e,0,e])},function(t,e){t.b(e/2,e/2,e/2,e/2,3)},function(t,e){t.a(0,0,e,e/2),t.a(0,e/2,e/2,e/2),t.b(e/2,e/2,e/2,e/2,1)},function(t,e){var a=.14*e,i=4>e?1:6>e?2:0|.35*e;a=8>e?a:0|a,t.a(0,0,e,e),t.a(i,i,e-i-a,e-i-a,!0)},function(t,e){var a=.12*e,i=3*a;t.a(0,0,e,e),t.g(i,i,e-a-i,!0)},function(t,e){t.b(e/2,e/2,e/2,e/2,3)},function(t,e){var a=.25*e;t.a(0,0,e,e),t.l(a,a,e-a,e-a,!0)},function(t,e,a){var i=.4*e;a||t.g(i,i,1.2*e)}],I:[function(t,e){t.b(0,0,e,e,0)},function(t,e){t.b(0,e/2,e,e/2,0)},function(t,e){t.l(0,0,e,e)},function(t,e){var a=e/6;t.g(a,a,e-2*a)}]};return u.prototype={f:function(t){for(var e="M"+l(t[0].x)+" "+l(t[0].y),a=1;a<t.length;a++)e+="L"+l(t[a].x)+" "+l(t[a].y);this.j+=e+"Z"},g:function(t,e,a){a=a?0:1;var i=l(e/2),n=l(e);this.j+="M"+l(t.x)+" "+l(t.y+e/2)+"a"+i+","+i+" 0 1,"+a+" "+n+",0a"+i+","+i+" 0 1,"+a+" "+-n+",0"}},f.prototype={m:function(t){t=/^(#......)(..)?/.exec(t),this.h.m(t[1],t[2]?d(t[2],0)/255:1)},D:function(t){this.c=this.b[t]||(this.b[t]=new u)},F:function(){},f:function(t){this.c.f(t)},g:function(t,e,a){this.c.g(t,e,a)},finish:function(){for(var t in this.b)this.h.c(t,this.b[t].j)}},_.prototype={f:function(t,e){var a=e?-2:2,i=this.c,n=[];for(e=e?t.length-2:0;e<t.length&&0<=e;e+=a)n.push(i.l(t[e],t[e+1]));this.h.f(n)},g:function(t,e,a,i){this.h.g(this.c.l(t,e,a,a),a,i)},a:function(t,e,a,i,n){this.f([t,e,t+a,e,t+a,e+i,t,e+i],n)},b:function(t,e,a,i,n,o){t=[t+a,e,t+a,e+i,t,e+i,t,e],t.splice((n||0)%4*2,2),this.f(t,o)},l:function(t,e,a,i,n){this.f([t+a/2,e,t+a,e+i/2,t+a/2,e+i,t,e+i/2],n)}},m.prototype={l:function(t,e,a,i){var n=this.b+this.h,o=this.c+this.h;return 1===this.a?new g(n-e-(i||0),this.c+t):2===this.a?new g(n-t-(a||0),o-e-(i||0)):3===this.a?new g(this.b+e,o-t-(a||0)):new g(this.b+t,this.c+e)}},m.a=new m(0,0,0,0),L.drawIcon=function(t,e,a,i){if(!t)throw Error("No canvas specified.");t=new s(t,a),v(t,C(e)||S(e),0,0,a,i||0,y())},L.toSvg=function(t,e,a){var i=new n(e);return v(new f(i),C(t)||S(t),0,0,e,a,y()),i.toString()},L.update=b,L.version="2.1.1",e&&(e.fn.jdenticon=function(t,e){return this.each(function(a,i){b(i,t,e)}),this}),"function"==typeof setTimeout&&setTimeout(w,0),L}),$(document).ready(function(){var t=window.location.hash;""!=t&&$('ul[role="tablist"] a[href="'+t.replace("#!","")+'"]').tab("show")});var phonecatApp=angular.module("lhcApp",["lhcAppServices","lhcAppControllers"]),services=angular.module("lhcAppServices",[]),lhcAppControllers=angular.module("lhcAppControllers",["checklist-model"]);angular.element(document).ready(function(){var t=angular.element(document.querySelector("form"));t.triggerHandler("$destroy")}),services.factory("LiveHelperChatFactory",["$http","$q",function(t,e){return this.loadChatList=function(a){var i=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"chat/syncadmininterface"+a).then(function(t){"undefined"!=typeof t.error_url?document.location=t.error_url:i.resolve(t.data)},function(){i.reject("error")}),i.promise},this.loadInitialData=function(a){var i=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"chat/loadinitialdata"+a).then(function(t){"undefined"!=typeof t.error_url?document.location=t.data.error_url:i.resolve(t.data)},function(){i.reject("error")}),i.promise},this.loadActiveChats=function(){var a=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"chat/loadactivechats").then(function(t){"undefined"!=typeof t.error_url?document.location=t.error_url:a.resolve(t.data)},function(){a.reject("error")}),a.promise},this.getNotificationsData=function(a){var i=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"chat/getnotificationsdata/(id)/"+a).then(function(t){"undefined"!=typeof t.error_url?document.location=t.data.error_url:i.resolve(t.data)},function(){i.reject("error")}),i.promise},this.setInactive=function(a){var i=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"user/setinactive/"+a).then(function(t){i.resolve(t.data)},function(){i.reject("error")}),i.promise},this.setOnlineMode=function(a){var i=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"user/setoffline/"+a).then(function(t){i.resolve(t.data)},function(t){i.reject(t.data)}),i.promise},this.changeVisibility=function(a){var i=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"user/setinvisible/"+a).then(function(t){i.resolve(t.data)},function(t){i.reject(t.data)}),i.promise},this.getActiveOperatorChat=function(a){var i=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"chat/startchatwithoperator/"+a+"/(mode)/check").then(function(t){i.resolve(t.data)},function(){i.reject("error")}),i.promise},this.truncate=function(t,e,a){return isNaN(e)&&(e=10),void 0===a&&(a="..."),t.length<=e||t.length-a.length<=e?t:String(t).substring(0,e-a.length)+a},this.loadChat=function(a){var i=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"chat/adminchat/"+a).then(function(t){i.resolve(t.data)},function(){i.reject("error")}),i.promise},this.acceptTransfer=function(a,i){var n=e.defer();return t.get(WWW_DIR_JAVASCRIPT+"chat/accepttransfer/"+a+(i===!0?"/(mode)/chat":"")).then(function(t){"undefined"!=typeof t.error_url?document.location=t.data.error_url:n.resolve(t.data)},function(){n.reject("error")}),n.promise},this}]),lhcAppControllers.controller("LiveHelperChatCtrl",["$compile","$scope","$http","$location","$rootScope","$log","$interval","LiveHelperChatFactory",function($compile,$scope,$http,$location,$rootScope,$log,$interval,LiveHelperChatFactory){function preloadSound(){_that.playPreloadSound(),jQuery(document).off("click",preloadSound),jQuery(document).off("touchstart",preloadSound)}$scope.predicate="last_visit",$scope.pending_chats={},$scope.pending_chats_expanded=!0,$scope.active_chats={},$scope.active_chats_expanded=!0,$scope.my_active_chats_expanded=!0,$scope.closed_chats={},$scope.closed_chats_expanded=!0,$scope.unread_chats={},$scope.unread_chats_expanded=!0,$scope.transfer_dep_chats={},$scope.transfer_chats={},$scope.timeoutControl=null,$scope.setTimeoutEnabled=!0,$scope.lmtoggle=!1,$scope.lmtoggler=!1,$scope.cmtoggle=!1,$scope.custom_list_1_expanded=!0,$scope.custom_list_2_expanded=!0,$scope.custom_list_3_expanded=!0,$scope.custom_list_4_expanded=!0;var _that=this;this.restoreLocalSetting=function(t,e,a){try{if(localStorage){var i=localStorage.getItem(t);if(null!==i){if(1==a){var n=i.split("/"),o=new Array;return angular.forEach(n,function(t){o.push(parseInt(t))}),o}return i}return e}}catch(s){}return e},this.custom_extension_filter="",this.limitb=this.restoreLocalSetting("limitb","10",!1),this.limita=this.restoreLocalSetting("limita","10",!1),this.limitu=this.restoreLocalSetting("limitu","10",!1),this.limitp=this.restoreLocalSetting("limitp","10",!1),this.limito=this.restoreLocalSetting("limito",confLH.dlist.op_n,!1),this.limitc=this.restoreLocalSetting("limitc","10",!1),this.limitd=this.restoreLocalSetting("limitd","10",!1),this.limitmc=this.restoreLocalSetting("limitmc","50",!1),this.activeu=this.restoreLocalSetting("activeu",[],!0),this.pendingu=this.restoreLocalSetting("pendingu",[],!0),$scope.lmtoggle="false"!=this.restoreLocalSetting("lmtoggle","false",!1),$scope.lmtoggler="false"!=this.restoreLocalSetting("lmtoggler","false",!1),$scope.cmtoggle="false"!=this.restoreLocalSetting("cmtoggle","false",!1),this.lhcVersion=0,this.lhcVersionCounter=8,this.lhcPendingRefresh=!1,this.lastidEvent=0,this.userDepartments=[],this.userProductNames=[],this.userDepartmentsGroups=[],this.userGroups=[],this.userList=[],this.additionalColumns=[],this.departmentd=this.restoreLocalSetting("departmentd",[],!0),this.departmentd_dpgroups=this.restoreLocalSetting("departmentd_dpgroups",[],!0),this.departmentdNames=[],this.operatord=this.restoreLocalSetting("operatord",[],!0),this.operatord_dpgroups=this.restoreLocalSetting("operatord_dpgroups",[],!0),this.operatordNames=[],this.actived=this.restoreLocalSetting("actived",[],!0),this.actived_products=this.restoreLocalSetting("actived_products",[],!0),this.actived_dpgroups=this.restoreLocalSetting("actived_dpgroups",[],!0),this.actived_ugroups=this.restoreLocalSetting("actived_ugroups",[],!0),this.activedNames=[],this.mcd=this.restoreLocalSetting("mcd",[],!0),this.mcd_products=this.restoreLocalSetting("mcd_products",[],!0),this.mcd_dpgroups=this.restoreLocalSetting("mcd_dpgroups",[],!0),this.mcdNames=[],this.unreadd=this.restoreLocalSetting("unreadd",[],!0),this.unreadd_products=this.restoreLocalSetting("unreadd_products",[],!0),this.unreadd_dpgroups=this.restoreLocalSetting("unreadd_dpgroups",[],!0),this.unreaddNames=[],this.pendingd=this.restoreLocalSetting("pendingd",[],!0),this.pendingd_products=this.restoreLocalSetting("pendingd_products",[],!0),this.pendingd_dpgroups=this.restoreLocalSetting("pendingd_dpgroups",[],!0),this.pendingd_ugroups=this.restoreLocalSetting("pendingd_ugroups",[],!0),this.pendingdNames=[],this.botd=this.restoreLocalSetting("botd",[],!0),this.botd_products=this.restoreLocalSetting("botd_products",[],!0),this.botd_dpgroups=this.restoreLocalSetting("botd_dpgroups",[],!0),this.botd_ugroups=this.restoreLocalSetting("botd_ugroups",[],!0),this.botdNames=[],this.closedd=this.restoreLocalSetting("closedd",[],!0),this.closedd_products=this.restoreLocalSetting("closedd_products",[],!0),this.closedd_dpgroups=this.restoreLocalSetting("closedd_dpgroups",[],!0),this.closeddNames=[],this.statusNotifications=[],this.isListLoaded=!1,this.widgetsItems=new Array,this.widgetsItems.push("actived"),this.widgetsItems.push("departmentd"),this.widgetsItems.push("unreadd"),this.widgetsItems.push("pendingd"),this.widgetsItems.push("operatord"),this.widgetsItems.push("closedd"),this.widgetsItems.push("mcd"),this.timeoutActivity=null,this.timeoutActivityTime=300,this.blockSync=!1,this.hideOnline=!1,this.hideInvisible=!1,this.changeVisibility=function(){LiveHelperChatFactory.changeVisibility(1==!_that.hideInvisible?"true":"false").then(function(t){t.error===!1?_that.hideInvisible=!_that.hideInvisible:"undefined"!=typeof t.msg?alert(t.msg):alert(t)},function(t){alert("We could not change your status!")})},this.changeOnline=function(){LiveHelperChatFactory.setOnlineMode(1==!_that.hideOnline?"true":"false").then(function(t){t.error===!1?_that.hideOnline=!_that.hideOnline:"undefined"!=typeof t.msg?alert(t.msg):alert(t)},function(t){alert("We could not change your status!")})},angular.forEach(this.widgetsItems,function(t){_that[t+"_all_departments"]="false"!=_that.restoreLocalSetting(t+"_all_departments","false",!1),_that[t+"_hide_hidden"]="false"!=_that.restoreLocalSetting(t+"_hide_hidden","false",!1),_that[t+"_hide_disabled"]="false"!=_that.restoreLocalSetting(t+"_hide_disabled","false",!1),_that[t+"_only_online"]="false"!=_that.restoreLocalSetting(t+"_only_online","false",!1),_that[t+"_only_explicit_online"]="false"!=_that.restoreLocalSetting(t+"_only_explicit_online","false",!1)}),this.storeLocalSetting=function(t,e){if(localStorage)try{var e=localStorage.setItem(t,e)}catch(a){}},this.removeLocalSetting=function(t){if(localStorage)try{localStorage.removeItem(t)}catch(e){}},this.toggleList=function(t){if($scope[t]=!$scope[t],localStorage)try{localStorage.setItem(t,$scope[t])}catch(e){}},this.toggleWidgetData=[],this.toggleWidget=function(t,e){if(_that.toggleWidgetData[t]="undefined"==typeof _that.toggleWidgetData[t]||!_that.toggleWidgetData[t],localStorage)try{localStorage.setItem(t,_that.toggleWidgetData[t])}catch(a){}"undefined"!=typeof e&&1==e&&$scope.loadChatList()},this.toggleWidgetSort=function(t,e,a,i){if(_that.toggleWidgetData[t]="undefined"==typeof _that.toggleWidgetData[t]?e:_that.toggleWidgetData[t]==e?a:e,localStorage)try{localStorage.setItem(t,_that.toggleWidgetData[t])}catch(n){}"undefined"!=typeof i&&1==i&&$scope.loadChatList()},this.getToggleWidget=function(t,e){this.toggleWidgetData[t]="false"!=this.restoreLocalSetting(t,"undefined"==typeof e?"false":e,!1)},this.getToggleWidgetSort=function(t){this.toggleWidgetData[t]=this.restoreLocalSetting(t,"",!1)},$scope.getSyncFilter=function(){_that.custom_extension_filter="";var t="/(limita)/"+parseInt(_that.limita);if(t+="/(limitu)/"+parseInt(_that.limitu),t+="/(limitp)/"+parseInt(_that.limitp),t+="/(limito)/"+parseInt(_that.limito),t+="/(limitc)/"+parseInt(_that.limitc),t+="/(limitd)/"+parseInt(_that.limitd),t+="/(limitmc)/"+parseInt(_that.limitmc),t+="/(limitb)/"+parseInt(_that.limitb),"object"==typeof _that.activeu&&_that.activeu.length>0&&(t+="/(activeu)/"+_that.activeu.join("/")),"object"==typeof _that.pendingu&&_that.pendingu.length>0&&(t+="/(pendingu)/"+_that.pendingu.join("/")),"object"==typeof _that.actived_dpgroups&&_that.actived_dpgroups.length>0&&(t+="/(adgroups)/"+_that.actived_dpgroups.join("/")),"object"==typeof _that.pendingd_dpgroups&&_that.pendingd_dpgroups.length>0&&(t+="/(pdgroups)/"+_that.pendingd_dpgroups.join("/")),"object"==typeof _that.closedd_dpgroups&&_that.closedd_dpgroups.length>0&&(t+="/(cdgroups)/"+_that.closedd_dpgroups.join("/")),"object"==typeof _that.mcd_dpgroups&&_that.mcd_dpgroups.length>0&&(t+="/(mdgroups)/"+_that.mcd_dpgroups.join("/")),"object"==typeof _that.unreadd_dpgroups&&_that.unreadd_dpgroups.length>0&&(t+="/(udgroups)/"+_that.unreadd_dpgroups.join("/")),"object"==typeof _that.departmentd_dpgroups&&_that.departmentd_dpgroups.length>0&&(t+="/(ddgroups)/"+_that.departmentd_dpgroups.join("/")),"object"==typeof _that.operatord_dpgroups&&_that.operatord_dpgroups.length>0&&(t+="/(odpgroups)/"+_that.operatord_dpgroups.join("/")),"object"==typeof _that.actived)if(_that.actived.length>0)t+="/(actived)/"+_that.actived.join("/");else{var e=_that.manualFilterByFilter("actived");e.length>0&&(t+="/(actived)/"+e.join("/"))}if("undefined"!=typeof _that.toggleWidgetData.only_user&&1==_that.toggleWidgetData.only_user&&(t+="/(ouser)/true"),"object"==typeof _that.mcd)if(_that.mcd.length>0)t+="/(mcd)/"+_that.mcd.join("/");else{var e=_that.manualFilterByFilter("mcd");e.length>0&&(t+="/(mcd)/"+e.join("/"))}if("object"==typeof _that.unreadd)if(_that.unreadd.length>0)t+="/(unreadd)/"+_that.unreadd.join("/");else{var e=_that.manualFilterByFilter("unreadd");e.length>0&&(t+="/(unreadd)/"+e.join("/"))}if("object"==typeof _that.pendingd){if(_that.pendingd.length>0)t+="/(pendingd)/"+_that.pendingd.join("/");else{var e=_that.manualFilterByFilter("pendingd");e.length>0&&(t+="/(pendingd)/"+e.join("/"))}"undefined"!=typeof _that.toggleWidgetData.pending_chats_sort&&1==_that.toggleWidgetData.pending_chats_sort&&(t+="/(psort)/asc")}if("object"==typeof _that.operatord)if(_that.operatord.length>0)t+="/(operatord)/"+_that.operatord.join("/");else{var e=_that.manualFilterByFilter("operatord");e.length>0&&(t+="/(operatord)/"+e.join("/"))}if("object"==typeof _that.closedd&&_that.closedd.length>0&&(t+="/(closedd)/"+_that.closedd.join("/")),"object"==typeof _that.departmentd)if(_that.departmentd.length>0)t+="/(departmentd)/"+_that.departmentd.join("/");else{var e=_that.manualFilterByFilter("departmentd");e.length>0&&(t+="/(departmentd)/"+e.join("/"))}"object"==typeof _that.actived_products&&_that.actived_products.length>0&&(t+="/(activedprod)/"+_that.actived_products.join("/")),"object"==typeof _that.pendingd_ugroups&&_that.pendingd_ugroups.length>0&&(t+="/(pugroups)/"+_that.pendingd_ugroups.join("/")),"object"==typeof _that.actived_ugroups&&_that.actived_ugroups.length>0&&(t+="/(augroups)/"+_that.actived_ugroups.join("/")),"object"==typeof _that.mcd_products&&_that.mcd_products.length>0&&(t+="/(mcdprod)/"+_that.mcd_products.join("/")),"object"==typeof _that.unreadd_products&&_that.unreadd_products.length>0&&(t+="/(unreaddprod)/"+_that.unreadd_products.join("/")),"object"==typeof _that.pendingd_products&&_that.pendingd_products.length>0&&(t+="/(pendingdprod)/"+_that.pendingd_products.join("/")),"object"==typeof _that.closedd_products&&_that.closedd_products.length>0&&(t+="/(closeddprod)/"+_that.closedd_products.join("/")),"undefined"!=typeof _that.toggleWidgetData.active_chats_sort&&""!==_that.toggleWidgetData.active_chats_sort&&(t+="/(acs)/"+_that.toggleWidgetData.active_chats_sort),"undefined"!=typeof _that.toggleWidgetData.closed_chats_sort&&""!==_that.toggleWidgetData.closed_chats_sort&&(t+="/(clcs)/"+_that.toggleWidgetData.closed_chats_sort),"undefined"!=typeof _that.toggleWidgetData.onop_sort&&""!==_that.toggleWidgetData.onop_sort&&(t+="/(onop)/"+_that.toggleWidgetData.onop_sort),ee.emitEvent("eventGetSyncFilter",[_that,$scope]),t+=_that.custom_extension_filter;var a=_that.getOpenedChatIds();return a.length>0&&(t+="/(exchat)/"+a.join("/")),t},$scope.$watch("lhc.limita",function(t,e){t!=e&&(_that.storeLocalSetting("limita",t),$scope.loadChatList())}),this.manualFilterByFilter=function(t){if((1==_that[t+"_only_explicit_online"]||1==_that[t+"_hide_hidden"]||1==_that[t+"_hide_disabled"]||1==_that[t+"_only_online"])&&_that.userDepartments.length>0){var e=[];return angular.forEach(_that.userDepartments,function(a){(0==_that[t+"_only_explicit_online"]||1==_that[t+"_only_explicit_online"]&&1==a.oexp)&&(0==_that[t+"_hide_hidden"]||1==_that[t+"_hide_hidden"]&&0==a.hidden)&&(0==_that[t+"_hide_disabled"]||1==_that[t+"_hide_disabled"]&&0==a.disabled)&&(0==_that[t+"_only_online"]||1==_that[t+"_only_online"]&&1==a.ogen)&&e.push(a.id)}),0==e.length&&e.push(-1),e}return[]},this.setDepartmentNames=function(t){_that[t+"Names"]=[],angular.forEach(_that[t],function(e){"undefined"!=typeof _that.userDepartmentsNames&&"undefined"!=typeof _that.userDepartmentsNames[e]?_that[t+"Names"].push(_that.userDepartmentsNames[e]):"undefined"!=typeof _that.userDepartmentsNames&&(_that[t].splice(_that[t].indexOf(e),1),_that.departmentChanged(t))})},this.departmentChanged=function(t){if(_that[t].length>0){_that[t+"_all_departments"]=!1,_that.allDepartmentsChanged(t,!1);var e=_that[t].join("/");""!=e&&(_that.storeLocalSetting(t,e),_that.setDepartmentNames(t))}else if(localStorage)try{localStorage.removeItem(t)}catch(a){}_that.isListLoaded=!1,$scope.loadChatList()},this.productChanged=function(t){if(_that[t].length>0){var e=_that[t].join("/");""!=e&&_that.storeLocalSetting(t,e)}else if(localStorage)try{localStorage.removeItem(t)}catch(a){}_that.isListLoaded=!1,$scope.loadChatList()},this.allDepartmentsChanged=function(t,e){1==_that[t+"_all_departments"]?_that.storeLocalSetting(t+"_all_departments",!0):_that.removeLocalSetting(t+"_all_departments"),1==_that[t+"_hide_hidden"]?_that.storeLocalSetting(t+"_hide_hidden",!0):_that.removeLocalSetting(t+"_hide_hidden"),1==_that[t+"_hide_disabled"]?_that.storeLocalSetting(t+"_hide_disabled",!0):_that.removeLocalSetting(t+"_hide_disabled"),1==_that[t+"_only_online"]?_that.storeLocalSetting(t+"_only_online",!0):_that.removeLocalSetting(t+"_only_online"),1==_that[t+"_all_departments"]?(_that[t]=[],angular.forEach(_that.userDepartments,function(e){(0==_that[t+"_only_explicit_online"]||1==_that[t+"_only_explicit_online"]&&1==e.oexp)&&(0==_that[t+"_hide_hidden"]||1==_that[t+"_hide_hidden"]&&0==e.hidden)&&(0==_that[t+"_hide_disabled"]||1==_that[t+"_hide_disabled"]&&0==e.disabled)&&(0==_that[t+"_only_online"]||1==_that[t+"_only_online"]&&1==e.ogen)&&_that[t].push(e.id)}),0==_that[t].length&&_that[t].push(-1)):1==e&&(_that[t]=[]),1==e&&(_that.isListLoaded=!1,$scope.loadChatList())},$scope.$watch("lhc.limitu",function(t,e){t!=e&&(_that.storeLocalSetting("limitu",t),$scope.loadChatList())}),$scope.$watch("lhc.limitc",function(t,e){t!=e&&(_that.storeLocalSetting("limitc",t),$scope.loadChatList())}),$scope.$watch("lhc.limitp",function(t,e){t!=e&&(_that.storeLocalSetting("limitp",t),$scope.loadChatList())}),$scope.$watch("lhc.limito",function(t,e){t!=e&&(_that.storeLocalSetting("limito",t),$scope.loadChatList())}),$scope.$watch("lhc.limitmc",function(t,e){t!=e&&(_that.storeLocalSetting("limitmc",t),$scope.loadChatList())}),$scope.$watch("lhc.limitd",function(t,e){t!=e&&(_that.storeLocalSetting("limitd",t),$scope.loadChatList())}),$scope.$watch("lhc.activeu",function(t,e){t!=e&&(_that.storeLocalSetting("activeu",t),_that.isListLoaded=!1,$scope.loadChatList())}),$scope.$watch("lhc.pendingu",function(t,e){t!=e&&(_that.storeLocalSetting("pendingu",t),_that.isListLoaded=!1,$scope.loadChatList())}),this.startChatBackground=function(t){return this.backgroundChats.indexOf(t)===-1&&(this.backgroundChats.push(t),this.startChatDashboard(t,{background:!0,unread:!0}),ee.emitEvent("chatStartBackground",[t]),!0)},$scope.startChatScope=function(t,e){_that.startChatDashboard(t,e)},$scope.hideMessagesNotifications=function(){angular.forEach(_that.notificationsArrayMessages,function(t,e){"undefined"!=typeof _that.notificationsArrayMessages[e]&&(window.webkitNotifications?_that.notificationsArrayMessages[e].cancel():_that.notificationsArrayMessages[e].close(),delete _that.notificationsArrayMessages[e])})},this.notificationsArrayMessages=[],this.notificationsArray=[],this.soundIsPlaying=!1,this.soundPlayedTimes=0,this.audio=new Audio,this.audio.autoplay="autoplay",this.playNewChatAudio=function(){if(clearTimeout(this.soundIsPlaying),this.soundPlayedTimes++,Modernizr.audio&&(this.audio.src=Modernizr.audio.ogg?WWW_DIR_JAVASCRIPT_FILES+"/new_chat.ogg":Modernizr.audio.mp3?WWW_DIR_JAVASCRIPT_FILES+"/new_chat.mp3":WWW_DIR_JAVASCRIPT_FILES+"/new_chat.wav",this.audio.load(),confLH.repeat_sound>this.soundPlayedTimes)){var t=this;this.soundIsPlaying=setTimeout(function(){t.playNewChatAudio()},1e3*confLH.repeat_sound_delay)}},this.isBlinking=!1,this.startBlinking=function(){if(0==this.isBlinking){var t=this,e=function(){var e,a=document.title,i="!!! "+document.title,n=function(){document.title=document.title==i?" ":i},o=function(){clearInterval(e),document.title=a,window.onmousemove=null,e=null,t.isBlinking=!1};return function(){e||(e=setInterval(n,1e3),window.onmousemove=o)}}();e(),this.isBlinking=!0}},this.playSoundNewAction=function(t,e,a,i,n){if(this.backgroundChats.indexOf(parseInt(e))==-1){if(1!=confLH.new_chat_sound_enabled||1!=confLH.sn_off&&"flash_on"!=$("#online-offline-user").text()||"pending_chat"!=t&&"transfer_chat"!=t&&"unread_chat"!=t&&"pending_transfered"!=t||(this.soundPlayedTimes=0,this.playNewChatAudio()),$("textarea[name=ChatMessage]").is(":focus")||1!=confLH.sn_off&&"flash_on"!=$("#online-offline-user").text()||"pending_chat"!=t&&"transfer_chat"!=t&&"unread_chat"!=t&&"pending_transfered"!=t||this.startBlinking(),("pending_chat"==t||"transfer_chat"==t||"unread_chat"==t||"pending_transfered"==t)&&(1==confLH.sn_off||"flash_on"==$("#online-offline-user").text())&&window.Notification&&"granted"==window.Notification.permission){var o=new Notification(a,{icon:WWW_DIR_JAVASCRIPT_FILES_NOTIFICATION+"/notification.png",body:i,requireInteraction:!0});o.onclick=function(){"pending_chat"==t||"unread_chat"==t||"pending_transfered"==t?$("#tabs").length>0?(window.focus(),_that.startChatDashboard(e)):_that.startChatNewWindow(e):_that.startChatNewWindowTransferByTransfer(e,n),o.close()},"pending_transfered"!=t&&("undefined"!==this.notificationsArray[e]&&o.close(),this.notificationsArray[e]=o)}"transfer_chat"==t&&1==confLH.show_alert_transfer&&confirm(confLH.transLation.transfered+"\n\n"+i)&&_that.startChatNewWindowTransferByTransfer(e,n),1==confLH.show_alert&&confirm(confLH.transLation.new_chat+"\n\n"+i)&&("pending_chat"==t||"unread_chat"==t||"pending_transfered"==t?$("#tabs").length>0?(window.focus(),_that.startChatDashboard(e)):_that.startChatNewWindow(e):_that.startChatNewWindowTransferByTransfer(e,n))}},$scope.loadChatList=function(){if(localStorage)try{$scope.pending_chats_expanded="false"!=localStorage.getItem("pending_chats_expanded"),$scope.active_chats_expanded="false"!=localStorage.getItem("active_chats_expanded"),$scope.my_active_chats_expanded="false"!=localStorage.getItem("my_active_chats_expanded"),$scope.closed_chats_expanded="false"!=localStorage.getItem("closed_chats_expanded"),$scope.unread_chats_expanded="false"!=localStorage.getItem("unread_chats_expanded"),$scope.my_chats_expanded="false"!=localStorage.getItem("my_chats_expanded"),$scope.custom_list_1_expanded="false"!=localStorage.getItem("custom_list_1_expanded"),$scope.custom_list_2_expanded="false"!=localStorage.getItem("custom_list_2_expanded"),$scope.custom_list_3_expanded="false"!=localStorage.getItem("custom_list_3_expanded"),$scope.custom_list_4_expanded="false"!=localStorage.getItem("custom_list_4_expanded")}catch(err){}return 1==_that.blockSync?(clearTimeout($scope.timeoutControl),void($scope.timeoutControl=setTimeout(function(){$scope.loadChatList()},confLH.back_office_sinterval))):(clearTimeout($scope.timeoutControl),void LiveHelperChatFactory.loadChatList($scope.getSyncFilter()).then(function(data){if(ee.emitEvent("eventLoadChatList",[data,$scope,_that]),"undefined"==typeof data.items_processed){var currentStatusNotifications=[],chatsToNotify=[],notificationsData=[],notificationDataAccept=[],tabs=$("#tabs");angular.forEach(data.result,function(t,e){if($scope[e]=t,tabs.length>0&&("pending_chat"!=e&&"my_chats"!=e||t.list.forEach(function(t){"undefined"!=typeof t.user_id&&t.user_id==confLH.user_id&&1==confLH.accept_chats&&1!==t.status&&_that.syncChatsOpen.indexOf(t.id)===-1&&(_that.startChatBackground(t.id),notificationDataAccept.push(t.id))})),t.last_id_identifier){chatsToNotify=[],currentStatusNotifications=[];var a=0,i=t.list;"pending_chat"==t.last_id_identifier&&"undefined"!=typeof _that.toggleWidgetData.pending_chats_sort&&1==_that.toggleWidgetData.pending_chats_sort&&(i=t.list.slice().reverse()),angular.forEach(i,function(e,i){var n="undefined"!=typeof e.user_id?e.user_id:0,o=e.id+"_"+n;
currentStatusNotifications.push(o),"undefined"==typeof _that.statusNotifications[t.last_id_identifier]&&(_that.statusNotifications[t.last_id_identifier]=new Array),1!=_that.isListLoaded||0!=a&&2!==e.status_sub_sub||!(_that.statusNotifications[t.last_id_identifier].indexOf(o)==-1&&0==n&&0==confLH.ownntfonly||_that.statusNotifications[t.last_id_identifier].indexOf(o)==-1&&n==confLH.user_id)?a++:lhinst.chatsSynchronising.indexOf(parseInt(e.id))===-1&&chatsToNotify.push(e.id)}),chatsToNotify.length>0&&(chatsToNotify.unshift(t.last_id_identifier),notificationsData.push(chatsToNotify.join("/"))),1==_that.isListLoaded&&_that.compareNotificationsAndHide(_that.statusNotifications[t.last_id_identifier],currentStatusNotifications),_that.statusNotifications[t.last_id_identifier]=currentStatusNotifications}}),notificationDataAccept.length>0&&(notificationDataAccept.unshift("active_chat"),LiveHelperChatFactory.getNotificationsData(notificationDataAccept.join("/")).then(function(t){angular.forEach(t,function(t,e){_that.backgroundChats.splice(_that.backgroundChats.indexOf(t.last_id),1),_that.playSoundNewAction(t.last_id_identifier,parseInt(t.last_id),t.nick?t.nick:"Live Help",t.msg?t.msg:confLH.transLation.new_chat,t.nt),_that.backgroundChats.push(t.last_id)})})),notificationsData.length>0&&LiveHelperChatFactory.getNotificationsData(notificationsData.join("/")).then(function(t){angular.forEach(t,function(t,e){_that.playSoundNewAction(t.last_id_identifier,parseInt(t.last_id),t.nick?t.nick:"Live Help",t.msg?t.msg:confLH.transLation.new_chat,t.nt)})})}"undefined"!=typeof data.ou&&eval(data.ou),"undefined"!=typeof data.fs&&data.fs.length>0&&angular.forEach(data.fs,function(t,e){_that.playSoundNewAction("pending_transfered",parseInt(t.id),t.nick?t.nick:"Live Help",confLH.transLation.transfered,t.nt,t.uid)}),_that.hideOnline=1==data.ho,_that.hideInvisible=1==data.im,_that.lhcVersion!=data.v&&(_that.lhcVersion=data.v,_that.lhcPendingRefresh=!0,_that.versionChanged()),1==$scope.setTimeoutEnabled&&($scope.timeoutControl=setTimeout(function(){$scope.loadChatList()},confLH.back_office_sinterval)),_that.startSyncChats(_that.isListLoaded),_that.isListLoaded=!0},function(t){console.log(t),$scope.timeoutControl=setTimeout(function(){$scope.loadChatList()},confLH.back_office_sinterval)}))},this.versionChanged=function(){var t=this;$interval(function(){t.lhcVersionCounter=t.lhcVersionCounter-1,0==t.lhcVersionCounter&&document.location.reload(!0)},1e3)},this.compareNotificationsAndHide=function(t,e){if("undefined"!=typeof t)for(var a=t.length-1;a>=0;a--){var i=t[a];-1===e.indexOf(i)&&lhinst.hideNotification(i.split("_")[0])}},this.previewChat=function(t){lhc.previewChat(t)},this.previewChatArchive=function(t,e){lhc.previewChatArchive(t,e)},this.redirectContact=function(t,e){return lhinst.redirectContact(t,e)},this.deleteChat=function(t,e,a){return lhinst.deleteChat(t,e,a)},this.startChatNewWindowTransfer=function(t,e,a){return LiveHelperChatFactory.acceptTransfer(a,!1).then(function(e){ee.emitEvent("operatorAcceptedTransfer",[t])}),this.startChatNewWindow(t,e)},this.startChatTransfer=function(t,e,a){LiveHelperChatFactory.acceptTransfer(a,!1).then(function(e){_that.startChatDashboard(t),ee.emitEvent("operatorAcceptedTransfer",[t])})},this.startChatNewWindowTransferByTransfer=function(t){LiveHelperChatFactory.acceptTransfer(t,!0).then(function(t){$("#tabs").length>0?_that.startChatDashboard(t.chat_id):_that.startChatNewWindow(t.chat_id),ee.emitEvent("operatorAcceptedTransfer",[t.chat_id])})},this.startChatOperator=function(t){LiveHelperChatFactory.getActiveOperatorChat(t).then(function(e){e.has_chat===!0?this.startChatDashboard(e.chat_id,{remember:!0}):lhc.revealModal({url:WWW_DIR_JAVASCRIPT+"chat/startchatwithoperator/"+t})})},this.addEvent=function(){var t=this;return document.addEventListener?function(e,a,i){if(e&&e.nodeName||e===window)e.addEventListener(a,i,!1);else if(e&&e.length)for(var n=0;n<e.length;n++)t.addEvent(e[n],a,i)}:function(e,a,i){if(e&&e.nodeName||e===window)e.attachEvent("on"+a,function(){return i.call(e,window.event)});else if(e&&e.length)for(var n=0;n<e.length;n++)t.addEvent(e[n],a,i)}}(),this.setupActivityMonitoring=function(){var t=this,e=function(){t.resetTimeoutActivity()};this.addEvent(window,"mousemove",e),this.addEvent(document,"mousemove",e),this.addEvent(window,"mousedown",e),this.addEvent(window,"click",e),this.addEvent(window,"scroll",e),this.addEvent(window,"keypress",e),this.addEvent(window,"load",e),this.addEvent(document,"scroll",e),this.addEvent(document,"touchstart",e),this.addEvent(document,"touchend",e),this.resetTimeoutActivity()},$scope.resetActivityFromChild=function(){_that.resetTimeoutActivity()},this.resetTimeoutActivity=function(){var t=window.opener;if(t)try{var e=t.angular.element("body").scope();e.resetActivityFromChild()}catch(a){console.log(a)}else if(0==this.blockSync){clearTimeout(this.timeoutActivity);var i=this;this.timeoutActivity=setTimeout(function(){i.blockSync=!0,lhinst.disableSync=!0,LiveHelperChatFactory.setInactive("true").then(function(t){lhc.revealModal({url:WWW_DIR_JAVASCRIPT+"user/wentinactive/false",hidecallback:function(){LiveHelperChatFactory.setInactive("false"),i.isListLoaded=!1,i.blockSync=!1,i.resetTimeoutActivity(),lhinst.disableSync=!1,$scope.loadChatList()}})})},1e3*i.timeoutActivityTime)}},this.getOpenedChatIds=function(){if(localStorage)try{var t=localStorage.getItem("achat_id");if(null!==t&&""!==t)return achat_id_array=t.split(",")}catch(e){}return[]},this.verifyFilters=function(){var t=[],e=[],a=[],i=[];angular.forEach(_that.userList,function(e){t.push(e.id)}),angular.forEach(_that.userGroups,function(t){e.push(t.id)}),angular.forEach(_that.userDepartmentsGroups,function(t){a.push(t.id)}),angular.forEach(_that.userProductNames,function(t){i.push(t.id)});var n={activeu:t,actived_products:i,actived_ugroups:e,actived_dpgroups:a,pendingu:t,pendingd_ugroups:e,pendingd_dpgroups:a,pendingd_products:i,departmentd_dpgroups:a,closedd_products:i,closedd_dpgroups:a,unreadd_dpgroups:a,unreadd_products:i,mcd_products:i,mcd_dpgroups:a};angular.forEach(n,function(t,e){angular.forEach(_that[e],function(a){t.indexOf(a)===-1&&(_that[e].splice(_that[e].indexOf(a),1),_that.productChanged(e))})})},this.truncateScope=function(t){return LiveHelperChatFactory.truncate(t,10)},this.initLHCData=function(){var t="",e=this.getOpenedChatIds();$("#tabs").length>0&&0==lhinst.disableremember&&e.length>0&&(t="/(chatopen)/"+e.join("/")),LiveHelperChatFactory.loadInitialData(t).then(function(t){_that.userDepartmentsNames=t.dp_names,_that.userDepartments=t.dep_list,_that.userProductNames=t.pr_names,_that.userDepartmentsGroups=t.dp_groups,_that.userGroups=t.user_groups,_that.userList=t.user_list,_that.hideInvisible=t.im,_that.hideOnline=t.ho,_that.lhcVersion=t.v,_that.additionalColumns=t.col,angular.forEach(_that.widgetsItems,function(t){_that.setDepartmentNames(t)}),1==t.track_activity&&(_that.timeoutActivityTime=t.timeout_activity,_that.setupActivityMonitoring()),angular.forEach(t.cdel,function(t){_that.forgetChat(t)}),ee.emitEvent("eventLoadInitialData",[t,$scope,_that]),_that.verifyFilters(),$scope.loadChatList()})},this.initLHCData(),this.syncChats=[],this.syncChatsMsg=[],this.syncChatsOpen=[],this.backgroundChats=[],this.current_chat_id=0,this.underMessageAdd=!1,this.syncroRequestSend=!1,this.hideNotification=function(t){"undefined"!=typeof this.notificationsArray[t]&&this.backgroundChats.indexOf(t)==-1&&(this.notificationsArray[t].close(),delete this.notificationsArray[t]),clearTimeout(this.soundIsPlaying)},this.removeBackgroundChat=function(t){var e=this.backgroundChats.indexOf(t);e!==-1&&this.backgroundChats.splice(e,1)},$scope.removeOpenedChat=function(t){0!=$("#CSChatMessage-"+t).length&&($("#CSChatMessage-"+t).unbind("keydown",function(){}),$("#CSChatMessage-"+t).unbind("keyup",function(){}));var e=_that.syncChatsOpen.indexOf(t);e!==-1&&_that.syncChatsOpen.splice(e,1);var e=_that.syncChats.indexOf(t);e!==-1&&(_that.syncChats.splice(e,1),_that.syncChatsMsg.splice(e,1),ee.emitEvent("removeSynchroChat",[t])),(t=_that.current_chat_id)&&(_that.current_chat_id=0,_that.syncChats.length>0&&_that.startChatDashboard(_that.syncChats[0])),_that.deleteMetaData(t)},this.forgetChat=function(t){if(localStorage)try{t=parseInt(t);var e=localStorage.getItem("achat_id"),a=new Array;null!==e&&(a=e.split(",").map(Number)),a.indexOf(t)!==-1&&a.splice(a.indexOf(t),1),localStorage.setItem("achat_id",a.join(","))}catch(i){console.log(i)}},this.rememberTab=function(t){if(localStorage)try{t=parseInt(t);var e=localStorage.getItem("achat_id"),a=new Array;if(null!==e)var a=e.split(",").map(Number);a.indexOf(t)===-1&&a.push(t),localStorage.setItem("achat_id",a.join(","))}catch(i){console.log(i)}},this.startChat=function(t,e){return $("#tabs").length>0?void this.startChatDashboard(t,{remember:!0}):void this.startChatNewWindow(t,e)},this.startChatNewWindow=function(t,e){window.open(WWW_DIR_JAVASCRIPT+"chat/single/"+t,"chatwindow-chat-id","menubar=1,resizable=1,width=800,height=650").focus();setTimeout(function(){$scope.loadChatList()},1e3),ee.emitEvent("chatStartOpenWindow",[t])},this.closeExternalChat=function(t){_that.forgetChat(t.id),$scope.removeOpenedChat(t.id),$scope.loadChatList()},$scope.debugLists=function(){console.log(localStorage.getItem("achat_id")),console.log(_that.syncChatsOpen),console.log(_that.syncChats),console.log(_that.syncChatsMsg),console.log(_that.chatMetaData)},this.weekDays={1:"Mon",2:"Tue",3:"Wed",4:"Thur",5:"Fri",6:"Sat",7:"Sun"},this.getCreateTime=function(t){return 1==t.f?this.weekDays[t.v]:t.v},this.currentPanel="dashboard",this.startChatDashboard=function(t,e){if(t=parseInt(t),"undefined"==typeof e)var e={};"undefined"!=typeof e.remember&&1==e.remember&&this.syncChats.indexOf(t)===-1&&this.rememberTab(t),"undefined"!=typeof e.reload&&1==e.reload&&(this.forgetChat(t),$scope.removeOpenedChat(t));var a="";"undefined"==typeof e.background||e.background===!1?(this.removeBackgroundChat(t),this.hideNotification(t),this.current_chat_id=t,this.currentPanel=null,this.setMetaData(t,"mn",0),$('#tabs a[href="#chatdashboard"]').tab("show")):"undefined"!=typeof e.background&&e.background===!0&&(a="/(arg)/background"),"undefined"!=typeof e.unread&&e.unread===!0&&this.setMetaData(t,"mn",1),this.syncChatsOpen.indexOf(t)===-1?(this.syncChatsOpen.push(t),LiveHelperChatFactory.loadChat(t+a).then(function(a){var i=$compile(a)($scope);$("#chat-content-"+t).html(i),"undefined"!=typeof e.background&&e.background!==!1||setTimeout(function(){$("#CSChatMessage-"+t).focus()},2),lhinst.addQuateHandler(t),lhinst.loadMainData(t),ee.emitEvent("chatTabLoaded",[t])}),$scope.loadChatList()):"undefined"!=typeof e.background&&e.background!==!1||(setTimeout(function(){$("#CSChatMessage-"+t).focus()},2),setTimeout(function(){$("#messagesBlock-"+t).stop(!0,!1).animate({scrollTop:$("#messagesBlock-"+t).prop("scrollHeight")},5),ee.emitEvent("chatTabClicked",[t])},500)),"undefined"!=typeof e.background&&e.background!==!1||ee.emitEvent("chatStartTab",[t]),this.syncChatsProcess()},this.toHex=function(t){var e=0;if(0===t.length)return e;for(var a=0;a<t.length;a++)e=t.charCodeAt(a)+((e<<5)-e),e&=e;for(var i="#",a=0;a<3;a++){var n=e>>8*a&255;i+=("00"+n.toString(16)).substr(-2)}return i},this.startSyncChats=function(t){var e=[];angular.forEach(["my_open_chats","my_chats"],function(t){"undefined"!=typeof $scope[t]&&Array.isArray($scope[t].list)&&angular.forEach($scope[t].list,function(t,a){if(_that.syncChats.indexOf(t.id)===-1){_that.syncChats.push(t.id),_that.syncChatsMsg.push(t.id+","+t.last_msg_id);var i=t.nick.split(" ");1==i.length?_that.setMetaData(t.id,"ctit",i[0].substr(0,2).toUpperCase()):_that.setMetaData(t.id,"ctit",i[0].substr(0,1).toUpperCase()+i[1].substr(0,1).toUpperCase()),_that.setMetaData(t.id,"cbg",_that.toHex(("undefined"!=typeof t.online_user_id?t.online_user_id:"")+t.nick))}e.push(t.id)})}),angular.forEach(_that.syncChats,function(t,a){e.indexOf(t)===-1&&(_that.forgetChat(t),$scope.removeOpenedChat(t))}),angular.forEach(_that.chatMetaData,function(t,e){_that.syncChats.indexOf(parseInt(e))===-1&&delete _that.chatMetaData[e]}),t===!1&&(angular.forEach(this.syncChats,function(t){ee.emitEvent("chatTabMonitor",[t])}),this.syncChatsProcess())},this.setImage=function(t){setTimeout(function(){var e=document.getElementById("chat-icon-img-"+t.id);null!==e&&$(e).attr("data-jdenticon-value",_that.getIcon(t)).jdenticon()},500)},this.syncChatsProcess=function(){this.loadChatMessages(),clearTimeout($scope.timeoutControlSync),$scope.timeoutControlSync=setTimeout(function(){_that.loadChatMessages()},confLH.chat_message_sinterval)},this.chatMetaData={},this.setMetaData=function(t,e,a){"undefined"==typeof this.chatMetaData[t]&&(this.chatMetaData[t]={}),"undefined"==typeof this.chatMetaData[t][e]?this.chatMetaData[t][e]=a:this.chatMetaData[t][e]=a},this.getIcon=function(t){var e=("undefined"!=typeof t.online_user_id?t.online_user_id:"")+t.nick;return e},this.getMetaData=function(t,e){return"undefined"!=typeof this.chatMetaData[t]&&("undefined"!=typeof this.chatMetaData[t][e]&&this.chatMetaData[t][e])},this.deleteMetaData=function(t){"undefined"!=typeof this.chatMetaData[t]&&delete this.chatMetaData[t]},this.playNewMessageSound=function(){Modernizr.audio&&(this.audio.src=Modernizr.audio.ogg?WWW_DIR_JAVASCRIPT_FILES+"/new_message.ogg":Modernizr.audio.mp3?WWW_DIR_JAVASCRIPT_FILES+"/new_message.mp3":WWW_DIR_JAVASCRIPT_FILES+"/new_message.wav",this.audio.load()),$("textarea[name=ChatMessage]").is(":focus")||this.startBlinking()},this.notificationsArrayMessages=[],this.showNewMessageNotification=function(t,e,a){try{if(window.Notification&&0==focused&&"granted"==window.Notification.permission){"undefined"!=typeof this.notificationsArrayMessages[t]&&(this.notificationsArrayMessages[t].close(),delete this.notificationsArrayMessages[t]);var i=new Notification(a,{icon:WWW_DIR_JAVASCRIPT_FILES_NOTIFICATION+"/notification.png",body:e}),n=this;i.onclick=function(){window.focus(),i.close(),delete n.notificationsArrayMessages[t]},i.onclose=function(){"undefined"!=typeof n.notificationsArrayMessages[t]&&delete n.notificationsArrayMessages[t]},this.notificationsArrayMessages[t]=i,this.scheduleNewMessageClose(i,t)}}catch(o){console.log(o)}},this.scheduleNewMessageClose=function(t,e){var a=this;setTimeout(function(){window.webkitNotifications?t.cancel():t.close(),"undefined"!=typeof a.notificationsArrayMessages[e]&&delete a.notificationsArrayMessages[e]},1e4)},$scope.loadchatMessagesScope=function(){_that.loadChatMessages()},this.loadChatMessages=function(){if(this.syncChats.length>0&&0==this.underMessageAdd&&0==this.syncroRequestSend){this.syncroRequestSend=!0,clearTimeout($scope.timeoutControlSync);var paramsCall=[];angular.forEach(this.syncChats,function(t,e){paramsCall.push(_that.syncChatsMsg[e]+","+(_that.syncChatsOpen.indexOf(t)!==-1?"1":"0"))}),$.postJSON(WWW_DIR_JAVASCRIPT+"/chat/syncadmin",{"chats[]":paramsCall},function(data){"undefined"!=typeof data.error_url&&document.location.replace(data.error_url);try{if("false"==data.error){if("false"!=data.result){var playSound=!1;$.each(data.result,function(t,e){var a=$("#messagesBlock-"+e.chat_id),i=a.prop("scrollHeight"),n=Math.abs(i-a.prop("scrollTop")-a.prop("clientHeight"));if(a.find(".pending-storage").remove(),a.append(e.content),lhinst.addQuateHandler(e.chat_id),n<20&&a.stop(!0,!1).animate({scrollTop:i},500),_that.updateChatLastMessageID(parseInt(e.chat_id),parseInt(e.message_id)),_that.current_chat_id!=e.chat_id){var o=_that.getMetaData(e.chat_id,"mn");_that.setMetaData(e.chat_id,"mn",o!==!1?o+e.mn:e.mn)}else _that.setMetaData(e.chat_id,"mn",0);0!=playSound||"false"!=data.uw||"undefined"!=typeof e.ignore&&typeof e.ignore!==!1||(playSound=!0),1!=confLH.new_message_browser_notification||"false"!=data.uw||"undefined"!=typeof e.ignore&&typeof e.ignore!==!1||_that.showNewMessageNotification(e.chat_id,e.msg,e.nck),e.msfrom>0&&$("#msg-"+e.msfrom).attr("data-op-id")!=e.msop&&$("#msg-"+e.msfrom).next().addClass("operator-changes"),ee.emitEvent("eventSyncAdmin",[e,t])}),1==confLH.new_message_sound_admin_enabled&&"false"==data.uw&&1==playSound&&_that.playNewMessageSound()}"false"!=data.result_status&&$.each(data.result_status,function(i,item){if(_that.setMetaData(item.chat_id,"ucs",item.us),""!==item.lmsgtxt&&_that.setMetaData(item.chat_id,"lmsg",item.lmsgtxt),_that.setMetaData(item.chat_id,"um",item.um),_that.syncChatsOpen.indexOf(item.chat_id)!==-1){"true"==item.tp?$("#user-is-typing-"+item.chat_id).html(item.tx).css("visibility","visible"):$("#user-is-typing-"+item.chat_id).css("visibility","hidden"),$("#chat-duration-"+item.chat_id).text(item.cdur),$("#last-msg-chat-"+item.chat_id).text(item.lmsg);var statusel=$("#chat-id-"+item.chat_id+"-mds");statusel.attr("data-chat-status")==item.cs&&statusel.attr("data-chat-user")==item.co||lhinst.updateVoteStatus(item.chat_id),1==item.um?(statusel.removeClass("chat-active"),statusel.addClass("chat-unread")):(statusel.removeClass("chat-unread"),statusel.addClass("chat-active")),item.lp!==!1?statusel.attr("title",item.lp+" s."):statusel.attr("title",""),"undefined"!=typeof item.oad&&eval(item.oad)}})}}catch(err){console.log(err)}_that.syncroRequestSend=!1,clearTimeout($scope.timeoutControlSync),$scope.timeoutControlSync=setTimeout(function(){_that.loadChatMessages()},confLH.chat_message_sinterval)})}},this.updateChatLastMessageID=function(t,e){this.syncChatsMsg[this.syncChats.indexOf(t)]=t+","+e},this.playPreloadSound=function(){Modernizr.audio&&(this.audio.src=Modernizr.audio.ogg?WWW_DIR_JAVASCRIPT_FILES+"/silence.ogg":Modernizr.audio.mp3?WWW_DIR_JAVASCRIPT_FILES+"/silence.mp3":WWW_DIR_JAVASCRIPT_FILES+"/silence.wav",this.audio.load())},jQuery(document).on("click",preloadSound),jQuery(document).on("touchstart",preloadSound),preloadSound()}]);